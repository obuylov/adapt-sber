function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _readOnlyError(name){throw new Error("\""+name+"\" is read-only")}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _newArrowCheck(innerThis,boundThis){if(innerThis!==boundThis){throw new TypeError("Cannot instantiate an arrow function")}}define("core/js/wait",[],function(){var Wait=Backbone.Controller.extend({initialize:function initialize(){_.bindAll(this,"begin","end")},_waitCount:0,_callbackHandle:null,_timeoutHandlerId:null,_timeoutInSeconds:7,isWaiting:function isWaiting(){return this._waitCount!==0},startTimer:function startTimer(){this.stopTimer();this._timeoutHandlerId=setInterval(function(){while(this._waitCount>0){this.end()}if(this._waitCount===0){this.stopTimer()}}.bind(this),this._timeoutInSeconds*1000)},stopTimer:function stopTimer(){if(this._timeoutHandlerId){clearInterval(this._timeoutHandlerId)}},begin:function begin(){if(!this.isWaiting()){this.trigger("wait")}this._waitCount++;if(this._callbackHandle){clearTimeout(this._callbackHandle);this._callbackHandle=null}this.startTimer();return this},end:function end(){if(!this.isWaiting()){return this}this._waitCount--;if(this._waitCount===0){this.stopTimer()}if(this.isWaiting()){return this}if(this._callbackHandle){return this}this._callbackHandle=setTimeout(function(){this._callbackHandle=null;this.trigger("ready")}.bind(this),0);return this},queue:function queue(callback){var _this2=this;if(!callback){this.begin();return new Promise(function(resolve){_newArrowCheck(this,_this2);this.once("ready",resolve);this.end()}.bind(this))}this.begin();this.once("ready",callback);this.end();return this},for:function _for(callback){this.begin();_.defer(function(){callback(_.once(this.end))}.bind(this));return this}});return Wait});define("core/js/models/lockingModel",[],function(){var _set=Backbone.Model.prototype.set;Object.assign(Backbone.Model.prototype,{set:function set(attrName,attrVal){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var stopProcessing=_typeof(attrName)==="object"||typeof attrVal!=="boolean"||!this.isLocking(attrName);if(stopProcessing)return _set.apply(this,arguments);var isSettingValueForSpecificPlugin=options&&options.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to change a locked attribute");options.pluginName="compatibility"}var pluginName=options.pluginName;if(this.defaults[attrName]!==undefined){this._lockedAttributes[attrName]=!this.defaults[attrName]}var lockingValue=this._lockedAttributes[attrName];var isAttemptingToLock=lockingValue===attrVal;if(isAttemptingToLock){this.setLockState(attrName,true,{pluginName:pluginName,skipcheck:true});return _set.call(this,attrName,lockingValue)}this.setLockState(attrName,false,{pluginName:pluginName,skipcheck:true});var totalLockValue=this.getLockCount(attrName,{skipcheck:true});if(totalLockValue===0){return _set.call(this,attrName,!lockingValue)}return this},setLocking:function setLocking(attrName,defaultLockValue){if(this.isLocking(attrName))return;if(!this._lockedAttributes)this._lockedAttributes={};this._lockedAttributes[attrName]=defaultLockValue},unsetLocking:function unsetLocking(attrName){if(!this.isLocking(attrName))return;if(!this._lockedAttributes)return;delete this._lockedAttributes[attrName];delete this._lockedAttributesValues[attrName];if(Object.keys(this._lockedAttributes).length===0){delete this._lockedAttributes;delete this._lockedAttributesValues}},isLocking:function isLocking(attrName){var isCheckingGeneralLockingState=attrName===undefined;var isUsingLockedAttributes=Boolean(this.lockedAttributes||this._lockedAttributes);if(isCheckingGeneralLockingState){return isUsingLockedAttributes}if(!isUsingLockedAttributes)return false;if(!this._lockedAttributes){this._lockedAttributes=_.result(this,"lockedAttributes")}var isAttributeALockingAttribute=this._lockedAttributes.hasOwnProperty(attrName);if(!isAttributeALockingAttribute)return false;if(!this._lockedAttributesValues){this._lockedAttributesValues={}}if(!this._lockedAttributesValues[attrName]){this._lockedAttributesValues[attrName]={}}return true},isLocked:function isLocked(attrName,options){var shouldSkipCheck=options&&options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}return this.getLockCount(attrName)>0},getLockCount:function getLockCount(attrName,options){var _this3=this;var shouldSkipCheck=options&&options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}var isGettingValueForSpecificPlugin=options&&options.pluginName;if(isGettingValueForSpecificPlugin){return this._lockedAttributesValues[attrName][options.pluginName]?1:0}var lockingAttributeValues=Object.values(this._lockedAttributesValues[attrName]);var lockingAttributeValuesSum=lockingAttributeValues.reduce(function(sum,value){_newArrowCheck(this,_this3);return sum+(value?1:0)}.bind(this),0);return lockingAttributeValuesSum},setLockState:function setLockState(attrName,value,options){var shouldSkipCheck=options&&options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return this}var isSettingValueForSpecificPlugin=options&&options.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to set a locked attribute lock value");options.pluginName="compatibility"}if(value){this._lockedAttributesValues[attrName][options.pluginName]=value}else{delete this._lockedAttributesValues[attrName][options.pluginName]}return this}})});define("core/js/adapt",["core/js/wait","core/js/models/lockingModel"],function(Wait){var Adapt=function(_Backbone$Model){"use strict";_inherits(Adapt,_Backbone$Model);var _super=_createSuper(Adapt);function Adapt(){_classCallCheck(this,Adapt);return _super.apply(this,arguments)}_createClass(Adapt,[{key:"initialize",value:function initialize(){this.loadScript=window.__loadScript;this.location={};this.store={};this.setupWait()}},{key:"defaults",value:function defaults(){return{_canScroll:true,_outstandingCompletionChecks:0,_pluginWaitCount:0,_isStarted:false,_shouldDestroyContentObjects:true}}},{key:"lockedAttributes",value:function lockedAttributes(){return{_canScroll:false}}},{key:"init",value:function init(){var _this4=this;this.addDirection();this.disableAnimation();this.trigger("adapt:preInitialize");this.deferUntilCompletionChecked(function(){_newArrowCheck(this,_this4);this.trigger("adapt:start");if(!Backbone.History.started){Backbone.history.start()}this.set("_isStarted",true);this.trigger("adapt:initialize")}.bind(this))}},{key:"checkingCompletion",value:function checkingCompletion(){var outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",outstandingChecks+1)}},{key:"checkedCompletion",value:function checkedCompletion(){var outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",outstandingChecks-1)}},{key:"deferUntilCompletionChecked",value:function deferUntilCompletionChecked(callback){var _this5=this;if(this.get("_outstandingCompletionChecks")===0)return callback();var _checkIfAnyChecksOutstanding=function checkIfAnyChecksOutstanding(model,outstandingChecks){_newArrowCheck(this,_this5);if(outstandingChecks!==0)return;this.off("change:_outstandingCompletionChecks",_checkIfAnyChecksOutstanding);callback()}.bind(this);this.on("change:_outstandingCompletionChecks",_checkIfAnyChecksOutstanding)}},{key:"setupWait",value:function setupWait(){var _this6=this;this.wait=new Wait;var beginWait=function beginWait(){_newArrowCheck(this,_this6);this.log.deprecated("Use Adapt.wait.begin() as Adapt.trigger('plugin:beginWait') may be removed in the future");this.wait.begin()}.bind(this);var endWait=function endWait(){_newArrowCheck(this,_this6);this.log.deprecated("Use Adapt.wait.end() as Adapt.trigger('plugin:endWait') may be removed in the future");this.wait.end()}.bind(this);var ready=function ready(){_newArrowCheck(this,_this6);if(this.wait.isWaiting()){return}var isEventListening=this._events["plugins:ready"];if(!isEventListening){return}this.log.deprecated("Use Adapt.wait.queue(callback) as Adapt.on('plugins:ready', callback) may be removed in the future");this.trigger("plugins:ready")}.bind(this);this.listenTo(this.wait,"ready",ready);this.listenTo(this,{"plugin:beginWait":beginWait,"plugin:endWait":endWait})}},{key:"isWaitingForPlugins",value:function isWaitingForPlugins(){this.log.deprecated("Use Adapt.wait.isWaiting() as Adapt.isWaitingForPlugins() may be removed in the future");return this.wait.isWaiting()}},{key:"checkPluginsReady",value:function checkPluginsReady(){this.log.deprecated("Use Adapt.wait.isWaiting() as Adapt.checkPluginsReady() may be removed in the future");if(this.isWaitingForPlugins()){return}this.trigger("plugins:ready")}},{key:"navigateToElement",value:function navigateToElement(){}},{key:"scrollTo",value:function scrollTo(){}},{key:"register",value:function register(name,object){var _this7=this;if(Array.isArray(name)){name.forEach(function(name){_newArrowCheck(this,_this7);return this.register(name,object)}.bind(this));return object}if(name.split(" ").length>1){this.register(name.split(" "),object);return object}if(!object.view&&!object.model||object instanceof Backbone.View){this.log&&this.log.deprecated("View-only registrations are no longer supported");object={view:object}}if(object.view&&!object.view.template){object.view.template=name}var isModelSetAndInvalid=object.model&&!(object.model.prototype instanceof Backbone.Model)&&!(object.model instanceof Function);if(isModelSetAndInvalid){throw new Error("The registered model is not a Backbone.Model or Function")}var isViewSetAndInvalid=object.view&&!(object.view.prototype instanceof Backbone.View)&&!(object.view instanceof Function);if(isViewSetAndInvalid){throw new Error("The registered view is not a Backbone.View or Function")}this.store[name]=Object.assign({},this.store[name],object);return object}},{key:"getViewName",value:function getViewName(nameModelViewOrData){var _this8=this;if(typeof nameModelViewOrData==="string"){return nameModelViewOrData}if(nameModelViewOrData instanceof Backbone.Model){nameModelViewOrData=nameModelViewOrData.toJSON()}if(nameModelViewOrData instanceof Backbone.View){var foundName;_.find(this.store,function(entry,name){_newArrowCheck(this,_this8);if(!entry||!entry.view)return;if(!(nameModelViewOrData instanceof entry.view))return;foundName=name;return true}.bind(this));return foundName}if(nameModelViewOrData instanceof Object){var names=[typeof nameModelViewOrData._view==="string"&&nameModelViewOrData._view,typeof nameModelViewOrData._component==="string"&&nameModelViewOrData._component,typeof nameModelViewOrData._type==="string"&&nameModelViewOrData._type].filter(Boolean);if(names.length){var name=names.find(function(name){_newArrowCheck(this,_this8);return this.store[name]&&this.store[name].view}.bind(this));return name||names.pop()}}throw new Error("Cannot derive view class name from input")}},{key:"getViewClass",value:function getViewClass(nameModelViewOrData){var name=this.getViewName(nameModelViewOrData);var object=this.store[name];if(!object){this.log.warnOnce("A view for '".concat(name,"' isn't registered in your project"));return}var isBackboneView=object.view&&object.view.prototype instanceof Backbone.View;if(!isBackboneView&&object.view instanceof Function){return object.view()}return object.view}},{key:"getModelName",value:function getModelName(nameModelOrData){var _this9=this;if(typeof nameModelOrData==="string"){return nameModelOrData}if(nameModelOrData instanceof Backbone.Model){nameModelOrData=nameModelOrData.toJSON()}if(nameModelOrData instanceof Object){var names=[typeof nameModelOrData._model==="string"&&nameModelOrData._model,typeof nameModelOrData._component==="string"&&nameModelOrData._component,typeof nameModelOrData._type==="string"&&nameModelOrData._type].filter(Boolean);if(names.length){var name=names.find(function(name){_newArrowCheck(this,_this9);return this.store[name]&&this.store[name].model}.bind(this));return name||names.pop()}}throw new Error("Cannot derive model class name from input")}},{key:"getModelClass",value:function getModelClass(nameModelOrData){var name=this.getModelName(nameModelOrData);var object=this.store[name];if(!object){this.log.warnOnce("A model for '".concat(name,"' isn't registered in your project"));return}var isBackboneModel=object.model&&object.model.prototype instanceof Backbone.Model;if(!isBackboneModel&&object.model instanceof Function){return object.model()}return object.model}},{key:"mapById",value:function mapById(id){return this.data.mapById(id)}},{key:"findById",value:function findById(id){return this.data.findById(id)}},{key:"findViewByModelId",value:function findViewByModelId(id){var _this10=this;var model=this.data.findById(id);if(!model)return;if(model===this.parentView.model)return this.parentView;var idPathToView=[id];var currentLocationId=this.location._currentId;var currentLocationModel=model.getAncestorModels().find(function(model){_newArrowCheck(this,_this10);var modelId=model.get("_id");if(modelId===currentLocationId)return true;idPathToView.unshift(modelId)}.bind(this));if(!currentLocationModel){return console.warn("Adapt.findViewByModelId() unable to find view for model id: ".concat(id))}var foundView=idPathToView.reduce(function(view,currentId){_newArrowCheck(this,_this10);return view&&view.childViews&&view.childViews[currentId]}.bind(this),this.parentView);return foundView}},{key:"parseRelativeString",value:function parseRelativeString(relativeString){var splitIndex=relativeString.search(/[ +\-\d]{1}/);var type=relativeString.slice(0,splitIndex).replace(/^@/,"");var offset=parseInt(relativeString.slice(splitIndex).trim()||0);return{type:type,offset:offset}}},{key:"addDirection",value:function addDirection(){var defaultDirection=this.config.get("_defaultDirection");$("html").addClass("dir-"+defaultDirection).attr("dir",defaultDirection)}},{key:"disableAnimation",value:function disableAnimation(){var disableAnimationArray=this.config.get("_disableAnimationFor");var disableAnimation=this.config.get("_disableAnimation");if(disableAnimationArray){for(var _i=0,l=disableAnimationArray.length;_i<l;_i++){if(!$("html").is(disableAnimationArray[_i]))continue;this.config.set("_disableAnimation",true);$("html").addClass("disable-animation");console.log("Animation disabled.")}return}$("html").toggleClass("disable-animation",disableAnimation===true)}},{key:"remove",value:function(){var _remove=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var currentView;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:currentView=this.parentView;if(currentView){currentView.model.setOnChildren("_isReady",false);currentView.model.set("_isReady",false)}this.trigger("preRemove",currentView);_context.next=5;return this.wait.queue();case 5:if(currentView&&this.get("_shouldDestroyContentObjects")){currentView.destroy()}this.trigger("remove",currentView);_.defer(this.trigger.bind(this),"postRemove",currentView);case 8:case"end":return _context.stop();}}},_callee,this)}));function remove(){return _remove.apply(this,arguments)}return remove}()},{key:"componentStore",get:function get(){this.log&&this.log.deprecated("Adapt.componentStore, please use Adapt.store instead");return this.store}}]);return Adapt}(Backbone.Model);return new Adapt});define("core/js/templateRenderEvent",[],function(){var TemplateRenderEvent=function(_Backbone$Controller){"use strict";_inherits(TemplateRenderEvent,_Backbone$Controller);var _super2=_createSuper(TemplateRenderEvent);function TemplateRenderEvent(){_classCallCheck(this,TemplateRenderEvent);return _super2.apply(this,arguments)}_createClass(TemplateRenderEvent,[{key:"initialize",value:function initialize(type,name,mode,value,args){this.type=type;this.name=name;this.mode=mode;this.value=value;this.args=args}}]);return TemplateRenderEvent}(Backbone.Controller);return TemplateRenderEvent});define("core/js/templates",["core/js/adapt","handlebars","./templateRenderEvent"],function(Adapt,Handlebars,TemplateRenderEvent){function onRender(cb){var _this11=this;var intercept=function intercept(object,name,mode,cb){_newArrowCheck(this,_this11);return object[name]=cb.bind(object,object[name],name,mode)}.bind(this);Object.keys(Handlebars.templates).forEach(function(name){_newArrowCheck(this,_this11);intercept(Handlebars.templates,name,"template",cb)}.bind(this));Object.keys(Handlebars.partials).forEach(function(name){_newArrowCheck(this,_this11);intercept(Handlebars.partials,name,"partial",cb)}.bind(this))}onRender(function(template,name,mode){for(var _len=arguments.length,args=new Array(_len>3?_len-3:0),_key=3;_key<_len;_key++){args[_key-3]=arguments[_key]}var preRenderEvent=new TemplateRenderEvent("".concat(mode,":preRender"),name,mode,null,args);Adapt.trigger(preRenderEvent.type,preRenderEvent);var value=template.apply(void 0,_toConsumableArray(preRenderEvent.args));var postRenderEvent=new TemplateRenderEvent("".concat(mode,":postRender"),name,mode,value,preRenderEvent.args);Adapt.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value})});define("core/js/fixes/img.lazyload",["core/js/adapt","../templates"],function(Adapt){Adapt.on("app:dataReady",function(){var config=Adapt.config.get("_fixes");if(config&&config._imgLazyLoad===false)return;applyImgLoadingFix()});function applyImgLoadingFix(){var findImgTag=/<img([^>]*)>/gi;var hasLoadingAttr=/ loading=/gi;Adapt.on("template:postRender partial:postRender",function(event){var _this12=this;var imgTagsFound=event.value.match(findImgTag);if(!imgTagsFound){return}event.value=imgTagsFound.reduce(function(value,img){_newArrowCheck(this,_this12);if(hasLoadingAttr.test(img)){return value}return value.replace(img,img.replace(findImgTag,"<img loading=\"eager\"$1>"))}.bind(this),event.value)})}});define("core/js/fixes",["./fixes/img.lazyload"],function(){});define("core/js/a11y/browserFocus",["core/js/adapt"],function(Adapt){var BrowserFocus=Backbone.Controller.extend({initialize:function initialize(){_.bindAll(this,"_onBlur","_onClick");this.$body=$("body");this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})},_attachEventListeners:function _attachEventListeners(){this.$body.on("blur","*",this._onBlur).on("blur",this._onBlur);this.$body[0].addEventListener("click",this._onClick,true)},_onBlur:function _onBlur(event){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isFocusNextOnDisabled){return}var $element=$(event.target);if($element.is("[data-a11y-force-focus]")){_.defer(function(){$element.removeAttr("tabindex data-a11y-force-focus")})}if(event.target!==event.currentTarget){return}if(!$element.is("[disabled]")){return}Adapt.a11y.focusNext($element)},_onClick:function _onClick(event){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isFocusOnClickEnabled){return}var $element=$(event.target);var $stack=$().add($element).add($element.parents());var $focusable=$stack.filter(config._options._tabbableElements);if(!$focusable.length){return}$focusable[0].focus()}});return BrowserFocus});define("core/js/a11y/focusOptions",[],function(){var FocusOptions=function FocusOptions(options){_.defaults(this,options,{preventScroll:true,defer:false})};return FocusOptions});define("core/js/a11y/keyboardFocusOutline",["core/js/adapt"],function(Adapt){var KeyboardFocusOutline=Backbone.Controller.extend({initialize:function initialize(){_.bindAll(this,"_onKeyDown");this.$html=$("html");this.showOnKeys={9:true,13:true,32:true,37:true,38:true,39:true,40:true};this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})},_attachEventListeners:function _attachEventListeners(){document.addEventListener("keydown",this._onKeyDown);this._start()},_start:function _start(){var config=Adapt.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled){return}this.$html.addClass("a11y-disable-focusoutline")},_onKeyDown:function _onKeyDown(event){var config=Adapt.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled||!this.showOnKeys[event.keyCode]){return}var $element=$(event.target);if(!$element.is(config._options._tabbableElements)||$element.is(config._options._focusOutlineKeyboardOnlyIgnore)){return}this.$html.removeClass("a11y-disable-focusoutline")}});return KeyboardFocusOutline});define("core/js/a11y/log",["core/js/adapt"],function(Adapt){var Log=function(_Backbone$Controller2){"use strict";_inherits(Log,_Backbone$Controller2);var _super3=_createSuper(Log);function Log(){_classCallCheck(this,Log);return _super3.apply(this,arguments)}_createClass(Log,[{key:"initialize",value:function initialize(){this._warned={}}},{key:"_hasWarned",value:function _hasWarned(args){var config=Adapt.a11y.config;if(!config._options._warnFirstOnly){return false}var hash=args.map(String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false}},{key:"_canWarn",value:function _canWarn(){var config=Adapt.a11y.config;return Boolean(config._options._warn)}},{key:"removed",value:function removed(){var _Adapt$log;for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}if(!this._canWarn){return}args=["A11Y"].concat(args);if(this._hasWarned(args)){return}(_Adapt$log=Adapt.log).removed.apply(_Adapt$log,_toConsumableArray(args));return this}},{key:"deprecated",value:function deprecated(){var _Adapt$log2;for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}if(!this._canWarn){return}args=["A11Y"].concat(args);if(this._hasWarned(args)){return}(_Adapt$log2=Adapt.log).deprecated.apply(_Adapt$log2,_toConsumableArray(args));return this}}]);return Log}(Backbone.Controller);return Log});define("core/js/a11y/scroll",[],function(){var Scroll=Backbone.Controller.extend({initialize:function initialize(){_.bindAll(this,"_onTouchStart","_onTouchEnd","_onScrollEvent","_onKeyDown");this._scrollDisabledElements=$([]);this.$window=$(window);this.$body=$("body");this._preventScrollOnKeys={37:true,38:true,39:true,40:true};this._ignoreKeysOnElementsMatching="textarea, input, select";this._isRunning=false;this._touchStartEventObject=null},disable:function disable($elements){$elements=$($elements);this._scrollDisabledElements=this._scrollDisabledElements.add($elements);this._checkRunning();return this},enable:function enable($elements){$elements=$($elements);if(!$elements||!$elements.length){this.clear();return this}this._scrollDisabledElements=this._scrollDisabledElements.not($elements);this._checkRunning();return this},clear:function clear(){this._scrollDisabledElements=$([]);this._checkRunning();return this},_checkRunning:function _checkRunning(){if(!this._scrollDisabledElements.length){this._stop();return}this._start()},_start:function _start(){if(this._isRunning){return}this._isRunning=true;window.addEventListener("touchstart",this._onTouchStart);window.addEventListener("touchend",this._onTouchEnd);window.addEventListener("touchmove",this._onScrollEvent,{passive:false});window.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("keydown",this._onKeyDown)},_onTouchStart:function _onTouchStart(event){event=$.event.fix(event);this._touchStartEventObject=event;return true},_onTouchEnd:function _onTouchEnd(){this._touchStartEventObject=null;return true},_onScrollEvent:function _onScrollEvent(event){event=$.event.fix(event);return this._preventScroll(event)},_onKeyDown:function _onKeyDown(event){event=$.event.fix(event);if(!this._preventScrollOnKeys[event.keyCode]){return}var $target=$(event.target);if($target.is(this._ignoreKeysOnElementsMatching)){return}return this._preventScroll(event)},_preventScroll:function _preventScroll(event){var isGesture=event.touches&&event.touches.length>1;if(isGesture){return}var $target=$(event.target);if(this._scrollDisabledElements.length){var scrollingParent=this._getScrollingParent(event,$target);if(scrollingParent.filter(this._scrollDisabledElements).length===0){this.$window.scroll();return}}event.preventDefault();return false},_getScrollingParent:function _getScrollingParent(event,$target){var isTouchEvent=event.type==="touchmove";var hasTouchStartEvent=this._touchStartEventObject&&this._touchStartEventObject.originalEvent;if(isTouchEvent&&!hasTouchStartEvent){return $target}var directionY=this._getScrollDirection(event);if(directionY==="none"){return this.$body}var parents=$target.parents();for(var i=0,l=parents.length;i<l;i++){var $parent=$(parents[i]);if($parent.is("body")){return this.$body}if(!this._isScrollable($parent)){continue}if(!this._isScrolling($parent,directionY)){continue}return $parent}return this.$body},_isScrollable:function _isScrollable($target){var scrollType=$target.css("overflow-y");if(scrollType!=="auto"&&scrollType!=="scroll"){return false}var pointerEvents=$target.css("pointer-events");if(pointerEvents==="none"){return false}return true},_isScrolling:function _isScrolling($target,directionY){var scrollTop=Math.ceil($target.scrollTop());var innerHeight=$target.outerHeight();var scrollHeight=$target[0].scrollHeight;var hasScrollingSpace=false;switch(directionY){case"down":hasScrollingSpace=scrollTop+innerHeight<scrollHeight;if(hasScrollingSpace){return true}break;case"up":hasScrollingSpace=scrollTop>0;if(hasScrollingSpace){return true}break;}return false},_getScrollDirection:function _getScrollDirection(event){var deltaY=this._getScrollDelta(event);if(deltaY===0){return"none"}return deltaY>0?"up":"down"},_getScrollDelta:function _getScrollDelta(event){var deltaY=0;var isTouchEvent=event.type==="touchmove";var originalEvent=event.originalEvent;if(isTouchEvent){var startOriginalEvent=this._touchStartEventObject.originalEvent;var currentY=originalEvent.pageY;var previousY=startOriginalEvent.pageY;if(currentY===0||currentY===previousY){currentY=originalEvent.touches[0].pageY;previousY=startOriginalEvent.touches[0].pageY}deltaY=currentY-previousY}else{var hasDeltaY=originalEvent.wheelDeltaY||originalEvent.deltaY!==undefined;if(hasDeltaY){deltaY=-originalEvent.deltaY}else{deltaY=originalEvent.wheelDelta||0}}return deltaY},_stop:function _stop(){if(!this._isRunning){return}this._isRunning=false;window.removeEventListener("touchstart",this._onTouchStart);window.removeEventListener("touchend",this._onTouchEnd);window.removeEventListener("touchmove",this._onScrollEvent,{passive:false});window.removeEventListener("wheel",this._onScrollEvent,{passive:false});document.removeEventListener("wheel",this._onScrollEvent,{passive:false});document.removeEventListener("keydown",this._onKeyDown)}});return Scroll});define("core/js/a11y/wrapFocus",["core/js/adapt"],function(Adapt){var WrapFocus=Backbone.Controller.extend({initialize:function initialize(){_.bindAll(this,"_onWrapAround");this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})},_attachEventListeners:function _attachEventListeners(){var config=Adapt.a11y.config;$("body").on("click focus",config._options._focusguard,this._onWrapAround)},_onWrapAround:function _onWrapAround(event){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupWrapFocusEnabled){return}event.preventDefault();event.stopPropagation();Adapt.a11y.focusFirst("body",{defer:false})}});return WrapFocus});define("core/js/a11y/popup",["core/js/adapt"],function(Adapt){var Popup=Backbone.Controller.extend({_floorStack:[$("body")],_focusStack:[],_tabIndexes:{},_ariaHiddens:{},_elementUIDIndex:0,initialize:function initialize(){this.listenTo(Adapt,{"popup:opened":function popupOpened($element,ignoreInternalTrigger){if(ignoreInternalTrigger){return}Adapt.a11y.log.deprecated("Adapt.trigger(\"popup:opened\", $element) is replaced with Adapt.a11y.popupOpened($element);");this.opened($element,true)},"popup:closed":function popupClosed($target,ignoreInternalTrigger){if(ignoreInternalTrigger){return}Adapt.a11y.log.deprecated("Adapt.trigger(\"popup:closed\", $target) is replaced with Adapt.a11y.popupClosed($target);");this.closed($target,true)}})},opened:function opened($popupElement,silent){$popupElement=$popupElement||$(document.activeElement);this._addPopupLayer($popupElement);if(!silent){Adapt.trigger("popup:opened",$popupElement,true)}return this},_addPopupLayer:function _addPopupLayer($popupElement){$popupElement=$($popupElement);var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled||$popupElement.length===0){return $popupElement}this._floorStack.push($popupElement);this._focusStack.push($(document.activeElement));var $elements=$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);var $branch=$popupElement.add($popupElement.parents());var $siblings=$branch.siblings().filter(config._options._tabbableElementsExcludes);$elements=$elements.add($siblings);$elements.each(function(index,item){var $item=$(item);var elementUID;if(typeof item.a11y_uid==="undefined"){item.a11y_uid="UID"+ ++this._elementUIDIndex}elementUID=item.a11y_uid;if(this._tabIndexes[elementUID]===undefined){this._tabIndexes[elementUID]=[]}if(this._ariaHiddens[elementUID]===undefined){this._ariaHiddens[elementUID]=[]}var tabindex=$item.attr("tabindex");var ariaHidden=$item.attr("aria-hidden");this._tabIndexes[elementUID].push(tabindex===undefined?"":tabindex);this._ariaHiddens[elementUID].push(ariaHidden===undefined?"":ariaHidden);if(config._options._isPopupTabIndexManagementEnabled){$item.attr("tabindex",-1)}if(config._options._isPopupAriaHiddenManagementEnabled){$item.attr("aria-hidden",true)}}.bind(this));var $items=$popupElement.find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);if(config._options._isPopupTabIndexManagementEnabled){$items.attr("tabindex",0)}if(config._options._isPopupAriaHiddenManagementEnabled){$items.removeAttr("aria-hidden").removeClass("aria-hidden").parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}},closed:function closed($focusElement,silent){var $previousFocusElement=this._removeLastPopupLayer();$focusElement=$focusElement||$previousFocusElement||$("body");if(!silent){Adapt.trigger("popup:closed",$focusElement,true)}Adapt.a11y.focusFirst($($focusElement));return this},_removeLastPopupLayer:function _removeLastPopupLayer(){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled){return $(document.activeElement)}if(this._floorStack.length<=1){return}this._floorStack.pop();$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes).each(function(index,item){var $item=$(item);var previousTabIndex="";var previousAriaHidden="";var elementUID;if(typeof item.a11y_uid==="undefined"){item.a11y_uid="UID"+ ++this._elementUIDIndex}elementUID=item.a11y_uid;if(this._tabIndexes[elementUID]!==undefined&&this._tabIndexes[elementUID].length!==0){previousTabIndex=this._tabIndexes[elementUID].pop();previousAriaHidden=this._ariaHiddens[elementUID].pop()}if(this._tabIndexes[elementUID]!==undefined&&this._tabIndexes[elementUID].length===0){delete this._tabIndexes[elementUID];delete this._ariaHiddens[elementUID]}if(config._options._isPopupTabIndexManagementEnabled){if(previousTabIndex===""){$item.removeAttr("tabindex")}else{$item.attr({"tabindex":previousTabIndex})}}if(config._options._isPopupAriaHiddenManagementEnabled){if(previousAriaHidden===""){$item.removeAttr("aria-hidden")}else{$item.attr({"aria-hidden":previousAriaHidden})}}}.bind(this));return document.activeElement=this._focusStack.pop()},setCloseTo:function setCloseTo($focusElement){var $original=this._focusStack.pop();this._focusStack.push($focusElement);return $original}});return Popup});define("core/js/a11y/deprecated",["core/js/adapt"],function(Adapt){_.extend($.fn,{isFixedPostion:function isFixedPostion(){Adapt.a11y.log.removed("$(\"..\").isFixedPostion was unneeded and has been removed, let us know if you need it back.");return false},a11y_aria_label:function a11y_aria_label(){Adapt.a11y.log.removed("$(\"..\").a11y_aria_label was incorrect behaviour.");return this},limitedScrollTo:function limitedScrollTo(){Adapt.a11y.log.removed("$.limitedScrollTo had no impact on the screen reader cursor.");return this},a11y_text:function a11y_text(){Adapt.a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return this},a11y_selected:function a11y_selected(){Adapt.a11y.log.removed("$(\"..\").a11y_selected is removed. Please use aria-live instead.");return this},a11y_on:function a11y_on(isOn){Adapt.a11y.log.deprecated("$(\"..\").a11y_on, use Adapt.a11y.findTabbable($element); and Adapt.a11y.toggleAccessible($elements, isAccessible); instead.");var $tabbable=Adapt.a11y.findTabbable(this);Adapt.a11y.toggleAccessible($tabbable,isOn);return this},a11y_only:function a11y_only(){Adapt.a11y.log.removed("$(\"..\").a11y_only, use Adapt.a11y.popupOpened($popupElement); instead.");return this},scrollDisable:function scrollDisable(){if(Adapt.a11y.config._options._isScrollDisableEnabled===false){return this}Adapt.a11y.log.deprecated("$(\"..\").scrollDisable, use Adapt.a11y.scrollDisable($elements); instead.");Adapt.a11y.scrollDisable(this);return this},scrollEnable:function scrollEnable(){if(Adapt.a11y.config._options._isScrollDisableEnabled===false){return this}Adapt.a11y.log.deprecated("$(\"..\").scrollEnable, use Adapt.a11y.scrollEnable($elements); instead.");Adapt.a11y.scrollEnable(this);return this},a11y_popup:function a11y_popup(){Adapt.a11y.log.deprecated("$(\"..\").a11y_popup, use Adapt.a11y.popupOpened($popupElement); instead.");return Adapt.a11y.popupOpened(this)},a11y_cntrl:function a11y_cntrl(isOn,withDisabled){Adapt.a11y.log.deprecated("$(\"..\").a11y_cntrl, use Adapt.a11y.toggleAccessible($elements, isAccessible); and if needed Adapt.a11y.toggleEnabled($elements, isEnabled); instead.");Adapt.a11y.toggleAccessible(this,isOn);if(withDisabled)Adapt.a11y.toggleEnabled(this,isOn);return this},a11y_cntrl_enabled:function a11y_cntrl_enabled(isOn){Adapt.a11y.log.deprecated("$(\"..\").a11y_cntrl_enabled, use Adapt.a11y.toggleAccessibleEnabled($elements, isAccessibleEnabled); instead.");Adapt.a11y.toggleAccessibleEnabled(this,isOn);return this},isReadable:function isReadable(){Adapt.a11y.log.deprecated("$(\"..\").isReadable, use Adapt.a11y.isReadable($element); instead.");return Adapt.a11y.isReadable(this)},findForward:function findForward(selector){Adapt.a11y.log.removed("$(\"..\").findForward has been removed as the use cases are very small, let us know if you need it back.");return Adapt.a11y._findFirstForward(this,selector)},findWalk:function findWalk(selector){Adapt.a11y.log.removed("$(\"..\").findWalk has been removed as the use cases are very small, let us know if you need it back.");return Adapt.a11y._findFindForwardDescendant(this,selector)},focusNoScroll:function focusNoScroll(){Adapt.a11y.log.deprecated("$(\"..\").focusNoScroll, use Adapt.a11y.focus($element); instead.");return Adapt.a11y.focus(this)},focusNext:function focusNext(returnOnly){Adapt.a11y.log.deprecated("$(\"..\").focusNext, use Adapt.a11y.focusNext($element); or if needed Adapt.a11y.findFirstReadable($element); instead.");if(returnOnly){return Adapt.a11y.findFirstReadable(this)}return Adapt.a11y.focusNext(this)},focusOrNext:function focusOrNext(returnOnly){Adapt.a11y.log.deprecated("$(\"..\").focusOrNext, use Adapt.a11y.focusFirst($element); or if needed Adapt.a11y.findFirstReadable($element); or Adapt.a11y.isReadable($element); instead.");if(returnOnly){if(Adapt.a11y.isReadable(this))return this;return Adapt.a11y.findFirstReadable(this)}return Adapt.a11y.focusFirst(this)},a11y_focus:function a11y_focus(dontDefer){Adapt.a11y.log.deprecated("$(\"..\").a11y_focus, use Adapt.a11y.focusFirst($element, { defer: true }); instead.");Adapt.a11y.focusFirst(this,{defer:!dontDefer});return this}});_.extend($,{a11y_alert:function a11y_alert(){Adapt.a11y.log.removed("$.a11y_alert is removed. Please use aria-live instead.");return this},a11y_update:function a11y_update(){Adapt.a11y.log.removed("a11y_update is no longer required.");return this},a11y_text:function a11y_text(text){Adapt.a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_on:function a11y_on(isOn,selector){Adapt.a11y.log.deprecated("$(\"..\").a11y_on, use Adapt.a11y.toggleHidden($elements, isHidden); instead.");return Adapt.a11y.toggleHidden(selector,!isOn)},a11y_popdown:function a11y_popdown($focusTarget){Adapt.a11y.log.removed("$.a11y_popdown, use Adapt.a11y.popupClosed($focusTarget); instead.");return Adapt.a11y.popupClosed($focusTarget)},a11y_focus:function a11y_focus(dontDefer){Adapt.a11y.log.deprecated("$.a11y_focus, use Adapt.a11y.focusFirst(\"body\", { defer: true }); instead.");Adapt.a11y.focusFirst("body",{defer:!dontDefer});return this},a11y_normalize:function a11y_normalize(html){Adapt.a11y.log.deprecated("$.a11y_normalize, use Adapt.a11y.normalize(\"html\"); instead.");return Adapt.a11y.normalize(html)},a11y_remove_breaks:function a11y_remove_breaks(html){Adapt.a11y.log.deprecated("$.a11y_remove_breaks, use Adapt.a11y.removeBreaks(\"html\"); instead.");return Adapt.a11y.removeBreaks(html)}})});define("core/js/a11y",["core/js/adapt","./a11y/browserFocus","./a11y/focusOptions","./a11y/keyboardFocusOutline","./a11y/log","./a11y/scroll","./a11y/wrapFocus","./a11y/popup","./a11y/deprecated"],function(Adapt,BrowserFocus,FocusOptions,KeyboardFocusOutline,Log,Scroll,WrapFocus,Popup){var A11y=Backbone.Controller.extend({$html:$("html"),_htmlCharRegex:/&.*;/g,config:null,defaults:{_isFocusOutlineKeyboardOnlyEnabled:true,_isFocusOutlineDisabled:false,_isFocusAssignmentEnabled:true,_isFocusOnClickEnabled:true,_isFocusNextOnDisabled:true,_isScrollDisableEnabled:true,_isAriaHiddenManagementEnabled:true,_isPopupManagementEnabled:true,_isPopupWrapFocusEnabled:true,_isPopupAriaHiddenManagementEnabled:true,_isPopupTabIndexManagementEnabled:true,_ariaHiddenExcludes:":not(#wrapper):not(body)",_tabbableElements:"a,button,input,select,textarea,[tabindex]:not([data-a11y-force-focus])",_focusOutlineKeyboardOnlyIgnore:"input,textarea",_tabbableElementsExcludes:":not(.a11y-ignore):not([data-a11y-force-focus])",_focusableElements:"a,button,input,select,textarea,[tabindex],label",_readableElements:"[role=heading],[aria-label],[aria-labelledby],[alt]",_focusguard:".a11y-focusguard",_wrapStyleElements:"b,i,abbr,strong,em,small,sub,sup,ins,del,mark,zw,nb",_warnFirstOnly:true,_warn:true},_browserFocus:new BrowserFocus,_keyboardFocusOutline:new KeyboardFocusOutline,_wrapFocus:new WrapFocus,_popup:new Popup,_scroll:new Scroll,log:new Log,initialize:function initialize(){this._removeLegacyElements();this.listenToOnce(Adapt,{"app:dataLoaded":this._onDataLoaded,"navigationView:postRender":this._removeLegacyElements},this);Adapt.on("device:changed",this._setupNoSelect);this.listenTo(Adapt,{"router:location":this._onNavigationStart,"contentObjectView:ready router:plugin":this._onNavigationEnd})},_onDataLoaded:function _onDataLoaded(){this.config=Adapt.config.get("_accessibility");this.config._isActive=false;this.config._options=_.defaults(this.config._options||{},this.defaults);Adapt.offlineStorage.set("a11y",false);this.$html.toggleClass("has-accessibility",this.isEnabled());this._setupNoSelect();this._addFocuserDiv();if(this._isReady){return}this._isReady=true;Adapt.trigger("accessibility:ready")},_setupNoSelect:function _setupNoSelect(){if(!this.config||!this.config._disableTextSelectOnClasses){return}var classes=this.config._disableTextSelectOnClasses.split(" ");var isMatch=false;for(var i=0,item;item=classes[i++];){if(this.$html.is(item)){isMatch=true;break}}this.$html.toggleClass("u-no-select",isMatch)},_addFocuserDiv:function _addFocuserDiv(){if($("#a11y-focuser").length){return}$("body").append($("<div id=\"a11y-focuser\" class=\"a11y-ignore\" tabindex=\"-1\" role=\"presentation\">&nbsp;</div>"))},_removeLegacyElements:function _removeLegacyElements(){var $legacyElements=$("body").children("#accessibility-toggle, #accessibility-instructions");var $navigationElements=$(".nav").find("#accessibility-toggle, #accessibility-instructions");if(!$legacyElements.length&&!$navigationElements.length){return}Adapt.log.warn("REMOVED: #accessibility-toggle and #accessibility-instructions have been removed. Please remove them from all of your .html files.");$legacyElements.remove();$navigationElements.remove()},_onNavigationStart:function _onNavigationStart(){if(!this.isEnabled()){return}_.defer(function(){Adapt.a11y.toggleHidden(".contentobject",true)})},_onNavigationEnd:function _onNavigationEnd(view){if(view&&view.model&&view.model.get("_id")!==Adapt.location._currentId||!this.isEnabled()){return}Adapt.a11y.toggleHidden(".contentobject",false)},isActive:function isActive(){this.log.removed("Accessibility is now always active when enabled. Please unify your user experiences.");return false},isEnabled:function isEnabled(){return this.config&&this.config._isEnabled},toggleHidden:function toggleHidden($elements,isHidden){$elements=$($elements);var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled){return this}isHidden=isHidden===undefined?true:isHidden;if(isHidden===true){$elements.attr("aria-hidden",true)}else{$elements.removeAttr("aria-hidden")}return this},toggleAccessibleEnabled:function toggleAccessibleEnabled($elements,isAccessibleEnabled){this.toggleAccessible($elements,isAccessibleEnabled);this.toggleEnabled($elements,isAccessibleEnabled);return this},toggleAccessible:function toggleAccessible($elements,isReadable){$elements=$($elements);var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled||$elements.length===0){return this}isReadable=isReadable===undefined?true:isReadable;if(!isReadable){$elements.attr({tabindex:"-1","aria-hidden":"true"}).addClass("aria-hidden")}else{$elements.removeAttr("aria-hidden tabindex").removeClass("aria-hidden");$elements.parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}return this},toggleEnabled:function toggleEnabled($elements,isEnabled){$elements=$($elements);if($elements.length===0){return this}isEnabled=isEnabled===undefined?true:isEnabled;if(!isEnabled){$elements.attr("disabled","disabled").addClass("is-disabled")}else{$elements.removeAttr("disabled").removeClass("is-disabled")}return this},findFirstTabbable:function findFirstTabbable($element){$element=$($element).first();return this._findFirstForward($element,this.isTabbable)},findFirstReadable:function findFirstReadable($element){$element=$($element).first();return this._findFirstForward($element,this.isReadable)},findTabbable:function findTabbable($element){var config=Adapt.a11y.config;return $($element).find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes)},findReadable:function findReadable($element){return $($element).find("*").filter(function(index,element){return this.isReadable(element)}.bind(this))},isTabbable:function isTabbable($element){var config=Adapt.a11y.config;var value=$($element).is(config._options._tabbableElements).is(config._options._tabbableElementsExcludes);if(!value){return undefined}return value},isReadable:function isReadable($element,checkParents){var config=Adapt.a11y.config;$element=$($element).first();checkParents=checkParents===undefined;var $branch=checkParents?$element.add($element.parents()):$element;var isNotVisible=_.find($branch.toArray(),function(item){var $item=$(item);var isNotVisible=$item.css("display")==="none"||$item.css("visibility")==="hidden"||$item.attr("aria-hidden")==="true";if(isNotVisible){return true}});if(isNotVisible){return false}var hasNativeFocusOrIsScreenReadable=$element.is(config._options._focusableElements)||$element.is(config._options._readableElements);if(hasNativeFocusOrIsScreenReadable){return true}var childNodes=$element[0].childNodes;for(var c=0,cl=childNodes.length;c<cl;c++){var childNode=childNodes[c];var isTextNode=childNode.nodeType===3;if(!isTextNode){continue}var isOnlyWhiteSpace=/^\s*$/.test(childNode.nodeValue);if(isOnlyWhiteSpace){continue}return true}return undefined},_findFirstForward:function _findFirstForward($element,selector){$element=$($element).first();var iterator;switch(_typeof(selector)){case"string":iterator=function iterator($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean;}if($element.length===0){return $element.not("*")}var $found=this._findFirstForwardDescendant($element,iterator);if($found&&$found.length){return $found}var $nextSiblings=$element.nextAll().toArray();_.find($nextSiblings,function(sibling){var $sibling=$(sibling);var value=iterator($sibling);if(value===false){return}if(value){$found=$sibling;return true}$found=this._findFirstForwardDescendant($sibling,iterator);if($found&&$found.length)return true}.bind(this));if($found&&$found.length){return $found}var $branch=$element.add($element.parents()).toArray().reverse();_.find($branch,function(parent){var $parent=$(parent);if(iterator($parent)===false){return false}var $siblings=$parent.nextAll().toArray();return _.find($siblings,function(sibling){var $sibling=$(sibling);var value=iterator($sibling);if(value===false){return}if(value){$found=$sibling;return true}$found=this._findFirstForwardDescendant($sibling,iterator);if($found&&$found.length){return true}}.bind(this))}.bind(this));if(!$found||!$found.length){return $element.not("*")}return $found},_findFirstForwardDescendant:function _findFirstForwardDescendant($element,selector){$element=$($element).first();var iterator;switch(_typeof(selector)){case"string":iterator=function iterator($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean;}var $notFound=$element.not("*");if($element.length===0){return $notFound}var stack=[{item:$element[0],value:undefined}];var stackIndexPosition=0;var childIndexPosition=stackIndexPosition+1;do{var stackEntry=stack[stackIndexPosition];var $stackItem=$(stackEntry.item);switch(stackEntry.value){case true:return $stackItem;case false:return $notFound;}var $children=$stackItem.children().toArray();_.find($children,function(item){var $item=$(item);var value=iterator($item);if(value===false){return false}stack.splice(childIndexPosition++,0,{item:item,value:value})});stackIndexPosition++;childIndexPosition=stackIndexPosition+1}while(stackIndexPosition<stack.length);return $notFound},focusNext:function focusNext($element,options){options=new FocusOptions(options);$element=$($element).first();$element=Adapt.a11y.findFirstReadable($element);this.focus($element,options);return this},focusFirst:function focusFirst($element,options){options=new FocusOptions(options);$element=$($element).first();if(Adapt.a11y.isReadable($element)){this.focus($element,options);return $element}$element=Adapt.a11y.findFirstReadable($element);this.focus($element,options);return $element},focus:function focus($element,options){options=new FocusOptions(options);$element=$($element).first();var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isFocusAssignmentEnabled||$element.length===0){return this}function perform(){if(options.preventScroll){var y=$(window).scrollTop();try{if($element.attr("tabindex")===undefined){$element.attr({"tabindex":"-1","data-a11y-force-focus":"true"})}$element[0].focus({preventScroll:true})}catch(e){}window.scrollTo(null,y)}else{$element[0].focus()}}if(options.defer){_.defer(function(){perform()})}else{perform()}return this},normalize:function normalize(htmls){var values=Array.prototype.slice.call(arguments,0);values=values.filter(Boolean);values=values.filter(_.isString);htmls=values.join(" ");var text=$("<div>"+htmls+"</div>").text();return text.replace(this._htmlCharRegex,"")},removeBreaks:function removeBreaks(htmls){var values=Array.prototype.slice.call(arguments,0);values=values.filter(Boolean);values=values.filter(_.isString);htmls=values.join(" ");var $div=$("<div>"+htmls+"</div>");var stack=[$div[0]];var stackIndex=0;var outputs=[];do{if(stack[stackIndex].childNodes.length){var nodes=stack[stackIndex].childNodes;var usable=_.filter(nodes,function(node){var isTextNode=node.nodeType===3;if(isTextNode){return true}var isStyleElement=$(node).is(Adapt.a11y.config._options._wrapStyleElements);if(isStyleElement){return true}return false});outputs.push.apply(outputs,usable);stack.push.apply(stack,nodes)}stackIndex++}while(stackIndex<stack.length);var rtnText="";outputs.forEach(function(item){rtnText+=item.outerHTML||item.textContent});return rtnText},scrollEnable:function scrollEnable($elements){this._scroll.enable($elements);return this},scrollDisable:function scrollDisable($elements){this._scroll.disable($elements);return this},popupOpened:function popupOpened($popupElement){this._popup.opened($popupElement);return this},popupClosed:function popupClosed($focusElement){this._popup.closed($focusElement);return this},setPopupCloseTo:function setPopupCloseTo($focusElement){return this._popup.setCloseTo($focusElement)}});return Adapt.a11y=new A11y});define("core/js/accessibility",["core/js/adapt","./a11y"],function(Adapt,a11y){Object.defineProperty(Adapt,"accessibility",{get:function get(){a11y.log.deprecated("Adapt.accessibility has moved to Adapt.a11y");return Adapt.accessibility=a11y}})});define("core/js/collections/adaptCollection",["core/js/adapt"],function(Adapt){var AdaptCollection=function(_Backbone$Collection){"use strict";_inherits(AdaptCollection,_Backbone$Collection);var _super4=_createSuper(AdaptCollection);function AdaptCollection(){_classCallCheck(this,AdaptCollection);return _super4.apply(this,arguments)}_createClass(AdaptCollection,[{key:"initialize",value:function initialize(models,options){this.once("reset",this.loadedData,this)}},{key:"loadedData",value:function loadedData(){Adapt.trigger("adaptCollection:dataLoaded")}}]);return AdaptCollection}(Backbone.Collection);return AdaptCollection});define("core/js/enums/logLevelEnum",[],function(){var LOG_LEVEL=ENUM(["DEBUG","INFO","WARN","ERROR","FATAL"]);return LOG_LEVEL});define("core/js/logging",["core/js/adapt","core/js/enums/logLevelEnum"],function(Adapt,LOG_LEVEL){var Logging=function(_Backbone$Controller3){"use strict";_inherits(Logging,_Backbone$Controller3);var _super5=_createSuper(Logging);function Logging(){_classCallCheck(this,Logging);return _super5.apply(this,arguments)}_createClass(Logging,[{key:"initialize",value:function initialize(){this._config={_isEnabled:true,_level:LOG_LEVEL.INFO.asLowerCase,_console:true,_warnFirstOnly:true};this._warned={};this.listenToOnce(Adapt,"configModel:dataLoaded",this.onLoadConfigData)}},{key:"onLoadConfigData",value:function onLoadConfigData(){this.loadConfig();this.debug("Logging config loaded");this.trigger("log:ready")}},{key:"loadConfig",value:function loadConfig(){if(Adapt.config.has("_logging")){this._config=Adapt.config.get("_logging")}this.checkQueryStringOverride()}},{key:"checkQueryStringOverride",value:function checkQueryStringOverride(){var matches=window.location.search.match(/[?&]loglevel=([a-z]*)/i);if(!matches||matches.length<2)return;var override=LOG_LEVEL(matches[1].toUpperCase());if(!override)return;this._config._level=override.asLowerCase;this.debug("Loglevel override in query string:",this._config._level)}},{key:"debug",value:function debug(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4]}this._log(LOG_LEVEL.DEBUG,args)}},{key:"info",value:function info(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5]}this._log(LOG_LEVEL.INFO,args)}},{key:"warn",value:function warn(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6]}this._log(LOG_LEVEL.WARN,args)}},{key:"error",value:function error(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7]}this._log(LOG_LEVEL.ERROR,args)}},{key:"fatal",value:function fatal(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8]}this._log(LOG_LEVEL.FATAL,args)}},{key:"removed",value:function removed(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++){args[_key9]=arguments[_key9]}args=["REMOVED"].concat(args);this.warnOnce.apply(this,_toConsumableArray(args))}},{key:"deprecated",value:function deprecated(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++){args[_key10]=arguments[_key10]}args=["DEPRECATED"].concat(args);this.warnOnce.apply(this,_toConsumableArray(args))}},{key:"warnOnce",value:function warnOnce(){for(var _len11=arguments.length,args=new Array(_len11),_key11=0;_key11<_len11;_key11++){args[_key11]=arguments[_key11]}if(this._hasWarned(args)){return}this._log(LOG_LEVEL.WARN,args)}},{key:"_log",value:function _log(level,data){var isEnabled=this._config._isEnabled;if(!isEnabled)return;var configLevel=LOG_LEVEL(this._config._level.toUpperCase());var isLogLevelAllowed=level>=configLevel;if(!isLogLevelAllowed)return;this._logToConsole(level,data);this.trigger("log",level,data);this.trigger("log:"+level.asLowerCase,level,data)}},{key:"_logToConsole",value:function _logToConsole(level,data){var shouldLogToConsole=this._config._console;if(!shouldLogToConsole)return;var log=[level.asUpperCase+":"];data&&log.push.apply(log,_toConsumableArray(data));if(console[level.asLowerCase]){var _console;(_console=console)[level.asLowerCase].apply(_console,log)}else{var _console2;(_console2=console).log.apply(_console2,log)}}},{key:"_hasWarned",value:function _hasWarned(args){if(!this._config._warnFirstOnly){return false}var hash=args.map(String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false}}]);return Logging}(Backbone.Controller);return Adapt.log=new Logging});define("core/js/models/buildModel",["core/js/adapt","core/js/logging"],function(Adapt){var BuildModel=function(_Backbone$Model2){"use strict";_inherits(BuildModel,_Backbone$Model2);var _super6=_createSuper(BuildModel);function BuildModel(){_classCallCheck(this,BuildModel);return _super6.apply(this,arguments)}_createClass(BuildModel,[{key:"defaults",value:function defaults(){return{jsonext:"json"}}},{key:"initialize",value:function initialize(attrs,options){var _this13=this;this.url=options.url;this.fetch({success:function success(){_newArrowCheck(this,_this13);this.isLoaded=true;Adapt.trigger("buildModel:dataLoaded")}.bind(this),error:function error(){_newArrowCheck(this,_this13);console.log("Unable to load adapt/js/build.js");Adapt.trigger("buildModel:dataLoaded")}.bind(this)})}},{key:"whenReady",value:function whenReady(){var _this14=this;if(this.isLoaded)return Promise.resolve();return new Promise(function(resolve){_newArrowCheck(this,_this14);Adapt.once("buildModel:dataLoaded",resolve)}.bind(this))}}]);return BuildModel}(Backbone.Model);return BuildModel});define("core/js/models/configModel",["core/js/adapt"],function(Adapt){var ConfigModel=function(_Backbone$Model3){"use strict";_inherits(ConfigModel,_Backbone$Model3);var _super7=_createSuper(ConfigModel);function ConfigModel(){_classCallCheck(this,ConfigModel);return _super7.apply(this,arguments)}_createClass(ConfigModel,[{key:"defaults",value:function defaults(){return{screenSize:{large:900,medium:760,small:520},_forceRouteLocking:false,_canLoadData:true,_disableAnimation:false}}},{key:"initialize",value:function initialize(attrs,options){var _this15=this;this.url=options.url;this.fetch({success:function success(){var _this16=this;_newArrowCheck(this,_this15);Adapt.trigger("offlineStorage:prepare");Adapt.wait.queue(function(){_newArrowCheck(this,_this16);Adapt.trigger("configModel:dataLoaded");if(!this.get("_canLoadData"))return;Adapt.trigger("configModel:loadCourseData")}.bind(this))}.bind(this),error:function error(){_newArrowCheck(this,_this15);return console.log("Unable to load course/config.json")}.bind(this)})}},{key:"loadData",value:function loadData(){}}]);return ConfigModel}(Backbone.Model);return ConfigModel});define("core/js/modelEvent",[],function(){var ModelEvent=Backbone.Controller.extend({type:null,target:null,value:null,canBubble:true,deepPath:null,timeStamp:null,initialize:function initialize(type,target,value){this.type=type;this.target=target;this.value=value;this.deepPath=[target]},stopPropagation:function stopPropagation(){this.canBubble=false},addPath:function addPath(target){this.deepPath.unshift(target)}});return ModelEvent});define("core/js/models/adaptModel",["core/js/adapt","core/js/modelEvent","core/js/logging"],function(Adapt,ModelEvent){var AdaptModel=function(_Backbone$Model4){"use strict";_inherits(AdaptModel,_Backbone$Model4);var _super8=_createSuper(AdaptModel);function AdaptModel(){_classCallCheck(this,AdaptModel);return _super8.apply(this,arguments)}_createClass(AdaptModel,[{key:"toJSON",value:function toJSON(){var json=_.clone(this.attributes);delete json._children;delete json._parent;return $.extend(true,{},json)}},{key:"get",value:function get(name){switch(name){case"_parent":case"_children":Adapt.log.deprecated("Use model.getChildren() or model.getParent() instead of model.get('_children') or model.get('_parent')");}return _get(_getPrototypeOf(AdaptModel.prototype),"get",this).call(this,name)}},{key:"defaults",value:function defaults(){return{_canShowFeedback:true,_classes:"",_canReset:false,_isComplete:false,_isInteractionComplete:false,_isA11yRegionEnabled:false,_isA11yCompletionDescriptionEnabled:true,_requireCompletionOf:-1,_isEnabled:true,_isResetOnRevisit:false,_isAvailable:true,_isOptional:false,_isReady:false,_isVisible:true,_isLocked:false,_isHidden:false}}},{key:"trackable",value:function trackable(){return["_id","_isComplete","_isInteractionComplete"]}},{key:"trackableType",value:function trackableType(){return[String,Boolean,Boolean]}},{key:"bubblingEvents",value:function bubblingEvents(){return["change:_isComplete","change:_isInteractionComplete","change:_isActive"]}},{key:"setupModel",value:function setupModel(){var _this17=this;if(this.hasManagedChildren){this.setupChildListeners()}this.init();_.defer(function(){_newArrowCheck(this,_this17);if(this.hasManagedChildren){this.checkCompletionStatus();this.checkInteractionCompletionStatus();this.checkLocking()}this.setupTrackables()}.bind(this))}},{key:"setupTrackables",value:function setupTrackables(){var _this18=this;var originalTrackableStateFunction=this.triggerTrackableState;this.triggerTrackableState=_.compose(function(){_newArrowCheck(this,_this18);this.triggerTrackableState.isQueued=true}.bind(this),_.debounce(function(){_newArrowCheck(this,_this18);originalTrackableStateFunction.apply(this);this.triggerTrackableState.isQueued=false}.bind(this),17));this.listenTo(this,"change",function(_ref){var _this19=this;_newArrowCheck(this,_this18);var changed=_ref.changed;if(this.triggerTrackableState.isQueued||!Adapt.attributes._isStarted){return}var trackablePropertyNames=_.result(this,"trackable",[]);var changedPropertyNames=Object.keys(changed);var isTrackable=changedPropertyNames.find(function(item){_newArrowCheck(this,_this19);return trackablePropertyNames.includes(item)}.bind(this));if(isTrackable){this.triggerTrackableState()}}.bind(this))}},{key:"setupChildListeners",value:function setupChildListeners(){var children=this.getChildren();if(!children.length){return}this.listenTo(children,{"all":this.onAll,"bubble":this.bubble,"change:_isReady":this.checkReadyStatus,"change:_isComplete":this.onIsComplete,"change:_isInteractionComplete":this.checkInteractionCompletionStatus})}},{key:"init",value:function init(){}},{key:"getTrackableState",value:function getTrackableState(){var _ref2;var trackable=this.resultExtend("trackable",[]);var json=this.toJSON();var args=trackable;args.unshift(json);return(_ref2=_).pick.apply(_ref2,_toConsumableArray(args))}},{key:"setTrackableState",value:function setTrackableState(state){var _ref3;var trackable=this.resultExtend("trackable",[]);var args=trackable;args.unshift(state);state=(_ref3=_).pick.apply(_ref3,_toConsumableArray(args));this.set(state);return this}},{key:"triggerTrackableState",value:function triggerTrackableState(){Adapt.trigger("state:change",this,this.getTrackableState())}},{key:"reset",value:function reset(type,force){if(!this.get("_canReset")&&!force)return;type=type||true;switch(type){case"hard":case true:this.set({_isEnabled:true,_isComplete:false,_isInteractionComplete:false});break;case"soft":this.set({_isEnabled:true,_isInteractionComplete:false});break;}}},{key:"checkReadyStatus",value:function checkReadyStatus(){var _this20=this;var children=this.getAvailableChildModels();if(children.find(function(child){_newArrowCheck(this,_this20);return child.get("_isReady")===false}.bind(this))){return}this.set("_isReady",true)}},{key:"setCompletionStatus",value:function setCompletionStatus(){if(!this.get("_isVisible"))return;this.set({_isComplete:true,_isInteractionComplete:true})}},{key:"checkCompletionStatus",value:function checkCompletionStatus(){Adapt.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isComplete")}},{key:"checkInteractionCompletionStatus",value:function checkInteractionCompletionStatus(){Adapt.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isInteractionComplete")}},{key:"checkCompletionStatusFor",value:function checkCompletionStatusFor(){var _this21=this;var completionAttribute=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"_isComplete";var completed=false;var children=this.getAvailableChildModels();var requireCompletionOf=this.get("_requireCompletionOf");if(requireCompletionOf===-1){completed=children.every(function(child){_newArrowCheck(this,_this21);return child.get(completionAttribute)||child.get("_isOptional")}.bind(this))}else{completed=children.filter(function(child){_newArrowCheck(this,_this21);return child.get(completionAttribute)&&!child.get("_isOptional")}.bind(this)).length>=requireCompletionOf}this.set(completionAttribute,completed);Adapt.checkedCompletion()}},{key:"getTypeGroup",value:function getTypeGroup(){}},{key:"isTypeGroup",value:function isTypeGroup(typeGroup){var hasUpperCase=/[A-Z]+/.test(typeGroup);var isPluralized=typeGroup.slice(-1)==="s";var lowerCased=typeGroup.toLowerCase();var singular=isPluralized&&lowerCased.slice(0,-1);var singularLowerCased=(singular||lowerCased).toLowerCase();if(isPluralized||hasUpperCase){Adapt.log.deprecated("'".concat(typeGroup,"' appears pluralized or contains uppercase characters, suggest using the singular, lowercase type group '").concat(singularLowerCased,"'."))}var pluralizedLowerCaseTypes=[singularLowerCased,!isPluralized&&"".concat(lowerCased,"s")].filter(Boolean);var typeGroups=this.getTypeGroups();if(_.intersection(pluralizedLowerCaseTypes,typeGroups).length){return true}return false}},{key:"getTypeGroups",value:function getTypeGroups(){var _this22=this;if(this._typeGroups)return this._typeGroups;var typeGroups=[this.get("_type")];var parentClass=this;while(parentClass=Object.getPrototypeOf(parentClass)){if(!parentClass.hasOwnProperty("getTypeGroup"))continue;typeGroups.push(parentClass.getTypeGroup.call(this))}return this._typeGroups=_.uniq(typeGroups.filter(Boolean).map(function(s){_newArrowCheck(this,_this22);return s.toLowerCase()}.bind(this)))}},{key:"findAncestor",value:function findAncestor(ancestorType){var parent=this.getParent();if(!parent)return;if(!ancestorType||parent.isTypeGroup(ancestorType)){return parent}return parent.findAncestor(ancestorType)}},{key:"findDescendantModels",value:function findDescendantModels(descendants,options){var _this23=this;var allDescendantsModels=this.getAllDescendantModels();var returnedDescendants=allDescendantsModels.filter(function(model){_newArrowCheck(this,_this23);return model.isTypeGroup(descendants)}.bind(this));if(!options){return returnedDescendants}if(options.where){return returnedDescendants.filter(function(descendant){_newArrowCheck(this,_this23);for(var property in options.where){var value=options.where[property];if(descendant.get(property)!==value){return false}}return true}.bind(this))}}},{key:"getAllDescendantModels",value:function getAllDescendantModels(isParentFirst){var _this24=this;var descendants=[];if(!this.hasManagedChildren){return descendants}var children=this.getChildren();children.models.forEach(function(child){_newArrowCheck(this,_this24);if(!child.hasManagedChildren){descendants.push(child);return}var subDescendants=child.getAllDescendantModels(isParentFirst);if(isParentFirst===true){descendants.push(child)}descendants.push.apply(descendants,_toConsumableArray(subDescendants));if(isParentFirst!==true){descendants.push(child)}}.bind(this));return descendants}},{key:"findRelativeModel",value:function findRelativeModel(relativeString){var _this25=this;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var rootModel=options.limitParentId?Adapt.findById(options.limitParentId):Adapt.course;var relativeDescriptor=Adapt.parseRelativeString(relativeString);var searchBackwards=relativeDescriptor.offset<0;var moveBy=Math.abs(relativeDescriptor.offset);var movementCount=0;var hasDescendantsOfType=Boolean(this.findDescendantModels(relativeDescriptor.type).length);if(hasDescendantsOfType){moveBy--}var pageDescendants;if(searchBackwards){var _pageDescendants;pageDescendants=[rootModel];(_pageDescendants=pageDescendants).push.apply(_pageDescendants,_toConsumableArray(rootModel.getAllDescendantModels(true)));pageDescendants.reverse()}else{pageDescendants=rootModel.getAllDescendantModels(false);pageDescendants.push(rootModel)}if(typeof options.filter==="function"){pageDescendants=pageDescendants.filter(options.filter)}var modelId=this.get("_id");var modelIndex=pageDescendants.findIndex(function(pageDescendant){_newArrowCheck(this,_this25);if(pageDescendant.get("_id")===modelId){return true}return false}.bind(this));if(options.loop){var totalOfType=pageDescendants.reduce(function(count,model){_newArrowCheck(this,_this25);if(!model.isTypeGroup(relativeDescriptor.type))return count;return++count}.bind(this),0);moveBy=moveBy%totalOfType;pageDescendants=pageDescendants.concat(pageDescendants.slice(0))}for(var _i2=modelIndex,l=pageDescendants.length;_i2<l;_i2++){var descendant=pageDescendants[_i2];if(descendant.isTypeGroup(relativeDescriptor.type)){if(movementCount>moveBy){break}if(movementCount===moveBy){return Adapt.findById(descendant.get("_id"))}movementCount++}}}},{key:"getChildren",value:function getChildren(){var _this26=this;if(this._childrenCollection){return this._childrenCollection}var childrenCollection;if(!this.hasManagedChildren){childrenCollection=new Backbone.Collection}else{var _id=this.get("_id");var children=Adapt.data.filter(function(model){_newArrowCheck(this,_this26);return model.get("_parentId")===_id}.bind(this));childrenCollection=new Backbone.Collection(children)}if(this.get("_type")==="block"&&childrenCollection.length===2&&childrenCollection.models[0].get("_layout")!=="left"){childrenCollection.comparator="_layout";childrenCollection.sort()}this.setChildren(childrenCollection);return this._childrenCollection}},{key:"setChildren",value:function setChildren(children){this._childrenCollection=children;this.set("_children",children)}},{key:"getAvailableChildModels",value:function getAvailableChildModels(){return this.getChildren().where({_isAvailable:true})}},{key:"getParent",value:function getParent(){if(this._parentModel){return this._parentModel}var parentId=this.get("_parentId");if(!parentId)return;this.setParent(Adapt.findById(parentId));return this._parentModel}},{key:"setParent",value:function setParent(parent){this._parentModel=parent;this.set("_parentId",this._parentModel.get("_id"));this.set("_parent",this._parentModel)}},{key:"getAncestorModels",value:function getAncestorModels(shouldIncludeChild){var parents=[];var context=this;if(shouldIncludeChild)parents.push(context);while(context.has("_parentId")){context=context.getParent();parents.push(context)}return parents.length?parents:null}},{key:"getSiblings",value:function getSiblings(passSiblingsAndIncludeSelf){var _this27=this;var id=this.get("_id");var parentId=this.get("_parentId");var siblings;if(!passSiblingsAndIncludeSelf){if(this._hasSiblingsAndSelf===false){return this.get("_siblings")}siblings=Adapt.data.filter(function(model){_newArrowCheck(this,_this27);return model.get("_parentId")===parentId&&model.get("_id")!==id}.bind(this));this._hasSiblingsAndSelf=false}else{if(this._hasSiblingsAndSelf){return this.get("_siblings")}siblings=Adapt.data.filter(function(model){_newArrowCheck(this,_this27);return model.get("_parentId")===parentId}.bind(this));this._hasSiblingsAndSelf=true}var siblingsCollection=new Backbone.Collection(siblings);this.set("_siblings",siblingsCollection);return siblingsCollection}},{key:"setOnChildren",value:function setOnChildren(){var _this28=this;for(var _len12=arguments.length,args=new Array(_len12),_key12=0;_key12<_len12;_key12++){args[_key12]=arguments[_key12]}this.set.apply(this,args);if(!this.hasManagedChildren)return;var children=this.getChildren();children.models.forEach(function(child){_newArrowCheck(this,_this28);return child.setOnChildren.apply(child,args)}.bind(this))}},{key:"setOptional",value:function setOptional(value){Adapt.log.deprecated("Use model.set('_isOptional', value) as setOptional() may be removed in the future");this.set({_isOptional:value})}},{key:"checkLocking",value:function checkLocking(){var lockType=this.get("_lockType");if(!lockType)return;switch(lockType){case"sequential":this.setSequentialLocking();break;case"unlockFirst":this.setUnlockFirstLocking();break;case"lockLast":this.setLockLastLocking();break;case"custom":this.setCustomLocking();break;default:console.warn("AdaptModel.checkLocking: unknown _lockType '".concat(lockType,"' found on ").concat(this.get("_id")));}}},{key:"setSequentialLocking",value:function setSequentialLocking(){var children=this.getAvailableChildModels();for(var _i3=1,j=children.length;_i3<j;_i3++){children[_i3].set("_isLocked",!children[_i3-1].get("_isComplete"))}}},{key:"setUnlockFirstLocking",value:function setUnlockFirstLocking(){var children=this.getAvailableChildModels();var isFirstChildComplete=children[0].get("_isComplete");for(var _i4=1,j=children.length;_i4<j;_i4++){children[_i4].set("_isLocked",!isFirstChildComplete)}}},{key:"setLockLastLocking",value:function setLockLastLocking(){var children=this.getAvailableChildModels();var lastIndex=children.length-1;for(var _i5=lastIndex-1;_i5>=0;_i5--){if(!children[_i5].get("_isComplete")){return children[lastIndex].set("_isLocked",true)}}children[lastIndex].set("_isLocked",false)}},{key:"setCustomLocking",value:function setCustomLocking(){var _this29=this;var children=this.getAvailableChildModels();children.forEach(function(child){_newArrowCheck(this,_this29);child.set("_isLocked",this.shouldLock(child))}.bind(this))}},{key:"shouldLock",value:function shouldLock(child){var lockedBy=child.get("_lockedBy");if(!lockedBy)return false;for(var _i6=lockedBy.length-1;_i6>=0;_i6--){var _id2=lockedBy[_i6];try{var model=Adapt.findById(_id2);if(!model.get("_isAvailable"))continue;if(!model.get("_isComplete"))return true}catch(e){console.warn("AdaptModel.shouldLock: unknown _lockedBy ID '".concat(_id2,"' found on ").concat(child.get("_id")))}}return false}},{key:"onIsComplete",value:function onIsComplete(){this.checkCompletionStatus();this.checkLocking()}},{key:"deepClone",value:function deepClone(){var _this30=this;var modifier=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var ModelClass=this.constructor;var clonedModel=new ModelClass(this.toJSON());if(modifier){modifier(clonedModel,this)}var clonedId=clonedModel.get("_id");var hasId=Boolean(clonedId);var shouldAssignUniqueId=this.get("_id")===clonedId;if(hasId&&shouldAssignUniqueId){var cid=_.uniqueId(ModelClass.prototype.cidPrefix||"c");clonedId="".concat(clonedId,"_").concat(cid);clonedModel.set("_id",clonedId)}if(hasId){Adapt.data.add(clonedModel)}if(this.hasManagedChildren){this.getChildren().each(function(child){var _this31=this;_newArrowCheck(this,_this30);if(!child.deepClone){throw new Error("Cannot deepClone child.")}child.deepClone(function(clone,child){_newArrowCheck(this,_this31);if(hasId){clone.set("_parentId",clonedId)}if(modifier){modifier(clone,child)}}.bind(this))}.bind(this))}clonedModel.getParent().getChildren().add(clonedModel);clonedModel.setupModel();return clonedModel}},{key:"onAll",value:function onAll(type,model,value){if(!_.result(this,"bubblingEvents").includes(type))return;var event=new ModelEvent(type,model,value);this.bubble(event)}},{key:"bubble",value:function bubble(event){if(!event.canBubble)return;event.addPath(this);this.trigger("bubble:".concat(event.type," bubble"),event)}},{key:"hasManagedChildren",get:function get(){return true}}]);return AdaptModel}(Backbone.Model);return AdaptModel});define("core/js/models/contentObjectModel",["core/js/adapt","core/js/models/adaptModel"],function(Adapt,AdaptModel){var ContentObjectModel=function(_AdaptModel){"use strict";_inherits(ContentObjectModel,_AdaptModel);var _super9=_createSuper(ContentObjectModel);function ContentObjectModel(){_classCallCheck(this,ContentObjectModel);return _super9.apply(this,arguments)}_createClass(ContentObjectModel,[{key:"getTypeGroup",value:function getTypeGroup(){return"contentobject"}},{key:"_parent",get:function get(){Adapt.log.deprecated("contentObjectModel._parent, use contentObjectModel.getParent() instead, parent models are defined by the JSON");var isParentCourse=this.get("_parentId")===Adapt.course.get("_id");if(isParentCourse){return"course"}return"contentObjects"}},{key:"_siblings",get:function get(){Adapt.log.deprecated("contentObjectModel._siblings, use contentObjectModel.getSiblings() instead, sibling models are defined by the JSON");return"contentObjects"}},{key:"_children",get:function get(){Adapt.log.deprecated("contentObjectModel._children, use contentObjectModel.hasManagedChildren instead, child models are defined by the JSON");return null}}]);return ContentObjectModel}(AdaptModel);return ContentObjectModel});define("core/js/models/menuModel",["core/js/adapt","core/js/models/contentObjectModel"],function(Adapt,ContentObjectModel){var MenuModel=function(_ContentObjectModel){"use strict";_inherits(MenuModel,_ContentObjectModel);var _super10=_createSuper(MenuModel);function MenuModel(){_classCallCheck(this,MenuModel);return _super10.apply(this,arguments)}_createClass(MenuModel,[{key:"getTypeGroup",value:function getTypeGroup(){return"menu"}},{key:"setCustomLocking",value:function setCustomLocking(){var _this32=this;var children=this.getAvailableChildModels();children.forEach(function(child){_newArrowCheck(this,_this32);child.set("_isLocked",this.shouldLock(child));if(!(child instanceof MenuModel))return;child.checkLocking()}.bind(this))}},{key:"_children",get:function get(){Adapt.log.deprecated("menuModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON");return"contentObjects"}}]);return MenuModel}(ContentObjectModel);Adapt.register("menu",{model:MenuModel});return MenuModel});define("core/js/models/courseModel",["core/js/adapt","core/js/models/menuModel"],function(Adapt,MenuModel){var CourseModel=function(_MenuModel){"use strict";_inherits(CourseModel,_MenuModel);var _super11=_createSuper(CourseModel);function CourseModel(){_classCallCheck(this,CourseModel);return _super11.apply(this,arguments)}_createClass(CourseModel,[{key:"_parent",get:function get(){Adapt.log.deprecated("courseModel._parent, use courseModel.getParent() instead, parent models are defined by the JSON");return null}},{key:"_siblings",get:function get(){Adapt.log.deprecated("courseModel._siblings, use courseModel.getSiblings() instead, sibling models are defined by the JSON");return null}}]);return CourseModel}(MenuModel);Adapt.register("course",{model:CourseModel});return CourseModel});define("core/js/startController",["core/js/adapt"],function(Adapt){var StartController=Backbone.Controller.extend({model:null,loadCourseData:function loadCourseData(){this.model=new Backbone.Model(Adapt.course.get("_start"))},setStartLocation:function setStartLocation(){if(!this.isEnabled())return;window.history.replaceState("","",this.getStartHash())},returnToStartLocation:function returnToStartLocation(){var startIds=this.model.get("_startIds");if(startIds){startIds.forEach(function(startId){startId._skipIfComplete=false})}window.location.hash=this.getStartHash(true)},getStartHash:function getStartHash(alwaysForce){var startId=this.getStartId();var isRouteSpecified=window.location.href.indexOf("#")>-1;var shouldForceStartId=alwaysForce||this.model.get("_force");var shouldNavigateToStartId=startId&&(!isRouteSpecified||shouldForceStartId);if(shouldNavigateToStartId&&startId!==Adapt.course.get("_id")){return"#/id/"+startId}return window.location.hash||"#/"},isEnabled:function isEnabled(){if(!this.model||!this.model.get("_isEnabled"))return false;return true},getStartId:function getStartId(){var startId=this.model.get("_id");var startIds=this.model.get("_startIds");if(!startIds||!startIds.length)return startId;var $html=$("html");for(var i=0,l=startIds.length;i<l;i++){var item=startIds[i];var className=item._className;var skipIfComplete=item._skipIfComplete;var model=Adapt.findById(item._id);if(!model){console.log("startController: cannot find id",item._id);continue}if(skipIfComplete){if(model.get("_isComplete"))continue}if(!className||$html.is(className)||$html.hasClass(className)){startId=item._id;break}}return startId}});Adapt.once("adapt:start",function(){Adapt.startController.loadCourseData();Adapt.startController.setStartLocation()});Adapt.on("navigation:returnToStart",function(){Adapt.startController.returnToStartLocation()});return Adapt.startController=new StartController});define("core/js/data",["core/js/adapt","core/js/collections/adaptCollection","core/js/models/buildModel","core/js/models/configModel","core/js/models/courseModel","core/js/models/lockingModel","core/js/startController"],function(Adapt,AdaptCollection,BuildModel,ConfigModel,CourseModel){var Data=function(_AdaptCollection){"use strict";_inherits(Data,_AdaptCollection);var _super12=_createSuper(Data);function Data(){_classCallCheck(this,Data);return _super12.apply(this,arguments)}_createClass(Data,[{key:"model",value:function model(json){var ModelClass=Adapt.getModelClass(json);if(!ModelClass){return new Backbone.Model(json)}return new ModelClass(json)}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(Data.prototype),"initialize",this).call(this);this.on({"add":this.onAdded,"remove":this.onRemoved})}},{key:"init",value:function(){var _init=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.reset();this._byAdaptID={};Adapt.build=new BuildModel(null,{url:"adapt/js/build.min.js",reset:true});_context2.next=5;return Adapt.build.whenReady();case 5:$("html").attr("data-adapt-framework-version",Adapt.build.get("package").version);this.loadConfigData();case 7:case"end":return _context2.stop();}}},_callee2,this)}));function init(){return _init.apply(this,arguments)}return init}()},{key:"onAdded",value:function onAdded(model){this._byAdaptID[model.get("_id")]=model}},{key:"onRemoved",value:function onRemoved(model){delete this._byAdaptID[model.get("_id")]}},{key:"loadConfigData",value:function loadConfigData(){Adapt.config=new ConfigModel(null,{url:"course/config."+Adapt.build.get("jsonext"),reset:true});this.listenToOnce(Adapt,"configModel:loadCourseData",this.onLoadCourseData);this.listenTo(Adapt.config,{"change:_activeLanguage":this.onLanguageChange,"change:_defaultDirection":this.onDirectionChange})}},{key:"onDirectionChange",value:function onDirectionChange(model,direction){if(direction==="rtl"){$("html").removeClass("dir-ltr").addClass("dir-rtl").attr("dir","rtl")}else{$("html").removeClass("dir-rtl").addClass("dir-ltr").attr("dir","ltr")}}},{key:"onLoadCourseData",value:function onLoadCourseData(){if(!Adapt.config.get("_activeLanguage")){Adapt.config.set("_activeLanguage",Adapt.config.get("_defaultLanguage"));return}this.loadCourseData()}},{key:"onLanguageChange",value:function onLanguageChange(model,language){Adapt.offlineStorage.set("lang",language);this.loadCourseData(language)}},{key:"loadCourseData",value:function(){var _loadCourseData=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(newLanguage){var language,courseFolder;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:language=Adapt.config.get("_activeLanguage");courseFolder="course/"+language+"/";$("html").attr("lang",language);_context3.next=5;return this.loadManifestFiles(courseFolder);case 5:_context3.next=7;return this.triggerDataLoaded();case 7:_context3.next=9;return this.triggerDataReady(newLanguage);case 9:this.triggerInit();case 10:case"end":return _context3.stop();}}},_callee3,this)}));function loadCourseData(_x){return _loadCourseData.apply(this,arguments)}return loadCourseData}()},{key:"getJSON",value:function getJSON(path){var _this33=this;return new Promise(function(resolve,reject){var _this34=this;_newArrowCheck(this,_this33);$.getJSON(path,function(data){_newArrowCheck(this,_this34);data.__path__=path;resolve(data)}.bind(this)).fail(reject)}.bind(this))}},{key:"loadManifestFiles",value:function(){var _loadManifestFiles=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(languagePath){var _this35=this;var manifestPath,manifest,allFileData,allModelData,course;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:this.trigger("loading");this.reset();manifestPath=languagePath+"language_data_manifest.js";_context4.prev=3;_context4.next=6;return this.getJSON(manifestPath);case 6:manifest=_context4.sent;_context4.next=13;break;case 9:_context4.prev=9;_context4.t0=_context4["catch"](3);manifest=["course.json","contentObjects.json","articles.json","blocks.json","components.json"];Adapt.log.warnOnce("Manifest path '".concat(manifestPath," not found. Using traditional files: ").concat(manifest.join(", ")));case 13:_context4.next=15;return Promise.all(manifest.map(function(filePath){_newArrowCheck(this,_this35);return this.getJSON("".concat(languagePath).concat(filePath))}.bind(this)));case 15:allFileData=_context4.sent;allModelData=allFileData.reduce(function(result,fileData){_newArrowCheck(this,_this35);if(Array.isArray(fileData)){result.push.apply(result,_toConsumableArray(fileData))}else if(fileData instanceof Object){result.push(fileData)}else{Adapt.log.warnOnce("File data isn't an array or object: ".concat(fileData.__path__))}return result}.bind(this),[]);course=allModelData.find(function(modelData){_newArrowCheck(this,_this35);return modelData._type==="course"}.bind(this));if(course){_context4.next=20;break}throw new Error("Expected a model data with \"_type\": \"course\", none found.");case 20:Adapt.trigger("courseModel:dataLoading");Adapt.course=this.push(course);Adapt.trigger("courseModel:dataLoaded");allModelData.forEach(function(modelData){_newArrowCheck(this,_this35);if(modelData._type==="course"){return}this.push(modelData)}.bind(this));this.trigger("reset");this.trigger("loaded");_context4.next=28;return Adapt.wait.queue();case 28:case"end":return _context4.stop();}}},_callee4,this,[[3,9]])}));function loadManifestFiles(_x2){return _loadManifestFiles.apply(this,arguments)}return loadManifestFiles}()},{key:"triggerDataLoaded",value:function(){var _triggerDataLoaded=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var _this36=this;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:Adapt.log.debug("Firing app:dataLoaded");try{this.forEach(function(model){_newArrowCheck(this,_this36);return model.setupModel&&model.setupModel()}.bind(this));Adapt.trigger("app:dataLoaded")}catch(e){Adapt.log.error("Error during app:dataLoading trigger",e)}_context5.next=4;return Adapt.wait.queue();case 4:case"end":return _context5.stop();}}},_callee5,this)}));function triggerDataLoaded(){return _triggerDataLoaded.apply(this,arguments)}return triggerDataLoaded}()},{key:"triggerDataReady",value:function(){var _triggerDataReady=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(newLanguage){var _this37=this;return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(newLanguage){Adapt.trigger("app:languageChanged",newLanguage);_.defer(function(){_newArrowCheck(this,_this37);Adapt.startController.loadCourseData();var hash=Adapt.startController.isEnabled()?"#/":Adapt.startController.getStartHash(true);Adapt.router.navigate(hash,{trigger:true,replace:true})}.bind(this))}Adapt.log.debug("Firing app:dataReady");try{Adapt.trigger("app:dataReady")}catch(e){Adapt.log.error("Error during app:dataReady trigger",e)}_context6.next=5;return Adapt.wait.queue();case 5:case"end":return _context6.stop();}}},_callee6,this)}));function triggerDataReady(_x3){return _triggerDataReady.apply(this,arguments)}return triggerDataReady}()},{key:"triggerInit",value:function triggerInit(){this.isReady=true;this.trigger("ready")}},{key:"whenReady",value:function whenReady(){var _this38=this;if(this.isReady)return Promise.resolve();return new Promise(function(resolve){_newArrowCheck(this,_this38);this.once("ready",resolve)}.bind(this))}},{key:"findById",value:function findById(id){var model=this._byAdaptID[id];if(!model){console.warn("Adapt.findById() unable to find collection type for id: ".concat(id));return}return model}}]);return Data}(AdaptCollection);return Adapt.data=new Data});define("core/js/offlineStorage",["core/js/adapt"],function(Adapt){var OfflineStorage=Backbone.Controller.extend({ready:true,_handler:undefined,initialize:function initialize(handler){if(!handler){return}this.ready=false;this._handler=handler},hasHandler:function hasHandler(){return this._handler!==undefined},save:function save(){Adapt.trigger("tracking:save");if(this._handler&&this._handler.save){return this._handler.save.apply(this._handler,arguments)}},serialize:function serialize(value){if(this._handler&&this._handler.serialize){return this._handler.serialize.apply(this._handler,arguments)}return JSON.stringify(value)},deserialize:function deserialize(value){if(this._handler&&this._handler.deserialize){return this._handler.deserialize.apply(this._handler,arguments)}return JSON.parse(value)},set:function set(name,value){if(this._handler&&this._handler.set){return this._handler.set.apply(this._handler,arguments)}this[name]=value},get:function get(name){if(this._handler&&this._handler.get){return this._handler.get.apply(this._handler,arguments)}return this[name]},setReadyStatus:function setReadyStatus(){this.ready=true;Adapt.trigger("offlineStorage:ready")}});Adapt.offlineStorage=new OfflineStorage;return Adapt.offlineStorage});define("core/js/enums/completionStateEnum",[],function(){var COMPLETION_STATE=ENUM(["INCOMPLETE","COMPLETED","PASSED","FAILED"]);return COMPLETION_STATE});define("core/js/tracking",["core/js/adapt","core/js/enums/completionStateEnum"],function(Adapt,COMPLETION_STATE){var Tracking=Backbone.Controller.extend({_config:{_requireContentCompleted:true,_requireAssessmentCompleted:false},_assessmentState:null,initialize:function initialize(){Adapt.once("configModel:dataLoaded",this.loadConfig.bind(this));Adapt.on("app:dataReady",this.setupEventListeners.bind(this))},setupEventListeners:function setupEventListeners(){if(this._config._requireAssessmentCompleted){this.listenTo(Adapt,{"assessment:complete":this.onAssessmentComplete,"assessment:restored":this.onAssessmentRestored})}if(this._config._requireContentCompleted){this.listenTo(Adapt.course,"change:_isComplete",this.checkCompletion)}},onAssessmentComplete:function onAssessmentComplete(assessmentState){this._assessmentState=assessmentState;this.checkCompletion()},onAssessmentRestored:function onAssessmentRestored(assessmentState){this._assessmentState=assessmentState},checkCompletion:function checkCompletion(){var completionData=this.getCompletionData();if(completionData.status===COMPLETION_STATE.INCOMPLETE){return}Adapt.trigger("tracking:complete",completionData);Adapt.log.debug("tracking:complete",completionData)},getCompletionData:function getCompletionData(){var completionData={status:COMPLETION_STATE.INCOMPLETE,assessment:null};if(this._config._requireContentCompleted&&!Adapt.course.get("_isComplete")){return completionData}if(this._config._requireAssessmentCompleted){if(!this._assessmentState){return completionData}completionData.status=this._assessmentState.isPass?COMPLETION_STATE.PASSED:COMPLETION_STATE.FAILED;completionData.assessment=this._assessmentState;return completionData}completionData.status=COMPLETION_STATE.COMPLETED;return completionData},loadConfig:function loadConfig(){if(Adapt.config.has("_completionCriteria")){this._config=Adapt.config.get("_completionCriteria")}}});Adapt.tracking=new Tracking;return Adapt.tracking});define("core/js/device",["core/js/adapt","bowser"],function(Adapt,Bowser){var $html=$("html");var $window=$(window);Adapt.device={touch:Modernizr.touchevents,screenWidth:getScreenWidth(),screenHeight:getScreenHeight(),browser:(Bowser.name||"").toLowerCase(),version:(Bowser.version||"").toLowerCase(),OS:getOperatingSystem().toLowerCase(),osVersion:Bowser.osversion||"",renderingEngine:getRenderingEngine()};Object.defineProperties(Adapt.device,{"orientation":{get:function get(){return this.screenWidth>=this.screenHeight?"landscape":"portrait"}},"aspectRatio":{get:function get(){return this.screenWidth/this.screenHeight}}});Adapt.once("app:dataReady",function(){Adapt.device.screenSize=checkScreenSize();$html.addClass("size-"+Adapt.device.screenSize);if(Adapt.device.orientation){$html.addClass("orientation-"+Adapt.device.orientation)}$window.on("resize orientationchange",onWindowResize)});function checkScreenSize(){var screenSizeConfig=Adapt.config.get("screenSize");var screenSize;var screensizeEmThreshold=300;var baseFontSize=16;var mediumEmBreakpoint=screenSizeConfig.medium>screensizeEmThreshold?screenSizeConfig.medium/baseFontSize:screenSizeConfig.medium;var smallEmBreakpoint=screenSizeConfig.small>screensizeEmThreshold?screenSizeConfig.small/baseFontSize:screenSizeConfig.small;var fontSize=parseFloat($("html").css("font-size"));var screenSizeEmWidth=Adapt.device.screenWidth/fontSize;if(screenSizeEmWidth>=mediumEmBreakpoint){screenSize="large"}else if(screenSizeEmWidth>=smallEmBreakpoint){screenSize="medium"}else{screenSize="small"}return screenSize}function getScreenWidth(){return isAppleDevice()?getAppleScreenWidth():window.innerWidth||$window.width()}function getScreenHeight(){return isAppleDevice()?getAppleScreenHeight():window.innerHeight||$window.height()}function getOperatingSystem(){var os="";var flags=["windows","mac","linux","windowsphone","chromeos","android","ios","blackberry","firefoxos","webos","bada","tizen","sailfish"];for(var i=0;i<flags.length;i++){if(Bowser[flags[i]]){os=flags[i];break}}if(os===""){var platform=navigator.platform;var platforms=["Win","Mac","Linux"];os="PlatformUnknown";for(var j=0;j<platforms.length;j++){if(platform.indexOf(platforms[j])!==-1){os=platforms[j].toLowerCase();break}}if(os==="win"){os="windows"}}return os}function getRenderingEngine(){var engine="";var flags=["webkit","blink","gecko","msie","msedge"];for(var i=0;i<flags.length;i++){if(Bowser[flags[i]]){engine=flags[i];break}}return engine}var onWindowResize=_.debounce(function onScreenSizeChanged(){var previousWidth=Adapt.device.screenWidth;var previousHeight=Adapt.device.screenHeight;Adapt.device.screenWidth=getScreenWidth();Adapt.device.screenHeight=getScreenHeight();if(previousWidth===Adapt.device.screenWidth&&previousHeight===Adapt.device.screenHeight){return}var newScreenSize=checkScreenSize();if(newScreenSize!==Adapt.device.screenSize){Adapt.device.screenSize=newScreenSize;$html.removeClass("size-small size-medium size-large").addClass("size-"+Adapt.device.screenSize);if(Adapt.device.orientation){$html.removeClass("orientation-landscape orientation-portrait").addClass("orientation-"+Adapt.device.orientation)}Adapt.trigger("device:changed",Adapt.device.screenSize)}Adapt.trigger("device:preResize device:resize device:postResize",Adapt.device.screenWidth)},100);function isAppleDevice(){return /iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function getAppleScreenWidth(){return Math.abs(window.orientation)===90?screen.height:screen.width}function getAppleScreenHeight(){return Math.abs(window.orientation)===90?screen.width:screen.height}function getAppleDeviceType(){var type="";var flags=["iphone","ipad","ipod"];for(var i=0;i<flags.length;i++){if(Bowser[flags[i]]){type=flags[i];break}}return type}function pixelDensity(){var pixelDensity=window.devicePixelRatio||1;if(pixelDensity>=3){return"ultra-high"}else if(pixelDensity>=2){return"high"}else if(pixelDensity>=1.5){return"medium"}else{return"low"}}var browser=Adapt.device.browser.toLowerCase();var browserString=browser.replace(/msie|internet explorer/,"ie");browserString=browserString+" version-"+Adapt.device.version+" OS-"+Adapt.device.OS+" "+getAppleDeviceType();browserString+=browserString.replace(".","-").toLowerCase();$html.addClass(browserString+" pixel-density-"+pixelDensity())});define("core/js/views/drawerItemView",["core/js/adapt"],function(Adapt){var DrawerItemView=Backbone.View.extend({className:"drawer__menu drawer__item",attributes:{role:"list"},initialize:function initialize(){this.listenTo(Adapt,"drawer:empty",this.remove);this.render()},events:{"click .drawer__item-btn":"onDrawerItemClicked"},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates["drawerItem"];$(this.el).html(template(data)).appendTo(".drawer__holder");return this},onDrawerItemClicked:function onDrawerItemClicked(event){event.preventDefault();var eventCallback=this.model.get("eventCallback");Adapt.trigger(eventCallback)}},{type:"drawerItem"});return DrawerItemView});define("core/js/views/drawerView",["core/js/adapt","core/js/views/drawerItemView"],function(Adapt,DrawerItemView){var DrawerView=Backbone.View.extend({className:"drawer u-display-none",disableAnimation:false,attributes:{"role":"dialog","aria-modal":"true","aria-labelledby":"drawer-heading","aria-hidden":"true"},initialize:function initialize(){this.disableAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;this._isVisible=false;this.drawerDir="right";if(Adapt.config.get("_defaultDirection")==="rtl"){this.drawerDir="left"}this.setupEventListeners();this.render();this.drawerDuration=Adapt.config.get("_drawer")._duration;this.drawerDuration=this.drawerDuration?this.drawerDuration:400;this.$wrapper=$("#wrapper")},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"navigation:toggleDrawer":this.toggleDrawer,"drawer:triggerCustomView":this.openCustomView,"drawer:closeDrawer":this.onCloseDrawer,"remove":this.onRemove,"drawer:remove":this.remove});this._onKeyUp=_.bind(this.onKeyUp,this);this.setupEscapeKey()},setupEscapeKey:function setupEscapeKey(){$(window).on("keyup",this._onKeyUp)},onKeyUp:function onKeyUp(event){if(event.which!==27)return;event.preventDefault();this.onCloseDrawer()},events:{"click .drawer__back":"onBackButtonClicked","click .drawer__close":"onCloseClicked"},render:function render(){var template=Handlebars.templates["drawer"];$(this.el).html(template({_globals:Adapt.course.get("_globals")})).prependTo("body");var shadowTemplate=Handlebars.templates["shadow"];$(shadowTemplate()).prependTo("body");_.defer(_.bind(function(){this.postRender()},this));return this},postRender:function postRender(){this.$("a, button, input, select, textarea").attr("tabindex",-1);this.checkIfDrawerIsAvailable()},openCustomView:function openCustomView(view,hasBackButton){this._hasBackButton=hasBackButton;this._isCustomViewVisible=true;Adapt.trigger("drawer:empty");this.showDrawer();this.$(".drawer__holder").html(view)},checkIfDrawerIsAvailable:function checkIfDrawerIsAvailable(){if(this.collection.length===0){$(".js-nav-drawer-btn").addClass("u-display-none");Adapt.trigger("drawer:noItems");return}$(".js-nav-drawer-btn").removeClass("u-display-none")},onBackButtonClicked:function onBackButtonClicked(event){event.preventDefault();this.showDrawer(true)},onCloseClicked:function onCloseClicked(event){event.preventDefault();this.hideDrawer()},onCloseDrawer:function onCloseDrawer($toElement){this.hideDrawer($toElement)},onRemove:function onRemove(){this.hideDrawer()},toggleDrawer:function toggleDrawer(){if(this._isVisible&&this._isCustomViewVisible===false){this.hideDrawer()}else{this.showDrawer(true)}},showDrawer:function showDrawer(emptyDrawer){this.$el.removeClass("u-display-none").removeAttr("aria-hidden");if(!this._isVisible){Adapt.a11y.popupOpened(this.$el);Adapt.a11y.scrollDisable("body");this._isVisible=true}this.$("a, button, input, select, textarea").attr("tabindex",0);if(emptyDrawer){this.$(".drawer__back").addClass("u-display-none");this._isCustomViewVisible=false;this.emptyDrawer();if(this.collection.models.length===1){Adapt.trigger(this.collection.models[0].get("eventCallback"));this._isCustomViewVisible=false}else{this.renderItems();Adapt.trigger("drawer:openedItemView")}}else{if(this._hasBackButton&&this.collection.models.length>1){this.$(".drawer__back").removeClass("u-display-none")}else{this.$(".drawer__back").addClass("u-display-none")}Adapt.trigger("drawer:openedCustomView")}var direction={};if(this.disableAnimation){$(".js-shadow").removeClass("u-display-none");$(".js-drawer-holder").scrollTop(0);direction[this.drawerDir]=0;this.$el.css(direction);complete.call(this)}else{$(".js-shadow").velocity({opacity:1},{duration:this.drawerDuration,begin:_.bind(function(){$(".js-shadow").removeClass("u-display-none");$(".js-drawer-holder").scrollTop(0);complete.call(this)},this)});var showEasingAnimation=Adapt.config.get("_drawer")._showEasing;var easing=showEasingAnimation||"easeOutQuart";direction[this.drawerDir]=0;this.$el.velocity(direction,this.drawerDuration,easing)}function complete(){this.addShadowEvent();Adapt.trigger("drawer:opened");Adapt.a11y.focusFirst(this.$el,{defer:true})}},emptyDrawer:function emptyDrawer(){this.$(".drawer__holder").empty()},renderItems:function renderItems(){Adapt.trigger("drawer:empty");this.emptyDrawer();var models=this.collection.models;for(var i=0,len=models.length;i<len;i++){var item=models[i];new DrawerItemView({model:item})}},hideDrawer:function hideDrawer($toElement){var direction={};if(this._isVisible){Adapt.a11y.popupClosed($toElement);this._isVisible=false;Adapt.a11y.scrollEnable("body")}else{return}if(this.disableAnimation){direction[this.drawerDir]=-this.$el.width();this.$el.css(direction).addClass("u-display-none").attr("aria-hidden","true");$(".js-shadow").addClass("u-display-none");Adapt.trigger("drawer:closed")}else{var showEasingAnimation=Adapt.config.get("_drawer")._hideEasing;var easing=showEasingAnimation||"easeOutQuart";direction[this.drawerDir]=-this.$el.width();this.$el.velocity(direction,this.drawerDuration,easing,_.bind(function(){this.$el.addClass("u-display-none").attr("aria-hidden","true");Adapt.trigger("drawer:closed")},this));$(".js-shadow").velocity({opacity:0},{duration:this.drawerDuration,complete:function complete(){$(".js-shadow").addClass("u-display-none")}})}this._isCustomViewVisible=false;this.removeShadowEvent()},addShadowEvent:function addShadowEvent(){$(".js-shadow").one("click touchstart",function(){this.onCloseDrawer()}.bind(this))},removeShadowEvent:function removeShadowEvent(){$(".js-shadow").off("click touchstart")},remove:function remove(){Backbone.View.prototype.remove.apply(this,arguments);$(window).off("keyup",this._onKeyUp);Adapt.trigger("drawer:empty");this.collection.reset();$(".js-shadow").remove()}},{childContainer:".js-drawer-holder",childView:DrawerItemView});return DrawerView});define("core/js/drawer",["core/js/adapt","core/js/views/drawerView"],function(Adapt,DrawerView){var DrawerCollection=new Backbone.Collection(null,{comparator:"drawerOrder"});var Drawer={};Drawer.addItem=function(drawerObject,eventCallback){drawerObject.eventCallback=eventCallback;DrawerCollection.add(drawerObject)};Drawer.triggerCustomView=function(view,hasBackButton){if(hasBackButton!==false){hasBackButton=true}Adapt.trigger("drawer:triggerCustomView",view,hasBackButton)};Adapt.on({"adapt:start":function adaptStart(){new DrawerView({collection:DrawerCollection})},"app:languageChanged":function appLanguageChanged(){Adapt.trigger("drawer:remove")}});Adapt.drawer=Drawer});define("core/js/views/notifyPushView",["core/js/adapt"],function(Adapt){var NotifyPushView=Backbone.View.extend({className:function className(){var classes="notify-push ";classes+=this.model.get("_classes")||"";return classes},attributes:{"role":"dialog","aria-labelledby":"notify-push-heading","aria-modal":"false"},initialize:function initialize(){this.listenTo(Adapt,{"notify:pushShown notify:pushRemoved":this.updateIndexPosition,"remove":this.remove});this.listenTo(this.model.collection,{"remove":this.updateIndexPosition,"change:_index":this.updatePushPosition});this.preRender();this.render()},events:{"click .js-notify-push-close-btn":"closePush","click .js-notify-push-inner":"triggerEvent"},preRender:function preRender(){this.hasBeenRemoved=false},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates["notifyPush"];this.$el.html(template(data)).appendTo("#wrapper");_.defer(this.postRender.bind(this));return this},postRender:function postRender(){this.$el.addClass("is-active");_.delay(this.closePush.bind(this),this.model.get("_timeout"));Adapt.trigger("notify:pushShown")},closePush:function closePush(event){if(event){event.preventDefault()}if(this.hasBeenRemoved===false){this.hasBeenRemoved=true;this.$el.removeClass("is-active");_.delay(function(){this.model.collection.remove(this.model);Adapt.trigger("notify:pushRemoved",this);this.remove()}.bind(this),600)}},triggerEvent:function triggerEvent(event){Adapt.trigger(this.model.get("_callbackEvent"));this.closePush()},updateIndexPosition:function updateIndexPosition(){if(!this.hasBeenRemoved){var models=this.model.collection.models;for(var i=0,len=models.length;i<len;i++){var index=i;var model=models[i];if(model.get("_isActive")===true){model.set("_index",index);this.updatePushPosition()}}}},updatePushPosition:function updatePushPosition(){if(this.hasBeenRemoved){return}if(typeof this.model.get("_index")!=="undefined"){var elementHeight=this.$el.height();var offset=20;var navigationHeight=$(".nav").height();var currentIndex=this.model.get("_index");var flippedIndex=currentIndex===0?1:0;if(this.model.collection.where({_isActive:true}).length===1){flippedIndex=0}var positionLowerPush=(elementHeight+offset)*flippedIndex+navigationHeight+offset;this.$el.css("top",positionLowerPush)}}});return NotifyPushView});define("core/js/models/notifyModel",[],function(){var NotifyModel=Backbone.Model.extend({defaults:{_isActive:false,_showIcon:false,_timeout:3000}});return NotifyModel});define("core/js/collections/notifyPushCollection",["core/js/adapt","core/js/views/notifyPushView","core/js/models/notifyModel"],function(Adapt,NotifyPushView,NotifyModel){var NotifyPushCollection=Backbone.Collection.extend({model:NotifyModel,initialize:function initialize(){this.listenTo(this,"add",this.onPushAdded);this.listenTo(Adapt,"notify:pushRemoved",this.onRemovePush)},onPushAdded:function onPushAdded(model){this.checkPushCanShow(model)},checkPushCanShow:function checkPushCanShow(model){if(this.canShowPush()){model.set("_isActive",true);this.showPush(model)}},canShowPush:function canShowPush(){var availablePushNotifications=this.where({_isActive:true});if(availablePushNotifications.length>=2){return false}return true},showPush:function showPush(model){new NotifyPushView({model:model})},onRemovePush:function onRemovePush(view){var inactivePushNotifications=this.where({_isActive:false});if(inactivePushNotifications.length>0){this.checkPushCanShow(inactivePushNotifications[0])}}});return NotifyPushCollection});define("core/js/views/adaptView",["core/js/adapt"],function(Adapt){var AdaptView=function(_Backbone$View){"use strict";_inherits(AdaptView,_Backbone$View);var _super13=_createSuper(AdaptView);function AdaptView(){_classCallCheck(this,AdaptView);return _super13.apply(this,arguments)}_createClass(AdaptView,[{key:"attributes",value:function attributes(){return{"data-adapt-id":this.model.get("_id")}}},{key:"initialize",value:function initialize(){this.listenTo(this.model,{"change:_isVisible":this.toggleVisibility,"change:_isHidden":this.toggleHidden,"change:_isComplete":this.onIsCompleteChange});this.model.set({"_globals":Adapt.course.get("_globals"),"_isReady":false});this._isRemoved=false;if(Adapt.location._currentId===this.model.get("_id")){Adapt.parentView=this}this.preRender();this.render();this.setupOnScreenHandler()}},{key:"preRender",value:function preRender(){}},{key:"postRender",value:function postRender(){this.addChildren()}},{key:"render",value:function render(){var _this39=this;var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRender view:preRender"),this);var data=this.model.toJSON();data.view=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data));Adapt.trigger("".concat(type,"View:render view:render"),this);_.defer(function(){_newArrowCheck(this,_this39);if(this._isRemoved)return;this.postRender();Adapt.trigger("".concat(type,"View:postRender view:postRender"),this)}.bind(this));return this}},{key:"setupOnScreenHandler",value:function setupOnScreenHandler(){var _this40=this;var onscreen=this.model.get("_onScreen");if(!onscreen||!onscreen._isEnabled)return;this.$el.addClass("has-animation ".concat(onscreen._classes,"-before"));this.$el.on("onscreen.adaptView",function(e,m){_newArrowCheck(this,_this40);if(!m.onscreen)return;var minVerticalInview=onscreen._percentInviewVertical||33;if(m.percentInviewVertical<minVerticalInview)return;this.$el.addClass("".concat(onscreen._classes,"-after")).off("onscreen.adaptView")}.bind(this))}},{key:"addChildren",value:function addChildren(){var _this41=this;var nthChild=0;var _this$model$getChildr=this.model.getChildren(),models=_this$model$getChildr.models;this.childViews={};models.forEach(function(model){_newArrowCheck(this,_this41);if(!model.get("_isAvailable"))return;nthChild++;model.set("_nthChild",nthChild);var ChildView=this.constructor.childView||Adapt.getViewClass(model);if(!ChildView){throw new Error("The component '".concat(model.attributes._id,"' ('").concat(model.attributes._component,"') has not been installed, and so is not available in your project."))}var $parentContainer=this.$(this.constructor.childContainer);var childView=new ChildView({model:model});this.childViews[model.get("_id")]=childView;$parentContainer.append(childView.$el)}.bind(this))}},{key:"findDescendantViews",value:function findDescendantViews(isParentFirst){var _this42=this;var descendants=[];this.childViews&&_.each(this.childViews,function(view){_newArrowCheck(this,_this42);if(isParentFirst)descendants.push(view);var children=view.findDescendantViews&&view.findDescendantViews(isParentFirst);if(children)descendants.push.apply(descendants,_toConsumableArray(children));if(!isParentFirst)descendants.push(view)}.bind(this));return descendants}},{key:"setReadyStatus",value:function setReadyStatus(){this.model.set("_isReady",true)}},{key:"setCompletionStatus",value:function setCompletionStatus(){if(!this.model.get("_isVisible"))return;this.model.set({_isComplete:true,_isInteractionComplete:true})}},{key:"resetCompletionStatus",value:function resetCompletionStatus(type){var _this43=this;if(!this.model.get("_canReset"))return;var descendantComponents=this.model.findDescendantModels("components");if(descendantComponents.length===0){this.model.reset(type)}else{descendantComponents.forEach(function(model){_newArrowCheck(this,_this43);return model.reset(type)}.bind(this))}}},{key:"preRemove",value:function preRemove(){var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRemove view:preRemove"),this)}},{key:"remove",value:function remove(){var _this44=this;var type=this.constructor.type;this.preRemove();Adapt.trigger("".concat(type,"View:remove view:remove"),this);this._isRemoved=true;Adapt.wait.for(function(end){var _this45=this;_newArrowCheck(this,_this44);this.$el.off("onscreen.adaptView");_get(_getPrototypeOf(AdaptView.prototype),"remove",this).call(this);_.defer(function(){_newArrowCheck(this,_this45);Adapt.trigger("".concat(type,"View:postRemove view:postRemove"),this)}.bind(this));end()}.bind(this));return this}},{key:"setVisibility",value:function setVisibility(){return this.model.get("_isVisible")?"":"u-visibility-hidden"}},{key:"toggleVisibility",value:function toggleVisibility(){this.$el.toggleClass("u-visibility-hidden",!this.model.get("_isVisible"))}},{key:"setHidden",value:function setHidden(){return this.model.get("_isHidden")?"u-display-none":""}},{key:"toggleHidden",value:function toggleHidden(){this.$el.toggleClass("u-display-none",this.model.get("_isHidden"))}},{key:"onIsCompleteChange",value:function onIsCompleteChange(model,isComplete){this.$el.toggleClass("is-complete",isComplete)}},{key:"getChildViews",value:function getChildViews(){return this.childViews}}]);return AdaptView}(Backbone.View);AdaptView.className="";return AdaptView});define("core/js/views/notifyView",["core/js/adapt","core/js/views/adaptView"],function(Adapt,AdaptView){var NotifyView=function(_Backbone$View2){"use strict";_inherits(NotifyView,_Backbone$View2);var _super14=_createSuper(NotifyView);function NotifyView(){_classCallCheck(this,NotifyView);return _super14.apply(this,arguments)}_createClass(NotifyView,[{key:"className",value:function className(){return"notify ".concat(this.model.get("_classes")||"")}},{key:"attributes",value:function attributes(){return Object.assign({role:"dialog","aria-labelledby":"notify-heading","aria-modal":"true"},this.model.get("_attributes"))}},{key:"events",value:function events(){return{"click .js-notify-btn-alert":"onAlertButtonClicked","click .js-notify-btn-prompt":"onPromptButtonClicked","click .js-notify-close-btn":"onCloseButtonClicked","click .js-notify-shadow-click":"onShadowClicked"}}},{key:"initialize",value:function initialize(){_.bindAll(this,"resetNotifySize","onKeyUp");this.disableAnimation=Adapt.config.get("_disableAnimation")||false;this.isOpen=false;this.hasOpened=false;this.setupEventListeners();this.render()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(Adapt,{"remove page:scrollTo":this.closeNotify,"notify:resize":this.resetNotifySize,"notify:cancel":this.cancelNotify,"notify:close":this.closeNotify,"device:resize":this.resetNotifySize});this.setupEscapeKey()}},{key:"setupEscapeKey",value:function setupEscapeKey(){$(window).on("keyup",this.onKeyUp)}},{key:"onKeyUp",value:function onKeyUp(event){if(event.which!==27)return;event.preventDefault();this.cancelNotify()}},{key:"render",value:function render(){var data=this.model.toJSON();var template=Handlebars.templates.notify;this.$el.css("visibility","hidden");this.$el.html(template(data)).appendTo("body");this.$(".notify__popup").css("visibility","hidden");this.$el.css("visibility","visible");this.showNotify();return this}},{key:"onAlertButtonClicked",value:function onAlertButtonClicked(event){event.preventDefault();this.closeNotify();Adapt.trigger(this.model.get("_callbackEvent"),this)}},{key:"onPromptButtonClicked",value:function onPromptButtonClicked(event){event.preventDefault();this.closeNotify();Adapt.trigger($(event.currentTarget).attr("data-event"),this)}},{key:"onCloseButtonClicked",value:function onCloseButtonClicked(event){event.preventDefault();this.cancelNotify()}},{key:"onShadowClicked",value:function onShadowClicked(event){event.preventDefault();if(this.model.get("_closeOnShadowClick")===false)return;this.cancelNotify()}},{key:"cancelNotify",value:function cancelNotify(){if(this.model.get("_isCancellable")===false)return;this.closeNotify();Adapt.trigger("notify:cancelled",this)}},{key:"resetNotifySize",value:function resetNotifySize(){if(!this.hasOpened)return;this.resizeNotify()}},{key:"resizeNotify",value:function resizeNotify(){var windowHeight=$(window).height();var notifyHeight=this.$(".notify__popup-inner").outerHeight();var isFullWindow=notifyHeight>=windowHeight;this.$(".notify__popup").css({"height":isFullWindow?"100%":"auto","top":isFullWindow?0:"","margin-top":isFullWindow?"":-(notifyHeight/2),"overflow-y":isFullWindow?"scroll":"","-webkit-overflow-scrolling":isFullWindow?"touch":""})}},{key:"showNotify",value:function(){var _showNotify=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(){return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:this.isOpen=true;_context7.next=3;return this.addSubView();case 3:Adapt.notify.stack.push(this);this.$previousActiveElement=$(document.activeElement);Adapt.trigger("notify:opened",this);this.$el.imageready(this.onLoaded.bind(this));case 7:case"end":return _context7.stop();}}},_callee7,this)}));function showNotify(){return _showNotify.apply(this,arguments)}return showNotify}()},{key:"onLoaded",value:function onLoaded(){var _this46=this;if(this.disableAnimation){this.$(".notify__shadow").css("display","block")}else{this.$(".notify__shadow").velocity({opacity:0},{duration:0}).velocity({opacity:1},{duration:400,begin:function begin(){_newArrowCheck(this,_this46);this.$(".notify__shadow").css("display","block")}.bind(this)})}this.resizeNotify();if(this.disableAnimation){this.$(".notify__popup").css("visibility","visible");this.onOpened()}else{this.$(".notify__popup").velocity({opacity:0},{duration:0}).velocity({opacity:1},{duration:400,begin:function begin(){_newArrowCheck(this,_this46);this.$(".notify__popup").css("visibility","visible");this.onOpened()}.bind(this)})}}},{key:"onOpened",value:function onOpened(){$.inview();this.hasOpened=true;Adapt.a11y.popupOpened(this.$(".notify__popup"));Adapt.a11y.scrollDisable("body");$("html").addClass("notify");Adapt.a11y.focusFirst(this.$(".notify__popup"),{defer:false})}},{key:"addSubView",value:function(){var _addSubView=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(){var _this47=this;var model,View;return regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:this.subView=this.model.get("_view");if(this.model.get("_id")){model=Adapt.findById(this.model.get("_id"));View=Adapt.getViewClass(model);this.subView=new View({model:model})}if(this.subView){_context8.next=4;break}return _context8.abrupt("return");case 4:this.subView.$el.on("resize",this.resetNotifySize);this.$(".notify__content-inner").prepend(this.subView.$el);if(!(!(this.subView instanceof AdaptView)||this.subView.model.get("_isReady"))){_context8.next=8;break}return _context8.abrupt("return");case 8:return _context8.abrupt("return",new Promise(function(resolve){var _this48=this;_newArrowCheck(this,_this47);var _check=function check(model,value){_newArrowCheck(this,_this48);if(!value)return;this.subView.model.off("change:_isReady",_check);resolve()}.bind(this);this.subView.model.on("change:_isReady",_check)}.bind(this)));case 9:case"end":return _context8.stop();}}},_callee8,this)}));function addSubView(){return _addSubView.apply(this,arguments)}return addSubView}()},{key:"closeNotify",value:function closeNotify(){var _this49=this;var stackItem=Adapt.notify.stack[Adapt.notify.stack.length-1];if(this!==stackItem)return;Adapt.notify.stack.pop();if(!this.isOpen)return;this.isOpen=false;if(this.hasOpened){this.onCloseReady();return}this.listenToOnce(Adapt,"popup:opened",function(){_newArrowCheck(this,_this49);_.defer(this.onCloseReady.bind(this))}.bind(this))}},{key:"onCloseReady",value:function onCloseReady(){var _this50=this;if(this.disableAnimation){this.$(".notify__popup").css("visibility","hidden");this.$el.css("visibility","hidden");this.remove()}else{this.$(".notify__popup").velocity({opacity:0},{duration:400,complete:function complete(){_newArrowCheck(this,_this50);this.$(".notify__popup").css("visibility","hidden")}.bind(this)});this.$(".notify__shadow").velocity({opacity:0},{duration:400,complete:function complete(){_newArrowCheck(this,_this50);this.$el.css("visibility","hidden");this.remove()}.bind(this)})}Adapt.a11y.scrollEnable("body");$("html").removeClass("notify");Adapt.a11y.popupClosed(this.$previousActiveElement);Adapt.trigger("notify:closed",this)}},{key:"remove",value:function remove(){var _get2;this.removeSubView();$(window).off("keyup",this.onKeyUp);for(var _len13=arguments.length,args=new Array(_len13),_key13=0;_key13<_len13;_key13++){args[_key13]=arguments[_key13]}(_get2=_get(_getPrototypeOf(NotifyView.prototype),"remove",this)).call.apply(_get2,[this].concat(args))}},{key:"removeSubView",value:function removeSubView(){var _this51=this;if(!this.subView)return;this.subView.$el.off("resize",this.resetNotifySize);if(this.subView instanceof AdaptView){var views=[].concat(_toConsumableArray(this.subView.findDescendantViews()),[this.subView]);views.forEach(function(view){_newArrowCheck(this,_this51);view.model.set("_isReady",false);view.remove()}.bind(this))}else{this.subView.remove()}this.subView=null}}]);return NotifyView}(Backbone.View);return NotifyView});define("core/js/notify",["core/js/adapt","core/js/collections/notifyPushCollection","core/js/views/notifyView","core/js/models/notifyModel"],function(Adapt,NotifyPushCollection,NotifyView,NotifyModel){var Notify=function(_Backbone$Controller4){"use strict";_inherits(Notify,_Backbone$Controller4);var _super15=_createSuper(Notify);function Notify(){_classCallCheck(this,Notify);return _super15.apply(this,arguments)}_createClass(Notify,[{key:"initialize",value:function initialize(){this._stack=[];this.notifyPushes=new NotifyPushCollection;this.listenTo(Adapt,{"notify:popup":this._deprecated.bind(this,"popup"),"notify:alert":this._deprecated.bind(this,"alert"),"notify:prompt":this._deprecated.bind(this,"prompt"),"notify:push":this._deprecated.bind(this,"push")})}},{key:"_deprecated",value:function _deprecated(type,notifyObject){Adapt.log.deprecated("NOTIFY DEPRECATED: Adapt.trigger('notify:".concat(type,"', notifyObject); is no longer supported, please use Adapt.notify.").concat(type,"(notifyObject);"));return this.create(notifyObject,{_type:type})}},{key:"create",value:function create(notifyObject,defaults){notifyObject=_.defaults({},notifyObject,defaults,{_type:"popup",_isCancellable:true,_showCloseButton:true,_closeOnShadowClick:true});if(notifyObject._type==="push"){this.notifyPushes.push(notifyObject);return}return new NotifyView({model:new NotifyModel(notifyObject)})}},{key:"popup",value:function popup(notifyObject){return this.create(notifyObject,{_type:"popup"})}},{key:"alert",value:function alert(notifyObject){return this.create(notifyObject,{_type:"alert"})}},{key:"prompt",value:function prompt(notifyObject){return this.create(notifyObject,{_type:"prompt"})}},{key:"push",value:function push(notifyObject){return this.create(notifyObject,{_type:"push"})}},{key:"stack",get:function get(){return this._stack}}]);return Notify}(Backbone.Controller);return Adapt.notify=new Notify});define("core/js/models/routerModel",["core/js/adapt"],function(Adapt){var RouterModel=function(_Backbone$Model5){"use strict";_inherits(RouterModel,_Backbone$Model5);var _super16=_createSuper(RouterModel);function RouterModel(){_classCallCheck(this,RouterModel);return _super16.apply(this,arguments)}_createClass(RouterModel,[{key:"defaults",value:function defaults(){return{_canNavigate:true,_shouldNavigateFocus:true}}},{key:"lockedAttributes",value:function lockedAttributes(){return{_canNavigate:false,_shouldNavigateFocus:false}}}]);return RouterModel}(Backbone.Model);return RouterModel});define("core/js/router",["core/js/adapt","core/js/models/routerModel","core/js/models/courseModel","core/js/models/contentObjectModel","core/js/models/menuModel","core/js/startController"],function(Adapt,RouterModel,CourseModel,ContentObjectModel,MenuModel){var Router=function(_Backbone$Router){"use strict";_inherits(Router,_Backbone$Router);var _super17=_createSuper(Router);function Router(){_classCallCheck(this,Router);return _super17.apply(this,arguments)}_createClass(Router,[{key:"routes",value:function routes(){return{"":"handleRoute","id/:id":"handleRoute",":pluginName(/*location)(/*action)":"handleRoute"}}},{key:"initialize",value:function initialize(_ref4){var model=_ref4.model;this.model=model;this._navigationRoot=null;this._isCircularNavigationInProgress=false;this.showLoading();this.$wrapper=$("#wrapper");this.$html=$("html");this.listenToOnce(Adapt,"app:dataReady",this.setDocumentTitle);this.listenTo(Adapt,"router:navigateTo",this.navigateToArguments)}},{key:"showLoading",value:function showLoading(){$(".js-loading").show()}},{key:"hideLoading",value:function hideLoading(){$(".js-loading").hide()}},{key:"setDocumentTitle",value:function setDocumentTitle(){var _this52=this;var currentModel=Adapt.location._currentModel;var hasSubTitle=currentModel&&currentModel!==Adapt.router.rootModel&&currentModel.get("title");var title=[this.rootModel.get("title"),hasSubTitle&&currentModel.get("title")].filter(Boolean).join(" | ");this.listenToOnce(Adapt,"contentObjectView:preRender",function(){_newArrowCheck(this,_this52);var escapedTitle=$("<div>".concat(title,"</div>")).text();document.title=escapedTitle}.bind(this))}},{key:"navigateToArguments",value:function navigateToArguments(args){var _this53=this;args=args.filter(function(v){_newArrowCheck(this,_this53);return v!==null}.bind(this));var options={trigger:false,replace:false};if(args.length===1&&Adapt.findById(args[0])){this.navigate("#/id/"+args[0],options);return}if(args.length<=3){this.navigate("#/"+args.join("/"),options);return}Adapt.log.deprecated("Use Backbone.history.navigate or window.location.href instead of Adapt.trigger('router:navigateTo')");this.handleRoute.apply(this,_toConsumableArray(args))}},{key:"handleRoute",value:function handleRoute(){var _this54=this;for(var _len14=arguments.length,args=new Array(_len14),_key14=0;_key14<_len14;_key14++){args[_key14]=arguments[_key14]}args=args.filter(function(v){_newArrowCheck(this,_this54);return v!==null}.bind(this));if(this.model.get("_canNavigate")){this._isCircularNavigationInProgress=false}if(this._isCircularNavigationInProgress===false){Adapt.trigger("router:navigate",args)}if(this.model.get("_canNavigate")){this.model.set("_canNavigate",false,{pluginName:"adapt"});if(args.length<=1){return this.handleId.apply(this,_toConsumableArray(args))}return this.handlePluginRouter.apply(this,_toConsumableArray(args))}if(this._isCircularNavigationInProgress){this._isCircularNavigationInProgress=false;return}this._isCircularNavigationInProgress=true;Adapt.trigger("router:navigationCancelled",args);this.navigateToCurrentRoute(true)}},{key:"handlePluginRouter",value:function(){var _handlePluginRouter=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(pluginName,location,action){var pluginLocation;return regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:pluginLocation=[pluginName,location&&"-".concat(location),action&&"-".concat(action)].filter(Boolean).join("");_context9.next=3;return this.updateLocation(pluginLocation,null,null,null);case 3:Adapt.trigger("router:plugin:"+pluginName,pluginName,location,action);Adapt.trigger("router:plugin",pluginName,location,action);this.model.set("_canNavigate",true,{pluginName:"adapt"});case 6:case"end":return _context9.stop();}}},_callee9,this)}));function handlePluginRouter(_x4,_x5,_x6){return _handlePluginRouter.apply(this,arguments)}return handlePluginRouter}()},{key:"handleId",value:function(){var _handleId=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(id){var _this55=this;var rootModel,model,isContentObject,isRoot,startController,isCourse,type,location,ViewClass,isMenu;return regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:rootModel=Adapt.router.rootModel;model=!id?rootModel:Adapt.findById(id);if(model){_context10.next=5;break}this.model.set("_canNavigate",true,{pluginName:"adapt"});return _context10.abrupt("return");case 5:id=model.get("_id");isContentObject=model instanceof ContentObjectModel;if(isContentObject){_context10.next=11;break}this.model.set("_canNavigate",true,{pluginName:"adapt"});Adapt.navigateToElement("."+id,{replace:true});return _context10.abrupt("return");case 11:isRoot=model===rootModel;if(!(isRoot&&Adapt.course.has("_start"))){_context10.next=16;break}startController=Adapt.course.get("_start");if(!(startController._isEnabled===true&&startController._isMenuDisabled===true)){_context10.next=16;break}return _context10.abrupt("return");case 16:if(!(model.get("_isLocked")&&Adapt.config.get("_forceRouteLocking"))){_context10.next=22;break}Adapt.log.warn("Unable to navigate to locked id: "+id);this.model.set("_canNavigate",true,{pluginName:"adapt"});if(!(Adapt.location._previousId===undefined)){_context10.next=21;break}return _context10.abrupt("return",this.navigate("#/",{trigger:true,replace:true}));case 21:return _context10.abrupt("return",this.navigateBack());case 22:this.showLoading();_context10.next=25;return Adapt.remove();case 25:isCourse=model instanceof CourseModel;type=isCourse?"menu":model.get("_type");location=isCourse?"course":"".concat(type,"-").concat(id);model.set("_isVisited",true);_context10.next=31;return this.updateLocation(location,type,id,model);case 31:Adapt.once("contentObjectView:ready",function(){_newArrowCheck(this,_this55);this.model.set("_canNavigate",true,{pluginName:"adapt"});this.handleNavigationFocus()}.bind(this));Adapt.trigger("router:".concat(type," router:contentObject"),model);ViewClass=Adapt.getViewClass(model);isMenu=model instanceof MenuModel;if(!(!ViewClass&&isMenu)){_context10.next=38;break}Adapt.log.deprecated("Using event based menu view instantiation for '".concat(Adapt.getViewName(model),"'"));return _context10.abrupt("return");case 38:this.$wrapper.append(new ViewClass({model:model}).$el);case 39:case"end":return _context10.stop();}}},_callee10,this)}));function handleId(_x7){return _handleId.apply(this,arguments)}return handleId}()},{key:"updateLocation",value:function(){var _updateLocation=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(currentLocation,type,id,currentModel){return regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:Adapt.location._previousModel=Adapt.location._currentModel;Adapt.location._previousId=Adapt.location._currentId;Adapt.location._previousContentType=Adapt.location._contentType;Adapt.location._currentModel=currentModel;Adapt.location._currentId=id;Adapt.location._contentType=type;Adapt.location._currentLocation=currentLocation;if(type==="menu"){Adapt.location._lastVisitedType="menu";Adapt.location._lastVisitedMenu=id}else if(type==="page"){Adapt.location._lastVisitedType="page";Adapt.location._lastVisitedPage=id}this.setDocumentTitle();this.setGlobalClasses();Adapt.trigger("router:location",Adapt.location);_context11.next=13;return Adapt.wait.queue();case 13:case"end":return _context11.stop();}}},_callee11,this)}));function updateLocation(_x8,_x9,_x10,_x11){return _updateLocation.apply(this,arguments)}return updateLocation}()},{key:"setGlobalClasses",value:function setGlobalClasses(){var currentModel=Adapt.location._currentModel;var htmlClasses=currentModel&&currentModel.get("_htmlClasses")||"";var classes=Adapt.location._currentId?"location-".concat(Adapt.location._contentType," location-id-").concat(Adapt.location._currentId):"location-".concat(Adapt.location._currentLocation);var currentClasses="".concat(classes," ").concat(htmlClasses);this.$html.removeClass(Adapt.location._previousClasses).addClass(currentClasses).attr("data-location",Adapt.location._currentLocation);this.$wrapper.removeClass().addClass(classes).attr("data-location",Adapt.location._currentLocation);Adapt.location._previousClasses=currentClasses}},{key:"handleNavigationFocus",value:function handleNavigationFocus(){if(!this.model.get("_shouldNavigateFocus"))return;Adapt.a11y.focus("body")}},{key:"navigateBack",value:function navigateBack(){Backbone.history.history.back()}},{key:"navigateToCurrentRoute",value:function navigateToCurrentRoute(force){if(!this.model.get("_canNavigate")&&!force){return}if(!Adapt.location._currentId){return}var currentId=Adapt.location._currentModel.get("_id");var isRoot=Adapt.location._currentModel===this.rootModel;var route=isRoot?"#/":"#/id/"+currentId;this.navigate(route,{trigger:true,replace:true})}},{key:"navigateToPreviousRoute",value:function navigateToPreviousRoute(force){if(!this.model.get("_canNavigate")&&!force){return}var currentModel=Adapt.location._currentModel;var previousModel=Adapt.location._previousModel;if(!currentModel){return this.navigateBack()}if(Adapt.location._currentModel instanceof MenuModel){return this.navigateToParent()}if(previousModel){return this.navigateBack()}this.navigateToParent()}},{key:"navigateToParent",value:function navigateToParent(force){if(!this.model.get("_canNavigate")&&!force){return}var parentId=Adapt.location._currentModel.get("_parentId");var parentModel=Adapt.findById(parentId);var isRoot=parentModel===this.rootModel;var route=isRoot?"#/":"#/id/"+parentId;this.navigate(route,{trigger:true})}},{key:"navigateToHomeRoute",value:function navigateToHomeRoute(force){if(!this.model.get("_canNavigate")&&!force){return}this.navigate("#/",{trigger:true})}},{key:"navigateToElement",value:function navigateToElement(selector){var _this56=this;var settings=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var currentModelId=selector.replace(/\./g,"");var currentModel=Adapt.findById(currentModelId);if(!currentModel)return;var currentPage=currentModel instanceof ContentObjectModel?currentModel:currentModel.findAncestor("contentObjects");var pageId=currentPage.get("_id");if(pageId===Adapt.location._currentId){return Adapt.scrollTo(selector,settings)}Adapt.once("contentObjectView:ready",_.debounce(function(){_newArrowCheck(this,_this56);this.model.set("_shouldNavigateFocus",true,{pluginName:"adapt"});Adapt.scrollTo(selector,settings)}.bind(this),1));var shouldReplaceRoute=settings.replace||false;this.model.set("_shouldNavigateFocus",false,{pluginName:"adapt"});this.navigate("#/id/"+pageId,{trigger:true,replace:shouldReplaceRoute})}},{key:"get",value:function get(){var _this$model;Adapt.log.deprecated("Adapt.router.get, please use Adapt.router.model.get");return(_this$model=this.model).get.apply(_this$model,arguments)}},{key:"set",value:function set(){var _this$model2;Adapt.log.deprecated("Adapt.router.set, please use Adapt.router.model.set");return(_this$model2=this.model).set.apply(_this$model2,arguments)}},{key:"rootModel",get:function get(){return this._navigationRoot||Adapt.course},set:function set(model){this._navigationRoot=model}}]);return Router}(Backbone.Router);Adapt.router=new Router({model:new RouterModel(null,{reset:true})});Adapt.navigateToElement=Adapt.router.navigateToElement.bind(Adapt.router);return Adapt.router});define("core/js/collections/adaptSubsetCollection",["core/js/adapt","./adaptCollection"],function(Adapt,AdaptCollection){var AdaptSubsetCollection=function(_AdaptCollection2){"use strict";_inherits(AdaptSubsetCollection,_AdaptCollection2);var _super18=_createSuper(AdaptSubsetCollection);function AdaptSubsetCollection(){_classCallCheck(this,AdaptSubsetCollection);return _super18.apply(this,arguments)}_createClass(AdaptSubsetCollection,[{key:"initialize",value:function initialize(models,options){_get(_getPrototypeOf(AdaptSubsetCollection.prototype),"initialize",this).call(this,models,options);this.parent=options.parent;this.listenTo(this.parent,"reset",this.loadSubset)}},{key:"loadSubset",value:function loadSubset(){var _this57=this;this.set(this.parent.filter(function(model){_newArrowCheck(this,_this57);return model instanceof this.model}.bind(this)));this._byAdaptID=this.groupBy("_id")}}]);return AdaptSubsetCollection}(AdaptCollection);return AdaptSubsetCollection});define("core/js/models/pageModel",["core/js/adapt","core/js/models/contentObjectModel"],function(Adapt,ContentObjectModel){var PageModel=function(_ContentObjectModel2){"use strict";_inherits(PageModel,_ContentObjectModel2);var _super19=_createSuper(PageModel);function PageModel(){_classCallCheck(this,PageModel);return _super19.apply(this,arguments)}_createClass(PageModel,[{key:"getTypeGroup",value:function getTypeGroup(){return"page"}},{key:"_children",get:function get(){Adapt.log.deprecated("pageModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON");return"articles"}}]);return PageModel}(ContentObjectModel);Adapt.register("page",{model:PageModel});return PageModel});define("core/js/models/articleModel",["core/js/adapt","core/js/models/adaptModel"],function(Adapt,AdaptModel){var ArticleModel=function(_AdaptModel2){"use strict";_inherits(ArticleModel,_AdaptModel2);var _super20=_createSuper(ArticleModel);function ArticleModel(){_classCallCheck(this,ArticleModel);return _super20.apply(this,arguments)}_createClass(ArticleModel,[{key:"getTypeGroup",value:function getTypeGroup(){return"article"}},{key:"_parent",get:function get(){Adapt.log.deprecated("articleModel._parent, use articleModel.getParent() instead, parent models are defined by the JSON");return"contentObjects"}},{key:"_siblings",get:function get(){Adapt.log.deprecated("articleModel._siblings, use articleModel.getSiblings() instead, sibling models are defined by the JSON");return"articles"}},{key:"_children",get:function get(){Adapt.log.deprecated("articleModel._children, use articleModel.hasManagedChildren instead, child models are defined by the JSON");return"blocks"}}]);return ArticleModel}(AdaptModel);Adapt.register("article",{model:ArticleModel});return ArticleModel});define("core/js/models/blockModel",["core/js/adapt","core/js/models/adaptModel"],function(Adapt,AdaptModel){var BlockModel=function(_AdaptModel3){"use strict";_inherits(BlockModel,_AdaptModel3);var _super21=_createSuper(BlockModel);function BlockModel(){_classCallCheck(this,BlockModel);return _super21.apply(this,arguments)}_createClass(BlockModel,[{key:"getTypeGroup",value:function getTypeGroup(){return"block"}},{key:"_parent",get:function get(){Adapt.log.deprecated("blockModel._parent, use blockModel.getParent() instead, parent models are defined by the JSON");return"articles"}},{key:"_siblings",get:function get(){Adapt.log.deprecated("blockModel._siblings, use blockModel.getSiblings() instead, sibling models are defined by the JSON");return"blocks"}},{key:"_children",get:function get(){Adapt.log.deprecated("blockModel._children, use blockModel.hasManagedChildren instead, child models are defined by the JSON");return"components"}}]);return BlockModel}(AdaptModel);Adapt.register("block",{model:BlockModel});return BlockModel});define("core/js/models/componentModel",["core/js/adapt","core/js/models/adaptModel"],function(Adapt,AdaptModel){var ComponentModel=function(_AdaptModel4){"use strict";_inherits(ComponentModel,_AdaptModel4);var _super22=_createSuper(ComponentModel);function ComponentModel(){_classCallCheck(this,ComponentModel);return _super22.apply(this,arguments)}_createClass(ComponentModel,[{key:"getTypeGroup",value:function getTypeGroup(){return"component"}},{key:"defaults",value:function defaults(){return AdaptModel.resultExtend("defaults",{_isA11yComponentDescriptionEnabled:true,_userAnswer:null,_attemptStates:null})}},{key:"trackable",value:function trackable(){return AdaptModel.resultExtend("trackable",["_userAnswer","_attemptStates"])}},{key:"trackableType",value:function trackableType(){return AdaptModel.resultExtend("trackableType",[Array,Array])}},{key:"init",value:function init(){if(Adapt.get("_isStarted")){this.onAdaptInitialize();return}this.listenToOnce(Adapt,"adapt:initialize",this.onAdaptInitialize)}},{key:"onAdaptInitialize",value:function onAdaptInitialize(){this.restoreUserAnswers()}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){}},{key:"storeUserAnswer",value:function storeUserAnswer(){}},{key:"resetUserAnswer",value:function resetUserAnswer(){this.set("_userAnswer",null)}},{key:"reset",value:function reset(type,force){if(!this.get("_canReset")&&!force)return;this.resetUserAnswer();_get(_getPrototypeOf(ComponentModel.prototype),"reset",this).call(this,type,force)}},{key:"getAttemptState",value:function getAttemptState(){var _this58=this;var object=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.toJSON();var trackables=this.trackable();var types=this.trackableType();trackables.find(function(name,index){_newArrowCheck(this,_this58);if(name!=="_attemptStates")return;trackables.splice(index,1);types.splice(index,1);return true}.bind(this));var values=trackables.map(function(n){_newArrowCheck(this,_this58);return object[n]}.bind(this));var booleans=values.filter(function(v,i){_newArrowCheck(this,_this58);return types[i]===Boolean}.bind(this)).map(Boolean);var numbers=values.filter(function(v,i){_newArrowCheck(this,_this58);return types[i]===Number}.bind(this)).map(function(v){_newArrowCheck(this,_this58);return Number(v)||0}.bind(this));var arrays=values.filter(function(v,i){_newArrowCheck(this,_this58);return types[i]===Array}.bind(this));return[numbers,booleans,arrays]}},{key:"getAttemptObject",value:function getAttemptObject(){var _this59=this;var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getAttemptState();var trackables=this.trackable();var types=this.trackableType();trackables.find(function(name,index){_newArrowCheck(this,_this59);if(name!=="_attemptStates")return;trackables.splice(index,1);types.splice(index,1);return true}.bind(this));var numbers=(state[0]||[]).slice(0);var booleans=(state[1]||[]).slice(0);var arrays=(state[2]||[]).slice(0);var object={};trackables.forEach(function(n,i){_newArrowCheck(this,_this59);if(n==="_id")return;switch(types[i]){case Number:object[n]=numbers.shift();break;case Boolean:object[n]=booleans.shift();break;case Array:object[n]=arrays.shift();break;}}.bind(this));return object}},{key:"setAttemptObject",value:function setAttemptObject(object){var silent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.set(object,{silent:silent})}},{key:"addAttemptObject",value:function addAttemptObject(){var object=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getAttemptObject();var attemptStates=this.get("_attemptStates")||[];var state=this.getAttemptState(object);attemptStates.push(state);this.set("_attemptStates",attemptStates)}},{key:"getAttemptObjects",value:function getAttemptObjects(){var _this60=this;var states=this.get("_attemptStates")||[];return states.map(function(state){_newArrowCheck(this,_this60);return this.getAttemptObject(state)}.bind(this))}},{key:"_parent",get:function get(){Adapt.log.deprecated("componentModel._parent, use componentModel.getParent() instead, parent models are defined by the JSON");return"blocks"}},{key:"_siblings",get:function get(){Adapt.log.deprecated("componentModel._siblings, use componentModel.getSiblings() instead, sibling models are defined by the JSON");return"components"}},{key:"hasManagedChildren",get:function get(){return false}}]);return ComponentModel}(AdaptModel);Adapt.register("component",{model:ComponentModel});return ComponentModel});define("core/js/views/contentObjectView",["core/js/adapt","core/js/views/adaptView"],function(Adapt,AdaptView){var ContentObjectView=function(_AdaptView){"use strict";_inherits(ContentObjectView,_AdaptView);var _super23=_createSuper(ContentObjectView);function ContentObjectView(){_classCallCheck(this,ContentObjectView);return _super23.apply(this,arguments)}_createClass(ContentObjectView,[{key:"attributes",value:function attributes(){return AdaptView.resultExtend("attributes",{"role":"main","aria-labelledby":"".concat(this.model.get("_id"),"-heading")},this)}},{key:"className",value:function className(){return[this.constructor.type,"contentobject",this.constructor.className,this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].filter(Boolean).join(" ")}},{key:"preRender",value:function preRender(){$.inview.lock(this.constructor.type+"View");this.disableAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;this.$el.css("opacity",0);this.listenTo(this.model,"change:_isReady",this.isReady)}},{key:"render",value:function render(){var _this61=this;var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRender contentObjectView:preRender view:preRender"),this);var data=this.model.toJSON();data.view=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data));Adapt.trigger("".concat(type,"View:render contentObjectView:render view:render"),this);_.defer(function(){_newArrowCheck(this,_this61);if(this._isRemoved)return;this.postRender();Adapt.trigger("".concat(type,"View:postRender contentObjectView:postRender view:postRender"),this)}.bind(this));return this}},{key:"isReady",value:function(){var _isReady=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(){var _this62=this;var type,performIsReady;return regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:if(!(!this.model.get("_isReady")||this._isTriggeredReady)){_context13.next=2;break}return _context13.abrupt("return");case 2:this._isTriggeredReady=true;type=this.constructor.type;performIsReady=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(){var _this63=this;var styleOptions;return regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:Adapt.trigger("".concat(type,"View:preReady contentObjectView:preReady view:preReady"),_this62);_context12.next=3;return Adapt.wait.queue();case 3:$(".js-loading").hide();if(Adapt.get("_shouldContentObjectScrollTop")!==false){$(window).scrollTop(0)}Adapt.trigger("".concat(type,"View:ready contentObjectView:ready view:ready"),_this62);$.inview.unlock("".concat(type,"View"));styleOptions={opacity:1};if(_this62.disableAnimation){_this62.$el.css(styleOptions);$.inview();_.defer(function(){_newArrowCheck(this,_this63);Adapt.trigger("".concat(type,"View:postReady contentObjectView:postReady view:postReady"),_this62)}.bind(this))}else{_this62.$el.velocity(styleOptions,{duration:"fast",complete:function complete(){_newArrowCheck(this,_this63);$.inview();Adapt.trigger("".concat(type,"View:postReady contentObjectView:postReady view:postReady"),_this62)}.bind(this)})}$(window).scroll();case 10:case"end":return _context12.stop();}}},_callee12,this)}));return function performIsReady(){return _ref5.apply(this,arguments)}}();_.defer(performIsReady);case 6:case"end":return _context13.stop();}}},_callee13,this)}));function isReady(){return _isReady.apply(this,arguments)}return isReady}()},{key:"preRemove",value:function preRemove(){var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRemove contentObjectView:preRemove view:preRemove"),this)}},{key:"remove",value:function remove(){var _this64=this;var type=this.constructor.type;this.preRemove();Adapt.trigger("".concat(type,"View:remove contentObjectView:remove view:remove"),this);this._isRemoved=true;Adapt.wait.for(function(end){var _this65=this;_newArrowCheck(this,_this64);this.$el.off("onscreen.adaptView");this.findDescendantViews().reverse().forEach(function(view){_newArrowCheck(this,_this65);view.remove()}.bind(this));this.childViews=[];_get(_getPrototypeOf(ContentObjectView.prototype),"remove",this).call(this);_.defer(function(){_newArrowCheck(this,_this65);Adapt.trigger("".concat(type,"View:postRemove contentObjectView:postRemove view:postRemove"),this);this.trigger("postRemove")}.bind(this));end()}.bind(this));return this}},{key:"destroy",value:function destroy(){this.remove();if(Adapt.parentView===this){Adapt.parentView=null}}}]);return ContentObjectView}(AdaptView);return ContentObjectView});define("core/js/views/pageView",["core/js/adapt","core/js/views/contentObjectView"],function(Adapt,ContentObjectView){var PageView=function(_ContentObjectView){"use strict";_inherits(PageView,_ContentObjectView);var _super24=_createSuper(PageView);function PageView(){_classCallCheck(this,PageView);return _super24.apply(this,arguments)}_createClass(PageView,[{key:"remove",value:function remove(){if(this.$pageLabel){this.$pageLabel.remove()}_get(_getPrototypeOf(PageView.prototype),"remove",this).call(this)}}]);return PageView}(ContentObjectView);Object.assign(PageView,{childContainer:".article__container",type:"page",template:"page"});Adapt.register("page",{view:PageView});return PageView});define("core/js/views/articleView",["core/js/adapt","core/js/views/adaptView"],function(Adapt,AdaptView){var ArticleView=function(_AdaptView2){"use strict";_inherits(ArticleView,_AdaptView2);var _super25=_createSuper(ArticleView);function ArticleView(){_classCallCheck(this,ArticleView);return _super25.apply(this,arguments)}_createClass(ArticleView,[{key:"className",value:function className(){return["article",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}}]);return ArticleView}(AdaptView);Object.assign(ArticleView,{childContainer:".block__container",type:"article",template:"article"});Adapt.register("article",{view:ArticleView});return ArticleView});define("core/js/views/blockView",["core/js/adapt","core/js/views/adaptView"],function(Adapt,AdaptView){var BlockView=function(_AdaptView3){"use strict";_inherits(BlockView,_AdaptView3);var _super26=_createSuper(BlockView);function BlockView(){_classCallCheck(this,BlockView);return _super26.apply(this,arguments)}_createClass(BlockView,[{key:"className",value:function className(){return["block",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}}]);return BlockView}(AdaptView);Object.assign(BlockView,{childContainer:".component__container",type:"block",template:"block"});Adapt.register("block",{view:BlockView});return BlockView});define("core/js/mpabc",["core/js/adapt","core/js/data","core/js/collections/adaptSubsetCollection","core/js/models/courseModel","core/js/models/contentObjectModel","core/js/models/menuModel","core/js/models/pageModel","core/js/models/articleModel","core/js/models/blockModel","core/js/models/componentModel","core/js/views/pageView","core/js/views/articleView","core/js/views/blockView"],function(Adapt,Data,AdaptSubsetCollection,CourseModel,ContentObjectModel,MenuModel,PageModel,ArticleModel,BlockModel,ComponentModel,PageView,ArticleView,BlockView){var MPABC=function(_Backbone$Controller5){"use strict";_inherits(MPABC,_Backbone$Controller5);var _super27=_createSuper(MPABC);function MPABC(){_classCallCheck(this,MPABC);return _super27.apply(this,arguments)}_createClass(MPABC,[{key:"initialize",value:function initialize(){this.listenTo(Data,{loading:this.waitForDataLoaded,loaded:this.onDataLoaded});this.setupDeprecatedSubsetCollections()}},{key:"waitForDataLoaded",value:function waitForDataLoaded(){Adapt.wait.begin()}},{key:"onDataLoaded",value:function onDataLoaded(){Adapt.wait.end()}},{key:"setupDeprecatedSubsetCollections",value:function setupDeprecatedSubsetCollections(){var _this66=this;var contentObjects=new AdaptSubsetCollection(null,{parent:Data,model:ContentObjectModel});var articles=new AdaptSubsetCollection(null,{parent:Data,model:ArticleModel});var blocks=new AdaptSubsetCollection(null,{parent:Data,model:BlockModel});var components=new AdaptSubsetCollection(null,{parent:Data,model:ComponentModel});Object.defineProperty(Adapt,"contentObjects",{get:function get(){_newArrowCheck(this,_this66);Adapt.log.deprecated("Adapt.contentObjects, please use Adapt.data instead");return contentObjects}.bind(this),set:function set(value){_newArrowCheck(this,_this66);return contentObjects=value}.bind(this)});Object.defineProperty(Adapt,"articles",{get:function get(){_newArrowCheck(this,_this66);Adapt.log.deprecated("Adapt.articles, please use Adapt.data instead");return articles}.bind(this),set:function set(value){_newArrowCheck(this,_this66);return articles=value}.bind(this)});Object.defineProperty(Adapt,"blocks",{get:function get(){_newArrowCheck(this,_this66);Adapt.log.deprecated("Adapt.blocks, please use Adapt.data instead");return blocks}.bind(this),set:function set(value){_newArrowCheck(this,_this66);return blocks=value}.bind(this)});Object.defineProperty(Adapt,"components",{get:function get(){_newArrowCheck(this,_this66);Adapt.log.deprecated("Adapt.components, please use Adapt.data instead");return components}.bind(this),set:function set(value){_newArrowCheck(this,_this66);return components=value}.bind(this)})}}]);return MPABC}(Backbone.Controller);return Adapt.mpabc=new MPABC});define("core/js/helpers",["handlebars","core/js/adapt"],function(Handlebars,Adapt){var defaultAriaLevels={"_menu":1,"_menuGroup":2,"_menuItem":2,"_page":1,"_article":2,"_block":3,"_component":4,"_componentItem":5,"_notify":1};var helpers={lowercase:function lowercase(text){return text.toLowerCase()},capitalise:function capitalise(text){return text.charAt(0).toUpperCase()+text.slice(1)},inc:function inc(index){return index+1},dec:function dec(index){return index-1},odd:function odd(index){return(index+1)%2===0?"even":"odd"},equals:function equals(value,text,block){return helpers.compare.call(this,value,"==",text,block)},compare:function compare(value,operator,text,block){switch(operator){case"===":if(value===text)return block.fn(this);break;case"=":case"==":if(value==text)return block.fn(this);break;case">=":if(value>=text)return block.fn(this);break;case"<=":if(value<=text)return block.fn(this);break;case">":if(value>text)return block.fn(this);break;case"<":if(value<text)return block.fn(this);break;}return block.inverse(this)},math:function math(lvalue,operator,rvalue,options){lvalue=parseFloat(lvalue);rvalue=parseFloat(rvalue);switch(operator){case"+":return lvalue+rvalue;case"-":return lvalue-rvalue;case"*":return lvalue*rvalue;case"/":return lvalue/rvalue;case"%":return lvalue%rvalue;}},any:function any(){var args=Array.prototype.slice.call(arguments,0,-1);var block=Array.prototype.slice.call(arguments,-1)[0];return _.any(args)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},all:function all(){var args=Array.prototype.slice.call(arguments,0,-1);var block=Array.prototype.slice.call(arguments,-1)[0];return _.all(args)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},none:function none(){var args=Array.prototype.slice.call(arguments,0,-1);var block=Array.prototype.slice.call(arguments,-1)[0];return!_.any(args)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},compile:function compile(template,context){if(!template){return""}if(template instanceof Object)template=template.toString();var data=this;if(context){data=!context.data||!context.data.root?context:context.data.root}return Handlebars.compile(template)(data)},compile_a11y_text:function compile_a11y_text(template,context){Adapt.a11y.log.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return helpers.compile.call(this,template,context)},compile_a11y_normalize:function compile_a11y_normalize(template,context){if(!template){return""}if(template instanceof Object)template=template.toString();return Handlebars.helpers.a11y_normalize.call(this,helpers.compile.call(this,template,context))},compile_a11y_remove_breaks:function compile_a11y_remove_breaks(template,context){if(!template){return""}return Handlebars.helpers.a11y_remove_breaks.call(this,helpers.compile.call(this,template,context))},import_globals:function import_globals(context){if(context.data.root._globals){return""}context.data.root._globals=Adapt.course.get("_globals");return""},import_adapt:function import_adapt(context){if(context.data.root.Adapt){return}var adapt=context.data.root.Adapt={};var i,l,name;var directImport=["config","course"];for(i=0,l=directImport.length;i<l;i++){name=directImport[i];adapt[name]=Adapt[name].toJSON()}var indexedImport=["contentObjects","articles","blocks","components"];for(i=0,l=indexedImport.length;i<l;i++){name=indexedImport[i];var importArray=Adapt[name].toJSON();var importIndex={};for(var i1=0,l1=importArray.length;i1<l1;i1++){var item=importArray[i1];importIndex[item._id]=item}adapt[name]=importIndex}return""},component_description:function component_description(override,context){if(!this._isA11yComponentDescriptionEnabled){return}var isNotDefined=!this._globals._components||!this._globals._components["_"+this._component];if(isNotDefined){return}var hasOverride=arguments.length>1;var description;if(hasOverride){description=override;description=helpers.compile(description,context)}else{description=this._globals._components["_"+this._component].ariaRegion;description=helpers.compile(description,override)}if(!description){return}return new Handlebars.SafeString("<div class=\"aria-label\">"+description+"</div>")},a11y_text:function a11y_text(text){Adapt.a11y.log.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_normalize:function a11y_normalize(htmls){return Adapt.a11y.normalize.apply(Adapt.a11y,arguments)},a11y_remove_breaks:function a11y_remove_breaks(htmls){return Adapt.a11y.removeBreaks.apply(Adapt.a11y,arguments)},a11y_aria_label:function a11y_aria_label(htmls){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label\">"+values.join(" ")+"</div>")},a11y_aria_label_relative:function a11y_aria_label_relative(htmls){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label relative\">"+values.join(" ")+"</div>")},a11y_aria_image:function a11y_aria_image(texts){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label\" role=\"img\" aria-label=\""+values.join(" ")+"\"></div>")},a11y_wrap_focus:function a11y_wrap_focus(){var cfg=Adapt.config.get("_accessibility");if(cfg._isPopupWrapFocusEnabled===false)return"";return new Handlebars.SafeString("<a class=\"a11y-focusguard a11y-ignore a11y-ignore-focus\" role=\"presentation\">&nbsp;</a>")},a11y_attrs_heading:function a11y_attrs_heading(levelOrType){var cfg=Adapt.config.get("_accessibility");var level=1;if(this._ariaLevel){levelOrType=this._ariaLevel}if(isNaN(levelOrType)===false){level=levelOrType}else if(_.isString(levelOrType)){cfg._ariaLevels=cfg._ariaLevels||defaultAriaLevels;if(cfg._ariaLevels&&cfg._ariaLevels["_"+levelOrType]!==undefined){level=cfg._ariaLevels["_"+levelOrType]}}return new Handlebars.SafeString(" role=\"heading\" aria-level=\""+level+"\" ")},a11y_attrs_tabbable:function a11y_attrs_tabbable(){Adapt.a11y.log.deprecated("a11y_attrs_tabbable should not be used. tabbable elements should be natively tabbable.");return new Handlebars.SafeString(" role=\"region\" tabindex=\"0\" ")},a11y_alt_text:function a11y_alt_text(visible,alternatives){var values=Array.prototype.slice.call(arguments,1,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<span aria-hidden=\"true\">"+visible+"</span><span class=\"aria-label\">"+values.join(" ")+"</span>")}};_.extend(helpers,{if_value_equals:function if_value_equals(){Adapt.a11y.log.deprecated("if_value_equals, use equals instead.");return helpers.equals.apply(this,arguments)},numbers:function numbers(){Adapt.a11y.log.deprecated("numbers, use inc instead.");return helpers.inc.apply(this,arguments)},lowerCase:function lowerCase(){Adapt.a11y.log.deprecated("lowerCase, use lowercase instead.");return helpers.lowercase.apply(this,arguments)}});for(var name in helpers){if(!helpers.hasOwnProperty(name))continue;Handlebars.registerHelper(name,helpers[name])}return helpers});define("core/js/scrolling",["core/js/adapt"],function(Adapt){var Scrolling=function(_Backbone$Controller6){"use strict";_inherits(Scrolling,_Backbone$Controller6);var _super28=_createSuper(Scrolling);function Scrolling(){_classCallCheck(this,Scrolling);return _super28.apply(this,arguments)}_createClass(Scrolling,[{key:"initialize",value:function initialize(){this.$html=null;this.$app=null;this.isLegacyScrolling=true;this._checkApp();Adapt.once("configModel:dataLoaded",this._loadConfig.bind(this))}},{key:"_checkApp",value:function _checkApp(){this.$html=$("html");this.$app=$("#app");if(this.$app.length)return;this.$app=$("<div id=\"app\">");$("body").append(this.$app);this.$app.append($("#wrapper"));Adapt.log.warn("UPDATE - Your html file needs to have #app adding. See https://github.com/adaptlearning/adapt_framework/issues/2168")}},{key:"_loadConfig",value:function _loadConfig(){var config=Adapt.config.get("_scrollingContainer");if(!config||!config._isEnabled)return;var limitTo=config._limitToSelector;var isIncluded=!limitTo||this.$html.is(limitTo)||this.$html.hasClass(limitTo);if(!isIncluded)return;this.isLegacyScrolling=false;this._addStyling();this._fixJQuery();this._fixScrollTo();this._fixBrowser()}},{key:"_addStyling",value:function _addStyling(){this.$html.addClass("adapt-scrolling")}},{key:"_fixJQuery",value:function _fixJQuery(){var selectorScrollTop=$.fn.scrollTop;var $app=Adapt.scrolling.$app;$.fn.scrollTop=function(){if(this[0]===window||this[0]===document.body){return selectorScrollTop.apply($app,arguments)}return selectorScrollTop.apply(this,arguments)};var selectorOffset=$.fn.offset;$.fn.offset=function(coordinates){if(coordinates){return selectorOffset.apply(this,arguments)}var $app=Adapt.scrolling.$app;var $element=this;var elementOffset=selectorOffset.call($element);var isCorrectedContainer=$element.is("html, body, #app")||$element.parents().is("#app");if(!isCorrectedContainer){return elementOffset}var scrollTop=parseInt($app.scrollTop());var scrollLeft=parseInt($app.scrollLeft());var appOffset=selectorOffset.call($app);elementOffset.top+=scrollTop-appOffset.top;elementOffset.left+=scrollLeft-appOffset.left;return elementOffset}}},{key:"_fixScrollTo",value:function _fixScrollTo(){var selectorScrollTo=$.fn.scrollTo;var scrollTo=$.scrollTo;var $app=Adapt.scrolling.$app;$.fn.scrollTo=function(target,duration,settings){if(this[0]===window||this[0]===document.body){return selectorScrollTo.apply($app,arguments)}return selectorScrollTo.apply(this,arguments)};$.scrollTo=function(target,duration,settings){return selectorScrollTo.apply($app,arguments)};Object.assign($.scrollTo,scrollTo)}},{key:"_fixBrowser",value:function _fixBrowser(){var _this67=this;var app=Adapt.scrolling.$app[0];window.scrollTo=function(x,y){app.scrollTop=y||0;app.scrollLeft=x||0};var $window=$(window);this.$app.on("scroll",function(){_newArrowCheck(this,_this67);$window.scroll()}.bind(this))}},{key:"scrollTo",value:function scrollTo(selector){var _this68=this;var settings=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var location=Adapt.location._contentType?Adapt.location._contentType:Adapt.location._currentLocation;Adapt.trigger("".concat(location,":scrollTo"),selector);var disableScrollToAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;if(disableScrollToAnimation){settings.duration=0}else if(!settings.duration){settings.duration=$.scrollTo.defaults.duration}var offsetTop=0;if(Adapt.scrolling.isLegacyScrolling){offsetTop=-$(".nav").outerHeight();if($(selector).hasClass("component")){offsetTop-=$(selector).find(".aria-label").height()||0}}if(!settings.offset)settings.offset={top:offsetTop,left:0};if(settings.offset.top===undefined)settings.offset.top=offsetTop;if(settings.offset.left===undefined)settings.offset.left=0;if(settings.offset.left===0)settings.axis="y";if(Adapt.get("_canScroll")!==false){$.scrollTo(selector,settings)}_.delay(function(){_newArrowCheck(this,_this68);Adapt.a11y.focusNext(selector);Adapt.trigger("".concat(location,":scrolledTo"),selector)}.bind(this),settings.duration+300)}}]);return Scrolling}(Backbone.Controller);Adapt.scrolling=new Scrolling;Adapt.scrollTo=Adapt.scrolling.scrollTo.bind(Adapt.scrolling);return Adapt.scrolling});define("core/js/views/headingView",["core/js/adapt"],function(Adapt){var HeadingView=Backbone.View.extend({initialize:function initialize(){this.listenTo(Adapt.parentView,"postRemove",this.remove);this.listenTo(this.model,"change:_isComplete",this.render);this.render()},render:function render(){var template=Handlebars.templates[this.constructor.template];var data=this.model.toJSON();var customHeadingType=this.$el.attr("data-a11y-heading-type");if(customHeadingType)data._type=customHeadingType;this.$el.html(template(data));this.checkCompletion()},checkCompletion:function checkCompletion(){var isComplete=this.model.get("_isComplete");this.$el.toggleClass("is-complete",isComplete).toggleClass("is-incomplete",!isComplete)}},{template:"heading"});return HeadingView});define("core/js/headings",["./adapt","./views/headingView"],function(Adapt,HeadingView){var Headings=Backbone.Controller.extend({initialize:function initialize(){this.listenTo(Adapt,"view:render",this.onViewRender)},onViewRender:function onViewRender(view){var $headingSeats=view.$(".js-heading");$headingSeats.each(function(index,el){new HeadingView({el:el,model:view.model})})}});return new Headings});define("core/js/views/navigationView",["core/js/adapt"],function(Adapt){var NavigationView=function(_Backbone$View3){"use strict";_inherits(NavigationView,_Backbone$View3);var _super29=_createSuper(NavigationView);function NavigationView(){_classCallCheck(this,NavigationView);return _super29.apply(this,arguments)}_createClass(NavigationView,[{key:"className",value:function className(){return"nav"}},{key:"events",value:function events(){return{"click [data-event]":"triggerEvent"}}},{key:"attributes",value:function attributes(){return{"role":"navigation"}}},{key:"initialize",value:function initialize(){this.listenToOnce(Adapt,{"courseModel:dataLoading":this.remove});this.listenTo(Adapt,"router:menu router:page",this.hideNavigationButton);this.preRender()}},{key:"preRender",value:function preRender(){Adapt.trigger("navigationView:preRender",this);this.render()}},{key:"render",value:function render(){var _this69=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template({_globals:Adapt.course.get("_globals"),_accessibility:Adapt.config.get("_accessibility")})).insertBefore("#app");_.defer(function(){_newArrowCheck(this,_this69);Adapt.trigger("navigationView:postRender",this)}.bind(this));return this}},{key:"triggerEvent",value:function triggerEvent(event){event.preventDefault();var currentEvent=$(event.currentTarget).attr("data-event");Adapt.trigger("navigation:"+currentEvent);switch(currentEvent){case"backButton":Adapt.router.navigateToPreviousRoute();break;case"homeButton":Adapt.router.navigateToHomeRoute();break;case"parentButton":Adapt.router.navigateToParent();break;case"skipNavigation":this.skipNavigation();break;case"returnToStart":Adapt.startController.returnToStartLocation();break;}}},{key:"skipNavigation",value:function skipNavigation(){Adapt.a11y.focusFirst("."+Adapt.location._contentType)}},{key:"hideNavigationButton",value:function hideNavigationButton(model){var shouldHide=model.get("_type")==="course";this.$(".nav__back-btn, .nav__home-btn").toggleClass("u-display-none",shouldHide)}},{key:"showNavigationButton",value:function showNavigationButton(){this.$(".nav__back-btn, .nav__home-btn").removeClass("u-display-none")}}]);return NavigationView}(Backbone.View);NavigationView.template="nav";return NavigationView});define("core/js/navigation",["core/js/adapt","core/js/views/navigationView"],function(Adapt,NavigationView){var NavigationController=Backbone.Controller.extend({initialize:function initialize(){this.listenTo(Adapt,"adapt:preInitialize",this.addNavigationBar)},addNavigationBar:function addNavigationBar(){var adaptConfig=Adapt.course.get("_navigation");if(adaptConfig&&adaptConfig._isDefaultNavigationDisabled){Adapt.trigger("navigation:initialize");return}Adapt.navigation=new NavigationView}});return new NavigationController});define("core/js/views/componentView",["core/js/adapt","core/js/views/adaptView"],function(Adapt,AdaptView){var ComponentView=function(_AdaptView4){"use strict";_inherits(ComponentView,_AdaptView4);var _super30=_createSuper(ComponentView);function ComponentView(){_classCallCheck(this,ComponentView);return _super30.apply(this,arguments)}_createClass(ComponentView,[{key:"attributes",value:function attributes(){if(!this.model.get("_isA11yRegionEnabled")){return AdaptView.resultExtend("attributes",{},this)}return AdaptView.resultExtend("attributes",{"aria-labelledby":this.model.get("_id")+"-heading","role":"region"},this)}},{key:"className",value:function className(){return["component",this.model.get("_component").toLowerCase(),this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),"is-"+this.model.get("_layout"),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}},{key:"renderState",value:function renderState(){Adapt.log.removed("renderState is removed and moved to item title")}},{key:"setupInviewCompletion",value:function setupInviewCompletion(){var inviewElementSelector=arguments.length>0&&arguments[0]!==undefined?arguments[0]:".component__inner";var callback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.setCompletionStatus;this.$inviewElement=this.$(inviewElementSelector);this.inviewCallback=callback;this.$inviewElement.on("inview.componentView",this.onInview.bind(this))}},{key:"removeInviewListener",value:function removeInviewListener(){if(!this.$inviewElement)return;this.$inviewElement.off("inview.componentView");this.$inviewElement=null}},{key:"onInview",value:function onInview(event,visible,visiblePartX,visiblePartY){if(!visible)return;switch(visiblePartY){case"top":this.hasSeenTop=true;break;case"bottom":this.hasSeenBottom=true;break;case"both":this.hasSeenTop=this.hasSeenBottom=true;}if(!this.hasSeenTop||!this.hasSeenBottom)return;this.inviewCallback();if(this.model.get("_isComplete")){this.removeInviewListener()}}},{key:"postRender",value:function postRender(){}},{key:"remove",value:function remove(){this.removeInviewListener();_get(_getPrototypeOf(ComponentView.prototype),"remove",this).call(this)}}]);return ComponentView}(AdaptView);ComponentView.type="component";return ComponentView});define("components/adapt-before-and-after/js/adapt-before-and-after",["core/js/models/componentModel","core/js/views/componentView","core/js/adapt"],function(ComponentModel,ComponentView,Adapt){var Beforeafter=ComponentView.extend({preRender:function preRender(){this.listenTo(Adapt,"device:changed",this.resizeImage);this.checkIfResetOnRevisit()},postRender:function postRender(){this.resizeImage(Adapt.device.screenSize,true);this.beforeAfterReveal()},events:function events(){return Adapt.device.touch==true?{"inview":"inview","touchmove .handle":"sliderHandle"}:{"inview":"inview","mousedown .handle":"sliderHandle","keydown .handle":"sliderHandle"}},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},inview:function inview(event,visible,visiblePartX,visiblePartY){if(visible){if(visiblePartY==="top"){this._isVisibleTop=true}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(this._isVisibleTop&&this._isVisibleBottom){this.$(".component__widget").off("inview")}}},sliderHandle:function sliderHandle(event){this.setCompletionStatus()},remove:function remove(){this.$(".component__widget").off("inview");ComponentView.prototype.remove.apply(this,arguments)},resizeImage:function resizeImage(width,setupInView){var imageWidth=width==="medium"?"small":width;var imageSrc=this.model.get("_beforeafter")?this.model.get("_beforeafter")[imageWidth]:"";this.$(".beforeafter__widget img").attr("src",imageSrc);this.$(".beforeafter__widget").imageready(_.bind(function(){this.setReadyStatus();if(setupInView){this.$(".component__widget").on("inview",_.bind(this.inview,this))}},this))},beforeAfterReveal:function beforeAfterReveal(){$(".beforeafter__widget").each(function(){var cur=$(this);var width=cur.width()+"px";cur.find(".resize img").css({"width":width,"min-width":width});drags(cur.find(".handle"),cur.find(".resize"),cur)});$(window).resize(function(){$(".beforeafter__widget").each(function(){var cur=$(this);var width=cur.width()+"px";cur.find(".resize img").css({"width":width,"min-width":width})})});function drags(dragElement,resizeElement,container){dragElement.on("mousedown touchstart",function(e){dragElement.addClass("draggable");resizeElement.addClass("resizable");var startX=e.pageX?e.pageX:e.originalEvent.touches[0].pageX;var dragWidth=dragElement.outerWidth(),posX=dragElement.offset().left+dragWidth-startX,containerOffset=container.offset().left,containerWidth=container.outerWidth();minLeft=containerOffset+0;maxLeft=containerOffset+containerWidth-dragWidth-0;dragElement.parents().on("mousemove",function(e){if(e.pageX>=1){var moveX=e.pageX?e.pageX:e.originalEvent.touches[0].pageX;leftValue=moveX+posX-dragWidth;if(leftValue<=minLeft){leftValue=minLeft}else if(leftValue>=maxLeft){leftValue=maxLeft}widthValue=(leftValue+dragWidth/2-containerOffset)*100/containerWidth+"%";$(".draggable").css("left",widthValue).on("mouseup",function(){$(this).removeClass("draggable");resizeElement.removeClass("resizable")});$(".resizable").css("width",widthValue)}else{}}).on("mouseup",function(){dragElement.removeClass("draggable");resizeElement.removeClass("resizable")});dragElement.parents().on("touchmove",function(e){var moveX=e.pageX?e.pageX:e.originalEvent.touches[0].pageX;leftValue=moveX+posX-dragWidth;if(leftValue<=minLeft){leftValue=minLeft}else if(leftValue>=maxLeft){leftValue=maxLeft}widthValue=(leftValue+dragWidth/2-containerOffset)*100/containerWidth+"%";$(".draggable").css("left",widthValue).on("touchend touchcancel",function(){$(this).removeClass("draggable");resizeElement.removeClass("resizable")});$(".resizable").css("width",widthValue)}).on("touchend touchcancel",function(){dragElement.removeClass("draggable");resizeElement.removeClass("resizable")});e.preventDefault()}).on("mouseup touchend touchcancel",function(e){dragElement.removeClass("draggable");resizeElement.removeClass("resizable")})}$(".beforeafter__widget").each(function(){var whereisit=100*parseFloat($(".resize").css("width"))/parseFloat($(".resize").parent().css("width"));var strokeCount=whereisit;var cur=$(this);$(function(){cur.find(".handle").keyup(function(e){switch(e.which){case 37:if(strokeCount>=0){cur.find(".handle").css("left",--strokeCount-1+"%"),cur.find(".resize").css("width",--strokeCount+"%")}else{cur.find(".handle").css("left","1%"),cur.find(".resize").css("width","1%")};break;case 39:if(strokeCount<=100){cur.find(".handle").css("left",++strokeCount+1+"%"),cur.find(".resize").css("width",++strokeCount+"%")}else{cur.find(".handle").css("left","100%"),cur.find(".resize").css("width","100%")};break;default:return;}e.preventDefault()})})})}});Adapt.register("beforeafter",{model:ComponentModel.extend({}),view:Beforeafter});return Beforeafter});define("components/adapt-blinds/js/adapt-blinds",["core/js/models/componentModel","core/js/views/componentView","core/js/adapt"],function(ComponentModel,ComponentView,Adapt){var Blinds=ComponentView.extend({preRender:function preRender(){this.listenTo(Adapt,"device:resize",this.calculateWidths,this);this.setDeviceSize()},postRender:function postRender(){this.$(".blinds__inner").imageready(_.bind(function(){this.setupBlinds();this.setReadyStatus()},this))},setupBlinds:function setupBlinds(){if(!this.model.has("_items")||!this.model.get("_items").length)return;this.model.set("_itemCount",this.model.get("_items").length);this.model.set("_active",true);this.calculateWidths();this.setupEventListeners()},setupEventListeners:function setupEventListeners(){if(!this.model.get("_isDesktop"))return;var that=this;var $items=this.$(".blinds__item");var _items=this.model.get("_items");var wItem=this.itemWidth;var animationTime=400;var captionDelay=this.model.has("captionDelay")?this.model.get("captionDelay"):800;var expandBy=this.model.get("_expandBy")||2;var count=0;var currentItem;var queue=[];var countaccess=this.model.get("_items").length;var minuscountaccess=countaccess-1;var divcountaccess=wItem/minuscountaccess;var subtractaccess=wItem-divcountaccess;$(".blinds__item").focus(function(){$(this).css("width",wItem*expandBy);$(this).find(".blinds__captions p").css("opacity","1")}).blur(function(){$(this).css("width",subtractaccess+"px");$(this).find(".blinds__captions p").css("opacity","0")});$(".accessibility-state span").focus(function(){$(".blinds__item").css("width",wItem)}).blur(function(){$(".blinds__item").css("width",wItem)});$items.on({mouseenter:function mouseenter(){currentItem=this;var $this=$(this);var itemIndex=$this.index();var _item=_items[itemIndex];var $siblings=$this.siblings();var $p=$this.find("p");var wItemNew=wItem*expandBy;var wSiblingsNew=wItem-(wItemNew-wItem)/$siblings.length;var currTop=10;$this.outerWidth(wItemNew);that.setStage(itemIndex);$p.each(function(i,el){(function(i,el){var t=animationTime+i*captionDelay;var caption=_item._captions[i];var left=caption.left||_item.left||0;var top=caption.top;if(!top&&i===0)top=0;var width=caption.width||wItem*expandBy+"px";queue[i]=setTimeout(function(){if(top===undefined){top=$p.eq(i-1).outerHeight()+currTop+10}currTop=parseInt(top);$(el).css({opacity:1,marginTop:top,left:left,maxWidth:width})},t)})(i,el)});$siblings.outerWidth(wSiblingsNew)},mouseleave:function mouseleave(){for(var i=0;i<queue.length;i++){clearTimeout(queue[i])}currentItem=null;count=0;var $this=$(this);$this.outerWidth(wItem);$this.find("p").css("opacity",0);$this.siblings().outerWidth(wItem)}});this.completionEvent=this.model.get("_setCompletionOn")||"allItems";if(this.completionEvent!=="inview"&&this.model.get("_items").length>1){this.on(this.completionEvent,_.bind(this.onCompletion,this))}else{this.$(".component__widget").on("inview",_.bind(this.inview,this))}},calculateWidths:function calculateWidths(){if(this.model.get("height"))this.$(".blinds__item").height(this.model.get("height"));var wTotal=this.$(".blinds__container").width();var $items=this.$(".blinds__item");var margin=parseInt($items.css("marginRight"));var wItem=wTotal/$items.length-margin*2;this.itemWidth=wItem;$items.outerWidth(wItem)},setStage:function setStage(stage){this.model.set("_stage",stage);if(this.model.get("_isDesktop")){var currentItem=this.getCurrentItem(stage);currentItem._isVisited=true}this.evaluateCompletion()},getCurrentItem:function getCurrentItem(index){return this.model.get("_items")[index]},getVisitedItems:function getVisitedItems(){return _.filter(this.model.get("_items"),function(item){return item._isVisited})},evaluateCompletion:function evaluateCompletion(){if($("html").hasClass("accessibility")){$(".component__widget").on("inview",_.bind(this.inview,this))}else{if(this.getVisitedItems().length===this.model.get("_items").length){this.trigger("allItems")}}},inview:function inview(event,visible,visiblePartX,visiblePartY){if(visible){if(visiblePartY==="top"){this._isVisibleTop=true}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(this._isVisibleTop&&this._isVisibleBottom){this.$(".component__inner").off("inview");this.setCompletionStatus()}}},onCompletion:function onCompletion(){this.setCompletionStatus();if(this.completionEvent&&this.completionEvent!="inview"){this.off(this.completionEvent,this)}},setDeviceSize:function setDeviceSize(){if(Adapt.device.screenSize==="large"){this.$el.addClass("desktop").removeClass("mobile");this.model.set("_isDesktop",true)}else{this.$el.addClass("mobile").removeClass("desktop");this.model.set("_isDesktop",false);this.setCompletionStatus()}}});Adapt.register("blinds",{model:ComponentModel.extend({}),view:Blinds});return Blinds});define("core/js/models/itemModel",[],function(){var ItemModel=function(_Backbone$Model6){"use strict";_inherits(ItemModel,_Backbone$Model6);var _super31=_createSuper(ItemModel);function ItemModel(){_classCallCheck(this,ItemModel);return _super31.apply(this,arguments)}_createClass(ItemModel,[{key:"defaults",value:function defaults(){return{_isActive:false,_isVisited:false}}},{key:"reset",value:function reset(){this.set({_isActive:false,_isVisited:false})}},{key:"toggleActive",value:function toggleActive(){var isActive=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.get("_isActive");this.set("_isActive",isActive)}},{key:"toggleVisited",value:function toggleVisited(){var isVisited=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.get("_isVisited");this.set("_isVisited",isVisited)}}]);return ItemModel}(Backbone.Model);return ItemModel});define("core/js/models/itemsComponentModel",["core/js/models/componentModel","core/js/models/itemModel"],function(ComponentModel,ItemModel){var ItemsComponentModel=function(_ComponentModel){"use strict";_inherits(ItemsComponentModel,_ComponentModel);var _super32=_createSuper(ItemsComponentModel);function ItemsComponentModel(){_classCallCheck(this,ItemsComponentModel);return _super32.apply(this,arguments)}_createClass(ItemsComponentModel,[{key:"toJSON",value:function toJSON(){var json=_get(_getPrototypeOf(ItemsComponentModel.prototype),"toJSON",this).call(this);json._items=this.getChildren().toJSON();return json}},{key:"init",value:function init(){this.setUpItems();this.listenTo(this.getChildren(),{"all":this.onAll,"change:_isVisited":this.checkCompletionStatus});_get(_getPrototypeOf(ItemsComponentModel.prototype),"init",this).call(this)}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){var _this70=this;var booleanArray=this.get("_userAnswer");if(!booleanArray)return;this.getChildren().forEach(function(child,index){_newArrowCheck(this,_this70);return child.set("_isVisited",booleanArray[index])}.bind(this))}},{key:"storeUserAnswer",value:function storeUserAnswer(){var _this71=this;var booleanArray=this.getChildren().map(function(child){_newArrowCheck(this,_this71);return child.get("_isVisited")}.bind(this));this.set("_userAnswer",booleanArray)}},{key:"getTypeGroup",value:function getTypeGroup(){return"itemscomponent"}},{key:"setUpItems",value:function setUpItems(){var _this72=this;var items=this.get("_items")||[];items.forEach(function(item,index){_newArrowCheck(this,_this72);return item._index=index}.bind(this));this.setChildren(new Backbone.Collection(items,{model:ItemModel}))}},{key:"getItem",value:function getItem(index){return this.getChildren().findWhere({_index:index})}},{key:"getVisitedItems",value:function getVisitedItems(){return this.getChildren().where({_isVisited:true})}},{key:"getActiveItems",value:function getActiveItems(){return this.getChildren().where({_isActive:true})}},{key:"getActiveItem",value:function getActiveItem(){return this.getChildren().findWhere({_isActive:true})}},{key:"areAllItemsCompleted",value:function areAllItemsCompleted(){return this.getVisitedItems().length===this.getChildren().length}},{key:"checkCompletionStatus",value:function checkCompletionStatus(){this.storeUserAnswer();if(!this.areAllItemsCompleted())return;this.setCompletionStatus()}},{key:"reset",value:function reset(type,force){var _this73=this;this.getChildren().each(function(item){_newArrowCheck(this,_this73);return item.reset()}.bind(this));_get(_getPrototypeOf(ItemsComponentModel.prototype),"reset",this).call(this,type,force)}},{key:"resetActiveItems",value:function resetActiveItems(){var _this74=this;this.getChildren().each(function(item){_newArrowCheck(this,_this74);return item.toggleActive(false)}.bind(this))}},{key:"setActiveItem",value:function setActiveItem(index){var item=this.getItem(index);if(!item)return;var activeItem=this.getActiveItem();if(activeItem)activeItem.toggleActive(false);item.toggleActive(true)}}]);return ItemsComponentModel}(ComponentModel);return ItemsComponentModel});define("components/adapt-contrib-accordion/js/accordionModel",["core/js/models/itemsComponentModel"],function(ItemsComponentModel){var AccordionModel=function(_ItemsComponentModel){"use strict";_inherits(AccordionModel,_ItemsComponentModel);var _super33=_createSuper(AccordionModel);function AccordionModel(){_classCallCheck(this,AccordionModel);return _super33.apply(this,arguments)}_createClass(AccordionModel,[{key:"defaults",value:function defaults(){return ItemsComponentModel.resultExtend("defaults",{_shouldCollapseItems:true,_toggleSpeed:200},this)}},{key:"toggleItemsState",value:function toggleItemsState(index){var item=this.getItem(index);var previousActiveItem=this.getActiveItem();item.toggleActive();item.toggleVisited(true);if(previousActiveItem&&this.get("_shouldCollapseItems")){previousActiveItem.toggleActive(false)}}}]);return AccordionModel}(ItemsComponentModel);return AccordionModel});define("components/adapt-contrib-accordion/js/accordionView",["core/js/views/componentView"],function(ComponentView){var AccordionView=function(_ComponentView){"use strict";_inherits(AccordionView,_ComponentView);var _super34=_createSuper(AccordionView);function AccordionView(){_classCallCheck(this,AccordionView);return _super34.apply(this,arguments)}_createClass(AccordionView,[{key:"events",value:function events(){return{"click .js-toggle-item":"onClick"}}},{key:"preRender",value:function preRender(){this.checkIfResetOnRevisit();this.model.resetActiveItems();this.listenTo(this.model.get("_children"),{"change:_isActive":this.onItemsActiveChange,"change:_isVisited":this.onItemsVisitedChange})}},{key:"postRender",value:function postRender(){this.setReadyStatus();if(this.model.get("_setCompletionOn")==="inview"){this.setupInviewCompletion()}}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}}},{key:"onClick",value:function onClick(event){this.model.toggleItemsState($(event.currentTarget).parent().data("index"))}},{key:"onItemsActiveChange",value:function onItemsActiveChange(item,isActive){this.toggleItem(item,isActive)}},{key:"onItemsVisitedChange",value:function onItemsVisitedChange(item,isVisited){if(!isVisited)return;var $item=this.getItemElement(item);$item.children(".accordion__item-btn").addClass("is-visited")}},{key:"toggleItem",value:function toggleItem(item,shouldExpand){var $item=this.getItemElement(item);var $body=$item.children(".accordion__item-content").stop(true,true);$item.children(".accordion__item-btn").toggleClass("is-selected is-open",shouldExpand).toggleClass("is-closed",!shouldExpand).attr("aria-expanded",shouldExpand);if(!shouldExpand){$body.slideUp(this.model.get("_toggleSpeed"));return}$body.slideDown(this.model.get("_toggleSpeed"))}},{key:"getItemElement",value:function getItemElement(item){var index=item.get("_index");return this.$(".accordion__item").filter("[data-index=\"".concat(index,"\"]"))}}]);return AccordionView}(ComponentView);AccordionView.template="accordion";return AccordionView});define("components/adapt-contrib-accordion/js/adapt-contrib-accordion",["core/js/adapt","./accordionModel","./accordionView"],function(Adapt,AccordionModel,AccordionView){return Adapt.register("accordion",{model:AccordionModel,view:AccordionView})});define("components/adapt-contrib-assessmentResults/js/assessmentResultsModel",["core/js/adapt","core/js/models/componentModel"],function(Adapt,ComponentModel){var AssessmentResultsModel=function(_ComponentModel2){"use strict";_inherits(AssessmentResultsModel,_ComponentModel2);var _super35=_createSuper(AssessmentResultsModel);function AssessmentResultsModel(){_classCallCheck(this,AssessmentResultsModel);return _super35.apply(this,arguments)}_createClass(AssessmentResultsModel,[{key:"init",value:function init(){var _get3;this.set("originalBody",this.get("body"));this.listenTo(Adapt,{"assessments:complete":this.onAssessmentComplete,"assessments:reset":this.onAssessmentReset});for(var _len15=arguments.length,args=new Array(_len15),_key15=0;_key15<_len15;_key15++){args[_key15]=arguments[_key15]}(_get3=_get(_getPrototypeOf(AssessmentResultsModel.prototype),"init",this)).call.apply(_get3,[this].concat(args))}},{key:"checkIfAssessmentComplete",value:function checkIfAssessmentComplete(){if(!Adapt.assessment||this.get("_assessmentId")===undefined){return}var assessmentModel=Adapt.assessment.get(this.get("_assessmentId"));if(!assessmentModel||assessmentModel.length===0)return;var state=assessmentModel.getState();var isResetOnRevisit=assessmentModel.get("_assessment")._isResetOnRevisit;if(state.isComplete&&(!state.allowResetIfPassed||!isResetOnRevisit)){this.onAssessmentComplete(state);return}this.setVisibility()}},{key:"onAssessmentComplete",value:function onAssessmentComplete(state){if(this.get("_assessmentId")===undefined||this.get("_assessmentId")!=state.id)return;this.set({_state:state,attempts:state.attempts,attemptsSpent:state.attemptsSpent,attemptsLeft:state.attemptsLeft,score:state.score,scoreAsPercent:state.scoreAsPercent,maxScore:state.maxScore,isPass:state.isPass});this.setFeedbackBand(state);this.checkRetryEnabled(state);this.setFeedbackText();this.toggleVisibility(true)}},{key:"setFeedbackBand",value:function setFeedbackBand(state){var scoreProp=state.isPercentageBased?"scoreAsPercent":"score";var bands=_.sortBy(this.get("_bands"),"_score");for(var _i7=bands.length-1;_i7>=0;_i7--){var isScoreInBandRange=state[scoreProp]>=bands[_i7]._score;if(!isScoreInBandRange)continue;this.set("_feedbackBand",bands[_i7]);break}}},{key:"checkRetryEnabled",value:function checkRetryEnabled(state){var assessmentModel=Adapt.assessment.get(state.id);if(!assessmentModel.canResetInPage())return false;var feedbackBand=this.get("_feedbackBand");var isRetryEnabled=(feedbackBand&&feedbackBand._allowRetry)!==false;var isAttemptsLeft=state.attemptsLeft>0||state.attemptsLeft==="infinite";var showRetry=isRetryEnabled&&isAttemptsLeft&&(!state.isPass||state.allowResetIfPassed);this.set({_isRetryEnabled:showRetry,retryFeedback:showRetry?this.get("_retry").feedback:""})}},{key:"setFeedbackText",value:function setFeedbackText(){var feedbackBand=this.get("_feedbackBand");var feedback=feedbackBand?Handlebars.compile(feedbackBand.feedback)(this.toJSON()):"";this.set({feedback:feedback,body:this.get("_completionBody")})}},{key:"setVisibility",value:function setVisibility(){if(!Adapt.assessment)return;var isVisibleBeforeCompletion=this.get("_isVisibleBeforeCompletion")||false;var wasVisible=this.get("_isVisible");var assessmentModel=Adapt.assessment.get(this.get("_assessmentId"));if(!assessmentModel||assessmentModel.length===0)return;var state=assessmentModel.getState();var isComplete=state.isComplete;var isAttemptInProgress=state.attemptInProgress;var attemptsSpent=state.attemptsSpent;var hasHadAttempt=!isAttemptInProgress&&attemptsSpent>0;var isVisible=isVisibleBeforeCompletion&&!isComplete||hasHadAttempt;if(!wasVisible&&isVisible)isVisible=(_readOnlyError("isVisible"),false);this.toggleVisibility(isVisible)}},{key:"toggleVisibility",value:function toggleVisibility(isVisible){if(isVisible===undefined){isVisible=!this.get("_isVisible")}this.set("_isVisible",isVisible,{pluginName:"assessmentResults"})}},{key:"checkCompletion",value:function checkCompletion(){if(this.get("_setCompletionOn")==="pass"&&!this.get("isPass")){return}this.setCompletionStatus()}},{key:"onAssessmentReset",value:function onAssessmentReset(state){if(this.get("_assessmentId")===undefined||this.get("_assessmentId")!=state.id)return;var resetType=this.get("_resetType");if(!resetType||resetType==="inherit"){resetType=state.resetType||"hard"}this.reset(resetType,true)}},{key:"reset",value:function reset(){var _get4;this.set({body:this.get("originalBody"),state:null,feedback:"",_feedbackBand:null,retryFeedback:"",_isRetryEnabled:false});for(var _len16=arguments.length,args=new Array(_len16),_key16=0;_key16<_len16;_key16++){args[_key16]=arguments[_key16]}(_get4=_get(_getPrototypeOf(AssessmentResultsModel.prototype),"reset",this)).call.apply(_get4,[this].concat(args))}}]);return AssessmentResultsModel}(ComponentModel);return AssessmentResultsModel});define("components/adapt-contrib-assessmentResults/js/assessmentResultsView",["core/js/adapt","core/js/views/componentView"],function(Adapt,ComponentView){var AssessmentResultsView=function(_ComponentView2){"use strict";_inherits(AssessmentResultsView,_ComponentView2);var _super36=_createSuper(AssessmentResultsView);function AssessmentResultsView(){_classCallCheck(this,AssessmentResultsView);return _super36.apply(this,arguments)}_createClass(AssessmentResultsView,[{key:"events",value:function events(){return{"click .js-assessment-retry-btn":"onRetryClicked"}}},{key:"preRender",value:function preRender(){this.model.setLocking("_isVisible",false);this.listenTo(Adapt.parentView,"preRemove",function(){this.model.unsetLocking("_isVisible")});this.listenTo(this.model,{"change:_feedbackBand":this.addClassesToArticle,"change:body":this.render})}},{key:"postRender",value:function postRender(){this.model.checkIfAssessmentComplete();this.setReadyStatus();this.setupInviewCompletion(".component__inner",this.model.checkCompletion.bind(this.model))}},{key:"onRetryClicked",value:function onRetryClicked(){var _this75=this;var state=this.model.get("_state");Adapt.assessment.get(state.id).reset(null,function(wasReset){_newArrowCheck(this,_this75);if(!wasReset){return}if(this.model.get("_retry")._routeToAssessment===true){Adapt.navigateToElement("."+state.articleId)}}.bind(this))}},{key:"addClassesToArticle",value:function addClassesToArticle(model,value){if(!value||!value._classes)return;this.$el.parents(".article").addClass(value._classes)}}]);return AssessmentResultsView}(ComponentView);AssessmentResultsView.template="assessmentResults";return AssessmentResultsView});define("components/adapt-contrib-assessmentResults/js/adapt-contrib-assessmentResults",["core/js/adapt","./assessmentResultsModel","./assessmentResultsView"],function(Adapt,AssessmentResultsModel,AssessmentResultsView){return Adapt.register("assessmentResults",{model:AssessmentResultsModel,view:AssessmentResultsView})});define("components/adapt-contrib-blank/js/adapt-contrib-blank",["core/js/adapt","core/js/views/componentView","core/js/models/componentModel"],function(Adapt,ComponentView,ComponentModel){var BlankView=function(_ComponentView3){"use strict";_inherits(BlankView,_ComponentView3);var _super37=_createSuper(BlankView);function BlankView(){_classCallCheck(this,BlankView);return _super37.apply(this,arguments)}_createClass(BlankView,[{key:"preRender",value:function preRender(){this.checkIfResetOnRevisit()}},{key:"postRender",value:function postRender(){this.setReadyStatus();this.setupInviewCompletion()}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}}}]);return BlankView}(ComponentView);BlankView.template="blank";return Adapt.register("blank",{model:ComponentModel.extend({}),view:BlankView})});define("components/adapt-contrib-flipcard/js/adapt-contrib-flipcard",["coreViews/componentView","coreJS/adapt"],function(ComponentView,Adapt){var Flipcard=ComponentView.extend({events:{"click .flipcard__item":"onClickFlipItem"},preRender:function preRender(){this.listenTo(Adapt,"device:resize",this.reRender,this);this.checkIfResetOnRevisit()},postRender:function postRender(){if(!Modernizr.testProp("transformStyle","preserve-3d")){this.$(".flipcard__item-back").hide()}this.$(".flipcard__widget").imageready(_.bind(function(){this.setReadyStatus();this.reRender()},this))},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}_.each(this.model.get("_items"),function(item){item._isVisited=false})},reRender:function reRender(){var imageHeight=this.$(".flipcard__item-frontImage").eq(0).height();if(imageHeight){this.$(".flipcard__item").height(imageHeight)}},onClickFlipItem:function onClickFlipItem(event){if(event&&event.target.tagName.toLowerCase()==="a"){return}else{event&&event.preventDefault()}var $selectedElement=$(event.currentTarget);var flipType=this.model.get("_flipType");if(flipType==="allFlip"){this.performAllFlip($selectedElement)}else if(flipType==="singleFlip"){this.performSingleFlip($selectedElement)}},performAllFlip:function performAllFlip($selectedElement){if(!Modernizr.testProp("transformStyle","preserve-3d")){var $frontflipcard=$selectedElement.find(".flipcard__item-front");var $backflipcard=$selectedElement.find(".flipcard__item-back");var flipTime=this.model.get("_flipTime")||"fast";if($frontflipcard.is(":visible")){$frontflipcard.fadeOut(flipTime,function(){$backflipcard.fadeIn(flipTime)})}else if($backflipcard.is(":visible")){$backflipcard.fadeOut(flipTime,function(){$frontflipcard.fadeIn(flipTime)})}}else{$selectedElement.toggleClass("flipcard-flip")}var flipcardElementIndex=this.$(".flipcard__item").index($selectedElement);this.setVisited(flipcardElementIndex)},performSingleFlip:function performSingleFlip($selectedElement){var flipcardContainer=$selectedElement.closest(".flipcard__widget");if(!Modernizr.testProp("transformStyle","preserve-3d")){var frontflipcard=$selectedElement.find(".flipcard__item-front");var backflipcard=$selectedElement.find(".flipcard__item-back");var flipTime=this.model.get("_flipTime")||"fast";if(backflipcard.is(":visible")){backflipcard.fadeOut(flipTime,function(){frontflipcard.fadeIn(flipTime)})}else{var visibleflipcardBack=flipcardContainer.find(".flipcard__item-back:visible");if(visibleflipcardBack.length>0){visibleflipcardBack.fadeOut(flipTime,function(){flipcardContainer.find(".flipcard__item-front:hidden").fadeIn(flipTime)})}frontflipcard.fadeOut(flipTime,function(){backflipcard.fadeIn(flipTime)})}}else{if($selectedElement.hasClass("flipcard-flip")){$selectedElement.removeClass("flipcard-flip")}else{flipcardContainer.find(".flipcard__item").removeClass("flipcard-flip");$selectedElement.addClass("flipcard-flip")}}var flipcardElementIndex=this.$(".flipcard__item").index($selectedElement);this.setVisited(flipcardElementIndex)},setVisited:function setVisited(index){var item=this.model.get("_items")[index];item._isVisited=true;this.checkCompletionStatus()},getVisitedItems:function getVisitedItems(){return _.filter(this.model.get("_items"),function(item){return item._isVisited})},checkCompletionStatus:function checkCompletionStatus(){if(this.getVisitedItems().length===this.model.get("_items").length){this.setCompletionStatus()}}});Adapt.register("flipcard",Flipcard);return Flipcard});define("components/adapt-contrib-glossary/js/adapt-contrib-glossaryItemView",["core/js/adapt"],function(Adapt){var GlossaryItemView=Backbone.View.extend({className:"glossary__item",attributes:{role:"listitem"},events:{"click .js-glossary-item-term-click":"onGlossaryItemClicked"},initialize:function initialize(){this.listenTo(Adapt,{"remove drawer:closed":this.remove,"glossary:descriptionOpen":this.descriptionOpen});this.setupModel();this.listenTo(this.model,"change:_isVisible",this.onGlossaryItemVisibilityChange);this.render()},setupModel:function setupModel(){this.model.set({"_isVisible":true,"_isDescriptionOpen":false})},render:function render(){var template=Handlebars.templates.glossaryItem;this.$el.html(template(this.model.toJSON()));_.defer(_.bind(function(){this.postRender()},this));return this},postRender:function postRender(){this.listenTo(Adapt,{"drawer:openedItemView":this.remove,"drawer:triggerCustomView":this.remove})},onGlossaryItemClicked:function onGlossaryItemClicked(event){event&&event.preventDefault();Adapt.trigger("glossary:descriptionOpen",this.model.cid)},toggleGlossaryItemDescription:function toggleGlossaryItemDescription(){if(this.model.get("_isDescriptionOpen")){this.hideGlossaryItemDescription()}else{this.showGlossaryItemDescription()}},showGlossaryItemDescription:function showGlossaryItemDescription(){var $glossaryItemTerm=this.$(".js-glossary-item-term-click");var description=$glossaryItemTerm.addClass("is-selected").siblings(".js-glossary-item-description").slideDown(200,function(){$(description).a11y_focus()});$glossaryItemTerm.attr("aria-expanded",true);this.model.set("_isDescriptionOpen",true)},hideGlossaryItemDescription:function hideGlossaryItemDescription(){this.$(".js-glossary-item-description").stop(true,true).slideUp(200);this.model.set("_isDescriptionOpen",false);this.$(".js-glossary-item-term-click").removeClass("is-selected").attr("aria-expanded",false)},descriptionOpen:function descriptionOpen(viewId){if(viewId==this.model.cid){this.toggleGlossaryItemDescription()}else if(this.model.get("_isDescriptionOpen")){this.hideGlossaryItemDescription()}},onGlossaryItemVisibilityChange:function onGlossaryItemVisibilityChange(){if(this.model.get("_isDescriptionOpen")){this.hideGlossaryItemDescription()}if(this.model.get("_isVisible")){this.$el.removeClass("u-display-none")}else{this.$el.addClass("u-display-none")}}});return GlossaryItemView});define("components/adapt-contrib-glossary/js/adapt-contrib-glossaryView",["core/js/adapt","./adapt-contrib-glossaryItemView"],function(Adapt,GlossaryItemView){var GlossaryView=Backbone.View.extend({className:"glossary",events:{"keyup .js-glossary-textbox-change":"onInputTextBoxValueChange","input .js-glossary-textbox-change":"onInputTextBoxValueChange","paste .js-glossary-textbox-change":"onInputTextBoxValueChange","change .js-glossary-checkbox-change":"onInputTextBoxValueChange","click .js-glossary-cancel-btn-click":"onCancelButtonClick"},itemViews:null,prevScrollPos:0,isSearchActive:false,initialize:function initialize(){this.listenTo(Adapt,"remove drawer:closed",this.remove);this.setupModel();this.onScroll=_.debounce(this.onScroll.bind(this),200);this.render()},checkForTermToShow:function checkForTermToShow(){if(this.$el.data("termtoshow")===undefined)return;for(var i=0,count=this.itemViews.length;i<count;i++){var itemView=this.itemViews[i];if(itemView.model.get("term").toLowerCase()===this.$el.data("termtoshow").toLowerCase()){Adapt.trigger("glossary:descriptionOpen",itemView.model.cid);break}}},remove:function remove(){this.itemViews=null;Backbone.View.prototype.remove.apply(this,arguments)},setupModel:function setupModel(){this.arrangeGlossaryItemsToAscendingOrder();this.groupGlossaryItems()},arrangeGlossaryItemsToAscendingOrder:function arrangeGlossaryItemsToAscendingOrder(){function caseInsensitiveComparator(model1,model2){return model1.get("term").toLowerCase().localeCompare(model2.get("term").toLowerCase())}this.collection.comparator=caseInsensitiveComparator;this.collection.sort()},groupGlossaryItems:function groupGlossaryItems(){if(this.model.get("_isIndexEnabled")){this.model.set("_isGroupHeadersEnabled",true)}if(!this.model.get("_isGroupHeadersEnabled"))return;var groups=this.collection.groupBy(function(model){return model.get("term").charAt(0).toLocaleUpperCase()});this.collection._byChar0=groups},render:function render(){var template=Handlebars.templates.glossary;this.$el.html(template(this.model.toJSON()));if(this.model.get("_isIndexEnabled")){this.renderIndexHeader()}if(this.model.get("_isGroupHeadersEnabled")){this.renderGlossaryItemsWithHeaders()}else{this.renderGlossaryItems()}_.defer(_.bind(function(){this.postRender()},this));return this},renderIndexHeader:function renderIndexHeader(){var $glossaryIndex=this.$(".js-glossary-index-container").empty();_.each(this.collection._byChar0,function(group,key){var template=Handlebars.templates.glossaryIndexItem;$glossaryIndex.append(template({_key:key,_group:group}))});this.prevScrollPos=$(".js-drawer-holder").scrollTop();$(".js-drawer-holder").on("scroll",this.onScroll);this.$(".js-glossary-index-link").on("click",this.scrollToPosition)},onScroll:function onScroll(){var currentScrollPos=$(".js-drawer-holder").scrollTop();var indexDisplay=this.$(".js-glossary-index-container").css("display");var isIndexVisible=indexDisplay==="none"?false:true;if(isIndexVisible){if(this.prevScrollPos>currentScrollPos){this.$(".js-glossary-index-container").addClass("scrolling-up").removeClass("scrolling-down");var indexOuterHeight=this.$(".js-glossary-index-container").outerHeight(true);this.$(".js-glossary-items-container").css("top",indexOuterHeight+"px")}else{this.$(".js-glossary-index-container").addClass("scrolling-down").removeClass("scrolling-up");this.$(".js-glossary-items-container").css("top","0")}}this.prevScrollPos=currentScrollPos},scrollToPosition:function scrollToPosition(event){if(event&&event.preventDefault)event.preventDefault();var selector=$(event.currentTarget).attr("href");var $target=$(selector);$(".js-drawer-holder").animate({scrollTop:$target.position().top})},renderGlossaryItemsWithHeaders:function renderGlossaryItemsWithHeaders(){this.itemViews=[];var $glossaryItemContainer=this.$(".js-glossary-items-container").empty();_.each(this.collection._byChar0,function(group,key){var $glossaryItemsGroupContainer=$("<div"+" class='glossary__items-group' role=list'"+" aria-labelledby='"+key+"'></div>");var $glossaryItemsGroupHeader=$("<div id="+key+" class='glossary__items-group-header js-glossary-items-group-header'>"+key+"</div>");$glossaryItemsGroupContainer.append($glossaryItemsGroupHeader);this.createItemViews(group,$glossaryItemsGroupContainer);$glossaryItemContainer.append($glossaryItemsGroupContainer)},this)},renderGlossaryItems:function renderGlossaryItems(){this.itemViews=[];var $glossaryItemContainer=this.$(".js-glossary-items-container").empty();this.createItemViews(this.collection.models,$glossaryItemContainer)},createItemViews:function createItemViews(models,$container){_.each(models,function(item){var itemView=new GlossaryItemView({model:item});itemView.$el.appendTo($container);this.itemViews.push(itemView)},this)},postRender:function postRender(){var widthExclScrollbar=$(".drawer").prop("clientWidth");$(".drawer__toolbar").css({"width":widthExclScrollbar+"px","z-index":"2"});this.listenTo(Adapt,{"drawer:openedItemView":this.remove,"drawer:triggerCustomView":this.remove});this.configureContainers();this.checkForTermToShow()},configureContainers:function configureContainers(){var isSearchEnabled=this.model.get("_isSearchEnabled");var isIndexEnabled=this.model.get("_isIndexEnabled");var glossaryWidth=this.$(".js-glossary-inner").width();var searchOuterHeight=this.$(".js-glossary-search-container").outerHeight(true);if(isSearchEnabled){this.$(".js-glossary-search-container").css("width",glossaryWidth);this.$(".js-glossary-item-not-found").css("top",searchOuterHeight+"px")}if(isIndexEnabled){this.$(".js-glossary-index-container").css("margin-top",searchOuterHeight).css("width",glossaryWidth)}if(isSearchEnabled&&!isIndexEnabled){this.$(".js-glossary-items-container").css("top",searchOuterHeight+"px")}if(isSearchEnabled&&isIndexEnabled){this.$(".js-glossary-items-container").css("top","unset")}if(this.isSearchActive&&isIndexEnabled){this.$(".js-glossary-items-container").css("top",searchOuterHeight)}},onInputTextBoxValueChange:_.debounce(function(event){this.showItemNotFoundMessage(false);this.isSearchActive=true;var searchItem=this.$(".js-glossary-textbox-change").val().toLowerCase();var shouldSearchInDescription=this.$(".js-glossary-checkbox-change").is(":checked");var searchItemsAlert=this.model.get("searchItemsAlert")||"";if(searchItem.length>0){this.$(".js-glossary-cancel-btn-click").removeClass("u-display-none");this.$(".js-glossary-search-icon").addClass("u-display-none");var filteredItems=this.getFilteredGlossaryItems(searchItem,shouldSearchInDescription);this.$(".js-glossary-alert").html(Handlebars.compile(searchItemsAlert)({filteredItems:filteredItems}));this.hideHeaders();this.showFilterGlossaryItems(filteredItems);this.configureContainers()}else{this.$(".js-glossary-cancel-btn-click").addClass("u-display-none");this.$(".js-glossary-search-icon").removeClass("u-display-none");this.isSearchActive=false;this.showHeaders();this.showGlossaryItems(true);this.configureContainers()}$(".js-drawer-holder").animate({scrollTop:"0"})},200),hideHeaders:function hideHeaders(){if(this.model.get("_isIndexEnabled")){this.$(".js-glossary-index-container").addClass("u-display-none")}if(this.model.get("_isGroupHeadersEnabled")){this.$(".js-glossary-items-group-header").addClass("u-display-none")}},showHeaders:function showHeaders(){if(this.model.get("_isIndexEnabled")){this.$(".js-glossary-index-container").removeClass("u-display-none")}if(this.model.get("_isGroupHeadersEnabled")){this.$(".js-glossary-items-group-header").removeClass("u-display-none")}},onCancelButtonClick:function onCancelButtonClick(event){if(event&&event.preventDefault)event.preventDefault();this.isSearchActive=false;var $input=this.$(".js-glossary-textbox-change");$input.val("").trigger("input");_.defer(function(){$input.focus()})},getFilteredGlossaryItems:function getFilteredGlossaryItems(searchItem,shouldSearchInDescription){var terms=searchItem.split(" ");return this.collection.filter(function(model){return _.every(terms,function(term){var title=model.get("term").toLowerCase();var description=model.get("description").toLowerCase();return shouldSearchInDescription?title.indexOf(term)!==-1||description.indexOf(term)!==-1:title.indexOf(term)!==-1})})},showFilterGlossaryItems:function showFilterGlossaryItems(filteredItems){this.showGlossaryItems(false);if(filteredItems.length>0){_.each(filteredItems,function(item,index){item.set("_isVisible",true)})}else{this.showItemNotFoundMessage(true)}},showItemNotFoundMessage:function showItemNotFoundMessage(_isVisible){var $itemNotFound=this.$(".js-glossary-item-not-found");if(!_isVisible&&!$itemNotFound.hasClass("u-display-none")){$itemNotFound.addClass("u-display-none")}else if(_isVisible&&$itemNotFound.hasClass("u-display-none")){$itemNotFound.removeClass("u-display-none")}},showGlossaryItems:function showGlossaryItems(_isVisible){_.invoke(this.collection.models,"set",{"_isVisible":_isVisible})}});return GlossaryView});define("components/adapt-contrib-glossary/js/adapt-contrib-glossary",["core/js/adapt","./adapt-contrib-glossaryView"],function(Adapt,GlossaryView){function setupGlossary(glossaryModel,glossaryItems){glossaryModel=new Backbone.Model(glossaryModel);var options={model:glossaryModel,collection:new Backbone.Collection(glossaryItems)};Adapt.on("glossary:showGlossary",function(){Adapt.drawer.triggerCustomView(new GlossaryView(options).$el)});$("body").on("click.glossary","a[data-glossaryterm]",function(e){if(e)e.preventDefault();var newoptions=_.clone(options);newoptions.attributes={"data-termtoshow":e.currentTarget.getAttribute("data-glossaryterm")};Adapt.drawer.triggerCustomView(new GlossaryView(newoptions).$el)})}function initGlossary(){var courseGlossary=Adapt.course.get("_glossary");if(!courseGlossary||!courseGlossary._isEnabled){return}var drawerObject={title:courseGlossary.title,description:courseGlossary.description,className:"is-glossary",drawerOrder:courseGlossary._drawerOrder||0};Adapt.drawer.addItem(drawerObject,"glossary:showGlossary");setupGlossary(courseGlossary,courseGlossary._glossaryItems)}Adapt.on("app:dataReady",initGlossary)});define("core/js/enums/buttonStateEnum",[],function(){var BUTTON_STATE=ENUM(["SUBMIT","CORRECT","INCORRECT","SHOW_CORRECT_ANSWER","HIDE_CORRECT_ANSWER","SHOW_FEEDBACK","RESET"]);return BUTTON_STATE});define("core/js/views/buttonsView",["core/js/adapt","core/js/enums/buttonStateEnum"],function(Adapt,BUTTON_STATE){var textPropertyName={"SUBMIT":"submit","CORRECT":"correct","INCORRECT":"incorrect","SHOW_CORRECT_ANSWER":"showCorrectAnswer","HIDE_CORRECT_ANSWER":"hideCorrectAnswer","SHOW_FEEDBACK":"showFeedback","RESET":"reset"};var ButtonsView=Backbone.View.extend({initialize:function initialize(options){this.parent=options.parent;this.listenTo(Adapt.parentView,"postRemove",this.remove);this.listenTo(this.model,{"change:_buttonState":this.onButtonStateChanged,"change:feedbackMessage":this.onFeedbackMessageChanged,"change:_attemptsLeft":this.onAttemptsChanged,"change:_canSubmit":this.onCanSubmitChange});this.render()},events:{"click .js-btn-action":"onActionClicked","click .js-btn-feedback":"onFeedbackClicked"},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates["buttons"];_.defer(_.bind(function(){this.postRender();Adapt.trigger("buttonsView:postRender",this)},this));this.$el.html(template(data))},postRender:function postRender(){this.refresh()},checkResetSubmittedState:function checkResetSubmittedState(){var isSubmitted=this.model.get("_isSubmitted");if(!isSubmitted){this.$(".js-btn-marking").removeClass("is-incorrect is-correct").addClass("u-display-none");this.$el.removeClass("is-submitted");this.model.set("feedbackMessage",undefined);Adapt.a11y.toggleAccessibleEnabled(this.$(".js-btn-feedback"),false)}else{this.$el.addClass("is-submitted")}},onActionClicked:function onActionClicked(){var buttonState=this.model.get("_buttonState");this.trigger("buttons:stateUpdate",BUTTON_STATE(buttonState));this.checkResetSubmittedState()},onFeedbackClicked:function onFeedbackClicked(){this.trigger("buttons:stateUpdate",BUTTON_STATE.SHOW_FEEDBACK)},onFeedbackMessageChanged:function onFeedbackMessageChanged(model,changedAttribute){if(changedAttribute&&this.model.get("_canShowFeedback")){Adapt.a11y.toggleAccessibleEnabled(this.$(".js-btn-feedback"),true)}else{Adapt.a11y.toggleAccessibleEnabled(this.$(".js-btn-feedback"),false)}},onCanSubmitChange:function onCanSubmitChange(){this.onButtonStateChanged(this.model,this.model.get("_buttonState"))},onButtonStateChanged:function onButtonStateChanged(model,changedAttribute){this.updateAttemptsCount();var $buttonsAction=this.$(".js-btn-action");var buttonState=BUTTON_STATE(changedAttribute);if(changedAttribute===BUTTON_STATE.CORRECT||changedAttribute===BUTTON_STATE.INCORRECT){Adapt.a11y.toggleAccessibleEnabled($buttonsAction,false)}else{var propertyName=textPropertyName[buttonState.asString];var ariaLabel=this.model.get("_buttons")["_"+propertyName].ariaLabel;var buttonText=this.model.get("_buttons")["_"+propertyName].buttonText;Adapt.a11y.toggleAccessibleEnabled($buttonsAction,this.model.get("_canSubmit"));$buttonsAction.html(buttonText).attr("aria-label",ariaLabel);switch(changedAttribute){case BUTTON_STATE.SHOW_CORRECT_ANSWER:case BUTTON_STATE.HIDE_CORRECT_ANSWER:Adapt.a11y.toggleAccessible($buttonsAction,false);}}},checkFeedbackState:function checkFeedbackState(){var canShowFeedback=this.model.get("_canShowFeedback");this.$(".js-btn-action").toggleClass("is-full-width",!canShowFeedback);this.$(".js-btn-feedback").toggleClass("u-display-none",!canShowFeedback);this.$(".js-btn-marking").toggleClass("is-full-width u-display-none",!canShowFeedback)},updateAttemptsCount:function updateAttemptsCount(model,changedAttribute){var isInteractionComplete=this.model.get("_isInteractionComplete");var attemptsLeft=this.model.get("_attemptsLeft")?this.model.get("_attemptsLeft"):this.model.get("_attempts");var shouldDisplayAttempts=this.model.get("_shouldDisplayAttempts");var attemptsString;this.checkResetSubmittedState();if(!isInteractionComplete&&attemptsLeft!==0){attemptsString=attemptsLeft+" ";if(attemptsLeft>1){attemptsString+=this.model.get("_buttons").remainingAttemptsText}else if(attemptsLeft===1){attemptsString+=this.model.get("_buttons").remainingAttemptText}}else{this.$(".js-display-attempts").addClass("u-visibility-hidden");this.showMarking()}if(shouldDisplayAttempts){this.$(".js-insert-attempts-string").html(attemptsString)}},showMarking:function showMarking(){if(!this.model.shouldShowMarking)return;var isCorrect=this.model.get("_isCorrect");var ariaLabels=Adapt.course.get("_globals")._accessibility._ariaLabels;this.$(".js-btn-marking").removeClass("u-display-none").addClass(isCorrect?"is-correct":"is-incorrect").attr("aria-label",isCorrect?ariaLabels.answeredCorrectly:ariaLabels.answeredIncorrectly)},refresh:function refresh(){this.updateAttemptsCount();this.checkResetSubmittedState();this.checkFeedbackState();this.onButtonStateChanged(null,this.model.get("_buttonState"));this.onFeedbackMessageChanged(null,this.model.get("feedbackMessage"))}});return ButtonsView});define("core/js/models/questionModel",["core/js/adapt","core/js/models/componentModel","core/js/enums/buttonStateEnum"],function(Adapt,ComponentModel,BUTTON_STATE){var QuestionModel=function(_ComponentModel3){"use strict";_inherits(QuestionModel,_ComponentModel3);var _super38=_createSuper(QuestionModel);function QuestionModel(){_classCallCheck(this,QuestionModel);return _super38.apply(this,arguments)}_createClass(QuestionModel,[{key:"defaults",value:function defaults(){return ComponentModel.resultExtend("defaults",{_isQuestionType:true,_shouldDisplayAttempts:false,_canShowModelAnswer:true,_canShowFeedback:true,_canShowMarking:true,_canSubmit:true,_isSubmitted:false,_questionWeight:Adapt.config.get("_questionWeight"),_items:[]})}},{key:"trackable",value:function trackable(){return ComponentModel.resultExtend("trackable",["_isSubmitted","_score","_isCorrect","_attemptsLeft"])}},{key:"trackableType",value:function trackableType(){return ComponentModel.resultExtend("trackableType",[Boolean,Number,Boolean,Number])}},{key:"getTypeGroup",value:function getTypeGroup(){return"question"}},{key:"init",value:function init(){this.setupDefaultSettings();this.setLocking("_canSubmit",true);_get(_getPrototypeOf(QuestionModel.prototype),"init",this).call(this)}},{key:"setupDefaultSettings",value:function setupDefaultSettings(){this.setupWeightSettings();this.setupButtonSettings()}},{key:"setupButtonSettings",value:function setupButtonSettings(){var globalButtons=Adapt.course.get("_buttons");if(!this.has("_buttons")){this.set("_buttons",globalButtons)}else{var componentButtons=this.get("_buttons");for(var key in componentButtons){if(_typeof(componentButtons[key])==="object"){if(!componentButtons[key].buttonText&&globalButtons[key].buttonText){componentButtons[key].buttonText=globalButtons[key].buttonText}if(!componentButtons[key].ariaLabel&&globalButtons[key].ariaLabel){componentButtons[key].ariaLabel=globalButtons[key].ariaLabel}}if(!componentButtons[key]&&globalButtons[key]){componentButtons[key]=globalButtons[key]}}}}},{key:"setupWeightSettings",value:function setupWeightSettings(){}},{key:"canSubmit",value:function canSubmit(){}},{key:"checkCanSubmit",value:function checkCanSubmit(){this.set("_canSubmit",this.canSubmit(),{pluginName:"adapt"})}},{key:"updateAttempts",value:function updateAttempts(){if(!this.get("_attemptsLeft")){this.set("_attemptsLeft",this.get("_attempts"))}this.set("_attemptsLeft",this.get("_attemptsLeft")-1)}},{key:"setQuestionAsSubmitted",value:function setQuestionAsSubmitted(){this.set({_isEnabled:false,_isSubmitted:true})}},{key:"markQuestion",value:function markQuestion(){if(this.isCorrect()){this.set("_isCorrect",true)}else{this.set("_isCorrect",false)}}},{key:"isCorrect",value:function isCorrect(){}},{key:"setScore",value:function setScore(){}},{key:"checkQuestionCompletion",value:function checkQuestionCompletion(){var isComplete=this.get("_isCorrect")||this.get("_attemptsLeft")===0;if(isComplete){this.setCompletionStatus()}return isComplete}},{key:"updateButtons",value:function updateButtons(){var isInteractionComplete=this.get("_isInteractionComplete");var isCorrect=this.get("_isCorrect");var isEnabled=this.get("_isEnabled");var buttonState=this.get("_buttonState");var canShowModelAnswer=this.get("_canShowModelAnswer");if(isInteractionComplete){if(isCorrect||!canShowModelAnswer){this.set("_buttonState",BUTTON_STATE.CORRECT)}else{switch(buttonState){case BUTTON_STATE.SUBMIT:case BUTTON_STATE.HIDE_CORRECT_ANSWER:this.set("_buttonState",BUTTON_STATE.SHOW_CORRECT_ANSWER);break;default:this.set("_buttonState",BUTTON_STATE.HIDE_CORRECT_ANSWER);}}}else{if(isEnabled){this.set("_buttonState",BUTTON_STATE.SUBMIT)}else{this.set("_buttonState",BUTTON_STATE.RESET)}}}},{key:"setupFeedback",value:function setupFeedback(){if(!this.has("_feedback"))return;if(this.get("_isCorrect")){this.setupCorrectFeedback()}else if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback()}else{this.setupIncorrectFeedback()}}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){}},{key:"setupCorrectFeedback",value:function setupCorrectFeedback(){this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:this.get("_feedback").correct})}},{key:"setupPartlyCorrectFeedback",value:function setupPartlyCorrectFeedback(){var feedback=this.get("_feedback")._partlyCorrect;if(feedback&&feedback.final){this.setAttemptSpecificFeedback(feedback)}else{this.setupIncorrectFeedback()}}},{key:"setupIncorrectFeedback",value:function setupIncorrectFeedback(){this.setAttemptSpecificFeedback(this.get("_feedback")._incorrect)}},{key:"setAttemptSpecificFeedback",value:function setAttemptSpecificFeedback(feedback){var body=this.get("_attemptsLeft")&&feedback.notFinal||feedback.final;this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:body})}},{key:"getFeedbackTitle",value:function getFeedbackTitle(){return this.get("_feedback").title||this.get("displayTitle")||this.get("title")||""}},{key:"isInteractive",value:function isInteractive(){return!this.get("_isComplete")||this.get("_isEnabled")&&!this.get("_isSubmitted")}},{key:"reset",value:function reset(type,force){if(!this.get("_canReset")&&!force)return;type=type||true;_get(_getPrototypeOf(QuestionModel.prototype),"reset",this).call(this,type,force);var attempts=this.get("_attempts");this.set({_attemptsLeft:attempts,_isCorrect:undefined,_isSubmitted:false,_buttonState:BUTTON_STATE.SUBMIT})}},{key:"setQuestionAsReset",value:function setQuestionAsReset(){this.set({_isEnabled:true,_isSubmitted:false})}},{key:"refresh",value:function refresh(){this.trigger("question:refresh")}},{key:"getButtonState",value:function getButtonState(){if(this.get("_isCorrect")){return BUTTON_STATE.CORRECT}if(this.get("_attemptsLeft")===0){return this.get("_canShowModelAnswer")?BUTTON_STATE.SHOW_CORRECT_ANSWER:BUTTON_STATE.INCORRECT}return this.get("_isSubmitted")?BUTTON_STATE.RESET:BUTTON_STATE.SUBMIT}},{key:"getInteractionObject",value:function getInteractionObject(){return{}}},{key:"getResponse",value:function getResponse(){}},{key:"getResponseType",value:function getResponseType(){}},{key:"onSubmitted",value:function onSubmitted(){this.addAttemptObject()}},{key:"shouldShowMarking",get:function get(){if(!this.get("_canShowMarking")){return false}return this.get("_isInteractionComplete")}}]);return QuestionModel}(ComponentModel);return QuestionModel});define("core/js/views/questionView",["core/js/adapt","core/js/views/componentView","core/js/views/buttonsView","core/js/models/questionModel","core/js/enums/buttonStateEnum"],function(Adapt,ComponentView,ButtonsView,QuestionModel,BUTTON_STATE){var useQuestionModelOnly=false;var QuestionView=function(_ComponentView4){"use strict";_inherits(QuestionView,_ComponentView4);var _super39=_createSuper(QuestionView);function QuestionView(){_classCallCheck(this,QuestionView);return _super39.apply(this,arguments)}_createClass(QuestionView,[{key:"className",value:function className(){return["component","is-question",this.model.get("_component").toLowerCase(),this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),"is-"+this.model.get("_layout"),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":"",this.model.get("_canShowModelAnswer")?"can-show-model-answer":"",this.model.get("_canShowFeedback")?"can-show-feedback":"",this.model.get("_canShowMarking")?"can-show-marking":""].join(" ")}},{key:"preRender",value:function preRender(){this.listenTo(this.model,"change:_isEnabled",this.onEnabledChanged);this.listenTo(this.model,"question:refresh",this.refresh);this.checkIfResetOnRevisit();this._runModelCompatibleFunction("setupDefaultSettings");this.setupQuestion()}},{key:"onEnabledChanged",value:function onEnabledChanged(model,changedAttribute){if(!changedAttribute){this.$(".component__widget").addClass("is-disabled");this.disableQuestion()}else{this.$(".component__widget").removeClass("is-disabled");this.enableQuestion()}}},{key:"disableQuestion",value:function disableQuestion(){}},{key:"enableQuestion",value:function enableQuestion(){}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var _this76=this;var isResetOnRevisit=this.model.get("_isResetOnRevisit");isResetOnRevisit=isResetOnRevisit==="false"?false:isResetOnRevisit;if(isResetOnRevisit){this.model.reset(isResetOnRevisit,true);_.defer(function(){_newArrowCheck(this,_this76);this.resetQuestionOnRevisit(isResetOnRevisit)}.bind(this))}else{var isInteractionComplete=this.model.get("_isInteractionComplete");if(isInteractionComplete){this.model.set("_buttonState",BUTTON_STATE.HIDE_CORRECT_ANSWER);_.defer(function(){_newArrowCheck(this,_this76);this.onHideCorrectAnswerClicked()}.bind(this))}else{this.model.set("_buttonState",BUTTON_STATE.SUBMIT);_.defer(function(){_newArrowCheck(this,_this76);this.onResetClicked()}.bind(this))}}}},{key:"resetQuestionOnRevisit",value:function resetQuestionOnRevisit(type){}},{key:"setupQuestion",value:function setupQuestion(){}},{key:"postRender",value:function postRender(){this.addButtonsView();this.onQuestionRendered()}},{key:"addButtonsView",value:function addButtonsView(){this.buttonsView=new ButtonsView({model:this.model,el:this.$(".btn__container")});this.listenTo(this.buttonsView,"buttons:stateUpdate",this.onButtonStateUpdate)}},{key:"onButtonStateUpdate",value:function onButtonStateUpdate(buttonState){switch(buttonState){case BUTTON_STATE.SUBMIT:this.onSubmitClicked();break;case BUTTON_STATE.RESET:this.onResetClicked();break;case BUTTON_STATE.SHOW_CORRECT_ANSWER:this.onShowCorrectAnswerClicked();break;case BUTTON_STATE.HIDE_CORRECT_ANSWER:this.onHideCorrectAnswerClicked();break;case BUTTON_STATE.SHOW_FEEDBACK:this.showFeedback();break;}}},{key:"onQuestionRendered",value:function onQuestionRendered(){}},{key:"onSubmitClicked",value:function onSubmitClicked(){var canSubmit=this._runModelCompatibleFunction("canSubmit");if(!canSubmit){this.showInstructionError();this.onCannotSubmit();return}this._runModelCompatibleFunction("updateAttempts");this._runModelCompatibleFunction("setQuestionAsSubmitted");this.removeInstructionError();this._runModelCompatibleFunction("storeUserAnswer");this._runModelCompatibleFunction("markQuestion","isCorrect");this._runModelCompatibleFunction("setScore");this._runModelCompatibleFunction("checkQuestionCompletion");if(this.model.shouldShowMarking){this.showMarking()}this.recordInteraction();this._runModelCompatibleFunction("setupFeedback");this.showFeedback();$(window).resize();this._runModelCompatibleFunction("updateButtons");this.model.onSubmitted();this.onSubmitted()}},{key:"showInstructionError",value:function showInstructionError(){Adapt.trigger("questionView:showInstructionError",this)}},{key:"onCannotSubmit",value:function onCannotSubmit(){}},{key:"onSubmitted",value:function onSubmitted(){}},{key:"setQuestionAsSubmitted",value:function setQuestionAsSubmitted(){this.model.setQuestionAsSubmitted();this.$(".component__widget").addClass("is-submitted")}},{key:"removeInstructionError",value:function removeInstructionError(){this.$(".component__instruction-inner").removeClass("validation-error")}},{key:"showMarking",value:function showMarking(){}},{key:"checkQuestionCompletion",value:function checkQuestionCompletion(){var isComplete=this.model.checkQuestionCompletion();if(isComplete){this.$(".component__widget").addClass("is-complete show-user-answer")}}},{key:"recordInteraction",value:function recordInteraction(){if(this.model.get("_recordInteraction")===true||!this.model.has("_recordInteraction")){Adapt.trigger("questionView:recordInteraction",this)}}},{key:"showFeedback",value:function showFeedback(){if(this.model.get("_canShowFeedback")){Adapt.trigger("questionView:showFeedback",this)}else{Adapt.trigger("questionView:disabledFeedback",this)}}},{key:"onResetClicked",value:function onResetClicked(){this.setQuestionAsReset();this._runModelCompatibleFunction("resetUserAnswer");this.resetQuestion();this.model.checkCanSubmit();this._runModelCompatibleFunction("updateButtons");if(!this.model.get("_isReady"))return;var currentModel=Adapt.findById(Adapt.location._currentId);if(!currentModel||!currentModel.get("_isReady"))return;Adapt.a11y.focusNext(this.$el)}},{key:"setQuestionAsReset",value:function setQuestionAsReset(){this.model.setQuestionAsReset();this.$(".component__widget").removeClass("is-submitted")}},{key:"resetQuestion",value:function resetQuestion(){}},{key:"refresh",value:function refresh(){this.model.set("_buttonState",this.model.getButtonState());if(this.model.shouldShowMarking&&this.model.get("_isSubmitted")){this.showMarking()}if(this.buttonsView){_.defer(this.buttonsView.refresh.bind(this.buttonsView))}}},{key:"onShowCorrectAnswerClicked",value:function onShowCorrectAnswerClicked(){this.setQuestionAsShowCorrect();this._runModelCompatibleFunction("updateButtons");this.showCorrectAnswer()}},{key:"setQuestionAsShowCorrect",value:function setQuestionAsShowCorrect(){this.$(".component__widget").addClass("is-submitted show-correct-answer").removeClass("show-user-answer")}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){}},{key:"onHideCorrectAnswerClicked",value:function onHideCorrectAnswerClicked(){this.setQuestionAsHideCorrect();this._runModelCompatibleFunction("updateButtons");this.hideCorrectAnswer()}},{key:"setQuestionAsHideCorrect",value:function setQuestionAsHideCorrect(){this.$(".component__widget").addClass("is-submitted show-user-answer").removeClass("show-correct-answer")}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){}},{key:"getLatency",value:function getLatency(){return null}},{key:"_runModelCompatibleFunction",value:function _runModelCompatibleFunction(name,lookForViewOnlyFunction){return this.model[name]()}}]);return QuestionView}(ComponentView);QuestionView._isQuestionType=true;if(useQuestionModelOnly)return QuestionView;var ViewOnlyQuestionViewCompatibilityLayer=function(_QuestionView){"use strict";_inherits(ViewOnlyQuestionViewCompatibilityLayer,_QuestionView);var _super40=_createSuper(ViewOnlyQuestionViewCompatibilityLayer);function ViewOnlyQuestionViewCompatibilityLayer(){_classCallCheck(this,ViewOnlyQuestionViewCompatibilityLayer);return _super40.apply(this,arguments)}_createClass(ViewOnlyQuestionViewCompatibilityLayer,[{key:"getInteractionObject",value:function getInteractionObject(){Adapt.log.deprecated("QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject");return this.model.getInteractionObject()}},{key:"getResponse",value:function getResponse(){Adapt.log.deprecated("QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject");return this.model.getResponse()}},{key:"getResponseType",value:function getResponseType(){Adapt.log.deprecated("QuestionView.getResponseType, please use QuestionModel.getResponseType");return this.model.getResponseType()}},{key:"setupDefaultSettings",value:function setupDefaultSettings(){Adapt.log.deprecated("QuestionView.setupDefaultSettings, please use QuestionModel.setupDefaultSettings");return this.model.setupDefaultSettings()}},{key:"setupButtonSettings",value:function setupButtonSettings(){Adapt.log.deprecated("QuestionView.setupButtonSettings, please use QuestionModel.setupButtonSettings");return this.model.setupButtonSettings()}},{key:"setupWeightSettings",value:function setupWeightSettings(){Adapt.log.deprecated("QuestionView.setupWeightSettings, please use QuestionModel.setupWeightSettings");return this.model.setupWeightSettings()}},{key:"canSubmit",value:function canSubmit(){Adapt.log.deprecated("QuestionView.canSubmit, please use QuestionModel.canSubmit");return this.model.canSubmit()}},{key:"updateAttempts",value:function updateAttempts(){Adapt.log.deprecated("QuestionView.updateAttempts, please use QuestionModel.updateAttempts");return this.model.updateAttempts()}},{key:"storeUserAnswer",value:function storeUserAnswer(){Adapt.log.deprecated("QuestionView.storeUserAnswer, please use QuestionModel.storeUserAnswer");return this.model.storeUserAnswer()}},{key:"resetUserAnswer",value:function resetUserAnswer(){Adapt.log.deprecated("QuestionView.resetUserAnswer, please use QuestionModel.resetUserAnswer");return this.model.resetUserAnswer()}},{key:"markQuestion",value:function markQuestion(){if(this._isInViewOnlyCompatibleMode("isCorrect")){if(this.isCorrect()){this.model.set("_isCorrect",true)}else{this.model.set("_isCorrect",false)}}else{return this.model.markQuestion()}}},{key:"isCorrect",value:function isCorrect(){Adapt.log.deprecated("QuestionView.isCorrect, please use QuestionModel.isCorrect");return this.model.isCorrect()}},{key:"setScore",value:function setScore(){Adapt.log.deprecated("QuestionView.setScore, please use QuestionModel.setScore");return this.model.setScore()}},{key:"updateButtons",value:function updateButtons(){Adapt.log.deprecated("QuestionView.updateButtons, please use QuestionModel.updateButtons");return this.model.updateButtons()}},{key:"setupFeedback",value:function setupFeedback(){if(this._isInViewOnlyCompatibleMode("isPartlyCorrect")){if(this.model.get("_isCorrect")){this._runModelCompatibleFunction("setupCorrectFeedback")}else if(this.isPartlyCorrect()){this._runModelCompatibleFunction("setupPartlyCorrectFeedback")}else{this._runModelCompatibleFunction("setupIncorrectFeedback")}}else{this.model.setupFeedback()}}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){Adapt.log.deprecated("QuestionView.isPartlyCorrect, please use QuestionModel.isPartlyCorrect");return this.model.isPartlyCorrect()}},{key:"setupCorrectFeedback",value:function setupCorrectFeedback(){Adapt.log.deprecated("QuestionView.setupCorrectFeedback, please use QuestionModel.setupCorrectFeedback");return this.model.setupCorrectFeedback()}},{key:"setupPartlyCorrectFeedback",value:function setupPartlyCorrectFeedback(){Adapt.log.deprecated("QuestionView.setupPartlyCorrectFeedback, please use QuestionModel.setupPartlyCorrectFeedback");return this.model.setupPartlyCorrectFeedback()}},{key:"setupIncorrectFeedback",value:function setupIncorrectFeedback(){Adapt.log.deprecated("QuestionView.setupIncorrectFeedback, please use QuestionModel.setupIncorrectFeedback");return this.model.setupIncorrectFeedback()}},{key:"_runModelCompatibleFunction",value:function _runModelCompatibleFunction(name,lookForViewOnlyFunction){if(this._isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction)){return this[name]()}else{return this.model[name]()}}},{key:"_isInViewOnlyCompatibleMode",value:function _isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction){var checkForFunction=lookForViewOnlyFunction||name;if(!this.constructor.prototype[checkForFunction])return false;var hasCompatibleVersion=ViewOnlyQuestionViewCompatibilityLayer.prototype.hasOwnProperty(checkForFunction);var usingCompatibleVersion=this.constructor.prototype[checkForFunction]===ViewOnlyQuestionViewCompatibilityLayer.prototype[checkForFunction];if(hasCompatibleVersion&&usingCompatibleVersion){switch(checkForFunction){case"setupFeedback":case"markQuestion":return true;}return false}return true}}]);return ViewOnlyQuestionViewCompatibilityLayer}(QuestionView);;return ViewOnlyQuestionViewCompatibilityLayer});define("components/adapt-contrib-mcq/js/mcqView",["core/js/adapt","core/js/views/questionView"],function(Adapt,QuestionView){var McqView=QuestionView.extend({events:{"focus .js-item-input":"onItemFocus","blur .js-item-input":"onItemBlur","change .js-item-input":"onItemSelect","keyup .js-item-input":"onKeyPress"},isCorrectAnswerShown:false,initialize:function initialize(){QuestionView.prototype.initialize.apply(this,arguments);this.update=_.debounce(this.update.bind(this),1);this.listenTo(this.model,{"change:_isEnabled change:_isComplete change:_isSubmitted":this.update});this.listenTo(this.model.getChildren(),{"change:_isActive":this.update})},resetQuestionOnRevisit:function resetQuestionOnRevisit(){this.resetQuestion()},setupQuestion:function setupQuestion(){this.model.setupRandomisation()},onQuestionRendered:function onQuestionRendered(){this.setReadyStatus();this.update()},onKeyPress:function onKeyPress(event){if(event.which!==13)return;this.onItemSelect(event)},onItemFocus:function onItemFocus(event){if(!this.model.isInteractive())return;this.$(".js-item-label[for="+$(event.currentTarget).attr("id")+"]").addClass("is-highlighted")},onItemBlur:function onItemBlur(event){this.$(".js-item-label[for="+$(event.currentTarget).attr("id")+"]").removeClass("is-highlighted")},onItemSelect:function onItemSelect(event){if(!this.model.isInteractive())return;var index=$(event.currentTarget).data("adapt-index");var itemModel=this.model.getItem(index);var shouldSelect=!itemModel.get("_isActive");if(this.model.isSingleSelect()){shouldSelect=true;this.model.resetActiveItems()}else if(shouldSelect&&this.model.isAtActiveLimit()){this.model.getLastActiveItem().toggleActive(false)}itemModel.toggleActive(shouldSelect)},onCannotSubmit:function onCannotSubmit(){},showMarking:function showMarking(){this.update()},resetQuestion:function resetQuestion(){this.model.resetActiveItems();this.model.resetItems()},showCorrectAnswer:function showCorrectAnswer(){this.isCorrectAnswerShown=true;this.update()},hideCorrectAnswer:function hideCorrectAnswer(){this.isCorrectAnswerShown=false;this.update()},update:function update(){this.updateSelection();this.updateMarking()},updateSelection:function updateSelection(){var isEnabled=this.model.get("_isEnabled");this.model.getChildren().each(function(itemModel){var isSelected=this.isCorrectAnswerShown?itemModel.get("_shouldBeSelected"):itemModel.get("_isActive");var index=itemModel.get("_index");this.$(".js-item-label").filter("[data-adapt-index=\""+index+"\"]").toggleClass("is-selected",isSelected).toggleClass("is-disabled",!isEnabled);this.$(".js-item-input").filter("[data-adapt-index=\""+index+"\"]").prop("checked",isSelected).prop("disabled",!isEnabled)}.bind(this))},updateMarking:function updateMarking(){var isInteractive=this.model.isInteractive();var canShowMarking=this.model.get("_canShowMarking");var ariaLabels=Adapt.course.get("_globals")._accessibility._ariaLabels;this.model.getChildren().each(function(itemModel){var index=itemModel.get("_index");var $itemInput=this.$(".js-item-input").filter("[data-adapt-index=\""+index+"\"]");var $item=$itemInput.parents(".js-mcq-item");if(isInteractive||!canShowMarking){$item.removeClass("is-correct is-incorrect");$itemInput.attr("aria-label",$.a11y_normalize(itemModel.get("text")));return}var shouldBeSelected=itemModel.get("_shouldBeSelected");var isCorrect=Boolean(itemModel.get("_isCorrect"));var isActive=Boolean(itemModel.get("_isActive"));$item.toggleClass("is-correct",isCorrect).toggleClass("is-incorrect",!isCorrect);$itemInput.attr("aria-label",[shouldBeSelected?ariaLabels.correct:ariaLabels.incorrect,", ",isActive?ariaLabels.selectedAnswer:ariaLabels.unselectedAnswer,". ",$.a11y_normalize(itemModel.get("text"))].join(""))}.bind(this))}});return McqView});define("core/js/models/itemsQuestionModel",["core/js/adapt","core/js/models/questionModel","core/js/models/itemsComponentModel"],function(Adapt,QuestionModel,ItemsComponentModel){var _this77=this;var BlendedItemsComponentQuestionModel=function(_QuestionModel){"use strict";_inherits(BlendedItemsComponentQuestionModel,_QuestionModel);var _super41=_createSuper(BlendedItemsComponentQuestionModel);function BlendedItemsComponentQuestionModel(){_classCallCheck(this,BlendedItemsComponentQuestionModel);return _super41.apply(this,arguments)}_createClass(BlendedItemsComponentQuestionModel,[{key:"init",value:function init(){ItemsComponentModel.prototype.init.call(this);_get(_getPrototypeOf(BlendedItemsComponentQuestionModel.prototype),"init",this).call(this)}},{key:"reset",value:function reset(type,force){ItemsComponentModel.prototype.reset.call(this,type,force);_get(_getPrototypeOf(BlendedItemsComponentQuestionModel.prototype),"reset",this).call(this,type,force)}}]);return BlendedItemsComponentQuestionModel}(QuestionModel);Object.getOwnPropertyNames(ItemsComponentModel.prototype).forEach(function(name){_newArrowCheck(this,_this77);if(name==="constructor"||name==="init"||name==="reset")return;Object.defineProperty(BlendedItemsComponentQuestionModel.prototype,name,{value:ItemsComponentModel.prototype[name]})}.bind(this));var ItemsQuestionModel=function(_BlendedItemsComponen){"use strict";_inherits(ItemsQuestionModel,_BlendedItemsComponen);var _super42=_createSuper(ItemsQuestionModel);function ItemsQuestionModel(){_classCallCheck(this,ItemsQuestionModel);return _super42.apply(this,arguments)}_createClass(ItemsQuestionModel,[{key:"init",value:function init(){_get(_getPrototypeOf(ItemsQuestionModel.prototype),"init",this).call(this);this.set("_isRadio",this.isSingleSelect());this.listenTo(this.getChildren(),"change:_isActive",this.checkCanSubmit);this.checkCanSubmit()}},{key:"getTypeGroup",value:function getTypeGroup(){return"itemsquestion"}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){var _this78=this;if(!this.get("_isSubmitted"))return;var itemModels=this.getChildren();var userAnswer=this.get("_userAnswer");itemModels.each(function(item){_newArrowCheck(this,_this78);item.toggleActive(userAnswer[item.get("_index")])}.bind(this));this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()}},{key:"setupRandomisation",value:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;var children=this.getChildren();children.set(children.shuffle())}},{key:"canSubmit",value:function canSubmit(){var activeItems=this.getActiveItems();return activeItems.length>0}},{key:"storeUserAnswer",value:function storeUserAnswer(){var _this79=this;var items=this.getChildren().slice(0);items.sort(function(a,b){_newArrowCheck(this,_this79);return a.get("_index")-b.get("_index")}.bind(this));var userAnswer=items.map(function(itemModel){_newArrowCheck(this,_this79);return itemModel.get("_isActive")}.bind(this));this.set("_userAnswer",userAnswer)}},{key:"isCorrect",value:function isCorrect(){var _this80=this;var props={_numberOfRequiredAnswers:0,_numberOfIncorrectAnswers:0,_isAtLeastOneCorrectSelection:false,_numberOfCorrectAnswers:0};this.getChildren().each(function(itemModel){_newArrowCheck(this,_this80);var itemShouldBeActive=itemModel.get("_shouldBeSelected");if(itemShouldBeActive){props._numberOfRequiredAnswers++}if(!itemModel.get("_isActive"))return;if(!itemShouldBeActive){props._numberOfIncorrectAnswers++;return}props._isAtLeastOneCorrectSelection=true;props._numberOfCorrectAnswers++;itemModel.set("_isCorrect",true)}.bind(this));this.set(props);var hasRightNumberOfCorrectAnswers=props._numberOfCorrectAnswers===props._numberOfRequiredAnswers;var hasNoIncorrectAnswers=!props._numberOfIncorrectAnswers;return hasRightNumberOfCorrectAnswers&&hasNoIncorrectAnswers}},{key:"setScore",value:function setScore(){var questionWeight=this.get("_questionWeight");var answeredCorrectly=this.get("_isCorrect");var score=answeredCorrectly?questionWeight:0;this.set("_score",score)}},{key:"setupFeedback",value:function setupFeedback(){if(!this.has("_feedback"))return;if(this.get("_isCorrect")){this.setupCorrectFeedback();return}if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback();return}var activeItem=this.getActiveItem();if(this.isSingleSelect()&&activeItem.get("feedback")){this.setupIndividualFeedback(activeItem);return}this.setupIncorrectFeedback()}},{key:"setupIndividualFeedback",value:function setupIndividualFeedback(selectedItem){this.set({feedbackTitle:this.getFeedbackTitle(this.get("_feedback")),feedbackMessage:selectedItem.get("feedback")})}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")}},{key:"resetUserAnswer",value:function resetUserAnswer(){this.set("_userAnswer",[])}},{key:"isAtActiveLimit",value:function isAtActiveLimit(){var selectedItems=this.getActiveItems();return selectedItems.length===this.get("_selectable")}},{key:"isSingleSelect",value:function isSingleSelect(){return this.get("_selectable")===1}},{key:"getLastActiveItem",value:function getLastActiveItem(){var selectedItems=this.getActiveItems();return selectedItems[selectedItems.length-1]}},{key:"resetItems",value:function resetItems(){this.resetActiveItems();this.set("_isAtLeastOneCorrectSelection",false)}},{key:"getInteractionObject",value:function getInteractionObject(){var _this81=this;var interactions={correctResponsesPattern:[],choices:[]};interactions.choices=this.getChildren().map(function(itemModel){_newArrowCheck(this,_this81);return{id:(itemModel.get("_index")+1).toString(),description:itemModel.get("text")}}.bind(this));var correctItems=this.getChildren().filter(function(itemModel){_newArrowCheck(this,_this81);return itemModel.get("_shouldBeSelected")}.bind(this));interactions.correctResponsesPattern=[correctItems.map(function(itemModel){_newArrowCheck(this,_this81);return String(itemModel.get("_index")+1)}.bind(this)).join("[,]")];return interactions}},{key:"getResponse",value:function getResponse(){var _this82=this;var activeItems=this.getActiveItems();var activeIndexes=activeItems.map(function(itemModel){_newArrowCheck(this,_this82);return itemModel.get("_index")+1}.bind(this));return activeIndexes.join(",")}},{key:"getResponseType",value:function getResponseType(){return"choice"}}]);return ItemsQuestionModel}(BlendedItemsComponentQuestionModel);return ItemsQuestionModel});define("components/adapt-contrib-mcq/js/adapt-contrib-mcq",["core/js/adapt","./mcqView","core/js/models/itemsQuestionModel"],function(Adapt,McqView,ItemsQuestionModel){return Adapt.register("mcq",{view:McqView,model:ItemsQuestionModel.extend({})})});define("components/adapt-contrib-gmcq/js/adapt-contrib-gmcq",["core/js/adapt","components/adapt-contrib-mcq/js/adapt-contrib-mcq"],function(Adapt,Mcq){var Gmcq=Mcq.view.extend({setupQuestion:function setupQuestion(){Mcq.view.prototype.setupQuestion.call(this);this.listenTo(Adapt,{"device:changed":this.resizeImage,"device:resize":this.onDeviceResize})},onQuestionRendered:function onQuestionRendered(){this.resizeImage(Adapt.device.screenSize);this.setUpColumns();this.$(".js-item-label").imageready(this.setReadyStatus.bind(this))},onDeviceResize:function onDeviceResize(){this.setUpColumns()},resizeImage:function resizeImage(width){var imageWidth=width==="medium"?"small":width;this.$(".js-item-label").each(function(index){var $img=$(this).find("img");var newSrc=$img.attr("data-"+imageWidth);if(!newSrc)return;$img.attr("src",newSrc)})},setUpColumns:function setUpColumns(){var columns=this.model.get("_columns");if(!columns)return;var isLarge=Adapt.device.screenSize==="large";this.$el.toggleClass("has-column-layout",isLarge);this.$(".js-mcq-item").css("width",isLarge?100/columns+"%":"")}},{template:"gmcq"});return Adapt.register("gmcq",{view:Gmcq,model:Mcq.model.extend({})})});define("components/adapt-contrib-graphic/js/adapt-contrib-graphic",["core/js/adapt","core/js/views/componentView","core/js/models/componentModel"],function(Adapt,ComponentView,ComponentModel){var GraphicView=function(_ComponentView5){"use strict";_inherits(GraphicView,_ComponentView5);var _super43=_createSuper(GraphicView);function GraphicView(){_classCallCheck(this,GraphicView);return _super43.apply(this,arguments)}_createClass(GraphicView,[{key:"preRender",value:function preRender(){this.listenTo(Adapt,"device:changed",this.resizeImage);this.checkIfResetOnRevisit()}},{key:"postRender",value:function postRender(){this.resizeImage(Adapt.device.screenSize,true)}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}}},{key:"resizeImage",value:function resizeImage(width,setupInView){var _this83=this;var imageWidth=width==="medium"?"small":width;var imageSrc=this.model.get("_graphic")?this.model.get("_graphic")[imageWidth]:"";this.$(".js-graphic-set-image-src").attr("src",imageSrc);this.$(".graphic__widget").imageready(function(){_newArrowCheck(this,_this83);this.setReadyStatus();if(setupInView){this.setupInviewCompletion(".graphic__widget")}}.bind(this))}}]);return GraphicView}(ComponentView);GraphicView.template="graphic";return Adapt.register("graphic",{model:ComponentModel.extend({}),view:GraphicView})});define("components/adapt-contrib-hotgraphic/js/hotgraphicPopupView",["core/js/adapt"],function(Adapt){var HotgraphicPopupView=function(_Backbone$View4){"use strict";_inherits(HotgraphicPopupView,_Backbone$View4);var _super44=_createSuper(HotgraphicPopupView);function HotgraphicPopupView(){_classCallCheck(this,HotgraphicPopupView);return _super44.apply(this,arguments)}_createClass(HotgraphicPopupView,[{key:"className",value:function className(){return"hotgraphic-popup"}},{key:"events",value:function events(){return{"click .js-hotgraphic-popup-close":"closePopup","click .js-hotgraphic-controls-click":"onControlClick"}}},{key:"initialize",value:function initialize(){var _get5;for(var _len17=arguments.length,args=new Array(_len17),_key17=0;_key17<_len17;_key17++){args[_key17]=arguments[_key17]}(_get5=_get(_getPrototypeOf(HotgraphicPopupView.prototype),"initialize",this)).call.apply(_get5,[this].concat(args));this.onControlClick=_.debounce(this.onControlClick.bind(this),100);this.listenToOnce(Adapt,"notify:opened",this.onOpened);this.listenTo(this.model.get("_children"),{"change:_isActive":this.onItemsActiveChange,"change:_isVisited":this.onItemsVisitedChange});this.render()}},{key:"onOpened",value:function onOpened(){this.applyNavigationClasses(this.model.getActiveItem().get("_index"));this.updatePageCount();this.handleTabs()}},{key:"applyNavigationClasses",value:function applyNavigationClasses(index){var itemCount=this.model.get("_items").length;var canCycleThroughPagination=this.model.get("_canCycleThroughPagination");var shouldEnableBack=index>0||canCycleThroughPagination;var shouldEnableNext=index<itemCount-1||canCycleThroughPagination;var $controls=this.$(".hotgraphic-popup__controls");this.$("hotgraphic-popup__nav").toggleClass("first",!shouldEnableBack).toggleClass("last",!shouldEnableNext);Adapt.a11y.toggleAccessibleEnabled($controls.filter(".back"),shouldEnableBack);Adapt.a11y.toggleAccessibleEnabled($controls.filter(".next"),shouldEnableNext)}},{key:"updatePageCount",value:function updatePageCount(){var template=Adapt.course.get("_globals")._components._hotgraphic.popupPagination||"{{itemNumber}} / {{totalItems}}";var labelText=Handlebars.compile(template)({itemNumber:this.model.getActiveItem().get("_index")+1,totalItems:this.model.get("_items").length});this.$(".hotgraphic-popup__count").html(labelText)}},{key:"handleTabs",value:function handleTabs(){Adapt.a11y.toggleHidden(this.$(".hotgraphic-popup__item:not(.is-active) *"),true);Adapt.a11y.toggleHidden(this.$(".hotgraphic-popup__item.is-active *"),false)}},{key:"onItemsActiveChange",value:function onItemsActiveChange(item,_isActive){if(!_isActive)return;var index=item.get("_index");this.updatePageCount();this.applyItemClasses(index);this.handleTabs();this.handleFocus(index)}},{key:"applyItemClasses",value:function applyItemClasses(index){this.$(".hotgraphic-popup__item[data-index=\"".concat(index,"\"]")).addClass("is-active").removeAttr("aria-hidden");this.$(".hotgraphic-popup__item[data-index=\"".concat(index,"\"] .hotgraphic-popup__item-title")).attr("id","notify-heading");this.$(".hotgraphic-popup__item:not([data-index=\"".concat(index,"\"])")).removeClass("is-active").attr("aria-hidden","true");this.$(".hotgraphic-popup__item:not([data-index=\"".concat(index,"\"]) .hotgraphic-popup__item-title")).removeAttr("id")}},{key:"handleFocus",value:function handleFocus(index){Adapt.a11y.focusFirst(this.$(".hotgraphic-popup__inner .is-active"));this.applyNavigationClasses(index)}},{key:"onItemsVisitedChange",value:function onItemsVisitedChange(item,_isVisited){if(!_isVisited)return;this.$(".hotgraphic-popup__item").filter("[data-index=\"".concat(item.get("_index"),"\"]")).addClass("is-visited")}},{key:"render",value:function render(){var data=this.model.toJSON();data.view=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}},{key:"closePopup",value:function closePopup(){Adapt.trigger("notify:close")}},{key:"onControlClick",value:function onControlClick(event){var direction=$(event.currentTarget).data("direction");var index=this.getNextIndex(direction);if(index===-1)return;this.setItemState(index)}},{key:"getNextIndex",value:function getNextIndex(direction){var index=this.model.getActiveItem().get("_index");var lastIndex=this.model.get("_items").length-1;switch(direction){case"back":if(index>0)return--index;if(this.model.get("_canCycleThroughPagination"))return lastIndex;break;case"next":if(index<lastIndex)return++index;if(this.model.get("_canCycleThroughPagination"))return 0;}return-1}},{key:"setItemState",value:function setItemState(index){this.model.getActiveItem().toggleActive();var nextItem=this.model.getItem(index);nextItem.toggleActive();nextItem.toggleVisited(true)}}]);return HotgraphicPopupView}(Backbone.View);;HotgraphicPopupView.template="hotgraphicPopup";return HotgraphicPopupView});define("components/adapt-contrib-hotgraphic/js/hotgraphicView",["core/js/adapt","core/js/views/componentView","./hotgraphicPopupView"],function(Adapt,ComponentView,HotgraphicPopupView){var HotGraphicView=function(_ComponentView6){"use strict";_inherits(HotGraphicView,_ComponentView6);var _super45=_createSuper(HotGraphicView);function HotGraphicView(){_classCallCheck(this,HotGraphicView);return _super45.apply(this,arguments)}_createClass(HotGraphicView,[{key:"events",value:function events(){return{"click .js-hotgraphic-item-click":"onPinClicked"}}},{key:"initialize",value:function initialize(){var _get6;for(var _len18=arguments.length,args=new Array(_len18),_key18=0;_key18<_len18;_key18++){args[_key18]=arguments[_key18]}(_get6=_get(_getPrototypeOf(HotGraphicView.prototype),"initialize",this)).call.apply(_get6,[this].concat(args));this.setUpViewData();this.setUpModelData();this.setUpEventListeners();this.checkIfResetOnRevisit()}},{key:"setUpViewData",value:function setUpViewData(){this.popupView=null;this._isPopupOpen=false}},{key:"setUpModelData",value:function setUpModelData(){if(this.model.get("_canCycleThroughPagination")===undefined){this.model.set("_canCycleThroughPagination",false)}}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(Adapt,"device:changed",this.reRender);this.listenTo(this.model.get("_children"),{"change:_isActive":this.onItemsActiveChange,"change:_isVisited":this.onItemsVisitedChange})}},{key:"reRender",value:function reRender(){if(Adapt.device.screenSize==="large")return;this.replaceWithNarrative()}},{key:"replaceWithNarrative",value:function replaceWithNarrative(){var _this84=this;var NarrativeView=Adapt.getViewClass("narrative");if(!NarrativeView)return;var model=this.prepareNarrativeModel();var newNarrative=new NarrativeView({model:model});this.$el.parents(".component__container").append(newNarrative.$el);this.remove();_.defer(function(){_newArrowCheck(this,_this84);Adapt.trigger("device:resize")}.bind(this))}},{key:"prepareNarrativeModel",value:function prepareNarrativeModel(){this.model.set({_component:"narrative",_wasHotgraphic:true,originalBody:this.model.get("body"),originalInstruction:this.model.get("instruction")});var activeItem=this.model.getActiveItem();if(!activeItem){this.model.getItem(0).toggleActive(true)}if(this.model.get("mobileBody")){this.model.set("body",this.model.get("mobileBody"))}if(this.model.get("mobileInstruction")){this.model.set("instruction",this.model.get("mobileInstruction"))}return this.model}},{key:"onItemsActiveChange",value:function onItemsActiveChange(model,_isActive){this.getItemElement(model).toggleClass("is-active",_isActive)}},{key:"getItemElement",value:function getItemElement(model){var index=model.get("_index");return this.$(".js-hotgraphic-item-click").filter("[data-index=\"".concat(index,"\"]"))}},{key:"onItemsVisitedChange",value:function onItemsVisitedChange(model,_isVisited){if(!_isVisited)return;var $pin=this.getItemElement(model);var visitedLabel=" ".concat(this.model.get("_globals")._accessibility._ariaLabels.visited,".");$pin.find(".aria-label").each(function(index,el){el.innerHTML+=visitedLabel});$pin.addClass("is-visited")}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}}},{key:"preRender",value:function preRender(){if(Adapt.device.screenSize==="large"){this.render();return}this.reRender()}},{key:"postRender",value:function postRender(){this.$(".hotgraphic__widget").imageready(this.setReadyStatus.bind(this));if(this.model.get("_setCompletionOn")==="inview"){this.setupInviewCompletion(".component__widget")}}},{key:"onPinClicked",value:function onPinClicked(event){var item=this.model.getItem($(event.currentTarget).data("index"));item.toggleActive(true);item.toggleVisited(true);this.openPopup()}},{key:"openPopup",value:function openPopup(){if(this._isPopupOpen)return;this._isPopupOpen=true;this.popupView=new HotgraphicPopupView({model:this.model});Adapt.notify.popup({_view:this.popupView,_isCancellable:true,_showCloseButton:false,_classes:"hotgraphic "+this.model.get("_classes")});this.listenToOnce(Adapt,{"popup:closed":this.onPopupClosed})}},{key:"onPopupClosed",value:function onPopupClosed(){this.model.getActiveItem().toggleActive();this._isPopupOpen=false}}]);return HotGraphicView}(ComponentView);HotGraphicView.template="hotgraphic";return HotGraphicView});define("components/adapt-contrib-hotgraphic/js/adapt-contrib-hotgraphic",["core/js/adapt","./hotgraphicView","core/js/models/itemsComponentModel"],function(Adapt,HotgraphicView,ItemsComponentModel){return Adapt.register("hotgraphic",{model:ItemsComponentModel.extend({}),view:HotgraphicView})});define("components/adapt-contrib-imgMagnify/js/adapt-contrib-imgMagnify",["core/js/models/componentModel","core/js/views/componentView","core/js/adapt","libraries/jquery.magnify","libraries/jquery.magnifymobile"],function(ComponentModel,ComponentView,Adapt,magnify,magnifymobile){'use strict';var ImgMagnify=ComponentView.extend({template:"text",preRender:function preRender(){this.listenTo(Adapt,"device:changed",this.resizeImage);this.checkIfResetOnRevisit()},postRender:function postRender(){this.resizeImage(Adapt.device.screenSize,true);ComponentView.prototype.postRender.apply(this)},events:function events(){return Adapt.device.touch==true?{"inview":"inview","click .imgmagnify__body-inner #mypopup":"mynotifyPopup","click .imgmagnify__body-inner #myalert":"mynotifyAlert","click .imgmagnify__body-inner #myexternalink":"myexternaLink","click .component__inner #mybutton":"mynotifyButton","click .imgMagnify-bottom-text #mypopup":"mynotifyPopup","click .imgMagnify-bottom-text #myalert":"mynotifyAlert","click .imgMagnify-bottom-text #myexternalink":"myexternaLink","touchmove .enableMagnify":"enabledZoom"}:{"inview":"inview","click .imgmagnify__body-inner #mypopup":"mynotifyPopup","click .imgmagnify__body-inner #myalert":"mynotifyAlert","click .imgmagnify__body-inner #myexternalink":"myexternaLink","click .component__inner #mybutton":"mynotifyButton","click .imgMagnify-bottom-text #mypopup":"mynotifyPopup","click .imgMagnify-bottom-text #myalert":"mynotifyAlert","click .imgMagnify-bottom-text #myexternalink":"myexternaLink","mousemove .enableMagnify":"enabledZoom","keydown .enableMagnify":"accessibleZoom"}},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},inview:function inview(event,visible,visiblePartX,visiblePartY){if(visible){if(visiblePartY==="top"){this._isVisibleTop=true}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(this._isVisibleTop&&this._isVisibleBottom){this.$(".component__widget").off("inview")}}},remove:function remove(){this.$(".component__widget").off("inview");ComponentView.prototype.remove.apply(this,arguments)},resizeImage:function resizeImage(width,setupInView){var imageWidth=width==="medium"?"small":width;var imageSrc=this.model.get("_graphic")?this.model.get("_graphic")[imageWidth]:"";this.$(".graphic__widget img").attr("src",imageSrc);this.$(".graphic__widget").imageready(_.bind(function(){this.setReadyStatus();if(setupInView){this.$(".component__widget").on("inview",_.bind(this.inview,this))}},this))},mynotifyPopup:function mynotifyPopup(event){event.preventDefault();this.model.set("_active",false);var getcurrentid=this.model.get("_id");var bodyText=this.model.get("_popupData").mypopup.message;var titleText=this.model.get("_popupData").mypopup.title;var popupObject={title:titleText,body:bodyText,_classes:" txtpopnotify"};Adapt.trigger("notify:popup",popupObject);this.setCompletionStatus();$(".accessibility ."+getcurrentid+" .imgmagnify__body-inner").removeAttr("tabindex");$(".accessibility ."+getcurrentid+" .imgmagnify__body-inner p").attr("tabindex","0")},mynotifyAlert:function mynotifyAlert(event){event.preventDefault();this.model.set("_active",false);var getcurrentid=this.model.get("_id");var bodyText2=this.model.get("_alertData").myalert.message;var titleText2=this.model.get("_alertData").myalert.title;var confirmText2=this.model.get("_alertData").myalert.confirmButton;var alertObject={title:titleText2,body:bodyText2,confirmText:confirmText2,_classes:" txtalertnotify"};Adapt.trigger("notify:alert",alertObject);this.setCompletionStatus();$(".accessibility ."+getcurrentid+" .imgmagnify__body-inner").removeAttr("tabindex");$(".accessibility ."+getcurrentid+" .imgmagnify__body-inner p").attr("tabindex","0")},myexternaLink:function myexternaLink(event){event.preventDefault();this.model.set("_active",false);var getcurrentid=this.model.get("_id");this.setCompletionStatus();$(".accessibility ."+getcurrentid+" .imgmagnify__body-inner").removeAttr("tabindex");$(".accessibility ."+getcurrentid+" .imgmagnify__body-inner p").attr("tabindex","0")},mynotifyButton:function mynotifyButton(event){event.preventDefault();this.model.set("_active",false);var getcurrentid=this.model.get("_id");var bodyText3=this.model.get("_buttonData").button.message;var titleText3=this.model.get("_buttonData").button.title;var confirmText3=this.model.get("_buttonData").button.confirmButton;var buttonObject={title:titleText3,body:bodyText3,confirmText:confirmText3,_classes:" txtbutnotify"};Adapt.trigger("notify:alert",buttonObject);this.setCompletionStatus();$(".accessibility ."+getcurrentid+" .imgmagnify__body-inner").removeAttr("tabindex");$(".accessibility ."+getcurrentid+" .imgmagnify__body-inner p").attr("tabindex","0")},enabledZoom:function enabledZoom(event){this.setCompletionStatus()},accessibleZoom:function accessibleZoom(event){var getcurrentid=this.model.get("_id");$(".accessibility ."+getcurrentid+" .enableMagnify").focus(this.setCompletionStatus())}});Adapt.register("imgMagnify",{model:ComponentModel.extend({}),view:ImgMagnify});return ImgMagnify});define("components/adapt-contrib-matching/js/dropdownOption",[],function(){var DropDownItem=Backbone.View.extend({events:{"click":"onClick","click *":"onClick"},initialize:function initialize(settings){this.settings=settings;this.$inner=this.$(".js-dropdown-list-item-inner")},isPlaceholder:function isPlaceholder(){return this.$el.is("[hidden]")},parent:function parent(){return this.settings.parent},onClick:function onClick(event){var parent=this.parent();event.preventDefault();this.select().scrollTo();parent.$button.focus()},getValue:function getValue(){return this.$el.attr("value").trim()},select:function select(){var parent=this.parent();parent.deselectAll();parent.setActiveDescendantId(this.el.id);this.$el.attr({selected:"","aria-selected":"true"});parent.$inner.html(this.$el.attr("text"));var value=this.isPlaceholder()?"":this.getValue();parent.$input.val(value).trigger("change");parent.trigger("change",parent);return this},deselect:function deselect(){if(!this.isSelected())return this;var parent=this.parent();parent.removeActiveDescendantId();this.$el.removeAttr("selected");this.$el.attr("aria-selected","false");parent.$inner.html("");parent.$input.val("").trigger("change");parent.trigger("change",parent);return this},reselect:function reselect(){var parent=this.parent();parent.setActiveDescendantId(this.$el[0].id);if(this.isSelected())return this;this.select();return this},isSelected:function isSelected(){return Boolean(this.$el.attr("selected"))},getIndex:function getIndex(){var parent=this.parent();return _.findIndex(parent.options,function(option){return option===this}.bind(this))},getNext:function getNext(){var parent=this.parent();return parent.options[this.getIndex()+1]},getPrevious:function getPrevious(){var parent=this.parent();return parent.options[this.getIndex()-1]},getFirst:function getFirst(){var parent=this.parent();return parent.options[0]},getLast:function getLast(){var parent=this.parent();return parent.options[parent.options.length-1]},scrollTo:function scrollTo(){var parent=this.parent();parent.settings.scrollToItem.call(parent,this)},destroy:function destroy(){var parent=this.parent();this.remove();if(this.isPlaceholder()){parent.placeholder=null}else{for(var i=0,l=parent.options.length;i<l;i++){var item=parent.options[i];if(item!==this)continue;parent.options.splice(i,1);break}}delete this.settings}});return DropDownItem});define("components/adapt-contrib-matching/js/dropdown",["./dropdownOption"],function(DropDownOption){var DropDown=Backbone.View.extend({initialize:function initialize(settings){_.bindAll(this,"onStartInteraction","onButtonClick","onListBlur","onKeyDown");this.settings=_.defaults(settings,this.getDefaults());this.placeholder=null;this.options=[];this.setUpElements();this.setUpItems();this.select(this.settings.value);this.addEventListeners();this.toggleOpen(false);this.settings.load.call(this,this);this.trigger("load",this)},getDefaults:function getDefaults(){return{load:DropDown.defaults.load,openList:DropDown.defaults.openList,closeList:DropDown.defaults.closeList,scrollToItem:DropDown.defaults.scrollToItem}},setUpElements:function setUpElements(){this.$list=this.$(".js-dropdown-list");this.$button=this.$(".js-dropdown-btn");this.$inner=this.$button.find(".js-dropdown-inner");this.$input=this.$(".js-data-output")},setUpItems:function setUpItems(){var $options=this.$(".js-dropdown-list-item");$options.each(function(index,el){var option=new DropDownOption({parent:this,el:el});if(option.isPlaceholder()){this.placeholder=option;return}this.options.push(option)}.bind(this))},addEventListeners:function addEventListeners(){this.$button.on({"mousedown touchstart":this.onStartInteraction,click:this.onButtonClick});this.$list.on("blur",this.onListBlur);$(document).on("keydown",this.onKeyDown)},onStartInteraction:function onStartInteraction(){this.wasOpen=this.isOpen()},deselectAll:function deselectAll(){this.placeholder.deselect();this.options.forEach(function(option){option.deselect()})},onButtonClick:function onButtonClick(event){if(this.wasOpen||this.isOpen()){this.wasOpen=false;return}this.toggleOpen();var option=this.getFirstSelectedItem()||this.placeholder;if(!option)return;option.reselect();option.scrollTo();this.$list.focus()},isOpen:function isOpen(){return!this.$list.hasClass("u-display-none")},toggleOpen:function toggleOpen(open){if(open===undefined)open=!this.isOpen();if(open)clearTimeout(this.blurTimeout);this.$button.attr("aria-expanded",open?"true":"false");var name=open?"openList":"closeList";this.settings[name].call(this,this);this.trigger(name,this)},onListBlur:function onListBlur(event){var handleBlur=function(){this.toggleOpen(false);this.removeActiveDescendantId()}.bind(this);this.blurTimeout=setTimeout(handleBlur,100)},onKeyDown:function onKeyDown(event){if(!this.isOpen())return;var option=this.getFirstSelectedItem()||this.placeholder;switch(event.keyCode){case 38:event.preventDefault();option=option.getPrevious()||option.getLast();break;case 40:event.preventDefault();option=option.getNext()||option.getFirst();break;case 13:case 32:case 27:event.preventDefault();this.$button.focus();return;default:return;}option.select().scrollTo()},getFirstSelectedItem:function getFirstSelectedItem(){return _.find(this.options,function(option){return option.isSelected()})},setActiveDescendantId:function setActiveDescendantId(id){this.$list.attr("aria-activedescendant",id)},removeActiveDescendantId:function removeActiveDescendantId(){this.$list.removeAttr("aria-activedescendant")},select:function select(value){value=String(value);var option=_.find(this.options,function(option){return option.getValue()===value});if(option){option.select();return}this.placeholder.select()},toggleDisabled:function toggleDisabled(value){if(value===undefined){value=!this.$input.attr("disabled")}if(value===false){this.$input.removeAttr("disabled");this.$button.removeAttr("disabled").removeClass("is-disabled");this.$el.removeAttr("disabled");return}this.$input.attr("disabled","");this.$button.attr("disabled","").addClass("is-disabled");this.$el.attr("disabled","")},isEmpty:function isEmpty(){return!this.getFirstSelectedItem()},val:function val(){return this.$input.val()},destroy:function destroy(){this.removeEventListeners();this.$el.remove();delete this.options;delete this.$input;delete this.$inner;delete this.$button;delete this.$list;delete this.$el},removeEventListeners:function removeEventListeners(){this.$button.off({"mousedown touchstart":this.onStartInteraction,click:this.onButtonClick});this.$list.off("blur",this.onListBlur);$(document).off("keydown",this.onKeyDown)}},{defaults:{load:function load(){},openList:function openList(){this.$list.css({top:"",left:this.$button[0].offsetLeft,width:this.$button.outerWidth()}).addClass("u-visibility-hidden").removeClass("u-display-none");var offset=this.$list[0].getBoundingClientRect();var height=this.$list.height();var windowHeight=$(window).height();var isOffscreen=offset.top+height>windowHeight;this.$list.css("top",isOffscreen?-height:"").removeClass("u-visibility-hidden").focus()},closeList:function closeList(){this.$list.removeClass("u-visibility-hidden").addClass("u-display-none").css("top","")},scrollToItem:function scrollToItem(option){var height=this.$list[0].clientHeight;var pos=option.$el[0].offsetTop-height/2;this.$list[0].scrollTop=pos}}});return DropDown});define("components/adapt-contrib-matching/js/matchingView",["core/js/adapt","core/js/views/questionView","./dropdown"],function(Adapt,QuestionView,DropDown){var MatchingView=QuestionView.extend({dropdowns:null,disableQuestion:function disableQuestion(){this.dropdowns.forEach(function(dropdown){dropdown.toggleDisabled(true)})},enableQuestion:function enableQuestion(){this.dropdowns.forEach(function(dropdown){dropdown.toggleDisabled(false)})},resetQuestionOnRevisit:function resetQuestionOnRevisit(){this.resetQuestion()},setupQuestion:function setupQuestion(){this.listenToOnce(Adapt.parentView,"postRemove",this.onPostRemove);this.model.setupRandomisation()},onPostRemove:function onPostRemove(){this.dropdowns.forEach(function(dropdown){dropdown.off("change",this.onOptionSelected);dropdown.destroy()},this)},onQuestionRendered:function onQuestionRendered(){this.setReadyStatus();this.setUpDropdowns()},setUpDropdowns:function setUpDropdowns(){_.bindAll(this,"onOptionSelected");this.dropdowns=[];var items=this.model.get("_items");this.$(".matching__item").each(function(i,el){var item=items[i];var selectedOption=_.find(item._options,function(option){return option._isSelected});var value=selectedOption?selectedOption._index:null;var dropdown=new DropDown({el:$(el).find(".dropdown")[0],placeholder:this.model.get("placeholder"),value:value});this.dropdowns.push(dropdown);dropdown.on("change",this.onOptionSelected)}.bind(this));this.enableQuestion();if(this.model.get("_isEnabled")!==true){this.disableQuestion()}},onCannotSubmit:function onCannotSubmit(){this.dropdowns.forEach(function(dropdown){if(!dropdown.isEmpty())return;dropdown.$el.parents(".matching__select-container").addClass("has-error")})},onOptionSelected:function onOptionSelected(dropdown){if(this.model.get("_isInteractionComplete"))return;var $container=dropdown.$el.parents(".matching__select-container");$container.removeClass("error");var itemIndex=dropdown.$el.parents(".matching__item").index();if(dropdown.isEmpty())return;var optionIndex=parseInt(dropdown.val());this.model.setOptionSelected(itemIndex,optionIndex,true)},showMarking:function showMarking(){if(!this.model.get("_canShowMarking"))return;this.model.get("_items").forEach(function(item,i){var $item=this.$(".matching__item").eq(i);$item.removeClass("is-correct is-incorrect").addClass(item._isCorrect?"is-correct":"is-incorrect")},this)},resetQuestion:function resetQuestion(){this.$(".matching__item").removeClass("is-correct is-incorrect");this.model.set("_isAtLeastOneCorrectSelection",false);var resetAll=this.model.get("_shouldResetAllAnswers");this.model.get("_items").forEach(function(item,index){if(item._isCorrect&&resetAll===false)return;this.selectValue(index,null);item._options.forEach(function(option,index){option._isSelected=false});item._selected=null},this)},showCorrectAnswer:function showCorrectAnswer(){this.model.get("_items").forEach(function(item,index){var correctOption=_.findWhere(item._options,{_isCorrect:true});this.selectValue(index,correctOption._index)},this)},hideCorrectAnswer:function hideCorrectAnswer(){var answerArray=this.model.has("_tempUserAnswer")?this.model.get("_tempUserAnswer"):this.model.get("_userAnswer");this.model.get("_items").forEach(function(item,index){var key=answerArray[index];var value=item._options[key]._index;this.selectValue(index,value)},this)},selectValue:function selectValue(index,optionIndex){if(!this.dropdowns)return;var dropdown=this.dropdowns[index];if(!dropdown)return;dropdown.select(optionIndex)}});return MatchingView});define("components/adapt-contrib-matching/js/matchingModel",["core/js/models/questionModel"],function(QuestionModel){var MatchingModel=QuestionModel.extend({init:function init(){QuestionModel.prototype.init.call(this);this.setupQuestionItemIndexes();this.checkCanSubmit()},setupQuestionItemIndexes:function setupQuestionItemIndexes(){this.get("_items").forEach(function(item,index){if(item._index===undefined){item._index=index;item._selected=false}item._options.forEach(function(option,index){if(option._index===undefined){option._index=index;option._isSelected=false}})})},setupRandomisation:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;this.get("_items").forEach(function(item){item._options=_.shuffle(item._options)})},restoreUserAnswers:function restoreUserAnswers(){if(!this.get("_isSubmitted"))return;var userAnswer=this.get("_userAnswer");this.get("_items").forEach(function(item,index){item._options.forEach(function(option,index){if(option._index===userAnswer[item._index]){option._isSelected=true;item._selected=option}})});this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()},canSubmit:function canSubmit(){var canSubmit=_.every(this.get("_items"),function(item){return _.findWhere(item._options,{"_isSelected":true})!==undefined});return canSubmit},setOptionSelected:function setOptionSelected(itemIndex,optionIndex,isSelected){var item=this.get("_items")[itemIndex];var option=_.findWhere(item._options,{"_index":optionIndex});option._isSelected=isSelected;item._selected=option;this.checkCanSubmit()},storeUserAnswer:function storeUserAnswer(){var userAnswer=new Array(this.get("_items").length);var tempUserAnswer=new Array(this.get("_items").length);this.get("_items").forEach(function(item,index){var optionIndex=_.findIndex(item._options,function(o){return o._isSelected});tempUserAnswer[item._index]=optionIndex;userAnswer[item._index]=item._options[optionIndex]._index},this);this.set({"_userAnswer":userAnswer,"_tempUserAnswer":tempUserAnswer})},isCorrect:function isCorrect(){var numberOfCorrectAnswers=0;this.get("_items").forEach(function(item,index){var isCorrect=item._selected&&item._selected._isCorrect;if(!isCorrect){item._isCorrect=false;return}numberOfCorrectAnswers++;item._isCorrect=true;this.set({"_numberOfCorrectAnswers":numberOfCorrectAnswers,"_isAtLeastOneCorrectSelection":true})},this);this.set("_numberOfCorrectAnswers",numberOfCorrectAnswers);if(numberOfCorrectAnswers===this.get("_items").length){return true}return false},setScore:function setScore(){var questionWeight=this.get("_questionWeight");if(this.get("_isCorrect")){this.set("_score",questionWeight);return}var numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");var itemLength=this.get("_items").length;var score=questionWeight*numberOfCorrectAnswers/itemLength;this.set("_score",score)},isPartlyCorrect:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")},resetUserAnswer:function resetUserAnswer(){this.set("_userAnswer",[])},getInteractionObject:function getInteractionObject(){var interactions={correctResponsesPattern:null,source:null,target:null};var items=this.get("_items");interactions.correctResponsesPattern=[items.map(function(item,questionIndex){questionIndex=questionIndex+1;return[questionIndex,item._options.filter(function(item){return item._isCorrect}).map(function(item){return questionIndex+"_"+(item._index+1).toString()})].join("[.]")}).join("[,]")];interactions.source=_.flatten(items.map(function(item){return{id:(item._index+1).toString(),description:item.text}}));interactions.target=_.flatten(items.map(function(item,index){index=index+1;return item._options.map(function(option){return{id:index+"_"+(option._index+1),description:option.text}})}));return interactions},getResponse:function getResponse(){var responses=[];this.get("_userAnswer").forEach(function(userAnswer,index){responses.push(index+1+"."+(userAnswer+1))});return responses.join("#")},getResponseType:function getResponseType(){return"matching"}});return MatchingModel});define("components/adapt-contrib-matching/js/adapt-contrib-matching",["core/js/adapt","./matchingView","./matchingModel"],function(Adapt,MatchingView,MatchingModel){return Adapt.register("matching",{view:MatchingView,model:MatchingModel})});define("components/adapt-contrib-media/js/adapt-contrib-media",["core/js/adapt","core/js/views/componentView","core/js/models/componentModel","libraries/mediaelement-and-player","libraries/mediaelement-fullscreen-hook"],function(Adapt,ComponentView,ComponentModel){var froogaloopAdded=false;function purge(d){var a=d.attributes,i,l,n;if(a){for(i=a.length-1;i>=0;i-=1){n=a[i].name;if(typeof d[n]==="function"){d[n]=null}}}a=d.childNodes;if(a){l=a.length;for(i=0;i<l;i+=1){purge(d.childNodes[i])}}}_.extend(mejs.MepDefaults,{keyActions:[],defaultSeekForwardInterval:function defaultSeekForwardInterval(duration){if(_typeof(duration)==="object")return duration.duration*0.05;return duration*0.05},defaultSeekBackwardInterval:function defaultSeekBackwardInterval(duration){if(_typeof(duration)==="object")return duration.duration*0.05;return duration*0.05}});var MediaView=ComponentView.extend({events:{"click .js-media-inline-transcript-toggle":"onToggleInlineTranscript","click .js-media-external-transcript-click":"onExternalTranscriptClicked","click .js-skip-to-transcript":"onSkipToTranscript"},className:function className(){var classes=ComponentView.prototype.className.call(this);var playerOptions=this.model.get("_playerOptions");if(playerOptions&&playerOptions.toggleCaptionsButtonWhenOnlyOne){classes+=" toggle-captions"}return classes},preRender:function preRender(){this.listenTo(Adapt,{"device:resize":this.onScreenSizeChanged,"device:changed":this.onDeviceChanged,"media:stop":this.onMediaStop});_.bindAll(this,"onMediaElementPlay","onMediaElementPause","onMediaElementEnded","onMediaElementTimeUpdate","onMediaElementSeeking");this.model.set({"_isMediaEnded":false,"_isMediaPlaying":false});if(this.model.get("_media").source){var media=this.model.get("_media");if(window.location.protocol==="https:"&&media.source.indexOf("http:")===0){media.source=media.source.replace(/^http\:/,"https:")}this.model.set("_media",media)}this.checkIfResetOnRevisit()},postRender:function postRender(){this.setupPlayer();this.addMejsButtonClass()},addMejsButtonClass:function addMejsButtonClass(){this.$(".mejs-overlay-button").addClass("icon")},setupPlayer:function setupPlayer(){if(!this.model.get("_playerOptions"))this.model.set("_playerOptions",{});var modelOptions=this.model.get("_playerOptions");if(modelOptions.pluginPath===undefined){_.extend(modelOptions,{pluginPath:"https://cdnjs.cloudflare.com/ajax/libs/mediaelement/2.21.2/",flashName:"flashmediaelement-cdn.swf",flashScriptAccess:"always"})}if(modelOptions.features===undefined){modelOptions.features=["playpause","progress","current","duration"];if(this.model.get("_useClosedCaptions")){modelOptions.features.unshift("tracks")}if(this.model.get("_allowFullScreen")){modelOptions.features.push("fullscreen")}if(this.model.get("_showVolumeControl")){modelOptions.features.push("volume")}}modelOptions.success=_.debounce(this.onPlayerReady.bind(this),100);if(this.model.get("_useClosedCaptions")){var startLanguage=this.model.get("_startLanguage")||"en";if(!Adapt.offlineStorage.get("captions")){Adapt.offlineStorage.set("captions",startLanguage)}modelOptions.startLanguage=this.checkForSupportedCCLanguage(Adapt.offlineStorage.get("captions"))}if(modelOptions.alwaysShowControls===undefined){modelOptions.alwaysShowControls=false}if(modelOptions.hideVideoControlsOnLoad===undefined){modelOptions.hideVideoControlsOnLoad=true}this.addMediaTypeClass();this.addThirdPartyFixes(modelOptions,function createPlayer(){this.$("audio, video").mediaelementplayer(modelOptions);this.cleanUpPlayer();var _media=this.model.get("_media");if(!_media.mp3&&!_media.mp4&&!_media.ogv&&!_media.webm&&!_media.source){Adapt.log.warn("ERROR! No media is selected in components.json for component "+this.model.get("_id"));this.setReadyStatus();return}if(_media.source){this.$(".media-widget").addClass("external-source")}}.bind(this))},addMediaTypeClass:function addMediaTypeClass(){var media=this.model.get("_media");if(media&&media.type){var typeClass=media.type.replace(/\//,"-");this.$(".media__widget").addClass(typeClass)}},addThirdPartyFixes:function addThirdPartyFixes(modelOptions,callback){var media=this.model.get("_media");if(!media)return callback();switch(media.type){case"video/vimeo":modelOptions.alwaysShowControls=false;modelOptions.hideVideoControlsOnLoad=true;modelOptions.features=[];if(froogaloopAdded)return callback();$.getScript("assets/froogaloop.js").done(function(){froogaloopAdded=true;callback()}).fail(function(){froogaloopAdded=false;console.log("Could not load froogaloop.js")});break;default:callback();}},cleanUpPlayer:function cleanUpPlayer(){this.$(".media__widget").children(".mejs-offscreen").remove();this.$("[role=application]").removeAttr("role tabindex");this.$("[aria-controls]").removeAttr("aria-controls")},setupEventListeners:function setupEventListeners(){this.completionEvent=this.model.get("_setCompletionOn")||"play";if(this.completionEvent==="inview"){this.setupInviewCompletion(".component__widget")}if(this.model.get("_preventForwardScrubbing")&&!this.model.get("_isComplete")){$(this.mediaElement).on({"seeking":this.onMediaElementSeeking,"timeupdate":this.onMediaElementTimeUpdate})}$(this.mediaElement).on({"play":this.onMediaElementPlay,"pause":this.onMediaElementPause,"ended":this.onMediaElementEnded});_.delay(this.listenForCaptionsChange.bind(this),250)},listenForCaptionsChange:function listenForCaptionsChange(){if(!this.model.get("_useClosedCaptions"))return;var selector=this.model.get("_playerOptions").toggleCaptionsButtonWhenOnlyOne?".mejs-captions-button button":".mejs-captions-selector";this.$(selector).on("click.mediaCaptionsChange",_.debounce(function(){var srclang=this.mediaElement.player.selectedTrack?this.mediaElement.player.selectedTrack.srclang:"none";Adapt.offlineStorage.set("captions",srclang);Adapt.trigger("media:captionsChange",this,srclang)}.bind(this),250));this.listenTo(Adapt,"media:captionsChange",this.onCaptionsChanged)},onCaptionsChanged:function onCaptionsChanged(view,lang){if(view&&view.cid===this.cid)return;lang=this.checkForSupportedCCLanguage(lang);this.mediaElement.player.setTrack(lang);var $inputs=this.$(".mejs-captions-selector input");$inputs.filter(":checked").prop("checked",false);$inputs.filter("[value=\""+lang+"\"]").prop("checked",true)},checkForSupportedCCLanguage:function checkForSupportedCCLanguage(lang){if(!lang||lang==="none")return"none";if(_.findWhere(this.model.get("_media").cc,{srclang:lang}))return lang;return this.model.get("_startLanguage")||"none"},onMediaElementPlay:function onMediaElementPlay(event){this.queueGlobalEvent("play");Adapt.trigger("media:stop",this);if(this.model.get("_pauseWhenOffScreen"))$(this.mediaElement).on("inview",this.onMediaElementInview);this.model.set({"_isMediaPlaying":true,"_isMediaEnded":false});if(this.completionEvent==="play"){this.setCompletionStatus()}},onMediaElementPause:function onMediaElementPause(event){this.queueGlobalEvent("pause");$(this.mediaElement).off("inview",this.onMediaElementInview);this.model.set("_isMediaPlaying",false)},onMediaElementEnded:function onMediaElementEnded(event){this.queueGlobalEvent("ended");this.model.set("_isMediaEnded",true);if(this.completionEvent==="ended"){this.setCompletionStatus()}},onMediaElementInview:function onMediaElementInview(event,isInView){if(!isInView&&!event.currentTarget.paused)event.currentTarget.pause()},onMediaElementSeeking:function onMediaElementSeeking(event){var maxViewed=this.model.get("_maxViewed");if(!maxViewed){maxViewed=0}if(event.target.currentTime>maxViewed){event.target.currentTime=maxViewed}},onMediaElementTimeUpdate:function onMediaElementTimeUpdate(event){var maxViewed=this.model.get("_maxViewed");if(!maxViewed){maxViewed=0}if(event.target.currentTime>maxViewed){this.model.set("_maxViewed",event.target.currentTime)}},setupPlayPauseToggle:function setupPlayPauseToggle(){var player=this.mediaElement.player;if(!player){console.log("Media.setupPlayPauseToggle: OOPS! there's no player reference.");return}player.options.clickToPlayPause=false;this.onOverlayClick=this.onOverlayClick.bind(this);this.onMediaElementClick=this.onMediaElementClick.bind(this);this.$(".mejs-overlay-button").on("click",this.onOverlayClick);this.$(".mejs-mediaelement").on("click",this.onMediaElementClick)},onMediaStop:function onMediaStop(view){if(view&&view.cid===this.cid)return;if(!this.mediaElement||!this.mediaElement.player)return;this.mediaElement.player.pause()},onOverlayClick:function onOverlayClick(){var player=this.mediaElement.player;if(!player)return;player.play()},onMediaElementClick:function onMediaElementClick(event){var player=this.mediaElement.player;if(!player)return;var isPaused=player.media.paused;if(!isPaused)player.pause()},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},remove:function remove(){this.$(".mejs-overlay-button").off("click",this.onOverlayClick);this.$(".mejs-mediaelement").off("click",this.onMediaElementClick);if(this.model.get("_useClosedCaptions")){var selector=this.model.get("_playerOptions").toggleCaptionsButtonWhenOnlyOne?".mejs-captions-button button":".mejs-captions-selector";this.$(selector).off("click.mediaCaptionsChange")}var modelOptions=this.model.get("_playerOptions");delete modelOptions.success;var media=this.model.get("_media");if(media){switch(media.type){case"video/vimeo":this.$("iframe")[0].isRemoved=true;}}if(this.mediaElement&&this.mediaElement.player){var player_id=this.mediaElement.player.id;purge(this.$el[0]);this.mediaElement.player.remove();if(mejs.players[player_id]){delete mejs.players[player_id]}}if(this.mediaElement){$(this.mediaElement).off({"play":this.onMediaElementPlay,"pause":this.onMediaElementPause,"ended":this.onMediaElementEnded,"seeking":this.onMediaElementSeeking,"timeupdate":this.onMediaElementTimeUpdate,"inview":this.onMediaElementInview});this.mediaElement.src="";$(this.mediaElement.pluginElement).remove();delete this.mediaElement}ComponentView.prototype.remove.call(this)},onDeviceChanged:function onDeviceChanged(){if(this.model.get("_media").source){this.$(".mejs-container").width(this.$(".component__widget").width())}},onPlayerReady:function onPlayerReady(mediaElement,domObject){this.mediaElement=mediaElement;var player=this.mediaElement.player;if(!player)player=mejs.players[this.$(".mejs-container").attr("id")];var hasTouch=mejs.MediaFeatures.hasTouch;if(hasTouch){this.setupPlayPauseToggle()}this.addThirdPartyAfterFixes();this.cleanUpPlayerAfter();if(player&&this.model.has("_startVolume")){player.setVolume(parseInt(this.model.get("_startVolume"))/100)}this.setReadyStatus();this.setupEventListeners()},addThirdPartyAfterFixes:function addThirdPartyAfterFixes(){var media=this.model.get("_media");switch(media.type){case"video/vimeo":this.$(".mejs-container").attr("tabindex",0);}},cleanUpPlayerAfter:function cleanUpPlayerAfter(){this.$("[aria-valuemax='NaN']").attr("aria-valuemax",0)},onScreenSizeChanged:function onScreenSizeChanged(){this.$("audio, video").width(this.$(".component__widget").width())},onSkipToTranscript:function onSkipToTranscript(){_.delay(function(){this.$(".media__transcript-btn").a11y_focus()}.bind(this),250)},onToggleInlineTranscript:function onToggleInlineTranscript(event){if(event)event.preventDefault();var $transcriptBodyContainer=this.$(".media__transcript-body-inline");var $button=this.$(".media__transcript-btn-inline");var $buttonText=this.$(".media__transcript-btn-inline .media__transcript-btn-text");if($transcriptBodyContainer.hasClass("inline-transcript-open")){$transcriptBodyContainer.stop(true,true).slideUp(function(){$(window).resize()});$button.attr("aria-expanded",false);$transcriptBodyContainer.removeClass("inline-transcript-open");$buttonText.html(this.model.get("_transcript").inlineTranscriptButton)}else{$transcriptBodyContainer.stop(true,true).slideDown(function(){$(window).resize()});$button.attr("aria-expanded",true);$transcriptBodyContainer.addClass("inline-transcript-open");$buttonText.html(this.model.get("_transcript").inlineTranscriptCloseButton);if(this.model.get("_transcript")._setCompletionOnView!==false){this.setCompletionStatus()}}},onExternalTranscriptClicked:function onExternalTranscriptClicked(event){if(this.model.get("_transcript")._setCompletionOnView!==false){this.setCompletionStatus()}},queueGlobalEvent:function queueGlobalEvent(eventType){var t=Date.now();var lastEvent=this.lastEvent||{time:0};var timeSinceLastEvent=t-lastEvent.time;var debounceTime=500;this.lastEvent={time:t,type:eventType};clearTimeout(this.eventTimeout);if(eventType==="ended"){return this.triggerGlobalEvent(eventType)}if(timeSinceLastEvent>debounceTime){this.eventTimeout=setTimeout(this.triggerGlobalEvent.bind(this,eventType),debounceTime)}},triggerGlobalEvent:function triggerGlobalEvent(eventType){var player=this.mediaElement.player;var eventObj={type:eventType,src:this.mediaElement.src,platform:this.mediaElement.pluginType};if(player)eventObj.isVideo=player.isVideo;Adapt.trigger("media",eventObj)}});return Adapt.register("media",{model:ComponentModel.extend({}),view:MediaView})});define("components/adapt-contrib-MultipleNotify/js/adapt-contrib-MultipleNotify",["core/js/models/componentModel","core/js/views/componentView","core/js/adapt"],function(ComponentModel,ComponentView,Adapt){var TextMultipleNotify=ComponentView.extend({template:"text",preRender:function preRender(){this.listenTo(Adapt,"device:changed",this.resizeImage);this.checkIfResetOnRevisit()},postRender:function postRender(){this.resizeImage(Adapt.device.screenSize,true);ComponentView.prototype.postRender.apply(this)},events:function events(){return Adapt.device.touch==true?{"inview":"inview","touchmove .multiplenotify__body-inner [data-index]":"completePopup","touchmove .textnotify-bottom-text [data-index]":"completePopup","click .component__inner #mybutton":"mynotifyButton"}:{"inview":"inview","mouseout .multiplenotify__body-inner [data-index]":"completePopup","mouseout .textnotify-bottom-text [data-index]":"completePopup","keydown .multiplenotify__body-inner [data-index]":"completePopup","keydown .textnotify-bottom-text [data-index]":"completePopup","click .component__inner #mybutton":"mynotifyButton"}},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},inview:function inview(event,visible,visiblePartX,visiblePartY){if(visible){if(visiblePartY==="top"){this._isVisibleTop=true}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(this._isVisibleTop&&this._isVisibleBottom){this.$(".component__widget").off("inview");this.completePopup()}}},remove:function remove(){this.$(".component__widget").off("inview");ComponentView.prototype.remove.apply(this,arguments)},resizeImage:function resizeImage(width,setupInView){var imageWidth=width==="medium"?"small":width;var imageSrc=this.model.get("_graphic")?this.model.get("_graphic")[imageWidth]:"";this.$(".graphic__widget img").attr("src",imageSrc);this.$(".graphic__widget").imageready(_.bind(function(){this.setReadyStatus();if(setupInView){this.$(".component__widget").on("inview",_.bind(this.inview,this))}},this))},completePopup:function completePopup(){var getcurrentid=this.model.get("_id");var howmanymypopup=this.$("[data-index]").length;var howmanyclicked=this.$(".popcount").length;if(howmanymypopup===0&&howmanyclicked===0){}else if(howmanymypopup===howmanyclicked){this.setCompletionStatus()}$(".accessibility ."+getcurrentid+" .multiplenotify__body-inner").removeAttr("tabindex");$(".accessibility ."+getcurrentid+" .multiplenotify__body-inner p").attr("tabindex","0");$(".accessibility ."+getcurrentid+" .textnotify-bottom-text").removeAttr("tabindex");$(".accessibility ."+getcurrentid+" .textnotify-bottom-text p").attr("tabindex","0")},mynotifyButton:function mynotifyButton(event){event.preventDefault();this.model.set("_active",false);var getcurrentid=this.model.get("_id");var bodyText3=this.model.get("_buttonData").button.message;var titleText3=this.model.get("_buttonData").button.title;var confirmText3=this.model.get("_buttonData").button.confirmButton;var buttonObject={title:titleText3,body:bodyText3,confirmText:confirmText3,_classes:" txtbutnotify"};Adapt.trigger("notify:alert",buttonObject);this.setCompletionStatus();$(".accessibility ."+getcurrentid+" .multiplenotify__body-inner").removeAttr("tabindex");$(".accessibility ."+getcurrentid+" button").attr("tabindex","0")}});Adapt.register("MultipleNotify",{model:ComponentModel.extend({}),view:TextMultipleNotify});return TextMultipleNotify});define("components/adapt-contrib-narrative/js/modeEnum",[],function(){return new ENUM(["SMALL","LARGE"])});define("components/adapt-contrib-narrative/js/narrativeView",["core/js/adapt","core/js/views/componentView","./modeEnum"],function(Adapt,ComponentView,MODE){var NarrativeView=function(_ComponentView7){"use strict";_inherits(NarrativeView,_ComponentView7);var _super46=_createSuper(NarrativeView);function NarrativeView(){_classCallCheck(this,NarrativeView);return _super46.apply(this,arguments)}_createClass(NarrativeView,[{key:"events",value:function events(){return{"click .js-narrative-strapline-open-popup":"openPopup","click .js-narrative-controls-click":"onNavigationClicked","click .js-narrative-progress-click":"onProgressClicked"}}},{key:"initialize",value:function initialize(){var _get7;for(var _len19=arguments.length,args=new Array(_len19),_key19=0;_key19<_len19;_key19++){args[_key19]=arguments[_key19]}(_get7=_get(_getPrototypeOf(NarrativeView.prototype),"initialize",this)).call.apply(_get7,[this].concat(args));this._isInitial=true}},{key:"preRender",value:function preRender(){this.listenTo(Adapt,{"device:changed device:resize":this.reRender,"notify:closed":this.closeNotify});this.renderMode();this.listenTo(this.model.getChildren(),{"change:_isActive":this.onItemsActiveChange,"change:_isVisited":this.onItemsVisitedChange});this.checkIfResetOnRevisit();this.calculateWidths()}},{key:"onItemsActiveChange",value:function onItemsActiveChange(item,_isActive){if(!_isActive)return;this.setStage(item)}},{key:"onItemsVisitedChange",value:function onItemsVisitedChange(item,_isVisited){if(!_isVisited)return;this.$("[data-index=\"".concat(item.get("_index"),"\"]")).addClass("is-visited")}},{key:"calculateMode",value:function calculateMode(){var mode=Adapt.device.screenSize==="large"?MODE.LARGE:MODE.SMALL;this.model.set("_mode",mode)}},{key:"renderMode",value:function renderMode(){this.calculateMode();var isLargeMode=this.isLargeMode();this.$el.toggleClass("mode-large",isLargeMode).toggleClass("mode-small",!isLargeMode)}},{key:"isLargeMode",value:function isLargeMode(){return this.model.get("_mode")===MODE.LARGE}},{key:"postRender",value:function postRender(){this.renderMode();this.setupNarrative();this.$(".narrative__slider").imageready(this.setReadyStatus.bind(this));if(Adapt.config.get("_disableAnimation")){this.$el.addClass("disable-animation")}}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}}},{key:"setupNarrative",value:function setupNarrative(){this.renderMode();var items=this.model.getChildren();if(!items||!items.length)return;var activeItem=this.model.getActiveItem();if(!activeItem){activeItem=this.model.getItem(0);activeItem.toggleActive(true)}else{items.trigger("change:_isActive",activeItem,true)}this.calculateWidths();if(!this.isLargeMode()&&!this.model.get("_wasHotgraphic")){this.replaceInstructions()}this.setupEventListeners();this._isInitial=false}},{key:"calculateWidths",value:function calculateWidths(){var itemCount=this.model.getChildren().length;this.model.set({_totalWidth:100*itemCount,_itemWidth:100/itemCount})}},{key:"resizeControl",value:function resizeControl(){var previousMode=this.model.get("_mode");this.renderMode();if(previousMode!==this.model.get("_mode"))this.replaceInstructions();this.evaluateNavigation();var activeItem=this.model.getActiveItem();if(activeItem)this.setStage(activeItem)}},{key:"reRender",value:function reRender(){if(this.model.get("_wasHotgraphic")&&this.isLargeMode()){this.replaceWithHotgraphic();return}this.resizeControl()}},{key:"closeNotify",value:function closeNotify(){this.evaluateCompletion()}},{key:"replaceInstructions",value:function replaceInstructions(){if(this.isLargeMode()){this.$(".narrative__instruction-inner").html(this.model.get("instruction"));return}if(this.model.get("mobileInstruction")&&!this.model.get("_wasHotgraphic")){this.$(".narrative__instruction-inner").html(this.model.get("mobileInstruction"))}}},{key:"replaceWithHotgraphic",value:function replaceWithHotgraphic(){var _this85=this;var HotgraphicView=Adapt.getViewClass("hotgraphic");if(!HotgraphicView)return;var model=this.prepareHotgraphicModel();var newHotgraphic=new HotgraphicView({model:model});this.$el.parents(".component__container").append(newHotgraphic.$el);this.remove();_.defer(function(){_newArrowCheck(this,_this85);Adapt.trigger("device:resize")}.bind(this))}},{key:"prepareHotgraphicModel",value:function prepareHotgraphicModel(){var model=this.model;model.resetActiveItems();model.set({_isPopupOpen:false,_component:"hotgraphic",body:model.get("originalBody"),instruction:model.get("originalInstruction")});return model}},{key:"moveSliderToIndex",value:function moveSliderToIndex(itemIndex){var offset=this.model.get("_itemWidth")*itemIndex;if(Adapt.config.get("_defaultDirection")==="ltr"){offset*=-1}var cssValue="translateX(".concat(offset,"%)");var $sliderElm=this.$(".narrative__slider");var $straplineHeaderElm=this.$(".narrative__strapline-header-inner");$sliderElm.css("transform",cssValue);$straplineHeaderElm.css("transform",cssValue);if(this._isInitial)return;var $elementToFocus=this.isLargeMode()?this.$(".narrative__content-item[data-index=\"".concat(itemIndex,"\"]")):this.$(".narrative__strapline-btn");Adapt.a11y.focusFirst($elementToFocus)}},{key:"setStage",value:function setStage(item){var index=item.get("_index");var indexSelector="[data-index=\"".concat(index,"\"]");if(this.isLargeMode()){item.toggleVisited(true)}this.$(".narrative__progress").removeClass("is-selected").filter(indexSelector).addClass("is-selected");var $slideGraphics=this.$(".narrative__slider-image-container");Adapt.a11y.toggleAccessibleEnabled($slideGraphics.children(".controls"),false);Adapt.a11y.toggleAccessibleEnabled($slideGraphics.filter(indexSelector).children(".controls"),true);var $narrativeItems=this.$(".narrative__content-item");$narrativeItems.addClass("u-visibility-hidden u-display-none");Adapt.a11y.toggleAccessible($narrativeItems,false);Adapt.a11y.toggleAccessible($narrativeItems.filter(indexSelector).removeClass("u-visibility-hidden u-display-none"),true);var $narrativeStraplineButtons=this.$(".narrative__strapline-btn");Adapt.a11y.toggleAccessibleEnabled($narrativeStraplineButtons,false);Adapt.a11y.toggleAccessibleEnabled($narrativeStraplineButtons.filter(indexSelector),true);this.evaluateNavigation();this.evaluateCompletion();this.moveSliderToIndex(index)}},{key:"evaluateNavigation",value:function evaluateNavigation(){var active=this.model.getActiveItem();if(!active)return;var index=active.get("_index");var itemCount=this.model.getChildren().length;var isAtStart=index===0;var isAtEnd=index===itemCount-1;this.$(".narrative__controls-left").toggleClass("u-visibility-hidden",isAtStart);this.$(".narrative__controls-right").toggleClass("u-visibility-hidden",isAtEnd)}},{key:"evaluateCompletion",value:function evaluateCompletion(){if(this.model.areAllItemsCompleted()){this.trigger("allItems")}}},{key:"openPopup",value:function openPopup(){var currentItem=this.model.getActiveItem();Adapt.notify.popup({title:currentItem.get("title"),body:currentItem.get("body")});Adapt.on("popup:opened",function(){currentItem.toggleVisited(true)})}},{key:"onNavigationClicked",value:function onNavigationClicked(event){var $btn=$(event.currentTarget);var index=this.model.getActiveItem().get("_index");$btn.data("direction")==="right"?index++:index--;this.model.setActiveItem(index)}},{key:"onProgressClicked",value:function onProgressClicked(event){var index=$(event.target).data("index");this.model.setActiveItem(index)}},{key:"setupEventListeners",value:function setupEventListeners(){if(this.model.get("_setCompletionOn")==="inview"){this.setupInviewCompletion(".component__widget")}}}]);return NarrativeView}(ComponentView);NarrativeView.template="narrative";return NarrativeView});define("components/adapt-contrib-narrative/js/adapt-contrib-narrative",["core/js/adapt","./narrativeView","core/js/models/itemsComponentModel"],function(Adapt,NarrativeView,ItemsComponentModel){return Adapt.register("narrative",{model:ItemsComponentModel.extend({}),view:NarrativeView})});define("components/adapt-contrib-reveal/js/adapt-contrib-reveal",["core/js/models/componentModel","core/js/views/componentView","core/js/adapt","libraries/jquery.dotdotdot"],function(ComponentModel,ComponentView,Adapt,dotdotdot){'use strict';var Reveal=ComponentView.extend({events:function events(){return Adapt.device.touch==true?{"click .reveal__widget-control":"clickReveal","inview":"inview","click .reveal-popup-open":"openPopup","click .reveal-acessibility":"clickReveal"}:{"click .reveal__widget-control":"clickReveal","inview":"inview","click .reveal-popup-open":"openPopup","click .reveal-acessibility":"clickReveal"}},orientationStates:{Vertical:"vertical",Horizontal:"horizontal"},preRender:function preRender(){var orientation;this.listenTo(Adapt,"device:resize",this.resizeControl,this);switch(this.model.get("_direction")){case"left":case"right":orientation=this.orientationStates.Horizontal;break;case"top":case"bottom":orientation=this.orientationStates.Vertical;}this.model.set("_orientation",orientation);var defaultTextDirection=Adapt.config.get("_defaultDirection");defaultTextDirection=defaultTextDirection==="rtl"?"right":"left";this.model.set("_defaultTextDirection",defaultTextDirection);this.checkIfResetOnRevisit()},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},setupReveal:function setupReveal(){var direction=!this.model.get("_direction")?"left":this.model.get("_direction");var iconDirection=this.getIconDirection(direction);this.$(".reveal__widget-item").addClass("reveal-"+this.model.get("_direction"));this.$(".reveal__widget-control").addClass("reveal-"+direction);this.$(".reveal-image").addClass("reveal-"+direction);this.$("div.reveal__widget-item-text").addClass("reveal-"+direction);this.$("div.reveal__widget-item-text-body").addClass("reveal-"+direction);this.$(".reveal__widget-icon").addClass("icon-controls-"+this.getOppositeDirection(iconDirection));this.$(".second .reveal__widget-item-text-body .accessible-text-block").attr("tabindex","-1");this.$(".first-item .reveal-image").removeClass("a11y-ignore").removeAttr("aria-hidden").attr("tabindex","0");this.$(".second-item .reveal-image").addClass("a11y-ignore").attr("aria-hidden","true").attr("tabindex","-1");this.$(".first .reveal__widget-item-text-body .reveal-content-title-inner").attr("tabindex","0");this.$(".first .reveal__widget-item-text-body .reveal-content-body-inner").attr("tabindex","0");this.$(".first .reveal-acessibility").attr("tabindex","0");this.$(".second .reveal__widget-item-text-body .reveal-content-title-inner").attr("tabindex","-1");this.$(".second .reveal__widget-item-text-body .reveal-content-body-inner").attr("tabindex","-1");this.$(".second .reveal__widget-item-text-body .reveal-popup-open").addClass("a11y-ignore").attr("aria-hidden","true").attr("tabindex","-1");this.model.set("_direction",direction);this.model.set("_active",true);this.model.set("_revealed",false);this.setControlText(false);if(direction=="bottom"){this.$(".first-item img").addClass("first-img");this.$(".second-item img").addClass("second-img");this.$(".second-item").prepend(this.$(".first-img")).prepend(this.$(".first.reveal-bottom"));this.$(".first-item").prepend(this.$(".second-img")).prepend(this.$(".second.reveal-bottom"))}if(direction=="right"){this.$(".first-item img").addClass("first-img");this.$(".second-item img").addClass("second-img");this.$(".second-item").prepend(this.$(".first-img")).prepend(this.$(".first.reveal-right"));this.$(".first-item").prepend(this.$(".second-img")).prepend(this.$(".second.reveal-right"))}if(this.model.get("_orientation")===this.orientationStates.Horizontal){this.calculateWidths()}else{this.calculateHeights()}this.$(".dot-ellipsis").each(function(){var watchWindow=$(this).hasClass("dot-resize-update");var watchTimer=$(this).hasClass("dot-timer-update");var height=0;var classList=$(this).attr("class").split(/\s+/);$.each(classList,function(index,item){var matchResult=item.match(/^dot-height-(\d+)$/);if(matchResult!==null)height=Number(matchResult[1])});var x={};if(watchTimer)x.watch=true;if(watchWindow)x.watch="window";if(height>0)x.height=height;x.after="button.reveal-popup-open";$(this).dotdotdot(x)})},setControlText:function setControlText(isRevealed){if(this.model.get("_control")){if(!isRevealed&&this.model.get("control").showText){this.$(".reveal__widget-control").attr("title",this.model.get("control").showText)}if(isRevealed&&this.model.get("control").hideText){this.$(".reveal__widget-control").attr("title",this.model.get("control").hideText)}}},calculateWidths:function calculateWidths(){var direction=this.model.get("_direction");var $widget=this.$(".reveal__widget");var $slider=this.$(".reveal__widget-slider");var $control=this.$(".reveal__widget-control");var imageWidth=$widget.width();var controlWidth=$control.width();var margin=-imageWidth;$slider.css("width",imageWidth*2);if(this.model.get("_revealed")){$control.css(this.model.get("_direction"),imageWidth-controlWidth)}if(direction=="right"){$slider.css("margin-left",0)}else{$slider.css("margin-"+direction,margin)}this.$("div.reveal__widget-item-text").css("width",$("img.reveal-image").width());this.model.set("_scrollSize",imageWidth);this.model.set("_controlWidth",controlWidth)},calculateHeights:function calculateHeights(){var direction=this.model.get("_direction");var $widget=this.$(".reveal__widget");var $image=this.$(".reveal__widget img");var $slider=this.$(".reveal__widget-slider");var $control=this.$(".reveal__widget-control");var imageHeight=$image.height();var controlHeight=$control.height();var margin=direction=="top"?-imageHeight:imageHeight;$widget.css("height",imageHeight);$slider.css("height",imageHeight);if(this.model.get("_revealed")){$control.css(this.model.get("_direction"),imageHeight-controlHeight)}if(direction=="bottom"){$slider.css("margin-top",0)}else{$slider.css("margin-"+direction,margin)}this.$("div.reveal__widget-item-text").css("height",imageHeight);this.model.set("_scrollSize",imageHeight);this.model.set("_controlWidth",controlHeight)},getMarginType:function getMarginType(){return this.model.get("_orientation")==this.orientationStates.Horizontal?"left":"top"},resizeControl:function resizeControl(){var direction=this.model.get("_direction");var marginType=this.getMarginType();var $widget=this.$(".reveal__widget");var $slider=this.$(".reveal__widget-slider");var $widgetText=this.$(".reveal__widget-item-text");var imageSize;var controlSize;if(this.model.get("_orientation")==this.orientationStates.Horizontal){var innerSize=this.$(".reveal__inner").width();imageSize=innerSize!=$widget.width()?innerSize:$widget.width();controlSize=this.$(".reveal__widget-control").width();$widget.css("width",imageSize);$widgetText.css("width",imageSize);$slider.css("width",imageSize*2)}else{imageSize=this.$(".reveal__widget img").height();controlSize=this.$(".reveal__widget-control").height();$widget.css("height",imageSize);$widgetText.css("height",imageSize);$slider.css("height",imageSize)}if(direction=="bottom"){$slider.css("margin-top",-imageSize)}else if(direction=="right"){$slider.css("margin-left",0)}else{$slider.css("margin-"+direction,-imageSize)}var sliderAnimation={};if(this.model.get("_revealed")){$slider.css("margin-"+marginType,direction==marginType?-imageSize:0);sliderAnimation["margin-"+marginType]=direction==marginType?0:-imageSize;$slider.animate(sliderAnimation)}else{$slider.css("margin-"+marginType,direction==marginType?-imageSize:0)}this.model.set("_scrollSize",imageSize);this.model.set("_controlWidth",controlSize)},postRender:function postRender(){this.$(".reveal__widget").imageready(_.bind(function(){if($("html").hasClass("ie")){var self=this;_.delay(function(){self.setupReveal();self.setReadyStatus()},400)}else{this.setupReveal();this.setReadyStatus()}},this))},getOppositeDirection:function getOppositeDirection(direction){var o={"left":"right","right":"left","up":"down","down":"up"};return o[direction]},getIconDirection:function getIconDirection(direction){if(this.model.get("_orientation")==this.orientationStates.Vertical){return direction=="top"?"up":"down"}else{return direction}},clickReveal:function clickReveal(event){event.preventDefault();var direction=this.model.get("_direction");var marginType=this.getMarginType();var scrollSize=this.model.get("_scrollSize");var controlWidth=this.model.get("_controlWidth");var controlMovement=!this.model.get("_revealed")?scrollSize-controlWidth:scrollSize;var operator=!this.model.get("_revealed")?"+=":"-=";var iconDirection=this.getIconDirection(direction);var defaultTextDirection=this.model.get("_defaultTextDirection");var controlAnimation={};var sliderAnimation={};var classToAdd;var classToRemove;this.$(".reveal__widget-item-text-body").removeClass("a11y-ignore").removeAttr("aria-hidden").removeAttr("tabindex");if(defaultTextDirection==="right"&&(direction=="left"||direction=="right")){marginType=this.getOppositeDirection(marginType)}if(!this.model.get("_revealed")){this.model.set("_revealed",true);this.$(".reveal__widget").addClass("reveal-showing");this.$(".first .reveal__widget-item-text-body").addClass("a11y-ignore").attr("aria-hidden","true").attr("tabindex","-1");this.$(".second .reveal__widget-item-text-body .accessible-text-block").removeClass("aria-hidden").removeAttr("aria-hidden").attr("tabindex","0");this.$(".first .reveal__widget-item-text-body .accessible-text-block").attr("tabindex","-1");this.$(".first-item .reveal-image").addClass("a11y-ignore").attr("aria-hidden","true").attr("tabindex","-1");this.$(".first .reveal__widget-item-text-body .reveal-content-title-inner").attr("tabindex","-1");this.$(".first .reveal__widget-item-text-body .reveal-content-body-inner").attr("tabindex","-1");this.$(".first .reveal-acessibility").attr("tabindex","-1");this.$(".second-item .reveal-image").removeClass("a11y-ignore").removeAttr("aria-hidden").attr("tabindex","0").a11y_focus();this.$(".second .reveal__widget-item-text-body .reveal-content-title-inner").removeClass("aria-hidden").removeAttr("aria-hidden").attr("tabindex","0");this.$(".second .reveal__widget-item-text-body .reveal-content-body-inner").removeClass("aria-hidden").removeAttr("aria-hidden").attr("tabindex","0");this.$(".first .reveal__widget-item-text-body .reveal-popup-open").addClass("a11y-ignore").attr("aria-hidden","true").attr("tabindex","-1");this.$(".second .reveal__widget-item-text-body .reveal-popup-open").removeClass("a11y-ignore").removeAttr("aria-hidden").attr("tabindex","0");controlAnimation[direction]=operator+controlMovement;classToAdd="icon-controls-"+iconDirection;classToRemove="icon-controls-"+this.getOppositeDirection(iconDirection);sliderAnimation["margin-"+marginType]=direction==marginType?0:-scrollSize;this.setCompletionStatus()}else{this.model.set("_revealed",false);this.$(".reveal__widget").removeClass("reveal-showing");this.$(".second .reveal__widget-item-text-body").addClass("a11y-ignore").attr("aria-hidden","true").attr("tabindex","-1");this.$(".first .reveal__widget-item-text-body .accessible-text-block").attr("tabindex","0");this.$(".second .reveal__widget-item-text-body .accessible-text-block").attr("tabindex","-1");this.$(".second-item .reveal-image").addClass("a11y-ignore").attr("aria-hidden","true").attr("tabindex","-1");this.$(".second .reveal__widget-item-text-body .reveal-content-title-inner").attr("tabindex","-1");this.$(".second .reveal__widget-item-text-body .reveal-content-body-inner").attr("tabindex","-1");this.$(".first-item .reveal-image").removeClass("a11y-ignore").removeAttr("aria-hidden").attr("tabindex","0");this.$(".first .reveal__widget-item-text-body .reveal-content-title-inner").attr("tabindex","0");this.$(".first .reveal__widget-item-text-body .reveal-content-body-inner").attr("tabindex","0");this.$(".first .reveal-acessibility").attr("tabindex","0");this.$(".first .reveal__widget-item-text-body .reveal-popup-open").removeClass("a11y-ignore").removeAttr("aria-hidden").attr("tabindex","0");this.$(".second .reveal__widget-item-text-body .reveal-popup-open").addClass("a11y-ignore").attr("aria-hidden","true").attr("tabindex","-1");controlAnimation[direction]=0;classToAdd="icon-controls-"+this.getOppositeDirection(iconDirection);classToRemove="icon-controls-"+iconDirection;sliderAnimation["margin-"+marginType]=direction==marginType?operator+controlMovement:0}this.$(".reveal__widget-slider").animate(sliderAnimation);this.$(".reveal__widget-icon").removeClass(classToRemove).addClass(classToAdd);this.setControlText(this.model.get("_revealed"))},openPopup:function openPopup(event){event.preventDefault();this.model.set("_active",false);var bodyText=this.model.get("_revealed")?this.model.get("second").body:this.model.get("first").body;var titleText=this.model.get("_revealed")?this.model.get("second").title:this.model.get("first").title;var popupObject={title:titleText,body:bodyText};Adapt.trigger("notify:popup",popupObject)}});Adapt.register("reveal",{model:ComponentModel.extend({}),view:Reveal});return Reveal});define("components/adapt-contrib-slider/js/sliderView",["core/js/adapt","core/js/views/questionView"],function(Adapt,QuestionView){var SliderView=QuestionView.extend({events:{"click .js-slider-number-click":"onNumberSelected","focus .js-slider-item-input":"onHandleFocus","blur .js-slider-item-input":"onHandleBlur"},resetQuestionOnRevisit:function resetQuestionOnRevisit(){this.setAllItemsEnabled();this.model.deselectAllItems();this.resetQuestion()},setupQuestion:function setupQuestion(){if(this.model.get("_isSubmitted"))return;this.selectItem(this.getIndexFromValue(this.model.get("_selectedItem").value),true)},setupRangeslider:function setupRangeslider(){this.$sliderScaleMarker=this.$(".js-slider-number-selection");this.$slider=this.$(".js-slider-item-input");if(this.model.has("_scaleStep")){this.$slider.attr({"step":this.model.get("_scaleStep")})}this.$slider.rangeslider({polyfill:false,onSlide:_.bind(this.handleSlide,this)});this.oldValue=0;if(this._deferEnable){this.setAllItemsEnabled()}},handleSlide:function handleSlide(position,value){if(this.oldValue===value){return}var itemIndex=this.getIndexFromValue(value);var pixels=this.mapIndexToPixels(itemIndex);this.selectItem(itemIndex,false);this.animateToPosition(pixels);this.oldValue=value},disableQuestion:function disableQuestion(){this.setAllItemsEnabled()},enableQuestion:function enableQuestion(){this.setAllItemsEnabled()},setAllItemsEnabled:function setAllItemsEnabled(){var isEnabled=this.model.get("_isEnabled");if(!this.$slider){this._deferEnable=true;return}if(!isEnabled){this.$(".slider__widget").addClass("is-disabled");this.$slider.prop("disabled",true).rangeslider("update",true);return}this.$(".slider__widget").removeClass("is-disabled");this.$slider.prop("disabled",false).rangeslider("update",true)},onQuestionRendered:function onQuestionRendered(){this.setupRangeslider();this.setScalePositions();this.onScreenSizeChanged();this.showScaleMarker(true);this.listenTo(Adapt,"device:resize",this.onScreenSizeChanged);this.setReadyStatus()},animateToPosition:function animateToPosition(newPosition){if(!this.$sliderScaleMarker)return;this.$sliderScaleMarker.velocity("stop").velocity({left:newPosition},{duration:200,easing:"linear",mobileHA:false})},getIndexFromValue:function getIndexFromValue(itemValue){var scaleStart=this.model.get("_scaleStart");var scaleEnd=this.model.get("_scaleEnd");return Math.round(this.mapValue(itemValue,scaleStart,scaleEnd,0,this.model.get("_items").length-1))},mapIndexToPixels:function mapIndexToPixels(value,$widthObject){var numberOfItems=this.model.get("_items").length;var width=$widthObject?$widthObject.width():this.$(".js-slider-scale").width();return Math.round(this.mapValue(value,0,numberOfItems-1,0,width))},mapPixelsToIndex:function mapPixelsToIndex(value){var numberOfItems=this.model.get("_items").length;var width=this.$(".slider-sliderange").width();return Math.round(this.mapValue(value,0,width,0,numberOfItems-1))},normalise:function normalise(value,low,high){var range=high-low;return(value-low)/range},mapValue:function mapValue(value,inputLow,inputHigh,outputLow,outputHigh){var normal=this.normalise(value,inputLow,inputHigh);return normal*(outputHigh-outputLow)+outputLow},onHandleFocus:function onHandleFocus(event){event.preventDefault();this.$slider.on("keydown",_.bind(this.onKeyDown,this))},onHandleBlur:function onHandleBlur(event){event.preventDefault();this.$slider.off("keydown")},onKeyDown:function onKeyDown(event){if(event.which===9)return;event.preventDefault();var newItemIndex=this.getIndexFromValue(this.model.get("_selectedItem").value);switch(event.which){case 40:case 37:newItemIndex=Math.max(newItemIndex-1,0);break;case 38:case 39:newItemIndex=Math.min(newItemIndex+1,this.model.get("_items").length-1);break;}this.selectItem(newItemIndex);if(typeof newItemIndex==="number")this.showScaleMarker(true);this.animateToPosition(this.mapIndexToPixels(newItemIndex));this.setSliderValue(this.getValueFromIndex(newItemIndex))},onNumberSelected:function onNumberSelected(event){event.preventDefault();if(this.model.get("_isInteractionComplete")){return}if(this.$slider.prop("disabled")){return}var itemValue=parseFloat($(event.currentTarget).attr("data-id"));var index=this.getIndexFromValue(itemValue);this.selectItem(index);this.animateToPosition(this.mapIndexToPixels(index));this.setSliderValue(itemValue)},getValueFromIndex:function getValueFromIndex(index){return this.model.get("_items")[index].value},resetControlStyles:function resetControlStyles(){this.$(".slider-handle").empty();this.showScaleMarker(false);this.$(".slider-bar").animate({width:"0px"});this.setSliderValue(this.model.get("_items")[0].value)},onCannotSubmit:function onCannotSubmit(){},setSliderValue:function setSliderValue(value){if(this.$slider){this.$slider.val(value).change()}},showMarking:function showMarking(){if(!this.model.get("_canShowMarking"))return;this.$(".slider__widget").removeClass("is-correct is-incorrect").addClass(this.model.get("_selectedItem").correct?"is-correct":"is-incorrect")},resetQuestion:function resetQuestion(){this.selectItem(0,true);this.animateToPosition(0);this.resetControlStyles();this.showScaleMarker(true)},setScalePositions:function setScalePositions(){var numberOfItems=this.model.get("_items").length;_.each(this.model.get("_items"),function(item,index){var normalisedPosition=this.normalise(index,0,numberOfItems-1);this.$(".js-slider-number").eq(index).data("normalisedPosition",normalisedPosition)},this)},showScale:function showScale(){var $markers=this.$(".js-slider-scale-notch-container").empty();if(this.model.get("_showScale")===false){$markers.eq(0).css({display:"none"});this.$(".js-slider-number").css(this.model.get("_showScaleIndicator")?{visibility:"hidden"}:{display:"none"});return}var $scaler=this.$(".js-slider-scale");for(var i=1,count=this.model.get("_items").length-1;i<count;i++){$markers.append("<div class='slider__scale-notch' style='left: "+this.mapIndexToPixels(i,$scaler)+"px'>")}this.showScaleNumbers()},showScaleNumbers:function showScaleNumbers(){var $scaler=this.$(".js-slider-scale");var $numbers=this.$(".js-slider-number");if(this.model.get("_showScaleNumbers")===false){$numbers.css("display","none");return}var scaleWidth=$scaler.width();this.model.get("_items").forEach(function(item,index){var $number=$numbers.eq(index);var newLeft=Math.round($number.data("normalisedPosition")*scaleWidth);$number.css({left:newLeft})})},showLabels:function showLabels(){if(!this.model.get("labelStart")&&!this.model.get("labelEnd")){this.$(".js-slider-label-container").eq(0).css({display:"none"})}},remapSliderBar:function remapSliderBar(){var $scaler=this.$(".js-slider-scale");var currentIndex=this.getIndexFromValue(this.model.get("_selectedItem").value);var left=this.mapIndexToPixels(currentIndex,$scaler);this.$(".slider-handle").css({left:left+"px"});this.$(".js-slider-number-selection").css({left:left+"px"});this.$(".slider-bar").width(left)},onScreenSizeChanged:function onScreenSizeChanged(){this.showScale();this.showLabels();this.remapSliderBar();if(this.$(".slider__widget").hasClass("show-user-answer")){this.hideCorrectAnswer()}else if(this.$(".slider__widget").hasClass("show-correct-answer")){this.showCorrectAnswer()}},showCorrectAnswer:function showCorrectAnswer(){var answers=[];if(this.model.has("_correctAnswer")){var correctAnswer=this.model.get("_correctAnswer")}if(this.model.has("_correctRange")){var bottom=this.model.get("_correctRange")._bottom;var top=this.model.get("_correctRange")._top;var step=this.model.has("_scaleStep")?this.model.get("_scaleStep"):1}this.showScaleMarker(false);if(correctAnswer){answers.push(correctAnswer)}else if(bottom!==undefined&&top!==undefined){var answer=this.model.get("_correctRange")._bottom;var topOfRange=this.model.get("_correctRange")._top;while(answer<=topOfRange){answers.push(answer);answer+=step}}else{console.log("adapt-contrib-slider::WARNING: no correct answer or correct range set in JSON")}var middleAnswer=answers[Math.floor(answers.length/2)];this.animateToPosition(this.mapIndexToPixels(this.getIndexFromValue(middleAnswer)));this.showModelAnswers(answers);this.setSliderValue(middleAnswer)},showModelAnswers:function showModelAnswers(correctAnswerArray){var $parentDiv=this.$(".js-slider-model-range");_.each(correctAnswerArray,function(correctAnswer,index){$parentDiv.append($("<div class='slider__number-model-answer'>"));var $element=$(this.$(".js-slider-model-range .slider__number-model-answer")[index]);var startingLeft=this.mapIndexToPixels(this.getIndexFromValue(this.model.get("_selectedItem").value));if(this.model.get("_showNumber"))$element.html(correctAnswer);$element.css({left:startingLeft}).fadeIn(0,_.bind(function(){$element.animate({left:this.mapIndexToPixels(this.getIndexFromValue(correctAnswer))})},this))},this)},hideCorrectAnswer:function hideCorrectAnswer(){var userAnswerIndex=this.getIndexFromValue(this.model.get("_userAnswer"));this.$(".js-slider-model-range").empty();this.showScaleMarker(true);this.selectItem(userAnswerIndex,true);this.animateToPosition(this.mapIndexToPixels(userAnswerIndex));this.setSliderValue(this.model.get("_userAnswer"))},selectItem:function selectItem(itemIndex,noFocus){_.each(this.model.get("_items"),function(item,index){item.selected=index===itemIndex;if(item.selected){this.model.set("_selectedItem",item);this.$(".js-slider-item-input").attr({"value":item.value,"aria-valuenow":item.value})}},this);this.showNumber(true)},showScaleMarker:function showScaleMarker(show){var $scaleMarker=this.$(".js-slider-number-selection");if(this.model.get("_showScaleIndicator")){this.showNumber(show);if(show){$scaleMarker.addClass("display-block")}else{$scaleMarker.removeClass("display-block")}}},showNumber:function showNumber(show){var $scaleMarker=this.$(".js-slider-number-selection");if(this.model.get("_showNumber")){if(show){$scaleMarker.html(this.model.get("_selectedItem").value)}else{$scaleMarker.html=""}}}});return SliderView});define("components/adapt-contrib-slider/js/sliderModel",["core/js/adapt","core/js/models/questionModel"],function(Adapt,QuestionModel){var SliderModel=QuestionModel.extend({init:function init(){QuestionModel.prototype.init.call(this);this.setupModelItems();this.set("_selectedItem",this.get("_items")[0])},getDecimalPlaces:function getDecimalPlaces(num){return(num.toString().split(".")[1]||[]).length},setupModelItems:function setupModelItems(){var items=[];var answer=this.get("_correctAnswer");var range=this.get("_correctRange");var start=this.get("_scaleStart");var end=this.get("_scaleEnd");var step=this.get("_scaleStep")||1;var dp=this.getDecimalPlaces(step);for(var i=start;i<=end;i+=step){if(dp!==0){i=parseFloat(i.toFixed(dp))}items.push({value:i,selected:false,correct:answer?i===Number(answer):i>=range._bottom&&i<=range._top})}this.set({"_items":items,"_marginDir":Adapt.config.get("_defaultDirection")==="rtl"?"right":"left"})},canSubmit:function canSubmit(){return true},restoreUserAnswers:function restoreUserAnswers(){if(!this.get("_isSubmitted")){this.set({_selectedItem:{},_userAnswer:undefined});return}var items=this.get("_items");var userAnswer=this.get("_userAnswer");for(var i=0,l=items.length;i<l;i++){var item=items[i];if(item.value===userAnswer){item.selected=true;this.set("_selectedItem",item);break}}this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()},storeUserAnswer:function storeUserAnswer(){this.set("_userAnswer",this.get("_selectedItem").value)},resetUserAnswer:function resetUserAnswer(){this.set({_isAtLeastOneCorrectSelection:false,_selectedItem:{},_userAnswer:undefined})},deselectAllItems:function deselectAllItems(){_.each(this.get("_items"),function(item){item.selected=false},this)},isCorrect:function isCorrect(){var numberOfCorrectAnswers=0;_.each(this.get("_items"),function(item,index){if(item.selected&&item.correct){this.set("_isAtLeastOneCorrectSelection",true);numberOfCorrectAnswers++}},this);this.set("_numberOfCorrectAnswers",numberOfCorrectAnswers);return this.get("_isAtLeastOneCorrectSelection")?true:false},isPartlyCorrect:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")},setScore:function setScore(){var numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");var questionWeight=this.get("_questionWeight");var score=questionWeight*numberOfCorrectAnswers;this.set("_score",score)},getResponse:function getResponse(){return this.get("_userAnswer").toString()},getResponseType:function getResponseType(){return"numeric"}});return SliderModel});define("components/adapt-contrib-slider/js/adapt-contrib-slider",["core/js/adapt","./sliderView","./sliderModel","libraries/rangeslider"],function(Adapt,SliderView,SliderModel){return Adapt.register("slider",{view:SliderView,model:SliderModel})});define("components/adapt-contrib-text/js/adapt-contrib-text",["core/js/adapt","core/js/views/componentView","core/js/models/componentModel"],function(Adapt,ComponentView,ComponentModel){var TextView=function(_ComponentView8){"use strict";_inherits(TextView,_ComponentView8);var _super47=_createSuper(TextView);function TextView(){_classCallCheck(this,TextView);return _super47.apply(this,arguments)}_createClass(TextView,[{key:"preRender",value:function preRender(){this.checkIfResetOnRevisit()}},{key:"postRender",value:function postRender(){this.setReadyStatus();this.setupInview()}},{key:"setupInview",value:function setupInview(){var selector=this.getInviewElementSelector();if(!selector){this.setCompletionStatus();return}this.setupInviewCompletion(selector)}},{key:"getInviewElementSelector",value:function getInviewElementSelector(){if(this.model.get("body"))return".component__body";if(this.model.get("instruction"))return".component__instruction";if(this.model.get("displayTitle"))return".component__title";return null}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}}}]);return TextView}(ComponentView);TextView.template="text";return Adapt.register("text",{model:ComponentModel.extend({}),view:TextView})});define("components/adapt-contrib-textInput/js/textInputView",["core/js/views/questionView"],function(QuestionView){var TextInputView=QuestionView.extend({events:{"focus .js-textinput-textbox":"clearValidationError","change .js-textinput-textbox":"onInputChanged","keyup .js-textinput-textbox":"onInputChanged"},resetQuestionOnRevisit:function resetQuestionOnRevisit(){this.setAllItemsEnabled(false);this.resetQuestion()},setupQuestion:function setupQuestion(){this.model.setupRandomisation()},disableQuestion:function disableQuestion(){this.setAllItemsEnabled(false)},enableQuestion:function enableQuestion(){this.setAllItemsEnabled(true)},setAllItemsEnabled:function setAllItemsEnabled(isEnabled){this.model.get("_items").forEach(function(item,index){var $itemInput=this.$(".js-textinput-textbox").eq(index);$itemInput.prop("disabled",!isEnabled)},this)},onQuestionRendered:function onQuestionRendered(){this.setReadyStatus()},clearValidationError:function clearValidationError(){this.$(".js-textinput-textbox").removeClass("has-error")},onCannotSubmit:function onCannotSubmit(){this.showValidationError()},showValidationError:function showValidationError(){this.$(".js-textinput-textbox").addClass("has-error")},showMarking:function showMarking(){if(!this.model.get("_canShowMarking"))return;this.model.get("_items").forEach(function(item,i){var $item=this.$(".js-textinput-item").eq(i);$item.removeClass("is-correct is-incorrect").addClass(item._isCorrect?"is-correct":"is-incorrect")},this)},resetQuestion:function resetQuestion(){this.$(".js-textinput-textbox").prop("disabled",!this.model.get("_isEnabled")).val("");this.model.set({_isAtLeastOneCorrectSelection:false,_isCorrect:undefined})},showCorrectAnswer:function showCorrectAnswer(){if(this.model.get("_answers")){var correctAnswers=this.model.get("_answers");this.model.get("_items").forEach(function(item,index){this.$(".js-textinput-textbox").eq(index).val(correctAnswers[index][0])},this)}else{this.model.get("_items").forEach(function(item,index){this.$(".js-textinput-textbox").eq(index).val(item._answers[0])},this)}},hideCorrectAnswer:function hideCorrectAnswer(){this.model.get("_items").forEach(function(item,index){this.$(".js-textinput-textbox").eq(index).val(item.userAnswer)},this)},onInputChanged:function onInputChanged(e){var $input=$(e.target);this.model.setItemUserAnswer($input.parents(".js-textinput-item").index(),$input.val())}});return TextInputView});define("components/adapt-contrib-textInput/js/textInputModel",["core/js/models/questionModel"],function(QuestionModel){var TextInputModel=QuestionModel.extend({init:function init(){QuestionModel.prototype.init.call(this);this.set("_genericAnswerIndexOffset",TextInputModel.genericAnswerIndexOffset);this.setupQuestionItemIndexes();this.checkCanSubmit()},setupQuestionItemIndexes:function setupQuestionItemIndexes(){this.get("_items").forEach(function(item,index){if(item._index===undefined)item._index=index;if(item._answerIndex===undefined)item._answerIndex=-1})},restoreUserAnswers:function restoreUserAnswers(){if(!this.get("_isSubmitted"))return;var userAnswer=this.get("_userAnswer");var genericAnswers=this.get("_answers");this.get("_items").forEach(function(item){var answerIndex=userAnswer[item._index];if(answerIndex>=TextInputModel.genericAnswerIndexOffset){item.userAnswer=genericAnswers[answerIndex-TextInputModel.genericAnswerIndexOffset];item._answerIndex=answerIndex}else if(answerIndex>-1){item.userAnswer=item._answers[answerIndex];item._answerIndex=answerIndex}else{if(item.userAnswer===undefined)item.userAnswer="******";item._answerIndex=-1}if(item.userAnswer instanceof Array)item.userAnswer=item.userAnswer[0]});this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()},setupRandomisation:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;this.set("_items",_.shuffle(this.get("_items")))},canSubmit:function canSubmit(){var _this86=this;return this.get("_items").every(function(_ref6){_newArrowCheck(this,_this86);var userAnswer=_ref6.userAnswer;return userAnswer}.bind(this))},setItemUserAnswer:function setItemUserAnswer(itemIndex,userAnswer){var item=this.get("_items")[itemIndex];item.userAnswer=userAnswer;this.checkCanSubmit()},storeUserAnswer:function storeUserAnswer(){var items=this.get("_items");this.isCorrect();var userAnswer=new Array(items.length);items.forEach(function(item,index){userAnswer[item._index]=item._answerIndex});this.set("_userAnswer",userAnswer)},isCorrect:function isCorrect(){if(this.get("_answers")){this.markGenericAnswers()}else{this.markSpecificAnswers()}return!_.contains(_.pluck(this.get("_items"),"_isCorrect"),false)},isPartlyCorrect:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")},markGenericAnswers:function markGenericAnswers(){var numberOfCorrectAnswers=0;var correctAnswers=this.get("_answers").slice();var usedAnswerIndexes=[];this.get("_items").forEach(function(item){correctAnswers.forEach(function(answerGroup,answerIndex){if(_.indexOf(usedAnswerIndexes,answerIndex)>-1)return;if(this.checkAnswerIsCorrect(answerGroup,item.userAnswer)==false)return;usedAnswerIndexes.push(answerIndex);item._isCorrect=true;item._answerIndex=answerIndex+TextInputModel.genericAnswerIndexOffset;this.set({_numberOfCorrectAnswers:++numberOfCorrectAnswers,_isAtLeastOneCorrectSelection:true})},this);if(!item._isCorrect)item._isCorrect=false},this)},markSpecificAnswers:function markSpecificAnswers(){var numberOfCorrectAnswers=0;this.get("_items").forEach(function(item){if(!item._answers)return;var userAnswer=item.userAnswer||"";if(this.checkAnswerIsCorrect(item._answers,userAnswer)){item._isCorrect=true;item._answerIndex=_.indexOf(item._answers,this.cleanupUserAnswer(userAnswer));this.set({_numberOfCorrectAnswers:++numberOfCorrectAnswers,_isAtLeastOneCorrectSelection:true})}else{item._isCorrect=false;item._answerIndex=-1}},this)},checkAnswerIsCorrect:function checkAnswerIsCorrect(possibleAnswers,userAnswer){var uAnswer=this.cleanupUserAnswer(userAnswer);var matched=possibleAnswers.filter(function(cAnswer){return this.cleanupUserAnswer(cAnswer)==uAnswer},this);var answerIsCorrect=matched&&matched.length>0;if(answerIsCorrect)this.set("_hasAtLeastOneCorrectSelection",true);return answerIsCorrect},cleanupUserAnswer:function cleanupUserAnswer(userAnswer){if(this.get("_allowsAnyCase")){userAnswer=userAnswer.toLowerCase()}if(this.get("_allowsPunctuation")){userAnswer=userAnswer.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"");userAnswer=userAnswer.replace(/(  +)+/g," ")}return $.trim(userAnswer)},setScore:function setScore(){var numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");var questionWeight=this.get("_questionWeight");var itemLength=this.get("_items").length;var score=questionWeight*numberOfCorrectAnswers/itemLength;this.set("_score",score)},resetUserAnswer:function resetUserAnswer(){this.get("_items").forEach(function(item){item._isCorrect=false;item.userAnswer=""})},getResponse:function getResponse(){return _.pluck(this.get("_items"),"userAnswer").join("[,]")},getResponseType:function getResponseType(){return"fill-in"}},{genericAnswerIndexOffset:65536});return TextInputModel});define("components/adapt-contrib-textInput/js/adapt-contrib-textInput",["core/js/adapt","./textInputView","./textInputModel"],function(Adapt,TextInputView,TextInputModel){return Adapt.register("textinput",{view:TextInputView,model:TextInputModel})});(function(t){"function"==typeof define&&define.amd?define("components/adapt-dragndrop/js/jquery-ui.min",["jquery"],t):t(jQuery)})(function(t){t.ui=t.ui||{},t.ui.version="1.12.1";var e=0,i=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++){try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},l=e.split(".")[0];e=e.split(".")[1];var h=l+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][h.toLowerCase()]=function(e){return!!t.data(e,h)},t[l]=t[l]||{},n=t[l][e],o=t[l][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(r[e]=s,void 0)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:l,widgetName:e,widgetFullName:h}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var s,n,o=i.call(arguments,1),a=0,r=o.length;r>a;a++){for(s in o[a]){n=o[a][s],o[a].hasOwnProperty(s)&&void 0!==n&&(e[s]=t.isPlainObject(n)?t.isPlainObject(e[s])?t.widget.extend({},e[s],n):t.widget.extend({},n):n)}}return e},t.widget.bridge=function(e,s){var n=s.prototype.widgetFullName||e;t.fn[e]=function(o){var a="string"==typeof o,r=i.call(arguments,1),l=this;return a?this.length||"instance"!==o?this.each(function(){var i,s=t.data(this,n);return"instance"===o?(l=s,!1):s?t.isFunction(s[o])&&"_"!==o.charAt(0)?(i=s[o].apply(s,r),i!==s&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+o+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; "+"attempted to call method '"+o+"'")}):l=void 0:(r.length&&(o=t.widget.extend.apply(null,[o].concat(r))),this.each(function(){var e=t.data(this,n);e?(e.option(o||{}),e._init&&e._init()):t.data(this,n,new s(o,this))})),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function _createWidget(i,s){s=t(s||this.defaultElement||this)[0],this.element=t(s),this.uuid=e++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},s!==this&&(t.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function remove(t){t.target===s&&this.destroy()}}),this.document=t(s.style?s.ownerDocument:s.document||s),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),i),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function _getCreateOptions(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function destroy(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function widget(){return this.element},option:function option(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++){n[s[o]]=n[s[o]]||{},n=n[s[o]]}if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function _setOptions(t){var e;for(e in t){this._setOption(e,t[e])}return this},_setOption:function _setOption(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function _setOptionClasses(e){var i,s,n;for(i in e){n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))}},_setOptionDisabled:function _setOptionDisabled(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function enable(){return this._setOptions({disabled:!1})},disable:function disable(){return this._setOptions({disabled:!0})},_classes:function _classes(e){function i(i,o){var a,r;for(r=0;i.length>r;r++){a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function _untrackClassesElement(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function _removeClass(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function _addClass(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function _toggleClass(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function _on(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var l=s.match(/^([\w:-]*)\s*(.*)$/),h=l[1]+o.eventNamespace,c=l[2];c?n.on(h,c,r):i.on(h,r)})},_off:function _off(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function _delay(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function _hoverable(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function mouseenter(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function mouseleave(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function _focusable(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function focusin(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function focusout(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function _trigger(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o){n in i||(i[n]=o[n])}return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,o=Math.max,a=Math.abs,r=/left|center|right/,l=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function scrollbarWidth(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function getScrollInfo(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function getWithinInfo(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,o=!s&&!n;return{element:i,isWindow:s,isDocument:n,offset:o?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=s(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):l.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=l.test(i[1])?i[1]:"center",t=h.exec(i[0]),e=h.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,l=t(this),h=l.outerWidth(),c=l.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=h+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),T=e(k.my,l.outerWidth(),l.outerHeight());"right"===n.my[0]?D.left-=h:"center"===n.my[0]&&(D.left-=h/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=T[0],D.top+=T[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:h,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+T[0],u[1]+T[1]],my:n.my,at:n.at,within:b,elem:l})}),n.using&&(r=function r(t){var e=g.left-D.left,i=e+p-h,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:l,left:D.left,top:D.top,width:h,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};h>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),l.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function left(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,l=n-r,h=r+e.collisionWidth-a-n;e.collisionWidth>a?l>0&&0>=h?(i=t.left+l+e.collisionWidth-a-n,t.left+=l-i):t.left=h>0&&0>=l?n:l>h?n+a-e.collisionWidth:n:l>0?t.left+=l:h>0?t.left-=h:t.left=o(t.left-r,t.left)},top:function top(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,l=n-r,h=r+e.collisionHeight-a-n;e.collisionHeight>a?l>0&&0>=h?(i=t.top+l+e.collisionHeight-a-n,t.top+=l-i):t.top=h>0&&0>=l?n:l>h?n+a-e.collisionHeight:n:l>0?t.top+=l:h>0?t.top-=h:t.top=o(t.top-r,t.top)}},flip:{left:function left(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,h=t.left-e.collisionPosition.marginLeft,c=h-l,u=h+e.collisionWidth-r-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-r-o,(0>i||a(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-l,(s>0||u>a(s))&&(t.left+=d+p+f))},top:function top(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,l=n.isWindow?n.scrollTop:n.offset.top,h=t.top-e.collisionPosition.marginTop,c=h-l,u=h+e.collisionHeight-r-l,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-r-o,(0>s||a(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-l,(i>0||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function left(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function top(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function enableSelection(){return this.off(".ui-disableSelection")}}),t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var s=!1;t(document).on("mouseup",function(){s=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function _mouseInit(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function _mouseDestroy(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function _mouseDown(e){if(!s){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,n=1===e.which,o="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return n&&!o&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),s=!0,!0)):!0}},_mouseMove:function _mouseMove(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function _mouseUp(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,s=!1,e.preventDefault()},_mouseDistanceMet:function _mouseDistanceMet(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function _mouseDelayMet(){return this.mouseDelayMet},_mouseStart:function _mouseStart(){},_mouseDrag:function _mouseDrag(){},_mouseStop:function _mouseStop(){},_mouseCapture:function _mouseCapture(){return!0}}),t.ui.plugin={add:function add(e,i,s){var n,o=t.ui[e].prototype;for(n in s){o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])}},call:function call(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++){t.options[o[n][0]]&&o[n][1].apply(t.element,i)}}},t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function _create(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function _setOption(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function _destroy(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function _mouseCapture(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function _blockFrames(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function _unblockFrames(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function _blurActiveElement(e){var i=t.ui.safeActiveElement(this.document[0]),s=t(e.target);s.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function _mouseStart(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function _refreshOffsets(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function _mouseDrag(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function _mouseStop(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function _mouseUp(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function cancel(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function _getHandle(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function _setHandleClassName(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function _removeHandleClassName(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function _createHelper(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function _setPositionRelative(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function _adjustOffsetFromHelper(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function _isRootNode(t){return /(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function _getParentOffset(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function _getRelativeOffset(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function _cacheMargins(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function _cacheHelperProportions(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function _setContainment(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function _convertPositionTo(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function _generatePosition(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),l=t.pageX,h=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(l=this.originalPageX),"x"===a.axis&&(h=this.originalPageY)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function _clear(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function _trigger(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function _uiHash(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function start(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function stop(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function drag(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function start(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function stop(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function start(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function stop(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function start(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function drag(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function start(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function drag(e,i,s){var n,o,a,r,l,h,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--){l=s.snapElements[d].left-s.margins.left,h=l+s.snapElements[d].width,c=s.snapElements[d].top-s.margins.top,u=c+s.snapElements[d].height,l-g>_||m>h+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(l-_),r=g>=Math.abs(h-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(l-m),r=g>=Math.abs(h-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}}),t.ui.plugin.add("draggable","stack",{start:function start(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function start(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function stop(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function _create(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],void 0):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function _addToManager(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function _splice(t){for(var e=0;t.length>e;e++){t[e]===this&&t.splice(e,1)}},_destroy:function _destroy(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function _setOption(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function _activate(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function _deactivate(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function _over(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function _out(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function _drop(e,i){var s=i||t.ui.ddmanager.current,o=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&n(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(o=!0,!1):void 0}),o?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function ui(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function _addHoverClass(){this._addClass("ui-droppable-hover")},_removeHoverClass:function _removeHoverClass(){this._removeClass("ui-droppable-hover")},_addActiveClass:function _addActiveClass(){this._addClass("ui-droppable-active")},_removeActiveClass:function _removeActiveClass(){this._removeClass("ui-droppable-active")}});var n=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,l=a+e.helperProportions.height,h=i.offset.left,c=i.offset.top,u=h+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return o>=h&&u>=r&&a>=c&&d>=l;case"intersect":return o+e.helperProportions.width/2>h&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>l-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,h,i.proportions().width);case"touch":return(a>=c&&d>=a||l>=c&&d>=l||c>a&&l>d)&&(o>=h&&u>=o||r>=h&&u>=r||h>o&&r>u);default:return!1;}}}();t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function prepareOffsets(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++){if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++){if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}}},drop:function drop(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&n(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function dragStart(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function drag(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,o,a,r=n(e,this,this.options.tolerance,i),l=!r&&this.isover?"isout":r&&!this.isover?"isover":null;l&&(this.options.greedy&&(o=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===o}),a.length&&(s=t(a[0]).droppable("instance"),s.greedyChild="isover"===l)),s&&"isover"===l&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[l]=!0,this["isout"===l?"isover":"isout"]=!1,this["isover"===l?"_over":"_out"].call(this,i),s&&"isout"===l&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function dragStop(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function _addActiveClass(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function _removeActiveClass(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function _addHoverClass(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function _removeHoverClass(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function _num(t){return parseFloat(t)||0},_isNumber:function _isNumber(t){return!isNaN(parseFloat(t))},_hasScroll:function _hasScroll(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function _create(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function _destroy(){this._mouseDestroy();var e,i=function i(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function _setOption(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles();break;default:}},_setupHandles:function _setupHandles(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++){e=t.trim(s[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o)}this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles){this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])}},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function _removeHandles(){this._handles.remove()},_mouseCapture:function _mouseCapture(e){var i,s,n=!1;for(i in this.handles){s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0)}return!this.options.disabled&&n},_mouseStart:function _mouseStart(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function _mouseDrag(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,l=this._change[o];return this._updatePrevProperties(),l?(i=l.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function _mouseStop(e){this.resizing=!1;var i,s,n,o,a,r,l,h=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,l=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,h.animate||this.element.css(t.extend(a,{top:l,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!h.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function _updatePrevProperties(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function _applyChanges(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function _updateVirtualBoundaries(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function _updateCache(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function _updateRatio(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function _respectSize(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,h=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&h&&(t.left=r-e.minWidth),s&&h&&(t.left=r-e.maxWidth),a&&c&&(t.top=l-e.minHeight),n&&c&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function _getPaddingPlusBorderDimensions(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++){i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0}return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function _proportionallyResize(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++){t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})}},_renderProxy:function _renderProxy(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function e(t,_e){return{width:this.originalSize.width+_e}},w:function w(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function n(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function s(t,e,i){return{height:this.originalSize.height+i}},se:function se(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function sw(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function ne(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function nw(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function _propagate(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function ui(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function stop(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,l={width:i.size.width-r,height:i.size.height-a},h=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,c&&h?{top:c,left:h}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function step(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function start(){var e,i,s,n,o,a,r,l=t(this).resizable("instance"),h=l.options,c=l.element,u=h.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(l.containerElement=t(d),/document/.test(u)||u===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=l._num(e.css("padding"+s))}),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=l.containerOffset,n=l.containerSize.height,o=l.containerSize.width,a=l._hasScroll(d,"left")?d.scrollWidth:o,r=l._hasScroll(d)?d.scrollHeight:n,l.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function resize(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,l=a.containerOffset,h=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=l),h.left<(a._helper?l.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-l.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?l.left:0),h.top<(a._helper?l.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-l.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?l.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-l.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-l.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function stop(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),l=a.outerWidth()-e.sizeDiff.width,h=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:h}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:h})}}),t.ui.plugin.add("resizable","alsoResize",{start:function start(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function resize(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function stop(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function start(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function resize(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function stop(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function resize(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,l="number"==typeof s.grid?[s.grid,s.grid]:s.grid,h=l[0]||1,c=l[1]||1,u=Math.round((n.width-o.width)/h)*h,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=l,_&&(p+=h),v&&(f+=c),g&&(p-=h),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-h)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-h>0?(i.size.width=p,i.position.left=a.left-u):(p=h-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function _create(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function _destroy(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function _mouseStart(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function _mouseDrag(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,l=e.pageY;return o>r&&(i=r,r=o,o=i),a>l&&(i=l,l=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:l-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),h=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?h=!(c.left>r||o>c.right||c.top>l||a>c.bottom):"fit"===n.tolerance&&(h=c.left>o&&r>c.right&&c.top>a&&l>c.bottom),h?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function _mouseStop(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function _isOverAxis(t,e,i){return t>=e&&e+i>t},_isFloating:function _isFloating(t){return /left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function _create(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function _setOption(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function _setHandleClassName(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function _destroy(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--){this.items[t].item.removeData(this.widgetName+"-item")}return this},_mouseCapture:function _mouseCapture(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function _mouseStart(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--){this.containers[n]._trigger("activate",e,this._uiHash(this))}return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function _mouseDrag(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--){if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function _mouseStop(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function cancel(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--){this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function serialize(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function toArray(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function _intersectsWith(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,l=r+t.height,h=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+h>r&&l>s+h,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&l>n-this.helperProportions.height/2},_intersectsWithPointer:function _intersectsWithPointer(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&n;return o?(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1)):!1},_intersectsWithSides:function _intersectsWithSides(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function _getDragVerticalDirection(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function _getDragHorizontalDirection(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function refresh(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function _connectWith(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function _getItemsAsjQuery(e){function i(){r.push(this)}var s,n,o,a,r=[],l=[],h=this._connectWith();if(h&&e)for(s=h.length-1;s>=0;s--){for(o=t(h[s],this.document[0]),n=o.length-1;n>=0;n--){a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&l.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a])}}for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=l.length-1;s>=0;s--){l[s][0].each(i)}return t(r)},_removeCurrentsFromItems:function _removeCurrentsFromItems(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++){if(e[i]===t.item[0])return!1}return!0})},_refreshItems:function _refreshItems(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,l,h,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--){for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--){o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o))}}for(i=u.length-1;i>=0;i--){for(a=u[i][1],r=u[i][0],s=0,h=r.length;h>s;s++){l=t(r[s]),l.data(this.widgetName+"-item",a),c.push({item:l,instance:a,width:0,height:0,left:0,top:0})}}},refreshPositions:function refreshPositions(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--){s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top)}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--){o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function _createPlaceholder(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function element(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function update(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function _createTrPlaceholder(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function _contactContainers(e){var i,s,n,o,a,r,l,h,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--){if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0)}if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),a=c?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--){t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(l=this.items[s].item.offset()[a],h=!1,e[u]-l>this.items[s][r]/2&&(h=!0),n>Math.abs(e[u]-l)&&(n=Math.abs(e[u]-l),o=this.items[s],this.direction=h?"up":"down"))}if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function _createHelper(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function _adjustOffsetFromHelper(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function _getParentOffset(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function _getRelativeOffset(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function _cacheMargins(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function _cacheHelperProportions(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function _setContainment(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function _convertPositionTo(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function _generatePosition(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:r.scrollLeft())}},_rearrange:function _rearrange(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function _clear(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS){("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="")}this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--){e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0)}if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++){n[s].call(this,t)}this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function _trigger(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function _uiHash(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})});(function(factory){if(typeof define==="function"&&define.amd){define("components/adapt-dragndrop/js/jquery.ui.touch-punch",["jquery"],factory)}else{factory(jQuery)}})(function($){$.support.touch="ontouchend"in document;if(!$.support.touch){return}var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,_mouseDestroy=mouseProto._mouseDestroy,touchHandled;console.log(mouseProto._touchStart);function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return}event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent)}mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return}touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,"mouseover");simulateMouseEvent(event,"mousemove");simulateMouseEvent(event,"mousedown")};mouseProto._touchMove=function(event){if(!touchHandled){return}this._touchMoved=true;simulateMouseEvent(event,"mousemove")};mouseProto._touchEnd=function(event){if(!touchHandled){return}simulateMouseEvent(event,"mouseup");simulateMouseEvent(event,"mouseout");if(!this._touchMoved){simulateMouseEvent(event,"click")}touchHandled=false};mouseProto._mouseInit=function(){var self=this;self.element.bind({touchstart:$.proxy(self,"_touchStart"),touchmove:$.proxy(self,"_touchMove"),touchend:$.proxy(self,"_touchEnd")});_mouseInit.call(self)};mouseProto._mouseDestroy=function(){var self=this;self.element.unbind({touchstart:$.proxy(self,"_touchStart"),touchmove:$.proxy(self,"_touchMove"),touchend:$.proxy(self,"_touchEnd")});_mouseDestroy.call(self)};console.log(mouseProto._touchStart)});define("components/adapt-dragndrop/js/dragndropView",["core/js/adapt","core/js/views/questionView","./jquery-ui.min","./jquery.ui.touch-punch"],function(Adapt,QuestionView,JQueryUI,TouchPunch){var DragndropView=QuestionView.extend({events:{"dragcreate .ui-draggable":"onDragCreate","dragstart .ui-draggable":"onDragStart","drag .ui-draggable":"onDrag","dragstop .ui-draggable":"onDragStop","drop .ui-droppable":"onDrop","dropout .ui-droppable":"onDropOut","dropover .ui-droppable":"onDropOver"},setupQuestion:function setupQuestion(){this.containerClass=".dragndrop__widget";this.$scrollElement=$(window);this.animationTime=300;this.animationDelay=100;var possibleAnswers=_.shuffle(this.getAnswers(true));this.model.set("_possibleAnswers",possibleAnswers);_.each(this.model.get("_items"),function(item){if(typeof item.accepted==="string")item.accepted=[item.accepted]})},onQuestionRendered:function onQuestionRendered(){this.setupDragAndDropItems();this.restoreUserAnswer();this.setReadyStatus()},setupDragAndDropItems:function setupDragAndDropItems(){var $draggables=this.$(".dragndrop-answer");var $droppables=this.$(".dragndrop-droppable");$draggables.draggable({containment:this.$(this.containerClass),snap:".ui-state-enabled",snapMode:"inner",snapTolerance:12});var hItem=$draggables.height();$(".dragquestext").each(function(){var text=$(this).html().replace(/&lt;ul&gt;/g,"<ul class=\"bulletoff\">").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&/g,"").replace(/amp;#39;/g,"'").replace(/amp;quot;/g,"\"").replace(/nbsp;/g," ").replace(/copy;/g,"\xA9").replace(/reg;/g,"\xAE").replace(/pound;/g,"\xA3").replace(/cent;/g,"\xA2").replace(/yen;/g,"\xA5").replace(/iquest;/g,"\xBF").replace(/euro;/g,"\u20AC").replace(/trade;/g,"\u2122").replace(/Agrave;/g,"\xC0").replace(/Aacute;/g,"\xC1").replace(/Acirc;/g,"\xC2").replace(/Atilde;/g,"\xC3").replace(/Auml;/g,"\xC4").replace(/Aring;/g,"\xC5").replace(/AElig;/g,"\xC6").replace(/Ccedil;/g,"\xC7").replace(/Egrave;/g,"\xC8").replace(/Eacute;/g,"\xC9").replace(/Ecirc;/g,"\xCA").replace(/Euml;/g,"\xCB").replace(/Igrave;/g,"\xCC").replace(/Iacute;/g,"\xCD").replace(/Icirc;/g,"\xCE").replace(/Iuml;/g,"\xCF").replace(/ETH;/g,"\xD0").replace(/Ntilde;/g,"\xD1").replace(/Ograve;/g,"\xD2").replace(/Oacute;/g,"\xD3").replace(/Ocirc;/g,"\xD4").replace(/Otilde;/g,"\xD5").replace(/Ouml;/g,"\xD6").replace(/times;/g,"\xD7").replace(/Oslash;/g,"\xD8").replace(/Ugrave;/g,"\xD9").replace(/Uacute;/g,"\xDA").replace(/Ucirc;/g,"\xDB").replace(/Uuml;/g,"\xDC").replace(/Yacute;/g,"\xDD").replace(/agrave;/g,"\xE0").replace(/aacute;/g,"\xE1").replace(/acirc;/g,"\xE2").replace(/atilde;/g,"\xE3").replace(/auml;/g,"\xE4").replace(/aring;/g,"\xE5").replace(/aelig;/g,"\xE6").replace(/ccedil;/g,"\xE7").replace(/egrave;/g,"\xE8").replace(/eacute;/g,"\xE9").replace(/ecirc;/g,"\xEA").replace(/euml;/g,"\xEB").replace(/igrave;/g,"\xEC").replace(/iacute;/g,"\xED").replace(/icirc;/g,"\xEE").replace(/iuml;/g,"\xEF").replace(/eth;/g,"\xF0").replace(/ntilde;/g,"\xF1").replace(/ograve;/g,"\xF2").replace(/oacute;/g,"\xF3").replace(/ocirc;/g,"\xF4").replace(/otilde;/g,"\xF5").replace(/ouml;/g,"\xF6").replace(/divide;/g,"\xF7").replace(/oslash;/g,"\xF8").replace(/ugrave;/g,"\xF9").replace(/uacute;/g,"\xFA").replace(/ucirc;/g,"\xFB").replace(/uuml;/g,"\xFC").replace(/yacute;/g,"\xFD").replace(/thorn;/g,"\xFE").replace(/yuml;/g,"\xFF").replace(/ndash;/g,"\u2013").replace(/mdash;/g,"\u2014").replace(/lsquo;/g,"\u2018").replace(/rsquo;/g,"\u2019").replace(/sbquo;/g,"\u201A").replace(/ldquo;/g,"\u201C").replace(/rdquo;/g,"\u201D").replace(/bdquo;/g,"\u201E").replace(/dagger;/g,"\u2020").replace(/Dagger;/g,"\u2021").replace(/amp;/g,"");$(this).html(text)});var $items=this.$(".dragndrop-item");var wMax=this.getMaxWidth($items);$items.width(wMax);var hMax=this.getMaxHeight($items);$droppables.droppable({activeClass:"ui-state-active",tolerance:"intersect"}).height(hMax).css({"line-height":hMax+"px"});$(".dragndrop-droppable").each(function(index,elem){if($(elem).is(":nth-child(2)")){$(this).css({"margin-left":350-wMax+"px"})}else{}});_.each($draggables,function(draggable){var $draggable=$(draggable);$draggable.data({originalPosition:{top:0,left:0},position:$draggable.offset()})})},restoreUserAnswer:function restoreUserAnswer(){if(!this.model.get("_isSubmitted"))return;var answers=this.getAnswers(true);var userAnswers=this.model.get("_userAnswer");var $droppables=this.$(".ui-droppable");var i=-1;if(userAnswers){_.each(this.model.get("_items"),function(item){var accepted=item.accepted;item._userAnswer=[];_.each(accepted,function(){i++;item._userAnswer.push(answers[userAnswers[i]])})});_.each(userAnswers,function(answerIndex,i){if(answerIndex>-1){var answer=answers[answerIndex];var $draggable=this.getDraggableByText(answer);var $droppable=$droppables.eq(i);this.placeDraggable($draggable,$droppable,0)}},this)}this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.showMarking();this.setupFeedback()},getMaxWidth:function getMaxWidth($collection){var wMax=0;for(var i=0;i<$collection.length;i++){var w=$collection.eq(i).width();if(w>wMax)wMax=w}return wMax+1},getMaxHeight:function getMaxHeight($collection){var hMax=0;for(var i=0;i<$collection.length;i++){var h=$collection.eq(i).height();if(h>hMax)hMax=h}return hMax+1},getDraggableByText:function getDraggableByText(text){var draggable=_.find(this.$(".dragndrop-answer"),function(draggable){var $draggable=$(draggable);return $draggable.text()===text});return $(draggable)},getAnswers:function getAnswers(includeDummyAnswers){var answers=[];_.each(this.model.get("_items"),function(item){answers=answers.concat(item.accepted)});if(includeDummyAnswers){var dummyAnswers=this.model.get("dummyAnswers");if(dummyAnswers)answers=answers.concat(dummyAnswers)}return answers},onDragCreate:function onDragCreate(e){var $draggable=$(e.target);$draggable.css({left:0,top:0})},onDragStart:function onDragStart(e,ui){if(!this.model.get("_isEnabled"))return;this.winHeight=this.$scrollElement.height();this.navHeight=$(".navigation").height();var fromDroppable=ui.helper.data("droppable");ui.helper.data("fromDroppable",fromDroppable);this.$(".dragndrop__widget").addClass("dragging");this.$currentDraggable=ui.helper;this.$currentDraggable.removeClass("ui-state-placed")},onDrag:function onDrag(e,ui){var top=ui.offset.top;var st=this.$scrollElement.scrollTop();var diff=st-top+this.navHeight;if(diff>0){this.dragScroll(-10,ui)}else if(st+this.winHeight<top+50){this.dragScroll(10,ui)}else if(this.isScrolling){this.cancelDragScroll()}},dragScroll:function dragScroll(increment,ui){if(this.isScrolling)return;this.isScrolling=true;var $container=this.$(this.containerClass);var containerTop=$container.offset().top;var containerBottom=containerTop+$container.height();this.scrollInterval=setInterval(_.bind(function(){var st=this.$scrollElement.scrollTop();var top=ui.helper.offset().top;if(increment>0){if(top>=containerBottom||st+this.winHeight>=containerBottom){this.cancelDragScroll()}}else{if(top<=containerTop-this.navHeight||st<=containerTop-this.navHeight){this.cancelDragScroll()}}ui.helper.css({top:"+="+increment});this.$scrollElement.scrollTop(st+increment)},this),32)},cancelDragScroll:function cancelDragScroll(){this.isScrolling=false;clearInterval(this.scrollInterval)},onDragStop:function onDragStop(e,ui){this.$(".dragndrop__widget").removeClass("dragging");this.$(".ui-state-hover").removeClass("ui-state-hover");var fromDroppable=ui.helper.data("fromDroppable");if(fromDroppable&&fromDroppable!==this.$currentDroppable){fromDroppable.removeClass("ui-state-disabled").addClass("ui-state-enabled").removeData()}if(!this.$currentDroppable||this.$currentDroppable.is(".ui-state-disabled")){this.resetDraggable();return}setTimeout(function(){ui.helper.addClass("ui-draggable-dragging")},2);setTimeout(function(){ui.helper.removeClass("ui-draggable-dragging")},this.animationTime);var userAnswer=this.$currentDraggable.text();this.$currentDroppable.data("userAnswer",userAnswer);var $question=this.$currentDroppable.parents();var $children=$question.children(".ui-droppable");var questionIndex=$question.index();var numAnswers=$children.length;var item=this.model.get("_items")[questionIndex];if(numAnswers>1){item._userAnswer=_.map($children,function(droppable){return $(droppable).data("userAnswer")})}else{item._userAnswer=[userAnswer]}this.placeDraggable(this.$currentDraggable,this.$currentDroppable,200);this.storeUserAnswer()},onDropOut:function onDropOut(e,ui){$(e.target).removeClass("ui-state-hover");var $droppable=this.$currentDraggable.data("droppable");if($droppable)$droppable.removeClass("ui-state-disabled").addClass("ui-state-enabled");if(this.$currentDroppable&&e.target===this.$currentDroppable[0]){this.$currentDraggable.data("droppable",null);this.$currentDroppable=null}},onDropOver:function onDropOver(e,ui){var $target=$(e.target);if($target.is(".ui-state-disabled"))return;if(this.$currentDroppable)this.$currentDroppable.removeClass("ui-state-hover");$target.addClass("ui-state-hover");this.$currentDroppable=$target},placeDraggable:function placeDraggable($draggable,$droppable,animationTime){if(typeof animationTime!=="number")animationTime=this.animationTime;var animationClass="dragndrop-transition-"+animationTime;$draggable.removeClass("ui-state-placed").addClass(animationClass).offset($droppable.offset());$droppable.removeClass("ui-state-enabled").addClass("ui-state-disabled").data("answer",$draggable.text());var that=this;setTimeout(function(){$draggable.toggleClass("ui-state-placed "+animationClass).data("droppable",$droppable)},animationTime);this.queue=setTimeout(function(){that.$currentDroppable=null},animationTime)},resetDraggable:function resetDraggable($draggable,position,animationTime){$draggable=$draggable||this.$currentDraggable;position=position||$draggable.data().originalPosition;if(animationTime===undefined)animationTime=this.animationTime;if($draggable.data("droppable"))$draggable.data("droppable").addClass("ui-state-enabled");$draggable.animate(position,animationTime).removeClass("ui-state-placed").data("droppable",null)},canSubmit:function canSubmit(){return this.$(".ui-state-enabled").length===0},showMarking:function showMarking(){_.each(this.model.get("_items"),function(item,i){var $question=this.$(".dragndrop-question").eq(i);$question.removeClass("correct incorrect").addClass(item._isCorrect?"correct":"incorrect")},this)},isCorrect:function isCorrect(){this.markAnswers();return!_.contains(_.pluck(this.model.get("_items"),"_isCorrect"),false)},markAnswers:function markAnswers(){var numberOfCorrectAnswers=0;this.model.set("_isAtLeastOneCorrectSelection",false);_.each(this.model.get("_items"),function(item){item._isCorrect=item.accepted.sort().join()===item._userAnswer.sort().join();if(item._isCorrect){numberOfCorrectAnswers++;this.model.set("_numberOfCorrectAnswers",numberOfCorrectAnswers);this.model.set("_isAtLeastOneCorrectSelection",true)}},this)},resetQuestion:function resetQuestion(){this.$(".dragndrop-question").removeClass("correct incorrect");this.$(".ui-droppable").removeClass("ui-state-disabled");_.each(this.$(".ui-state-placed"),function(draggable){this.resetDraggable($(draggable))},this);_.each(this.model.get("_items"),function(item,i){item._isCorrect=false})},hideCorrectAnswer:function hideCorrectAnswer(){this.showAnswer(true)},showCorrectAnswer:function showCorrectAnswer(){this.showAnswer()},disableButtonActions:function disableButtonActions(val){this.$(".btn__action").prop("disabled",val)},showAnswer:function showAnswer(showUserAnswer){var $droppables=this.$(".ui-droppable");var context=this;this.disableButtonActions(true);if(!$droppables.length)return;setTimeout(function(){context.disableButtonActions(false)},this.model.get("animationTime")||300);if(!$droppables.length)return;var items=this.model.get("_items");var dummyAnswers=this.model.get("dummyAnswers")||[];var userAnswers=_.flatten(_.pluck(items,"_userAnswer"));var usedDroppables=[];var toReset=[];var toPlace=[];var toMove=[];_.each(items,function(item,i){var $question=this.$(".dragndrop-question").eq(i);item._userAnswer.sort();item.accepted.sort();if(item._userAnswer.join()!==item.accepted.join()){var itemUserAnswers=_.difference(item._userAnswer,item.accepted);var acceptedAnswers=_.difference(item.accepted,item._userAnswer);var difference=userAnswers.concat(acceptedAnswers);_.each(itemUserAnswers,function(userAnswer,j){var answerPlace=showUserAnswer?userAnswer:acceptedAnswers[j];var answerReset=showUserAnswer?acceptedAnswers[j]:userAnswer;var droppable=_.find($question.children(".ui-droppable"),function(droppable){var answer=$(droppable).data().answer;if(usedDroppables.indexOf(droppable)>-1)return false;usedDroppables.push(droppable);return!showUserAnswer&&item.accepted.indexOf(answer)===-1||showUserAnswer&&item._userAnswer.indexOf(answer)===-1});var $droppable=$(droppable);placeDraggables(answerPlace,answerReset,$droppable,this)},this)}},this);var draggables=toReset.concat(toMove,toPlace);_.each(draggables,function($,i){var delay=this.animationDelay;var t=i*delay;var that=this;setTimeout(function(){$.drop?that.placeDraggable($.drag,$.drop,600):that.resetDraggable($.drag,null,600)},t)},this);function placeDraggables(answerPlace,answerReset,$droppable,instance){var $draggablePlace=instance.getDraggableByText(answerPlace);var $draggableReset=instance.getDraggableByText(answerReset);var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers.indexOf(answerReset)>-1;$draggablePlace.hasClass("ui-state-placed")?toMove.push({drag:$draggablePlace,drop:$droppable}):toPlace.push({drag:$draggablePlace,drop:$droppable});if(isReset)toReset.push({drag:$draggableReset})}},storeUserAnswer:function storeUserAnswer(){var answers=this.getAnswers(true);var $droppables=this.$(".ui-droppable");var userAnswers=_.map($droppables,function(droppable,i){var answer=$droppables.eq(i).data("userAnswer");return answers.indexOf(answer)});this.model.set("_userAnswer",userAnswers)},setScore:function setScore(){var numberOfCorrectAnswers=this.model.get("_numberOfCorrectAnswers")||0;var questionWeight=this.model.get("_questionWeight");var itemLength=this.model.get("_items").length;var score=questionWeight*numberOfCorrectAnswers/itemLength;this.model.set("_score",score)},disableQuestion:function disableQuestion(){this.$(".dragndrop-answers").children().draggable("disable")},enableQuestion:function enableQuestion(){this.$(".dragndrop-answers").children().draggable("enable")}});return DragndropView});define("components/adapt-dragndrop/js/adapt-dragndrop",["core/js/adapt","./dragndropView","core/js/models/questionModel"],function(Adapt,DragndropView,QuestionModel){return Adapt.register("dragndrop",{view:DragndropView,model:QuestionModel})});(function(t){"function"==typeof define&&define.amd?define("components/adapt-dragndropwithimage/js/jquery-ui.min",["jquery"],t):t(jQuery)})(function(t){t.ui=t.ui||{},t.ui.version="1.12.1";var e=0,i=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++){try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},l=e.split(".")[0];e=e.split(".")[1];var h=l+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][h.toLowerCase()]=function(e){return!!t.data(e,h)},t[l]=t[l]||{},n=t[l][e],o=t[l][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(r[e]=s,void 0)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:l,widgetName:e,widgetFullName:h}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var s,n,o=i.call(arguments,1),a=0,r=o.length;r>a;a++){for(s in o[a]){n=o[a][s],o[a].hasOwnProperty(s)&&void 0!==n&&(e[s]=t.isPlainObject(n)?t.isPlainObject(e[s])?t.widget.extend({},e[s],n):t.widget.extend({},n):n)}}return e},t.widget.bridge=function(e,s){var n=s.prototype.widgetFullName||e;t.fn[e]=function(o){var a="string"==typeof o,r=i.call(arguments,1),l=this;return a?this.length||"instance"!==o?this.each(function(){var i,s=t.data(this,n);return"instance"===o?(l=s,!1):s?t.isFunction(s[o])&&"_"!==o.charAt(0)?(i=s[o].apply(s,r),i!==s&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+o+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; "+"attempted to call method '"+o+"'")}):l=void 0:(r.length&&(o=t.widget.extend.apply(null,[o].concat(r))),this.each(function(){var e=t.data(this,n);e?(e.option(o||{}),e._init&&e._init()):t.data(this,n,new s(o,this))})),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function _createWidget(i,s){s=t(s||this.defaultElement||this)[0],this.element=t(s),this.uuid=e++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},s!==this&&(t.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function remove(t){t.target===s&&this.destroy()}}),this.document=t(s.style?s.ownerDocument:s.document||s),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),i),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function _getCreateOptions(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function destroy(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function widget(){return this.element},option:function option(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++){n[s[o]]=n[s[o]]||{},n=n[s[o]]}if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function _setOptions(t){var e;for(e in t){this._setOption(e,t[e])}return this},_setOption:function _setOption(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function _setOptionClasses(e){var i,s,n;for(i in e){n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))}},_setOptionDisabled:function _setOptionDisabled(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function enable(){return this._setOptions({disabled:!1})},disable:function disable(){return this._setOptions({disabled:!0})},_classes:function _classes(e){function i(i,o){var a,r;for(r=0;i.length>r;r++){a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function _untrackClassesElement(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function _removeClass(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function _addClass(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function _toggleClass(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function _on(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var l=s.match(/^([\w:-]*)\s*(.*)$/),h=l[1]+o.eventNamespace,c=l[2];c?n.on(h,c,r):i.on(h,r)})},_off:function _off(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function _delay(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function _hoverable(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function mouseenter(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function mouseleave(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function _focusable(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function focusin(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function focusout(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function _trigger(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o){n in i||(i[n]=o[n])}return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,o=Math.max,a=Math.abs,r=/left|center|right/,l=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function scrollbarWidth(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function getScrollInfo(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function getWithinInfo(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,o=!s&&!n;return{element:i,isWindow:s,isDocument:n,offset:o?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=s(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):l.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=l.test(i[1])?i[1]:"center",t=h.exec(i[0]),e=h.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,l=t(this),h=l.outerWidth(),c=l.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=h+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),T=e(k.my,l.outerWidth(),l.outerHeight());"right"===n.my[0]?D.left-=h:"center"===n.my[0]&&(D.left-=h/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=T[0],D.top+=T[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:h,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+T[0],u[1]+T[1]],my:n.my,at:n.at,within:b,elem:l})}),n.using&&(r=function r(t){var e=g.left-D.left,i=e+p-h,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:l,left:D.left,top:D.top,width:h,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};h>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),l.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function left(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,l=n-r,h=r+e.collisionWidth-a-n;e.collisionWidth>a?l>0&&0>=h?(i=t.left+l+e.collisionWidth-a-n,t.left+=l-i):t.left=h>0&&0>=l?n:l>h?n+a-e.collisionWidth:n:l>0?t.left+=l:h>0?t.left-=h:t.left=o(t.left-r,t.left)},top:function top(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,l=n-r,h=r+e.collisionHeight-a-n;e.collisionHeight>a?l>0&&0>=h?(i=t.top+l+e.collisionHeight-a-n,t.top+=l-i):t.top=h>0&&0>=l?n:l>h?n+a-e.collisionHeight:n:l>0?t.top+=l:h>0?t.top-=h:t.top=o(t.top-r,t.top)}},flip:{left:function left(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,h=t.left-e.collisionPosition.marginLeft,c=h-l,u=h+e.collisionWidth-r-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-r-o,(0>i||a(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-l,(s>0||u>a(s))&&(t.left+=d+p+f))},top:function top(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,l=n.isWindow?n.scrollTop:n.offset.top,h=t.top-e.collisionPosition.marginTop,c=h-l,u=h+e.collisionHeight-r-l,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-r-o,(0>s||a(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-l,(i>0||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function left(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function top(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function enableSelection(){return this.off(".ui-disableSelection")}}),t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var s=!1;t(document).on("mouseup",function(){s=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function _mouseInit(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function _mouseDestroy(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function _mouseDown(e){if(!s){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,n=1===e.which,o="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return n&&!o&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),s=!0,!0)):!0}},_mouseMove:function _mouseMove(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function _mouseUp(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,s=!1,e.preventDefault()},_mouseDistanceMet:function _mouseDistanceMet(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function _mouseDelayMet(){return this.mouseDelayMet},_mouseStart:function _mouseStart(){},_mouseDrag:function _mouseDrag(){},_mouseStop:function _mouseStop(){},_mouseCapture:function _mouseCapture(){return!0}}),t.ui.plugin={add:function add(e,i,s){var n,o=t.ui[e].prototype;for(n in s){o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])}},call:function call(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++){t.options[o[n][0]]&&o[n][1].apply(t.element,i)}}},t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function _create(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function _setOption(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function _destroy(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function _mouseCapture(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function _blockFrames(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function _unblockFrames(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function _blurActiveElement(e){var i=t.ui.safeActiveElement(this.document[0]),s=t(e.target);s.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function _mouseStart(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function _refreshOffsets(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function _mouseDrag(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function _mouseStop(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function _mouseUp(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function cancel(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function _getHandle(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function _setHandleClassName(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function _removeHandleClassName(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function _createHelper(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function _setPositionRelative(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function _adjustOffsetFromHelper(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function _isRootNode(t){return /(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function _getParentOffset(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function _getRelativeOffset(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function _cacheMargins(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function _cacheHelperProportions(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function _setContainment(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function _convertPositionTo(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function _generatePosition(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),l=t.pageX,h=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(l=this.originalPageX),"x"===a.axis&&(h=this.originalPageY)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function _clear(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function _trigger(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function _uiHash(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function start(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function stop(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function drag(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function start(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function stop(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function start(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function stop(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function start(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function drag(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function start(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function drag(e,i,s){var n,o,a,r,l,h,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--){l=s.snapElements[d].left-s.margins.left,h=l+s.snapElements[d].width,c=s.snapElements[d].top-s.margins.top,u=c+s.snapElements[d].height,l-g>_||m>h+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(l-_),r=g>=Math.abs(h-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(l-m),r=g>=Math.abs(h-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}}),t.ui.plugin.add("draggable","stack",{start:function start(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function start(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function stop(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function _create(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],void 0):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function _addToManager(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function _splice(t){for(var e=0;t.length>e;e++){t[e]===this&&t.splice(e,1)}},_destroy:function _destroy(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function _setOption(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function _activate(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function _deactivate(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function _over(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function _out(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function _drop(e,i){var s=i||t.ui.ddmanager.current,o=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&n(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(o=!0,!1):void 0}),o?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function ui(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function _addHoverClass(){this._addClass("ui-droppable-hover")},_removeHoverClass:function _removeHoverClass(){this._removeClass("ui-droppable-hover")},_addActiveClass:function _addActiveClass(){this._addClass("ui-droppable-active")},_removeActiveClass:function _removeActiveClass(){this._removeClass("ui-droppable-active")}});var n=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,l=a+e.helperProportions.height,h=i.offset.left,c=i.offset.top,u=h+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return o>=h&&u>=r&&a>=c&&d>=l;case"intersect":return o+e.helperProportions.width/2>h&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>l-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,h,i.proportions().width);case"touch":return(a>=c&&d>=a||l>=c&&d>=l||c>a&&l>d)&&(o>=h&&u>=o||r>=h&&u>=r||h>o&&r>u);default:return!1;}}}();t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function prepareOffsets(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++){if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++){if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}}},drop:function drop(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&n(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function dragStart(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function drag(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,o,a,r=n(e,this,this.options.tolerance,i),l=!r&&this.isover?"isout":r&&!this.isover?"isover":null;l&&(this.options.greedy&&(o=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===o}),a.length&&(s=t(a[0]).droppable("instance"),s.greedyChild="isover"===l)),s&&"isover"===l&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[l]=!0,this["isout"===l?"isover":"isout"]=!1,this["isover"===l?"_over":"_out"].call(this,i),s&&"isout"===l&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function dragStop(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function _addActiveClass(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function _removeActiveClass(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function _addHoverClass(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function _removeHoverClass(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function _num(t){return parseFloat(t)||0},_isNumber:function _isNumber(t){return!isNaN(parseFloat(t))},_hasScroll:function _hasScroll(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function _create(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function _destroy(){this._mouseDestroy();var e,i=function i(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function _setOption(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles();break;default:}},_setupHandles:function _setupHandles(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++){e=t.trim(s[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o)}this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles){this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])}},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function _removeHandles(){this._handles.remove()},_mouseCapture:function _mouseCapture(e){var i,s,n=!1;for(i in this.handles){s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0)}return!this.options.disabled&&n},_mouseStart:function _mouseStart(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function _mouseDrag(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,l=this._change[o];return this._updatePrevProperties(),l?(i=l.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function _mouseStop(e){this.resizing=!1;var i,s,n,o,a,r,l,h=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,l=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,h.animate||this.element.css(t.extend(a,{top:l,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!h.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function _updatePrevProperties(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function _applyChanges(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function _updateVirtualBoundaries(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function _updateCache(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function _updateRatio(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function _respectSize(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,h=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&h&&(t.left=r-e.minWidth),s&&h&&(t.left=r-e.maxWidth),a&&c&&(t.top=l-e.minHeight),n&&c&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function _getPaddingPlusBorderDimensions(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++){i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0}return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function _proportionallyResize(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++){t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})}},_renderProxy:function _renderProxy(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function e(t,_e2){return{width:this.originalSize.width+_e2}},w:function w(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function n(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function s(t,e,i){return{height:this.originalSize.height+i}},se:function se(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function sw(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function ne(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function nw(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function _propagate(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function ui(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function stop(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,l={width:i.size.width-r,height:i.size.height-a},h=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,c&&h?{top:c,left:h}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function step(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function start(){var e,i,s,n,o,a,r,l=t(this).resizable("instance"),h=l.options,c=l.element,u=h.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(l.containerElement=t(d),/document/.test(u)||u===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=l._num(e.css("padding"+s))}),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=l.containerOffset,n=l.containerSize.height,o=l.containerSize.width,a=l._hasScroll(d,"left")?d.scrollWidth:o,r=l._hasScroll(d)?d.scrollHeight:n,l.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function resize(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,l=a.containerOffset,h=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=l),h.left<(a._helper?l.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-l.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?l.left:0),h.top<(a._helper?l.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-l.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?l.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-l.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-l.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function stop(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),l=a.outerWidth()-e.sizeDiff.width,h=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:h}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:h})}}),t.ui.plugin.add("resizable","alsoResize",{start:function start(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function resize(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function stop(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function start(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function resize(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function stop(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function resize(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,l="number"==typeof s.grid?[s.grid,s.grid]:s.grid,h=l[0]||1,c=l[1]||1,u=Math.round((n.width-o.width)/h)*h,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=l,_&&(p+=h),v&&(f+=c),g&&(p-=h),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-h)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-h>0?(i.size.width=p,i.position.left=a.left-u):(p=h-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function _create(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function _destroy(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function _mouseStart(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function _mouseDrag(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,l=e.pageY;return o>r&&(i=r,r=o,o=i),a>l&&(i=l,l=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:l-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),h=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?h=!(c.left>r||o>c.right||c.top>l||a>c.bottom):"fit"===n.tolerance&&(h=c.left>o&&r>c.right&&c.top>a&&l>c.bottom),h?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function _mouseStop(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function _isOverAxis(t,e,i){return t>=e&&e+i>t},_isFloating:function _isFloating(t){return /left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function _create(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function _setOption(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function _setHandleClassName(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function _destroy(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--){this.items[t].item.removeData(this.widgetName+"-item")}return this},_mouseCapture:function _mouseCapture(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function _mouseStart(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--){this.containers[n]._trigger("activate",e,this._uiHash(this))}return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function _mouseDrag(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--){if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function _mouseStop(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function cancel(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--){this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function serialize(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function toArray(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function _intersectsWith(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,l=r+t.height,h=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+h>r&&l>s+h,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&l>n-this.helperProportions.height/2},_intersectsWithPointer:function _intersectsWithPointer(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&n;return o?(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1)):!1},_intersectsWithSides:function _intersectsWithSides(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function _getDragVerticalDirection(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function _getDragHorizontalDirection(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function refresh(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function _connectWith(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function _getItemsAsjQuery(e){function i(){r.push(this)}var s,n,o,a,r=[],l=[],h=this._connectWith();if(h&&e)for(s=h.length-1;s>=0;s--){for(o=t(h[s],this.document[0]),n=o.length-1;n>=0;n--){a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&l.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a])}}for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=l.length-1;s>=0;s--){l[s][0].each(i)}return t(r)},_removeCurrentsFromItems:function _removeCurrentsFromItems(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++){if(e[i]===t.item[0])return!1}return!0})},_refreshItems:function _refreshItems(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,l,h,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--){for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--){o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o))}}for(i=u.length-1;i>=0;i--){for(a=u[i][1],r=u[i][0],s=0,h=r.length;h>s;s++){l=t(r[s]),l.data(this.widgetName+"-item",a),c.push({item:l,instance:a,width:0,height:0,left:0,top:0})}}},refreshPositions:function refreshPositions(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--){s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top)}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--){o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function _createPlaceholder(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function element(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function update(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function _createTrPlaceholder(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function _contactContainers(e){var i,s,n,o,a,r,l,h,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--){if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0)}if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),a=c?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--){t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(l=this.items[s].item.offset()[a],h=!1,e[u]-l>this.items[s][r]/2&&(h=!0),n>Math.abs(e[u]-l)&&(n=Math.abs(e[u]-l),o=this.items[s],this.direction=h?"up":"down"))}if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function _createHelper(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function _adjustOffsetFromHelper(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function _getParentOffset(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function _getRelativeOffset(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function _cacheMargins(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function _cacheHelperProportions(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function _setContainment(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function _convertPositionTo(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function _generatePosition(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:r.scrollLeft())}},_rearrange:function _rearrange(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function _clear(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS){("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="")}this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--){e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0)}if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++){n[s].call(this,t)}this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function _trigger(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function _uiHash(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})});(function(factory){if(typeof define==="function"&&define.amd){define("components/adapt-dragndropwithimage/js/jquery.ui.touch-punch",["jquery"],factory)}else{factory(jQuery)}})(function($){$.support.touch="ontouchend"in document;if(!$.support.touch){return}var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,_mouseDestroy=mouseProto._mouseDestroy,touchHandled;console.log(mouseProto._touchStart);function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return}event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent)}mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return}touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,"mouseover");simulateMouseEvent(event,"mousemove");simulateMouseEvent(event,"mousedown")};mouseProto._touchMove=function(event){if(!touchHandled){return}this._touchMoved=true;simulateMouseEvent(event,"mousemove")};mouseProto._touchEnd=function(event){if(!touchHandled){return}simulateMouseEvent(event,"mouseup");simulateMouseEvent(event,"mouseout");if(!this._touchMoved){simulateMouseEvent(event,"click")}touchHandled=false};mouseProto._mouseInit=function(){var self=this;self.element.bind({touchstart:$.proxy(self,"_touchStart"),touchmove:$.proxy(self,"_touchMove"),touchend:$.proxy(self,"_touchEnd")});_mouseInit.call(self)};mouseProto._mouseDestroy=function(){var self=this;self.element.unbind({touchstart:$.proxy(self,"_touchStart"),touchmove:$.proxy(self,"_touchMove"),touchend:$.proxy(self,"_touchEnd")});_mouseDestroy.call(self)};console.log(mouseProto._touchStart)});define("components/adapt-dragndropwithimage/js/dragndropwithimageView",["coreJS/adapt","coreViews/questionView","./jquery-ui.min","./jquery.ui.touch-punch"],function(Adapt,QuestionView,JQueryUI,TouchPunch){var DragndropwithimageView=QuestionView.extend({events:{"dragcreate .ui-draggable":"onDragCreate","dragstart .ui-draggable":"onDragStart","drag .ui-draggable":"onDrag","dragstop .ui-draggable":"onDragStop","drop .ui-droppable":"onDrop","dropout .ui-droppable":"onDropOut","dropover .ui-droppable":"onDropOver"},setupQuestion:function setupQuestion(){this.containerClass=".dragndropwi__widget";this.$scrollElement=$(window);this.animationTime=300;this.animationDelay=100;var possibleAnswers=_.shuffle(this.getAnswers(true));this.model.set("_possibleAnswers",possibleAnswers);_.each(this.model.get("_items"),function(item){_.each(item.accepted,function(mraccepted){var accepted=mraccepted.src;if(typeof accepted==="string")accepted=[accepted]})})},onQuestionRendered:function onQuestionRendered(){this.setupDragAndDropItems();this.restoreUserAnswer();this.setReadyStatus()},setupDragAndDropItems:function setupDragAndDropItems(){var $draggables=this.$(".dragndropwi-answer");var $droppables=this.$(".dragndropwi-droppable");$draggables.draggable({containment:this.$(this.containerClass),snap:".ui-state-enabled",snapMode:"inner",snapTolerance:12});var hItem=$draggables.height();$droppables.droppable({activeClass:"ui-state-active",tolerance:"intersect"}).height(hItem);var $items=this.$(".dragndropwi-item");var wMax=this.getMaxWidth($items);$items.width(wMax);_.each($draggables,function(draggable){var $draggable=$(draggable);$draggable.data({originalPosition:{top:0,left:0},position:$draggable.offset()})})},restoreUserAnswer:function restoreUserAnswer(){if(!this.model.get("_isSubmitted"))return;var answers=this.getAnswers(true);var userAnswers=this.model.get("_userAnswer");var $droppables=this.$(".ui-droppable");var i=-1;if(userAnswers){_.each(this.model.get("_items"),function(item){_.each(item.accepted,function(mraccepted){var theaccepted=mraccepted.src});item._userAnswer=[];_.each(item.accepted,function(){i++;item._userAnswer.push(answers[userAnswers[i]])})});_.each(userAnswers,function(answerIndex,i){if(answerIndex>-1){var answer=answers[answerIndex];var $draggable=this.getDraggableByText(answer);var $droppable=$droppables.eq(i);this.placeDraggable($draggable,$droppable,0)}},this)}this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.showMarking();this.setupFeedback()},getMaxWidth:function getMaxWidth($collection){var wMax=0;for(var i=0;i<$collection.length;i++){var w=$collection.eq(i).width();if(w>wMax)wMax=w}return wMax+1},getDraggableByText:function getDraggableByText(text){var draggable=_.find(this.$(".dragndropwi-answer"),function(draggable){var $draggable=$(draggable);return $draggable.text()===text});return $(draggable)},getAnswers:function getAnswers(includeDummyAnswers){var answers=[];_.each(this.model.get("_items"),function(item){_.each(item.accepted,function(mraccepted){var accepted=mraccepted.src;answers=answers.concat(accepted)})});if(includeDummyAnswers){_.each(this.model.get("dummyAnswers"),function(mrdummy){var dummyAnswers=mrdummy.src;if(dummyAnswers)answers=answers.concat(dummyAnswers)})}return answers},onDragCreate:function onDragCreate(e){var $draggable=$(e.target);$draggable.css({left:0,top:0})},onDragStart:function onDragStart(e,ui){if(!this.model.get("_isEnabled"))return;this.winHeight=this.$scrollElement.height();this.navHeight=$(".navigation").height();var fromDroppable=ui.helper.data("droppable");ui.helper.data("fromDroppable",fromDroppable);this.$(".dragndropwi__widget").addClass("dragging");this.$currentDraggable=ui.helper;this.$currentDraggable.removeClass("ui-state-placed")},onDrag:function onDrag(e,ui){var top=ui.offset.top;var st=this.$scrollElement.scrollTop();var diff=st-top+this.navHeight;if(diff>0){this.dragScroll(-10,ui)}else if(st+this.winHeight<top+50){this.dragScroll(10,ui)}else if(this.isScrolling){this.cancelDragScroll()}},dragScroll:function dragScroll(increment,ui){if(this.isScrolling)return;this.isScrolling=true;var $container=this.$(this.containerClass);var containerTop=$container.offset().top;var containerBottom=containerTop+$container.height();this.scrollInterval=setInterval(_.bind(function(){var st=this.$scrollElement.scrollTop();var top=ui.helper.offset().top;if(increment>0){if(top>=containerBottom||st+this.winHeight>=containerBottom){this.cancelDragScroll()}}else{if(top<=containerTop-this.navHeight||st<=containerTop-this.navHeight){this.cancelDragScroll()}}ui.helper.css({top:"+="+increment});this.$scrollElement.scrollTop(st+increment)},this),32)},cancelDragScroll:function cancelDragScroll(){this.isScrolling=false;clearInterval(this.scrollInterval)},onDragStop:function onDragStop(e,ui){this.$(".dragndropwi__widget").removeClass("dragging");this.$(".ui-state-hover").removeClass("ui-state-hover");var fromDroppable=ui.helper.data("fromDroppable");if(fromDroppable&&fromDroppable!==this.$currentDroppable){fromDroppable.removeClass("ui-state-disabled").removeClass("nomorespace").addClass("ui-state-enabled").removeData()}if(!this.$currentDroppable||this.$currentDroppable.is(".ui-state-disabled")){this.resetDraggable();return}setTimeout(function(){ui.helper.addClass("ui-draggable-dragging")},2);setTimeout(function(){ui.helper.removeClass("ui-draggable-dragging")},this.animationTime);var userAnswer=this.$currentDraggable.text();this.$currentDroppable.data("userAnswer",userAnswer);var $question=this.$currentDroppable.parents();var $children=$question.children(".ui-droppable");var questionIndex=$question.index();var numAnswers=$children.length;var item=this.model.get("_items")[questionIndex];if(numAnswers>1){item._userAnswer=_.map($children,function(droppable){return $(droppable).data("userAnswer")})}else{item._userAnswer=[userAnswer]}this.placeDraggable(this.$currentDraggable,this.$currentDroppable,200);this.storeUserAnswer()},onDropOut:function onDropOut(e,ui){$(e.target).removeClass("ui-state-hover");var $droppable=this.$currentDraggable.data("droppable");if($droppable)$droppable.removeClass("ui-state-disabled").removeClass("nomorespace").addClass("ui-state-enabled");if(this.$currentDroppable&&e.target===this.$currentDroppable[0]){this.$currentDraggable.data("droppable",null);this.$currentDroppable=null}},onDropOver:function onDropOver(e,ui){var $target=$(e.target);if($target.is(".ui-state-disabled"))return;if(this.$currentDroppable)this.$currentDroppable.removeClass("ui-state-hover");$target.addClass("ui-state-hover");this.$currentDroppable=$target},placeDraggable:function placeDraggable($draggable,$droppable,animationTime){if(typeof animationTime!=="number")animationTime=this.animationTime;var animationClass="dragndrop-transition-"+animationTime;$draggable.removeClass("ui-state-placed").addClass(animationClass).offset($droppable.offset());$droppable.removeClass("ui-state-enabled").addClass("ui-state-disabled").data("answer",$draggable.text());var that=this;setTimeout(function(){$draggable.toggleClass("ui-state-placed "+animationClass).data("droppable",$droppable)},animationTime);this.queue=setTimeout(function(){that.$currentDroppable=null},animationTime);var component_id=this.model.get("_id");var items=this.model.get("_items");_.each(items,function(item,i){var uniqueitem=$(".dragndropwithimage[data-adapt-id=\""+component_id+"\"] .dragndropwi__inner .dragndropwi-question[data-index=\""+i+"\"] .ui-state-disabled");var uniqueitemnum=uniqueitem.length;var accepted=item.accepted.length;if(uniqueitemnum==accepted){uniqueitem.addClass("nomorespace");uniqueitem.last().css("opacity","0.9")}});var bounceBack=this.model.get("_bounceBack");if(this.bounceBack==true||$(".dragndropwithimage[data-adapt-id=\""+component_id+"\"] .dragndropwi__inner .btn__container").hasClass("bounceback")){var getindex=$droppable.attr("data-index");var myitem0=items[getindex].accepted[0].src;var myuser0=items[getindex]._userAnswer;if(myuser0==myitem0){setTimeout(function(){$(".dragndropwithimage[data-adapt-id=\""+component_id+"\"] .dragndropwi__inner .dragndropwi-question[data-index=\""+getindex+"\"]").addClass("correct");$(".dragndropwithimage[data-adapt-id=\""+component_id+"\"] .dragndropwi__inner .dragndropwi-answer[name=\""+myuser0+"\"]").remove();$(".dragndropwithimage[data-adapt-id=\""+component_id+"\"] .dragndropwi__inner .dragndropwi-question[data-index=\""+getindex+"\"] .ui-state-disabled[data-index=\""+getindex+"\"]").removeAttr("data-index")},animationTime);this.popupCorrect()}else{setTimeout(function(){$(".dragndropwithimage[data-adapt-id=\""+component_id+"\"] .dragndropwi__inner .dragndropwi-question[data-index=\""+getindex+"\"] .dragndropwi-droppable").removeClass("ui-state-disabled").removeClass("nomorespace").addClass("ui-state-enabled");$(".dragndropwithimage[data-adapt-id=\""+component_id+"\"] .dragndropwi__inner .dragndropwi-answer[name=\""+myuser0+"\"]").animate($draggable.data().originalPosition,animationTime).removeClass("ui-state-placed").data("droppable",null)},animationTime);this.popupIncorrect()}}else{}},popupCorrect:function popupCorrect(){this.model.set("_active",false);var countenabled=this.$(".ui-state-enabled").length;var bodyText=this.model.get("_feedback").correct;var titleText=this.model.get("title");var popupObject={title:titleText,body:bodyText};Adapt.trigger("notify:popup",popupObject);if(countenabled===0){this.setCompletionStatus()}},popupIncorrect:function popupIncorrect(){this.model.set("_active",false);var bodyText2=this.model.get("_feedback")._incorrect.notFinal;var titleText2=this.model.get("title");var popupObject2={title:titleText2,body:bodyText2};Adapt.trigger("notify:popup",popupObject2)},resetDraggable:function resetDraggable($draggable,position,animationTime){$draggable=$draggable||this.$currentDraggable;position=position||$draggable.data().originalPosition;if(animationTime===undefined)animationTime=this.animationTime;if($draggable.data("droppable"))$draggable.data("droppable").addClass("ui-state-enabled");$draggable.animate(position,animationTime).removeClass("ui-state-placed").data("droppable",null)},canSubmit:function canSubmit(){return this.$(".ui-state-enabled").length===0},showMarking:function showMarking(){_.each(this.model.get("_items"),function(item,i){var $question=this.$(".dragndropwi-question").eq(i);$question.removeClass("correct incorrect").addClass(item._isCorrect?"correct":"incorrect")},this)},isCorrect:function isCorrect(){this.markAnswers();return!_.contains(_.pluck(this.model.get("_items"),"_isCorrect"),false)},markAnswers:function markAnswers(){var numberOfCorrectAnswers=0;var myownid=this.model.get("_id");this.model.set("_isAtLeastOneCorrectSelection",false);_.each(this.model.get("_items"),function(item){var answers=[];_.each(item.accepted,function(mraccepted){var checkaccepted=mraccepted.src;answers=answers.concat(checkaccepted);$(".dragndropwithimage[data-adapt-id=\""+myownid+"\"] .dragndropwi__inner .dragndropwi-item[name*=\""+checkaccepted+"\"]").addClass("dragcharm").text("For \n"+item.text);item._isCorrect=answers.sort().join()===item._userAnswer.sort().join();if(item._isCorrect){numberOfCorrectAnswers++;this.model.set("_numberOfCorrectAnswers",numberOfCorrectAnswers);this.model.set("_isAtLeastOneCorrectSelection",true)}},this)},this)},resetQuestion:function resetQuestion(){this.$(".dragndropwi-question").removeClass("correct incorrect");this.$(".ui-droppable").removeClass("ui-state-disabled").removeClass("nomorespace");var myownid=this.model.get("_id");_.each(this.$(".ui-state-placed"),function(draggable){this.resetDraggable($(draggable))},this);_.each(this.model.get("_items"),function(item,i){item._isCorrect=false;_.each(item.accepted,function(mraccepted){var accepted=mraccepted.src;$(".dragndropwithimage[data-adapt-id=\""+myownid+"\"] .dragndropwi__inner .dragndropwi-item[name*=\""+accepted+"\"]").removeClass("dragcharm").text(accepted)})})},hideCorrectAnswer:function hideCorrectAnswer(){this.showAnswer(true)},showCorrectAnswer:function showCorrectAnswer(){this.showAnswer()},disableButtonActions:function disableButtonActions(val){this.$(".btn__action").prop("disabled",val)},showAnswer:function showAnswer(showUserAnswer){var $droppables=this.$(".ui-droppable");var context=this;this.disableButtonActions(true);if(!$droppables.length)return;setTimeout(function(){context.disableButtonActions(false)},this.model.get("animationTime")||300);if(!$droppables.length)return;var items=this.model.get("_items");var countdummy=this.model.get("dummyAnswers").length;if(countdummy==1){var dummyAnswers0=this.model.get("dummyAnswers")[0].src||[]}else if(countdummy==2){var dummyAnswers0=this.model.get("dummyAnswers")[0].src||[];var dummyAnswers1=this.model.get("dummyAnswers")[1].src||[]}else if(countdummy==3){var dummyAnswers0=this.model.get("dummyAnswers")[0].src||[];var dummyAnswers1=this.model.get("dummyAnswers")[1].src||[];var dummyAnswers2=this.model.get("dummyAnswers")[2].src||[]}else if(countdummy==4){var dummyAnswers0=this.model.get("dummyAnswers")[0].src||[];var dummyAnswers1=this.model.get("dummyAnswers")[1].src||[];var dummyAnswers2=this.model.get("dummyAnswers")[2].src||[];var dummyAnswers3=this.model.get("dummyAnswers")[3].src||[]}else if(countdummy==5){var dummyAnswers0=this.model.get("dummyAnswers")[0].src||[];var dummyAnswers1=this.model.get("dummyAnswers")[1].src||[];var dummyAnswers2=this.model.get("dummyAnswers")[2].src||[];var dummyAnswers3=this.model.get("dummyAnswers")[3].src||[];var dummyAnswers4=this.model.get("dummyAnswers")[4].src||[]}else if(countdummy==6){var dummyAnswers0=this.model.get("dummyAnswers")[0].src||[];var dummyAnswers1=this.model.get("dummyAnswers")[1].src||[];var dummyAnswers2=this.model.get("dummyAnswers")[2].src||[];var dummyAnswers3=this.model.get("dummyAnswers")[3].src||[];var dummyAnswers4=this.model.get("dummyAnswers")[4].src||[];var dummyAnswers5=this.model.get("dummyAnswers")[5].src||[]}else if(countdummy==7){var dummyAnswers0=this.model.get("dummyAnswers")[0].src||[];var dummyAnswers1=this.model.get("dummyAnswers")[1].src||[];var dummyAnswers2=this.model.get("dummyAnswers")[2].src||[];var dummyAnswers3=this.model.get("dummyAnswers")[3].src||[];var dummyAnswers4=this.model.get("dummyAnswers")[4].src||[];var dummyAnswers5=this.model.get("dummyAnswers")[5].src||[];var dummyAnswers6=this.model.get("dummyAnswers")[6].src||[]}else if(countdummy==8){var dummyAnswers0=this.model.get("dummyAnswers")[0].src||[];var dummyAnswers1=this.model.get("dummyAnswers")[1].src||[];var dummyAnswers2=this.model.get("dummyAnswers")[2].src||[];var dummyAnswers3=this.model.get("dummyAnswers")[3].src||[];var dummyAnswers4=this.model.get("dummyAnswers")[4].src||[];var dummyAnswers5=this.model.get("dummyAnswers")[5].src||[];var dummyAnswers6=this.model.get("dummyAnswers")[6].src||[];var dummyAnswers7=this.model.get("dummyAnswers")[7].src||[]}else if(countdummy==9){var dummyAnswers0=this.model.get("dummyAnswers")[0].src||[];var dummyAnswers1=this.model.get("dummyAnswers")[1].src||[];var dummyAnswers2=this.model.get("dummyAnswers")[2].src||[];var dummyAnswers3=this.model.get("dummyAnswers")[3].src||[];var dummyAnswers4=this.model.get("dummyAnswers")[4].src||[];var dummyAnswers5=this.model.get("dummyAnswers")[5].src||[];var dummyAnswers6=this.model.get("dummyAnswers")[6].src||[];var dummyAnswers7=this.model.get("dummyAnswers")[7].src||[];var dummyAnswers8=this.model.get("dummyAnswers")[8].src||[]}else if(countdummy==10){var dummyAnswers0=this.model.get("dummyAnswers")[0].src||[];var dummyAnswers1=this.model.get("dummyAnswers")[1].src||[];var dummyAnswers2=this.model.get("dummyAnswers")[2].src||[];var dummyAnswers3=this.model.get("dummyAnswers")[3].src||[];var dummyAnswers4=this.model.get("dummyAnswers")[4].src||[];var dummyAnswers5=this.model.get("dummyAnswers")[5].src||[];var dummyAnswers6=this.model.get("dummyAnswers")[6].src||[];var dummyAnswers7=this.model.get("dummyAnswers")[7].src||[];var dummyAnswers8=this.model.get("dummyAnswers")[8].src||[];var dummyAnswers9=this.model.get("dummyAnswers")[9].src||[]}var userAnswers=_.flatten(_.pluck(items,"_userAnswer"));var usedDroppables=[];var toReset=[];var toPlace=[];var toMove=[];_.each(items,function(item,i){var $question=this.$(".dragndropwi-question").eq(i);var answers=[];_.each(item.accepted,function(mraccepted){var checkaccepted=mraccepted.src;answers=answers.concat(checkaccepted);answers.sort();item._userAnswer.sort();if(item._userAnswer.join()!==answers.join()){var itemUserAnswers=_.difference(item._userAnswer,answers);var acceptedAnswers=_.difference(answers,item._userAnswer);var difference=userAnswers.concat(acceptedAnswers);_.each(itemUserAnswers,function(userAnswer,j){var answerPlace=showUserAnswer?userAnswer:acceptedAnswers[j];var answerReset=showUserAnswer?acceptedAnswers[j]:userAnswer;var droppable=_.find($question.children(".ui-droppable"),function(droppable){var answer=$(droppable).data().answer;if(usedDroppables.indexOf(droppable)>-1)return false;usedDroppables.push(droppable);return!showUserAnswer&&answers.indexOf(answer)===-1||showUserAnswer&&item._userAnswer.indexOf(answer)===-1});var $droppable=$(droppable);placeDraggables(answerPlace,answerReset,$droppable,this)},this)}},this)},this);var draggables=toReset.concat(toMove,toPlace);_.each(draggables,function($,i){var delay=this.animationDelay;var t=i*delay;var that=this;setTimeout(function(){$.drop?that.placeDraggable($.drag,$.drop,600):that.resetDraggable($.drag,null,600)},t)},this);function placeDraggables(answerPlace,answerReset,$droppable,instance){var $draggablePlace=instance.getDraggableByText(answerPlace);var $draggableReset=instance.getDraggableByText(answerReset);if(countdummy==1){var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers0.indexOf(answerReset)>-1}else if(countdummy==2){var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers0.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers1.indexOf(answerReset)>-1}else if(countdummy==3){var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers0.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers1.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers2.indexOf(answerReset)>-1}else if(countdummy==4){var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers0.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers1.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers2.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers3.indexOf(answerReset)>-1}else if(countdummy==5){var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers0.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers1.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers2.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers3.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers4.indexOf(answerReset)>-1}else if(countdummy==6){var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers0.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers1.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers2.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers3.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers4.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers5.indexOf(answerReset)>-1}else if(countdummy==7){var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers0.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers1.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers2.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers3.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers4.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers5.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers6.indexOf(answerReset)>-1}else if(countdummy==8){var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers0.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers1.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers2.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers3.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers4.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers5.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers6.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers7.indexOf(answerReset)>-1}else if(countdummy==9){var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers0.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers1.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers2.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers3.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers4.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers5.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers6.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers7.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers8.indexOf(answerReset)>-1}else if(countdummy==10){var isReset=showUserAnswer&&userAnswers.indexOf(answerReset)===-1||!showUserAnswer&&dummyAnswers0.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers1.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers2.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers3.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers4.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers5.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers6.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers7.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers8.indexOf(answerReset)>-1||!showUserAnswer&&dummyAnswers9.indexOf(answerReset)>-1}$draggablePlace.hasClass("ui-state-placed")?toMove.push({drag:$draggablePlace,drop:$droppable}):toPlace.push({drag:$draggablePlace,drop:$droppable});if(isReset)toReset.push({drag:$draggableReset})}},storeUserAnswer:function storeUserAnswer(){var answers=this.getAnswers(true);var $droppables=this.$(".ui-droppable");var userAnswers=_.map($droppables,function(droppable,i){var answer=$droppables.eq(i).data("userAnswer");return answers.indexOf(answer)});this.model.set("_userAnswer",userAnswers)},setScore:function setScore(){var numberOfCorrectAnswers=this.model.get("_numberOfCorrectAnswers")||0;var questionWeight=this.model.get("_questionWeight");var itemLength=this.model.get("_items").length;var score=questionWeight*numberOfCorrectAnswers/itemLength;this.model.set("_score",score)},disableQuestion:function disableQuestion(){this.$(".dragndropwi-answers").children().draggable("disable")},enableQuestion:function enableQuestion(){this.$(".dragndropwi-answers").children().draggable("enable")}});return DragndropwithimageView});define("components/adapt-dragndropwithimage/js/adapt-dragndropwithimage",["core/js/adapt","./dragndropwithimageView","core/js/models/questionModel"],function(Adapt,DragndropwithimageView,QuestionModel){return Adapt.register("dragndropwithimage",{view:DragndropwithimageView,model:QuestionModel})});define("components/adapt-iframe/js/adapt-iframe",["core/js/adapt","core/js/views/componentView"],function(Adapt,ComponentView){var iFrameComponent=ComponentView.extend({postRender:function postRender(){var $iframe=this.$("iframe");_.bindAll(this,"onIframeLoaded","onMessage","onInview");$iframe.on("load",this.onIframeLoaded);this.listenTo(Adapt,"device:resize",this.onResize);switch(this.model.get("_setCompletionOn")){case"message":window.addEventListener("message",this.onMessage);break;case"inview":default:$iframe.on("inview",this.onInview);}},onIframeLoaded:function onIframeLoaded(){this.iframeContents=this.$("iframe").contents();var delegateSelector=this.model.get("_dimensionDelegateSelector");if(delegateSelector){this.$dimensionDelegate=$(this.iframeContents.find(delegateSelector));this.model.set({"_initialWidth":this.$dimensionDelegate.width(),"_initialHeight":this.$dimensionDelegate.height()})}this.onResize();this.setReadyStatus()},aspectRatio:function aspectRatio(){var width=this.model.get("_initialWidth");var height=this.model.get("_initialHeight");return width&&height?height/width:0.56},width:function width(){return this.$(".iframe-container").width()},height:function height(){return this.width()*this.aspectRatio()},dimensions:function dimensions(){return{width:this.width(),height:this.height()}},onResize:function onResize(){if(!this.iframeContents)return;var dimensions=this.dimensions();this.$("iframe").css(dimensions);if(this.$dimensionDelegate)this.$dimensionDelegate.css(dimensions)},onMessage:function onMessage(event){if(event.data!=="complete")return;this.setCompletionStatus();window.removeEventListener("message",this.onMessage)},onInview:function onInview(event,visible,visiblePartX,visiblePartY){if(!visible)return;switch(visiblePartY){case"top":this.hasSeenTop=true;break;case"bottom":this.hasSeenBottom=true;break;case"both":this.hasSeenTop=true;this.hasSeenBottom=true;}if(!this.hasSeenTop||!this.hasSeenBottom)return;this.$("iframe").off("inview",this.onInview);this.setCompletionStatus()}});return Adapt.register("iframe",iFrameComponent)});define("components/adapt-imageSlider/js/adapt-image-slider",["core/js/models/componentModel","core/js/views/componentView","core/js/adapt"],function(ComponentModel,ComponentView,Adapt){var ImageSlider=ComponentView.extend({events:{"click .next":"onNextClick","click .previous":"onPreviousClick","click .progress":"onProgressClick"},onNextClick:function onNextClick(event){if(this._activeIndex+1>=this.itemCount){return}this._activeIndex++;if($("html").hasClass("accessibility")){this.$(".imgslide-title").attr("tabindex","-1");this.$(".imgslide-alt").attr("tabindex","-1");this.$(".imgslide-title[data-index=\""+this._activeIndex+"\"]").attr("tabindex","0").focus();this.$(".imgslide-alt[data-index=\""+this._activeIndex+"\"]").attr("tabindex","0")}else{}this.moveSlide()},onPreviousClick:function onPreviousClick(event){if(this._activeIndex-1<0){return}this._activeIndex--;if($("html").hasClass("accessibility")){this.$(".imgslide-title").attr("tabindex","-1");this.$(".imgslide-alt").attr("tabindex","-1");this.$(".imgslide-title[data-index=\""+this._activeIndex+"\"]").attr("tabindex","0").focus();this.$(".imgslide-alt[data-index=\""+this._activeIndex+"\"]").attr("tabindex","0")}else{}this.moveSlide()},onProgressClick:function onProgressClick(event){var index=$(event.currentTarget).attr("data-index");this._activeIndex=parseInt(index);this.moveSlide()},moveSlide:function moveSlide(){var offset=100/this.itemCount*this._activeIndex*-1;var value="translateX("+offset+"%)";this.prefixHelper(this.imageSliderElm,"Transform",value);this.prefixHelper(this.titleSliderElm,"Transform",value);this.imageSliderElm.style.transform=value;this.titleSliderElm.style.transform=value;this.controllButtons();this.controllIndicators()},controllButtons:function controllButtons(){this.checkCompletion();var showPrevBtn=true;var showNextBtn=true;if(this._activeIndex===0){showPrevBtn=false}if(this._activeIndex>=this.itemCount-1){showNextBtn=false}this.$el.toggleClass("show-next",showNextBtn);this.$el.toggleClass("show-prev",showPrevBtn)},controllIndicators:function controllIndicators(){this.$(".indicator").find(".progress").removeClass("selected");this.$(".indicator").find("[data-index=\""+this._activeIndex+"\"]").addClass("selected")},checkCompletion:function checkCompletion(){if(this.model.get("_isComplete"))return;var items=this.model.get("_items");items[this._activeIndex]._isVisited=true;var visited=0;for(var i=0;i<items.length;i++){if(items[i]._isVisited){visited++}}if(visited>=this.itemCount){this.setCompletionStatus()}},preRender:function preRender(){this.checkIfResetOnRevisit();this._activeIndex=0;this.itemCount=this.model.get("_items").length;this.model.set("_totalWidth",100*this.itemCount);this.model.set("_itemWidth",100/this.itemCount)},postRender:function postRender(){this.imageSliderElm=this.$(".image-slider")[0];this.titleSliderElm=this.$(".title-slider")[0];this.controllButtons();this.controllIndicators();this.$(".graphic__widget").imageready(_.bind(function(){this.setReadyStatus()},this));if($("html").hasClass("accessibility")){this.$(".imgslide-title[data-index=\"0\"]").attr("tabindex","0").focus();this.$(".imgslide-alt[data-index=\"0\"]").attr("tabindex","0")}else{}},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},prefixHelper:function prefixHelper(elm,prop,val){elm.style["webkit"+prop]=val;elm.style["moz"+prop]=val;elm.style["ms"+prop]=val;elm.style["o"+prop]=val}});Adapt.register("imageSlider",{model:ComponentModel.extend({}),view:ImageSlider});return ImageSlider});define("components/adapt-list/js/adapt-list",["core/js/adapt","core/js/views/componentView","core/js/models/componentModel"],function(Adapt,ComponentView,ComponentModel){var ListView=ComponentView.extend({preRender:function preRender(){this.checkIfResetOnRevisit()},postRender:function postRender(){this.setReadyStatus();this.setupInviewCompletion(".component__widget");if(!this.model.get("_animateList"))return;this.$el.addClass("is-animated-list");this.$(".list__container").on("onscreen.animate",this.checkIfOnScreen.bind(this))},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},checkIfOnScreen:function checkIfOnScreen(event,measurements){var percentage=this.model.get("_percentInviewVertical")?this.model.get("_percentInviewVertical"):70;if(measurements.percentFromTop>=percentage)return;$(event.currentTarget).addClass("is-inview").off("onscreen.animate");this.animateListItems()},animateListItems:function animateListItems(){this.$(".list__item").each(function(index,listItem){setTimeout(function(){$(listItem).addClass("is-animating")},200*index)})},remove:function remove(){this.$(".list__container").off("onscreen.animate");ComponentView.prototype.remove.call(this)}},{template:"list"});return Adapt.register("list",{model:ComponentModel.extend({}),view:ListView})});define("components/adapt-notify-imagegrid/js/adapt-notify-imagegrid",["core/js/models/componentModel","core/js/views/componentView","core/js/adapt"],function(ComponentModel,ComponentView,Adapt){var Notifyimagegrid=ComponentView.extend({preRender:function preRender(){this.listenTo(Adapt,"device:changed",this.resizeControl);this.setDeviceSize();this.checkIfResetOnRevisit()},events:function events(){return Adapt.device.touch==true?{"inview":"inview","click button":"gridnotifyPopup"}:{"inview":"inview","mouseover button":"gridnotifyPopup"}},setDeviceSize:function setDeviceSize(){if(Adapt.device.screenSize==="large"){this.$el.addClass("desktop").removeClass("mobile");this.model.set("_isDesktop",true)}else{this.$el.addClass("mobile").removeClass("desktop");this.model.set("_isDesktop",false)}},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},inview:function inview(event,visible,visiblePartX,visiblePartY){if(visible){if(visiblePartY==="top"){this._isVisibleTop=true}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(this._isVisibleTop&&this._isVisibleBottom){this.$(".component__widget").off("inview");this.completePopup()}}},remove:function remove(){this.$(".component__widget").off("inview");ComponentView.prototype.remove.apply(this,arguments)},postRender:function postRender(){this.setUpColumns();this.$(".notify-imagegrid__widget").imageready(_.bind(function(){this.setReadyStatus();this.$(".component__widget").on("inview",_.bind(this.inview,this))},this));this.reverseDirection();this.constrainHeight()},resizeControl:function resizeControl(){this.setDeviceSize();this.render()},reverseDirection:function reverseDirection(){if(this.model.get("_reverseDirection")&&this.model.get("_isEnabled")){this.$(".notify-imagegrid-grid-inner").addClass("reverserow")}},constrainHeight:function constrainHeight(){var rowheight=this.model.get("_gridrowHeight")._heightAmount;if(this.model.get("_gridrowHeight")._constrainHeight&&this.model.get("_isEnabled")){this.$(".notify-imagegrid-item-image img").addClass("constrainimg");this.$(".constrainimg").css({"max-height":rowheight+"px","min-height":rowheight+"px"})}},setUpColumns:function setUpColumns(){var columns=this.model.get("_columns");if(columns&&Adapt.device.screenSize==="large"){var griditempercent=100/columns;var gridminuspad=5/columns;this.$(".notify-imagegrid-grid-item").css("width",griditempercent+"%")}},completePopup:function completePopup(){var mycurrentid="."+this.model.get("_id");var howmanygridimg=$(mycurrentid+" .howmanygrid").length;var howmanystr=$(mycurrentid+" .totalgrid").text();if(howmanystr>=howmanygridimg){this.setCompletionStatus()}else if(howmanygridimg==0){this.setCompletionStatus()}},gridnotifyPopup:function gridnotifyPopup(event){event.preventDefault();this.model.set("_active",false);var mycurrentid="."+this.model.get("_id");var howmanygridimg=$(mycurrentid+" .howmanygrid").length;var howmanystr=$(mycurrentid+" .totalgrid").text();if(howmanystr>=howmanygridimg){this.setCompletionStatus()}else if(howmanygridimg==0){this.setCompletionStatus()}}},{template:"notify-imagegrid"});Adapt.register("notify-imagegrid",{model:ComponentModel.extend({}),view:Notifyimagegrid});return Notifyimagegrid});define("components/adapt-pageNav/js/model",["core/js/adapt","core/js/models/componentModel"],function(Adapt,ComponentModel){var Model=ComponentModel.extend({defaults:function defaults(){return $.extend({},_.result(ComponentModel.prototype,"defaults"),{_isOptional:true,_isComplete:true,_isInteractionComplete:true,_pageLevelProgress:{_isEnabled:false}})},getData:function getData(){var data=_.extend(this.toJSON(),{_items:this.getNavigationData()});return data},getNavigationData:function getNavigationData(){var buttonTypeModels={_returnToPreviousLocation:this.getReturnToPreviousLocation(),_page:this.getCurrentPage(),_up:this.getCurrentMenu(),_root:Adapt.course,_next:this.getNextPage(),_previous:this.getPrevPage(),_sibling:this.getSiblingPages(),_close:new Backbone.Model({_id:"",_onClick:"top.window.close();"})};var data=[];var buttons=this.get("_buttons");if(!buttons){return data}var order=0;var item;var currentPageComplete=buttonTypeModels._page.get("_isComplete");for(var attrName in buttons){var buttonConfig=buttons[attrName];var buttonModel=buttonTypeModels[attrName];if(attrName==="_sibling"){if(buttonModel.length<=1)continue;_.each(buttonModel,function(model,index){item=model.toJSON();_.extend(item,buttonConfig,{type:attrName,index:index,order:order++,locked:item._isLocked||buttonConfig._lockUntilPageComplete&&!currentPageComplete});data.push(item)});continue}if(buttonConfig._customRouteId)buttonModel=Adapt.findById(buttonConfig._customRouteId);item=buttonModel?buttonModel.toJSON():{"_isHidden":true};_.extend(item,buttonConfig,{type:attrName,index:0,order:order++,locked:item._isLocked||buttonConfig._lockUntilPageComplete&&!currentPageComplete});data.push(item)}var orderedData=_.sortBy(data,"_order");orderedData.forEach(function(item,index){item._index=index});return orderedData},getReturnToPreviousLocation:function getReturnToPreviousLocation(){return Adapt.location._previousId?Adapt.findById(Adapt.location._previousId):null},getCurrentPage:function getCurrentPage(){var parents=this.getAncestorModels?this.getAncestorModels():this.getParents().models;for(var i=0,l=parents.length;i<l;i++){var model=parents[i];switch(model.get("_type")){case"page":return model;}}},getCurrentMenu:function getCurrentMenu(){var parents=this.getAncestorModels?this.getAncestorModels():this.getParents().models;for(var i=0,l=parents.length;i<l;i++){var model=parents[i];switch(model.get("_type")){case"menu":case"course":return model;}}},getSiblingPages:function getSiblingPages(){var currentMenu=this.getCurrentMenu();var siblingModels=currentMenu.getAllDescendantModels(true);siblingModels=_.filter(siblingModels,function(model){return model.get("_type")==="page"&&model.get("_isAvailable")});return siblingModels},getPrevPage:function getPrevPage(){var currentPage=this.getCurrentPage();var currentPageId=currentPage.get("_id");var pages=this.getPages();var hasFoundCurrentPage=false;for(var i=pages.length-1;i>-1;i--){var page=pages[i];var isNotAvailable=!page.get("_isAvailable");if(isNotAvailable)continue;if(!hasFoundCurrentPage&&page.get("_id")===currentPageId){hasFoundCurrentPage=true;continue}if(hasFoundCurrentPage){return page}}return},getNextPage:function getNextPage(){var currentPage=this.getCurrentPage();var currentPageId=currentPage.get("_id");var pages=this.getPages();var hasFoundCurrentPage=false;for(var i=0,l=pages.length;i<l;i++){var page=pages[i];var isNotAvailable=!page.get("_isAvailable");if(isNotAvailable)continue;if(!hasFoundCurrentPage&&page.get("_id")===currentPageId){hasFoundCurrentPage=true;continue}if(hasFoundCurrentPage){return page}}return},getPages:function getPages(){var loopStyle=this.get("_loopStyle");if(!loopStyle)return[];var loop=false;var descendants;switch(loopStyle){case"allPages":loop=true;descendants=Adapt.course.getAllDescendantModels(true);break;case"siblings":loop=true;default:var currentMenu=this.getCurrentMenu();descendants=currentMenu.getAllDescendantModels(true);}if(loop){descendants=descendants.concat(descendants)}return _.filter(descendants,function(model){return model.get("_type")==="page"})}});return Model});define("components/adapt-pageNav/js/tooltip",["core/js/adapt"],function(Adapt){var Tooltip=Backbone.View.extend({className:"pagenav__tooltip",initialize:function initialize(options){this.removeOtherTooltips();this.setupEventListeners();this.setupData(options);this.render()},removeOtherTooltips:function removeOtherTooltips(){Adapt.trigger("tooltip:remove");Adapt.tooltip=this},setupEventListeners:function setupEventListeners(){_.bindAll(this,"remove","postRender","show");this.show=_.debounce(this.show,17);$(document).on("mouseover",this.remove);this.listenTo(Adapt,{"device:resize":this.checkPosition,"tooltip:remove":this.remove,remove:this.remove})},setupData:function setupData(options){this.$target=options.$target;this.id=this.$target.attr("data-id");this.type=this.$target.attr("data-type");this.index=this.$target.attr("data-index");this.model.set("tooltip",this.$target.attr("tooltip"))},render:function render(){var template=Handlebars.templates["pageNav-tooltip"];this.$el.html(template(this.model.toJSON()));_.defer(this.postRender)},postRender:function postRender(){if(this.isRemoved)return;this.checkPosition();this.show()},checkPosition:function checkPosition(){if(this.isRemoved)return;var buttonPosition=this.$target.position();var buttonWidth=this.$target.outerWidth(true);var buttonHalfWidth=buttonWidth/2;var buttonCenterLeft=buttonPosition.left+buttonHalfWidth;var tooltipWidth=this.$el.outerWidth(true);var tooltipHalfWidth=tooltipWidth/2;var tooltipCenter={top:buttonPosition.top,left:buttonCenterLeft};var $offsetParent=this.$el.offsetParent();var parentWidth=$offsetParent.innerWidth();var overflowRight=parentWidth-(tooltipCenter.left+tooltipHalfWidth);var overflowLeft=tooltipCenter.left-tooltipHalfWidth;var isOverflowingRight=overflowRight<0;var isOverflowingLeft=overflowLeft<0;var leftOffset=isOverflowingRight?overflowRight:isOverflowingLeft?-overflowLeft:0;this.$el.css({top:tooltipCenter.top,left:tooltipCenter.left+leftOffset});this.$el.find(".pagenav__triangle").css({left:tooltipHalfWidth-leftOffset})},show:function show(){if(this.isRemoved)return;this.$el.addClass("show")},remove:function remove(){this.isRemoved=true;delete this.$target;delete Adapt.tooltip;$(document).off("mouseover",this.onBodyMouseOver);Backbone.View.prototype.remove.call(this)}});return Tooltip});define("components/adapt-pageNav/js/view",["core/js/adapt","core/js/views/componentView","./tooltip"],function(Adapt,ComponentView,Tooltip){function getAttributes($node){var attrs={};_.each($node[0].attributes,function(attribute){attrs[attribute.name]=attribute.value});return attrs}var View=ComponentView.extend({events:{"click .js-pagenav-btn":"onButtonClick","mouseover .js-pagenav-btn":"onButtonTooltip"},preRender:function preRender(){Adapt.trigger(this.constructor.type+"View:preRender",this);this.$el.addClass("pagenav "+this.model.get("_id"));_.bindAll(this,"postRender","checkButtonStates");this.setCompletionStatus();this.listenTo(Adapt,"remove",this.remove);this.listenTo(Adapt.contentObjects,{"change:_isComplete change:_isLocked":this.onContentObjectComplete})},render:function render(){var template=Handlebars.templates.pageNav;var data=this.model.getData();this.$el.html(template(data));Adapt.trigger(this.constructor.type+"View:render",this);_.defer(this.postRender)},postRender:function postRender(){Adapt.trigger(this.constructor.type+"View:postRender",this);this.checkButtonStates();this.setReadyStatus()},onContentObjectComplete:function onContentObjectComplete(){_.defer(this.checkButtonStates)},checkButtonStates:function checkButtonStates(){this.$("button").each(function(index,item){this.checkButtonState(item)}.bind(this))},checkButtonState:function checkButtonState(button){var $button=$(button);var id=$button.attr("data-id");var index=$button.attr("data-item-index");if(!id)return;var items=this.model.getNavigationData();var data=items[index];var $buttonRendered=$(Handlebars.partials["pageNav-item"](data));if($buttonRendered.length===0){$button.remove();return}var renderedAttrs=getAttributes($buttonRendered);var attrs=getAttributes($button);var renderedAttrNames=_.keys(renderedAttrs);var attrNames=_.keys(attrs);var removeAttrNames=_.difference(attrNames,renderedAttrNames);removeAttrNames.forEach(function(name){$button.removeAttr(name)});$button.attr(renderedAttrs);$button.html($buttonRendered.html())},onButtonClick:function onButtonClick(event){var $target=$(event.currentTarget);var isLocked=$target.hasClass("is-locked");var isSelected=$target.hasClass("is-selected");if(isLocked||isSelected)return;var id=$target.attr("data-id");var index=$target.attr("data-item-index");switch(id){case"":var data=this.model.getData();try{var execute=new Function(data._items[index]._onClick||"");execute()}catch(err){Adapt.log.error(err)}break;default:this.navigateTo(id);break;}},onButtonTooltip:function onButtonTooltip(event){var $target=$(event.currentTarget);var id=$target.attr("data-id")||this.model.getCurrentPage().get("_id");if(!id){return}if(!$target.attr("tooltip")){return}event.stopPropagation();if(Adapt.tooltip){var type=$target.attr("data-type");var index=$target.attr("data-index");var isCurrentTooltip=Adapt.tooltip.type===type&&Adapt.tooltip.index===index;if(isCurrentTooltip){return}}var tooltip=new Tooltip({$target:$target,model:Adapt.findById(id)});this.$(".pagenav__tooltip-container").append(tooltip.$el)},navigateTo:function navigateTo(id){var isCourse=id===Adapt.course.get("_id");var hash="#"+(isCourse?"/":"/id/"+id);Backbone.history.navigate(hash,{trigger:true,replace:false})}});return View});define("components/adapt-pageNav/js/adapt-pageNav",["core/js/adapt","./model","./view"],function(Adapt,Model,View){return Adapt.register("pageNav",{model:Model,view:View})});(function(window){function classReg(className){return new RegExp("(^|\\s+)"+className+"(\\s+|$)")}var hasClass,addClass,removeClass;if("classList"in document.documentElement){hasClass=function hasClass(elem,c){return elem.classList.contains(c)};addClass=function addClass(elem,c){elem.classList.add(c)};removeClass=function removeClass(elem,c){elem.classList.remove(c)}}else{hasClass=function hasClass(elem,c){return classReg(c).test(elem.className)};addClass=function addClass(elem,c){if(!hasClass(elem,c)){elem.className=elem.className+" "+c}};removeClass=function removeClass(elem,c){elem.className=elem.className.replace(classReg(c)," ")}}function toggleClass(elem,c){var fn=hasClass(elem,c)?removeClass:addClass;fn(elem,c)}var classie={hasClass:hasClass,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,has:hasClass,add:addClass,remove:removeClass,toggle:toggleClass};if(typeof define==="function"&&define.amd){define("classie/classie",classie)}else{window.classie=classie}})(window);(function(){function EventEmitter(){}var proto=EventEmitter.prototype;function indexOfListener(listeners,listener){var i=listeners.length;while(i--){if(listeners[i].listener===listener){return i}}return-1}function alias(name){return function aliasClosure(){return this[name].apply(this,arguments)}}proto.getListeners=function getListeners(evt){var events=this._getEvents();var response;var key;if(_typeof(evt)==="object"){response={};for(key in events){if(events.hasOwnProperty(key)&&evt.test(key)){response[key]=events[key]}}}else{response=events[evt]||(events[evt]=[])}return response};proto.flattenListeners=function flattenListeners(listeners){var flatListeners=[];var i;for(i=0;i<listeners.length;i+=1){flatListeners.push(listeners[i].listener)}return flatListeners};proto.getListenersAsObject=function getListenersAsObject(evt){var listeners=this.getListeners(evt);var response;if(listeners instanceof Array){response={};response[evt]=listeners}return response||listeners};proto.addListener=function addListener(evt,listener){var listeners=this.getListenersAsObject(evt);var listenerIsWrapped=_typeof(listener)==="object";var key;for(key in listeners){if(listeners.hasOwnProperty(key)&&indexOfListener(listeners[key],listener)===-1){listeners[key].push(listenerIsWrapped?listener:{listener:listener,once:false})}}return this};proto.on=alias("addListener");proto.addOnceListener=function addOnceListener(evt,listener){return this.addListener(evt,{listener:listener,once:true})};proto.once=alias("addOnceListener");proto.defineEvent=function defineEvent(evt){this.getListeners(evt);return this};proto.defineEvents=function defineEvents(evts){for(var i=0;i<evts.length;i+=1){this.defineEvent(evts[i])}return this};proto.removeListener=function removeListener(evt,listener){var listeners=this.getListenersAsObject(evt);var index;var key;for(key in listeners){if(listeners.hasOwnProperty(key)){index=indexOfListener(listeners[key],listener);if(index!==-1){listeners[key].splice(index,1)}}}return this};proto.off=alias("removeListener");proto.addListeners=function addListeners(evt,listeners){return this.manipulateListeners(false,evt,listeners)};proto.removeListeners=function removeListeners(evt,listeners){return this.manipulateListeners(true,evt,listeners)};proto.manipulateListeners=function manipulateListeners(remove,evt,listeners){var i;var value;var single=remove?this.removeListener:this.addListener;var multiple=remove?this.removeListeners:this.addListeners;if(_typeof(evt)==="object"&&!(evt instanceof RegExp)){for(i in evt){if(evt.hasOwnProperty(i)&&(value=evt[i])){if(typeof value==="function"){single.call(this,i,value)}else{multiple.call(this,i,value)}}}}else{i=listeners.length;while(i--){single.call(this,evt,listeners[i])}}return this};proto.removeEvent=function removeEvent(evt){var type=_typeof(evt);var events=this._getEvents();var key;if(type==="string"){delete events[evt]}else if(type==="object"){for(key in events){if(events.hasOwnProperty(key)&&evt.test(key)){delete events[key]}}}else{delete this._events}return this};proto.emitEvent=function emitEvent(evt,args){var listeners=this.getListenersAsObject(evt);var listener;var i;var key;var response;for(key in listeners){if(listeners.hasOwnProperty(key)){i=listeners[key].length;while(i--){listener=listeners[key][i];response=listener.listener.apply(this,args||[]);if(response===this._getOnceReturnValue()||listener.once===true){this.removeListener(evt,listener.listener)}}}}return this};proto.trigger=alias("emitEvent");proto.emit=function emit(evt){var args=Array.prototype.slice.call(arguments,1);return this.emitEvent(evt,args)};proto.setOnceReturnValue=function setOnceReturnValue(value){this._onceReturnValue=value;return this};proto._getOnceReturnValue=function _getOnceReturnValue(){if(this.hasOwnProperty("_onceReturnValue")){return this._onceReturnValue}else{return true}};proto._getEvents=function _getEvents(){return this._events||(this._events={})};if(typeof define==="function"&&define.amd){define("eventEmitter/EventEmitter",[],function(){return EventEmitter})}else if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&module.exports){module.exports=EventEmitter}else{this.EventEmitter=EventEmitter}}).call(this);(function(window){var docElem=document.documentElement;var bind=function bind(){};if(docElem.addEventListener){bind=function bind(obj,type,fn){obj.addEventListener(type,fn,false)}}else if(docElem.attachEvent){bind=function bind(obj,type,fn){obj[type+fn]=fn.handleEvent?function(){var event=window.event;event.target=event.target||event.srcElement;fn.handleEvent.call(fn,event)}:function(){var event=window.event;event.target=event.target||event.srcElement;fn.call(obj,event)};obj.attachEvent("on"+type,obj[type+fn])}}var unbind=function unbind(){};if(docElem.removeEventListener){unbind=function unbind(obj,type,fn){obj.removeEventListener(type,fn,false)}}else if(docElem.detachEvent){unbind=function unbind(obj,type,fn){obj.detachEvent("on"+type,obj[type+fn]);try{delete obj[type+fn]}catch(err){obj[type+fn]=undefined}}}var eventie={bind:bind,unbind:unbind};if(typeof define==="function"&&define.amd){define("eventie/eventie",eventie)}else{window.eventie=eventie}})(this);(function(window){var prefixes="Webkit Moz ms Ms O".split(" ");var docElemStyle=document.documentElement.style;function getStyleProperty(propName){if(!propName){return}if(typeof docElemStyle[propName]==="string"){return propName}propName=propName.charAt(0).toUpperCase()+propName.slice(1);var prefixed;for(var i=0,len=prefixes.length;i<len;i++){prefixed=prefixes[i]+propName;if(typeof docElemStyle[prefixed]==="string"){return prefixed}}}if(typeof define==="function"&&define.amd){define("get-style-property/get-style-property",[],function(){return getStyleProperty})}else{window.getStyleProperty=getStyleProperty}})(window);(function(window,undefined){var defView=document.defaultView;var getStyle=defView&&defView.getComputedStyle?function(elem){return defView.getComputedStyle(elem,null)}:function(elem){return elem.currentStyle};function getStyleSize(value){var num=parseFloat(value);var isValid=value.indexOf("%")===-1&&!isNaN(num);return isValid&&num}var measurements=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];function getZeroSize(){var size={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0};for(var i=0,len=measurements.length;i<len;i++){var measurement=measurements[i];size[measurement]=0}return size}function defineGetSize(getStyleProperty){var boxSizingProp=getStyleProperty("boxSizing");var isBoxSizeOuter;(function(){if(!boxSizingProp){return}var div=document.createElement("div");div.style.width="200px";div.style.padding="1px 2px 3px 4px";div.style.borderStyle="solid";div.style.borderWidth="1px 2px 3px 4px";div.style[boxSizingProp]="border-box";var body=document.body||document.documentElement;body.appendChild(div);var style=getStyle(div);isBoxSizeOuter=getStyleSize(style.width)===200;body.removeChild(div)})();function getSize(elem){if(typeof elem==="string"){elem=document.querySelector(elem)}if(!elem||_typeof(elem)!=="object"||!elem.nodeType){return}var style=getStyle(elem);if(style.display==="none"){return getZeroSize()}var size={};size.width=elem.offsetWidth;size.height=elem.offsetHeight;var isBorderBox=size.isBorderBox=!!(boxSizingProp&&style[boxSizingProp]&&style[boxSizingProp]==="border-box");for(var i=0,len=measurements.length;i<len;i++){var measurement=measurements[i];var value=style[measurement];var num=parseFloat(value);size[measurement]=!isNaN(num)?num:0}var paddingWidth=size.paddingLeft+size.paddingRight;var paddingHeight=size.paddingTop+size.paddingBottom;var marginWidth=size.marginLeft+size.marginRight;var marginHeight=size.marginTop+size.marginBottom;var borderWidth=size.borderLeftWidth+size.borderRightWidth;var borderHeight=size.borderTopWidth+size.borderBottomWidth;var isBorderBoxSizeOuter=isBorderBox&&isBoxSizeOuter;var styleWidth=getStyleSize(style.width);if(styleWidth!==false){size.width=styleWidth+(isBorderBoxSizeOuter?0:paddingWidth+borderWidth)}var styleHeight=getStyleSize(style.height);if(styleHeight!==false){size.height=styleHeight+(isBorderBoxSizeOuter?0:paddingHeight+borderHeight)}size.innerWidth=size.width-(paddingWidth+borderWidth);size.innerHeight=size.height-(paddingHeight+borderHeight);size.outerWidth=size.width+marginWidth;size.outerHeight=size.height+marginHeight;return size}return getSize}if(typeof define==="function"&&define.amd){define("get-size/get-size",["get-style-property/get-style-property"],defineGetSize)}else{window.getSize=defineGetSize(window.getStyleProperty)}})(window);(function(window){var document=window.document;function extend(a,b){for(var prop in b){a[prop]=b[prop]}return a}function noop(){}var defView=document.defaultView;var getStyle=defView&&defView.getComputedStyle?function(elem){return defView.getComputedStyle(elem,null)}:function(elem){return elem.currentStyle};var isElement=(typeof HTMLElement==="undefined"?"undefined":_typeof(HTMLElement))==="object"?function isElementDOM2(obj){return obj instanceof HTMLElement}:function isElementQuirky(obj){return obj&&_typeof(obj)==="object"&&obj.nodeType===1&&typeof obj.nodeName==="string"};var lastTime=0;var prefixes="webkit moz ms o".split(" ");var requestAnimationFrame=window.requestAnimationFrame;var cancelAnimationFrame=window.cancelAnimationFrame;var prefix;for(var i=0;i<prefixes.length;i++){if(requestAnimationFrame&&cancelAnimationFrame){break}prefix=prefixes[i];requestAnimationFrame=requestAnimationFrame||window[prefix+"RequestAnimationFrame"];cancelAnimationFrame=cancelAnimationFrame||window[prefix+"CancelAnimationFrame"]||window[prefix+"CancelRequestAnimationFrame"]}if(!requestAnimationFrame||!cancelAnimationFrame){requestAnimationFrame=function requestAnimationFrame(callback){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id};cancelAnimationFrame=function cancelAnimationFrame(id){window.clearTimeout(id)}}function draggabillyDefinition(classie,EventEmitter,eventie,getStyleProperty,getSize){var transformProperty=getStyleProperty("transform");var is3d=!!getStyleProperty("perspective");function Draggabilly(element,options){this.element=typeof element==="string"?document.querySelector(element):element;this.options=extend({},this.options);extend(this.options,options);this._create()}extend(Draggabilly.prototype,EventEmitter.prototype);Draggabilly.prototype.options={};Draggabilly.prototype._create=function(){this.position={};this._getPosition();this.startPoint={x:0,y:0};this.dragPoint={x:0,y:0};this.startPosition=extend({},this.position);var style=getStyle(this.element);if(style.position!=="relative"&&style.position!=="absolute"){this.element.style.position="relative"}this.enable();this.setHandles()};Draggabilly.prototype.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element];this.bindHandles(true)};Draggabilly.prototype.bindHandles=function(isBind){var binder;if(window.navigator.pointerEnabled){binder=this.bindPointer}else if(window.navigator.msPointerEnabled){binder=this.bindMSPointer}else{binder=this.bindMouseTouch}isBind=isBind===undefined?true:!!isBind;for(var i=0,len=this.handles.length;i<len;i++){var handle=this.handles[i];binder.call(this,handle,isBind)}};Draggabilly.prototype.bindPointer=function(handle,isBind){var bindMethod=isBind?"bind":"unbind";eventie[bindMethod](handle,"pointerdown",this);handle.style.touchAction=isBind?"none":""};Draggabilly.prototype.bindMSPointer=function(handle,isBind){var bindMethod=isBind?"bind":"unbind";eventie[bindMethod](handle,"MSPointerDown",this);handle.style.msTouchAction=isBind?"none":""};Draggabilly.prototype.bindMouseTouch=function(handle,isBind){var bindMethod=isBind?"bind":"unbind";eventie[bindMethod](handle,"mousedown",this);eventie[bindMethod](handle,"touchstart",this);if(isBind){disableImgOndragstart(handle)}};function noDragStart(){return false}var isIE8=("attachEvent"in document.documentElement);var disableImgOndragstart=!isIE8?noop:function(handle){if(handle.nodeName==="IMG"){handle.ondragstart=noDragStart}var images=handle.querySelectorAll("img");for(var i=0,len=images.length;i<len;i++){var img=images[i];img.ondragstart=noDragStart}};Draggabilly.prototype._getPosition=function(){var style=getStyle(this.element);var x=parseInt(style.left,10);var y=parseInt(style.top,10);this.position.x=isNaN(x)?0:x;this.position.y=isNaN(y)?0:y;this._addTransformPosition(style)};Draggabilly.prototype._addTransformPosition=function(style){if(!transformProperty){return}var transform=style[transformProperty];if(transform.indexOf("matrix")!==0){return}var matrixValues=transform.split(",");var xIndex=transform.indexOf("matrix3d")===0?12:4;var translateX=parseInt(matrixValues[xIndex],10);var translateY=parseInt(matrixValues[xIndex+1],10);this.position.x+=translateX;this.position.y+=translateY};Draggabilly.prototype.handleEvent=function(event){var method="on"+event.type;if(this[method]){this[method](event)}};Draggabilly.prototype.getTouch=function(touches){for(var i=0,len=touches.length;i<len;i++){var touch=touches[i];if(touch.identifier===this.pointerIdentifier){return touch}}};Draggabilly.prototype.onmousedown=function(event){var button=event.button;if(button&&button!==0&&button!==1){return}this.dragStart(event,event)};Draggabilly.prototype.ontouchstart=function(event){if(this.isDragging){return}this.dragStart(event,event.changedTouches[0])};Draggabilly.prototype.onMSPointerDown=Draggabilly.prototype.onpointerdown=function(event){if(this.isDragging){return}this.dragStart(event,event)};function setPointerPoint(point,pointer){point.x=pointer.pageX!==undefined?pointer.pageX:pointer.clientX;point.y=pointer.pageY!==undefined?pointer.pageY:pointer.clientY}var postStartEvents={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"],MSPointerDown:["MSPointerMove","MSPointerUp","MSPointerCancel"]};Draggabilly.prototype.dragStart=function(event,pointer){if(!this.isEnabled){return}if(event.preventDefault){event.preventDefault()}else{event.returnValue=false}this.pointerIdentifier=pointer.pointerId!==undefined?pointer.pointerId:pointer.identifier;this._getPosition();this.measureContainment();setPointerPoint(this.startPoint,pointer);this.startPosition.x=this.position.x;this.startPosition.y=this.position.y;this.setLeftTop();this.dragPoint.x=0;this.dragPoint.y=0;this._bindEvents({events:postStartEvents[event.type],node:event.preventDefault?window:document});classie.add(this.element,"is-dragging");this.isDragging=true;this.emitEvent("dragStart",[this,event,pointer]);this.animate()};Draggabilly.prototype._bindEvents=function(args){for(var i=0,len=args.events.length;i<len;i++){var event=args.events[i];eventie.bind(args.node,event,this)}this._boundEvents=args};Draggabilly.prototype._unbindEvents=function(){var args=this._boundEvents;if(!args||!args.events){return}for(var i=0,len=args.events.length;i<len;i++){var event=args.events[i];eventie.unbind(args.node,event,this)}delete this._boundEvents};Draggabilly.prototype.measureContainment=function(){var containment=this.options.containment;if(!containment){return}this.size=getSize(this.element);var elemRect=this.element.getBoundingClientRect();var container=isElement(containment)?containment:typeof containment==="string"?document.querySelector(containment):this.element.parentNode;this.containerSize=getSize(container);var containerRect=container.getBoundingClientRect();this.relativeStartPosition={x:elemRect.left-containerRect.left,y:elemRect.top-containerRect.top}};Draggabilly.prototype.onmousemove=function(event){this.dragMove(event,event)};Draggabilly.prototype.onMSPointerMove=Draggabilly.prototype.onpointermove=function(event){if(event.pointerId===this.pointerIdentifier){this.dragMove(event,event)}};Draggabilly.prototype.ontouchmove=function(event){var touch=this.getTouch(event.changedTouches);if(touch){this.dragMove(event,touch)}};Draggabilly.prototype.dragMove=function(event,pointer){setPointerPoint(this.dragPoint,pointer);var dragX=this.dragPoint.x-this.startPoint.x;var dragY=this.dragPoint.y-this.startPoint.y;var grid=this.options.grid;var gridX=grid&&grid[0];var gridY=grid&&grid[1];dragX=applyGrid(dragX,gridX);dragY=applyGrid(dragY,gridY);dragX=this.containDrag("x",dragX,gridX);dragY=this.containDrag("y",dragY,gridY);dragX=this.options.axis==="y"?0:dragX;dragY=this.options.axis==="x"?0:dragY;this.position.x=this.startPosition.x+dragX;this.position.y=this.startPosition.y+dragY;this.dragPoint.x=dragX;this.dragPoint.y=dragY;this.emitEvent("dragMove",[this,event,pointer])};function applyGrid(value,grid,method){method=method||"round";return grid?Math[method](value/grid)*grid:value}Draggabilly.prototype.containDrag=function(axis,drag,grid){if(!this.options.containment){return drag}var measure=axis==="x"?"width":"height";var rel=this.relativeStartPosition[axis];var min=applyGrid(-rel,grid,"ceil");var max=this.containerSize[measure]-rel-this.size[measure];max=applyGrid(max,grid,"floor");return Math.min(max,Math.max(min,drag))};Draggabilly.prototype.onmouseup=function(event){this.dragEnd(event,event)};Draggabilly.prototype.onMSPointerUp=Draggabilly.prototype.onpointerup=function(event){if(event.pointerId===this.pointerIdentifier){this.dragEnd(event,event)}};Draggabilly.prototype.ontouchend=function(event){var touch=this.getTouch(event.changedTouches);if(touch){this.dragEnd(event,touch)}};Draggabilly.prototype.dragEnd=function(event,pointer){this.isDragging=false;delete this.pointerIdentifier;if(transformProperty){this.element.style[transformProperty]="";this.setLeftTop()}this._unbindEvents();classie.remove(this.element,"is-dragging");this.emitEvent("dragEnd",[this,event,pointer])};Draggabilly.prototype.onMSPointerCancel=Draggabilly.prototype.onpointercancel=function(event){if(event.pointerId===this.pointerIdentifier){this.dragEnd(event,event)}};Draggabilly.prototype.ontouchcancel=function(event){var touch=this.getTouch(event.changedTouches);this.dragEnd(event,touch)};Draggabilly.prototype.animate=function(){if(!this.isDragging){return}this.positionDrag();var _this=this;requestAnimationFrame(function animateFrame(){_this.animate()})};var translate=is3d?function(x,y){return"translate3d( "+x+"px, "+y+"px, 0)"}:function(x,y){return"translate( "+x+"px, "+y+"px)"};Draggabilly.prototype.setLeftTop=function(){this.element.style.left=this.position.x+"px";this.element.style.top=this.position.y+"px"};Draggabilly.prototype.positionDrag=transformProperty?function(){this.element.style[transformProperty]=translate(this.dragPoint.x,this.dragPoint.y)}:Draggabilly.prototype.setLeftTop;Draggabilly.prototype.enable=function(){this.isEnabled=true};Draggabilly.prototype.disable=function(){this.isEnabled=false;if(this.isDragging){this.dragEnd()}};Draggabilly.prototype.destroy=function(){this.disable();if(transformProperty){this.element.style[transformProperty]=""}this.element.style.left="";this.element.style.top="";this.element.style.position="";this.bindHandles(false)};return Draggabilly}if(typeof define==="function"&&define.amd){define("components/adapt-ppq/js/draggabilly",["classie/classie","eventEmitter/EventEmitter","eventie/eventie","get-style-property/get-style-property","get-size/get-size"],draggabillyDefinition)}else if((typeof exports==="undefined"?"undefined":_typeof(exports))==="object"){module.exports=draggabillyDefinition(require("desandro-classie"),require("wolfy87-eventemitter"),require("eventie"),require("desandro-get-style-property"),require("get-size"))}else{window.Draggabilly=draggabillyDefinition(window.classie,window.EventEmitter,window.eventie,window.getStyleProperty,window.getSize)}})(window);define("components/adapt-ppq/js/round",[],function(){return function(value,exp){if(typeof exp==="undefined"||+exp===0)return Math.round(value);value=+value;exp=+exp;if(isNaN(value)||!(typeof exp==="number"&&exp%1===0))return NaN;value=value.toString().split("e");value=Math.round(+(value[0]+"e"+(value[1]?+value[1]+exp:exp)));value=value.toString().split("e");return+(value[0]+"e"+(value[1]?+value[1]-exp:-exp))}});define("components/adapt-ppq/js/ppqView",["core/js/adapt","core/js/views/questionView","./draggabilly","./round"],function(Adapt,QuestionView,Draggabilly,round){var PpqView=QuestionView.extend({events:{"click .ppq-pinboard":"onPinboardClicked"},render:function render(){QuestionView.prototype.render.apply(this,arguments);this.setupPinboardImage(Adapt.device.screenSize);this.setupCorrectZones();this.addPinViews();if(this.model.get("_isSubmitted"))this.showMarking();this.checkCompatibility();return this},addPinViews:function addPinViews(){var userAnswer=_.extend([],this.model.get("_userAnswer"));var isDesktop=Adapt.device.screenSize!="small";if(this.model.get("_isSubmitted")&&userAnswer.length>0){userAnswer.shift()}for(var i=0,l=this.model.get("_maxSelection");i<l;i++){var pin=new PinView;pin.setPosition(userAnswer[i*2]/100,userAnswer[i*2+1]/100);this._pinViews.push(pin);this.$(".ppq-boundary").append(pin.$el)}},resetQuestionOnRevisit:function resetQuestionOnRevisit(type){this.setAllItemsEnabled(true);this.resetQuestion()},setupQuestion:function setupQuestion(){if(!this.model.has("_minSelection"))this.model.set("_minSelection",1);this.model.set("_maxSelection",Math.max(this.model.get("_maxSelection")||0,this.model.get("_items").length));this._pinViews=[];this.model.restoreUserAnswers()},setupPinboardImage:function setupPinboardImage(screenSize){var imageObj=screenSize=="small"?this.model.get("_pinboardMobile"):this.model.get("_pinboardDesktop");if(imageObj){this.$("img.ppq-pinboard").attr({"src":imageObj.src,"alt":imageObj.alt,"title":imageObj.title})}},setupCorrectZones:function setupCorrectZones(){var props,isDesktop=Adapt.device.screenSize!="small";_.each(this.model.get("_items"),function(item,index){props=isDesktop?item.desktop:item.mobile;this.$(".ppq-correct-zone").eq(index).css({left:props.left+"%",top:props.top+"%",width:props.width+"%",height:props.height+"%"})},this)},restoreUserAnswers:function restoreUserAnswers(){if(!this.model.get("_isSubmitted"))return;this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.showMarking();this.setupFeedback()},disableQuestion:function disableQuestion(){this.setAllItemsEnabled(false)},enableQuestion:function enableQuestion(){this.setAllItemsEnabled(true)},setAllItemsEnabled:function setAllItemsEnabled(isEnabled){_.each(this._pinViews,function(pin){if(pin.dragObj){isEnabled?pin.dragObj.enable():pin.dragObj.disable()}})},updatePinPositions:function updatePinPositions(){var $pinboard=this.$(".ppq-pinboard");var boardw=$pinboard.width();var boardh=$pinboard.height();var pin,pos;for(var i=0,l=this._pinViews.length;i<l;i++){pin=this._pinViews[i];pos=pin.getPosition();if(pos){pin.$el.css({left:boardw*pos.percentX/100-pin.$el.width()/2,top:boardh*pos.percentY/100-pin.$el.height()})}}},onQuestionRendered:function onQuestionRendered(){var $pinboardContainerInner=this.$(".ppq-pinboard-container-inner");$pinboardContainerInner.imageready(_.bind(function(){for(var i=0,l=this._pinViews.length;i<l;i++){var pin=this._pinViews[i];pin.dragObj=new Draggabilly(pin.el,{containment:$pinboardContainerInner});if(!this.model.get("_isEnabled"))pin.dragObj.disable();pin.dragObj.on("dragStart",_.bind(this.onDragStart,this,pin));pin.dragObj.on("dragEnd",_.bind(this.onDragEnd,this,pin))}this.setReadyStatus()},this));this.listenTo(Adapt,"device:changed",this.onDeviceChanged);this.listenTo(Adapt,"device:resize",this.updatePinPositions)},onDeviceChanged:function onDeviceChanged(screenSize){this.setupPinboardImage(screenSize);this.setupCorrectZones();if(this.model.get("_resetPinsOnPinboardChange")){if(this.model.get("_isSubmitted")){this.checkCompatibility();this.$(".ppq-other-device").toggleClass("display-none",!this.model.get("_showOtherDeviceCompletionMessage"));this.$(".ppq-pinboard-container, .buttons").toggleClass("display-none",this.model.get("_showOtherDeviceCompletionMessage"))}else{this.resetPins()}}else{this.updatePinPositions()}},checkCompatibility:function checkCompatibility(){var isSubmitted=this.model.get("_isSubmitted");if(!isSubmitted)return;var isDesktop=Adapt.device.screenSize!="small",isUserAnswerDesktop=this.model.get("_userAnswer")[0]===1,resetPinsOnPinboardChange=this.model.get("_resetPinsOnPinboardChange");if(isSubmitted&&isDesktop!=isUserAnswerDesktop&&resetPinsOnPinboardChange){this.model.set("_showOtherDeviceCompletionMessage",true)}else{this.model.set("_showOtherDeviceCompletionMessage",false)}},getNextUnusedPin:function getNextUnusedPin(){for(var i=0,l=this._pinViews.length;i<l;i++){if(!this._pinViews[i].$el.is(".in-use"))return this._pinViews[i]}return null},onPinboardClicked:function onPinboardClicked(event){event.preventDefault();var pin=this.getNextUnusedPin();if(!pin||this.$(".component__widget").is(".disabled"))return;var offset=this.$(".ppq-pinboard").offset();var $pinboard=this.$(".ppq-pinboard");var boardw=$pinboard.width();var boardh=$pinboard.height();var x=event.pageX-offset.left;var y=event.pageY-offset.top;var percentX=100*x/boardw;var percentY=100*y/boardh;pin.$el.css({left:x-pin.$el.width()/2,top:y-pin.$el.height()});pin.setPosition(percentX,percentY)},canSubmit:function canSubmit(){return this.$(".ppq-pin.in-use").length>=this.model.get("_minSelection")},storeUserAnswer:function storeUserAnswer(){var userAnswer=[Adapt.device.screenSize=="small"?0:1];var pin,pos;for(var i=0,l=this._pinViews.length;i<l;i++){pin=this._pinViews[i];pos=pin.getPosition();if(pos)userAnswer.push(round(pos.percentX*100,-2),round(pos.percentY*100,-2))}this.model.set("_userAnswer",userAnswer)},isCorrect:function isCorrect(){var items=this.model.get("_items");var userAnswer=this.model.get("_userAnswer");var isDesktop=userAnswer[0];var map=new Array(items.length);for(var i=1,l=userAnswer.length;i<l;i+=2){var itemIndex=this.getIndexOfItem(userAnswer[i]/100,userAnswer[i+1]/100,isDesktop);if(itemIndex!=-1)map[itemIndex]=true}this.model.get("_isAtLeastOneCorrectSelection",_.indexOf(map,true)!=-1);return _.compact(map).length==items.length},isPartlyCorrect:function isPartlyCorrect(){return this.model.get("_isAtLeastOneCorrectSelection")},setScore:function setScore(){var questionWeight=this.model.get("_questionWeight");var answeredCorrectly=this.model.get("_isCorrect");var score=answeredCorrectly?questionWeight:0;this.model.set("_score",score)},showMarking:function showMarking(){if(!this.model.get("_canShowMarking"))return;var map=new Array(this.model.get("_items").length);for(var i=0,l=this._pinViews.length;i<l;i++){var pin=this._pinViews[i];var pos=pin.getPosition();if(pos){var itemIndex=this.getIndexOfItem(pos.percentX,pos.percentY);if(itemIndex!=-1&&!map[itemIndex]){map[itemIndex]=true;pin.$el.addClass("correct").removeClass("incorrect")}else{pin.$el.addClass("incorrect").removeClass("correct")}}}},resetUserAnswer:function resetUserAnswer(){this.model.set({_userAnswer:[]})},resetQuestion:function resetQuestion(){this.resetPins();this.model.set({_isAtLeastOneCorrectSelection:false})},resetPins:function resetPins(){_.each(this._pinViews,function(pin){pin.reset()})},showCorrectAnswer:function showCorrectAnswer(){var isDesktop=Adapt.device.screenSize!="small",items=this.model.get("_items"),map=new Array(this.model.get("_items").length),free=[],i=0,l=0,pin,zone;_.each(this._pinViews,function(pin,pinIndex){var pos=pin.getPosition();if(pos){var itemIndex=this.getIndexOfItem(pos.percentX,pos.percentY);if(itemIndex!=-1&&!map[itemIndex])map[itemIndex]=true;else free.push(pin)}},this);for(l=items.length;i<l;i++){if(!map[i]){zone=isDesktop?items[i].desktop:items[i].mobile;pin=free.shift();pin.setPosition(zone.left+zone.width/2,zone.top+zone.height/2)}}for(i=l,l=this._pinViews.length;i<l;i++){pin=this._pinViews[i];pin.reset()}this.updatePinPositions()},hideCorrectAnswer:function hideCorrectAnswer(){var userAnswer=this.model.get("_userAnswer");var i=1,l=0,pin;for(l=userAnswer.length;i<l;i+=2){pin=this._pinViews[i-1>>1];pin.setPosition(userAnswer[i]/100,userAnswer[i+1]/100)}for(i=userAnswer.length-1>>1,l=this._pinViews.length;i<l;i++){pin=this._pinViews[i];pin.reset()}this.updatePinPositions()},getIndexOfItem:function getIndexOfItem(x,y,desktop){var isDesktop=_.isBoolean(desktop)?desktop:Adapt.device.screenSize!="small";var items=this.model.get("_items");for(var i=0,l=items.length;i<l;i++){var zone=isDesktop?items[i].desktop:items[i].mobile;if(x>=zone.left&&y>=zone.top&&x<zone.left+zone.width&&y<zone.top+zone.height){return i}}return-1},onDragStart:function onDragStart(pin,event){console.log("Drag Start")},onDragEnd:function onDragEnd(pin,event){console.log("Drag End");var $pinboard=this.$(".ppq-pinboard");var boardw=$pinboard.width();var boardh=$pinboard.height();var pos=pin.$el.position();var x=pos.left+pin.$el.width()/2;var y=pos.top+pin.$el.height();var percentX=100*x/boardw;var percentY=100*y/boardh;pin.setPosition(percentX,percentY)}},{template:"ppq"});var PinView=Backbone.View.extend({tagName:"a",className:"ppq-pin",events:{"click .ppq-icon":"preventDefault"},initialize:function initialize(){this.state=new Backbone.Model;this.render();this.$el.attr("href","#")},render:function render(){var template=Handlebars.templates["ppqPin"];this.$el.html(template());return this},preventDefault:function preventDefault(event){event.preventDefault()},reset:function reset(){this.$el.removeClass("in-use correct incorrect");this.state.unset("position")},getPosition:function getPosition(){return this.state.get("position")},setPosition:function setPosition(percentX,percentY){if(!this.isGraphable(percentX)||!this.isGraphable(percentY))return;this.$el.addClass("in-use");this.state.set("position",{"percentX":percentX,"percentY":percentY})},isGraphable:function isGraphable(o){return _.isNumber(o)&&!isNaN(o)&&isFinite(o)},onCannotSubmit:function onCannotSubmit(){}});return PpqView});define("components/adapt-ppq/js/adapt-ppq",["core/js/adapt","./ppqView","core/js/models/questionModel"],function(Adapt,PpqView,QuestionModel){return Adapt.register("ppq",{view:PpqView,model:QuestionModel})});define("components/adapt-stacklist/js/adapt-stacklist",["core/js/adapt","coreViews/componentView"],function(Adapt,ComponentView){var StackList=ComponentView.extend({TRANSITION_TIME:250,events:{"click .stacklist__next":"nextItem"},preRender:function preRender(){this.model.set("_globals",Adapt.course.get("_globals"));this.model.set("_stage",-1);this.setupButton()},postRender:function postRender(){this.$items=this.$(".stacklist__item");this.$button=this.$(".stacklist__button");if(!this.model.get("_isComplete")||this.model.get("_isResetOnRevisit")){this.setupListItems();this.setupItemOffsets();this.listenTo(Adapt,"device:resize",this.setupItemOffsets)}this.setReadyStatus()},setupButton:function setupButton(){var _button=this.model.get("_button")||{};var btnAriaLabel=this.model.get("_globals")._components._stacklist.ariaButtonLabel||this.model.get("_globals")._accessibility._ariaLabels.next;this.model.set({buttonAriaLabel:btnAriaLabel});if(!_button.startText)_button.startText="Click here to begin";if(!_button.continueText)_button.continueText="Next";if(!_button.ariaLabel)_button.ariaLabel=btnAriaLabel;this.model.set("_button",_button)},setupListItems:function setupListItems(){this.$items.addClass("visibility-hidden");this.$button.show()},setupItemOffsets:function setupItemOffsets(){var wWin=$(window).width();var offsetLeft=-this.$el.outerWidth();var offsetRight=wWin+10;var stage=this.model.get("_stage");var buttonOffset=0;this.$items.each(function(i){var $el=$(this);if(i<=stage){buttonOffset+=$el.outerHeight(true);return}var isLeft=i%2===0;var offset=$el.offset();offset.left=isLeft?offsetLeft:offsetRight;$el.offset(offset)});this.$button.css({top:buttonOffset})},nextItem:function nextItem(){var stage=this.model.get("_stage")+1;this.setStage(stage)},setStage:function setStage(stage){this.model.set("_stage",stage);var items=this.model.get("_items");var isComplete=this.model.get("_items").length-1===stage;var $item=this.$(".stacklist__item").eq(stage);$item.removeClass("visibility-hidden");var h=$item.outerHeight(true);$item.velocity({left:0},{delay:this.TRANSITION_TIME,duration:this.TRANSITION_TIME,complete:function complete(){$item.addClass("show").a11y_focus()}});if(isComplete){this.onComplete();this.updateButton("",h)}else{var continueText=items[stage].next||this.model.get("_button").continueText;var btnAriaLabel=this.model.get("_globals")._components._stacklist.ariaButtonLabel||this.model.get("_globals")._accessibility._ariaLabels.next;var ariaLabel=continueText+", "+btnAriaLabel;this.updateButton(continueText,h,ariaLabel)}},updateButton:function updateButton(text,offset,ariaLabel){this.$(".stacklist__button").css({top:"+="+offset});if(text===""){return}var $button=this.$(".stacklist__next");$button.blur();setTimeout(function(){$button.html(text);$button.attr("aria-label",ariaLabel)},this.TRANSITION_TIME*2)},onComplete:function onComplete(){var $buttonDiv=this.$(".stacklist__button");var $button=this.$(".stacklist__next");$buttonDiv.css({opacity:0});setTimeout(function(){$button.remove()},this.TRANSITION_TIME);this.setCompletionStatus()}});Adapt.register("stacklist",StackList);return StackList});define("components/adapt-tabs/js/adapt-tabs",["core/js/adapt","core/js/views/componentView","core/js/models/itemsComponentModel"],function(Adapt,ComponentView,ItemsComponentModel){var Tabs=ComponentView.extend({events:{"click .js-tabs-nav-item-btn-click":"onTabItemClicked"},preRender:function preRender(){this.checkIfResetOnRevisit();this.model.resetActiveItems();this.listenTo(this.model.get("_children"),{"change:_isActive":this.onItemsActiveChange,"change:_isVisited":this.onItemsVisitedChange})},postRender:function postRender(){this.setReadyStatus();this.setLayout();this.listenTo(Adapt,"device:resize",this.setLayout);this.model.setActiveItem(0);if(this.model.get("_setCompletionOn")==="inview"){this.setupInviewCompletion()}},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},setLayout:function setLayout(){this.$el.removeClass("is-horizontal-layout is-vertical-layout");if(Adapt.device.screenSize==="large"){var tabLayout=this.model.get("_tabLayout");this.$el.addClass("is-"+tabLayout+"-layout");if(tabLayout==="vertical"){this.setTabLayoutVertical();return}this.setTabLayoutHorizontal();return}this.$el.addClass("is-horizontal-layout");this.setTabLayoutVertical()},setTabLayoutHorizontal:function setTabLayoutHorizontal(){var itemsLength=this.model.get("_items").length;var itemWidth=100/itemsLength;this.$(".tabs__nav-item-btn").css({width:itemWidth+"%"})},setTabLayoutVertical:function setTabLayoutVertical(){this.$(".tabs__nav-item-btn").css({width:100+"%"})},onTabItemClicked:function onTabItemClicked(e){if(e&&e.preventDefault)e.preventDefault();this.model.setActiveItem($(e.currentTarget).data("index"))},onItemsActiveChange:function onItemsActiveChange(item,isActive){var dataFilter="[data-index=\""+item.get("_index")+"\"]";var $tabButton=this.$(".js-tabs-nav-item-btn-click").filter(dataFilter);var $tabPanel=this.$(".tabs__content-item").filter(dataFilter);$tabButton.toggleClass("is-selected",isActive).attr("aria-selected",isActive);$tabPanel.toggleClass("is-active",isActive);if(isActive){$tabPanel.a11y_focus();item.toggleVisited(true)}},onItemsVisitedChange:function onItemsVisitedChange(item,isVisited){if(!isVisited)return;var ariaLabel=item.get("tabTitle")+". "+this.model.get("_globals")._accessibility._ariaLabels.visited;var $tabButton=this.$(".js-tabs-nav-item-btn-click").filter("[data-index=\""+item.get("_index")+"\"]");$tabButton.addClass("is-visited").attr("aria-label",ariaLabel)}},{template:"tabs"});return Adapt.register("tabs",{model:ItemsComponentModel,view:Tabs})});define("components/adapt-timed-mcq/js/timedMcqView",["core/js/adapt","core/js/views/questionView"],function(Adapt,QuestionView){var timer;var timer2;var TimedMcqView=QuestionView.extend({events:{"inview":"inview","focus .timedMcq-item input":"onItemFocus","blur .timedMcq-item input":"onItemBlur","change .timedMcq-item input":"onItemSelected","keyup .timedMcq-item input":"onKeyPress","click .timedMcq-time-start":"startTimer","click .stoppedimgtimer":"setupInitialimgTimer"},resetQuestionOnRevisit:function resetQuestionOnRevisit(){this.setAllItemsEnabled(true);this.resetQuestion()},setupQuestion:function setupQuestion(){this.model.set("_isRadio",this.model.get("_selectable")==1);this.model.set("_selectedItems",[]);this.setupQuestionItemIndexes();this.setupRandomisation();this.restoreUserAnswers()},startTimer:function startTimer(){this.displayQuestions();var currentimedmcq=this.model.get("_id");window.setTimeout(function(){if($("html").hasClass("accessibility")){$(".accessibility ."+currentimedmcq+" .timedMcq__body-inner").a11y_focus()}},500);parent=this;timer=setInterval(function(){parent.decreaseTime()},1000)},displayQuestions:function displayQuestions(){this.$(".timedMcq__widget").css("visibility","visible");this.$(".btn__container").css("visibility","visible");this.$(".timedMcq-body-items").addClass("started");this.$(".timedMcq-time-start").addClass("started").prop("disabled",true);this.$(".timedMcq-time-instruction").addClass("started");this.$(".timedMcq-time").addClass("started");this.$(".aria-instruct").removeClass("display-none");this.$(".btn__action").removeClass("disabled").prop("disabled",false);$(".timedMcq-time-start").addClass("disabled").prop("disabled",true)},checkTimeUp:function checkTimeUp(){if(this.model.get("_seconds")>0){return false}else{if($(".timedmcq").hasClass("enabledimgtime")&&!$(".timedmcq").hasClass("embedimgtimeup")){$(".timedMcq-time-start").addClass("disabled").prop("disabled",true)}else{$(".timedMcq-time-start").removeClass("disabled").prop("disabled",false);this.$(".timedMcq-time").attr("tabindex","0").attr("aria-label","time left to answer 0 seconds").text("0")}}return true},stopTimer:function stopTimer(){clearInterval(timer)},stopTimer2:function stopTimer2(){$(".enabledimgtime .imgcounton").addClass("stoppedimgtimer");clearInterval(timer2)},decreaseTime:function decreaseTime(){var seconds=this.model.get("_seconds");this.model.set("_seconds",--seconds);this.$(".timedMcq-time").attr("tabindex","0").attr("aria-label","time left to answer "+seconds+" seconds").text(seconds);if(this.checkTimeUp()){this.disableQuestion()}},inview:function inview(event,visible,visiblePartX,visiblePartY){if(visible){if(visiblePartY==="top"){this._isVisibleTop=true;this.stopTimer2();this.setupInitialimgTimer()}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(this._isVisibleTop&&this._isVisibleBottom){this.$(".component__widget").off("inview")}}},decreaseTime2:function decreaseTime2(setupInView){var seconds=this.model.get("_seconds");var currentimedmcq=this.model.get("_id");$("."+currentimedmcq+".enabledimgtime .timedMcq-time").addClass("imgcounton");$("."+currentimedmcq+".enabledimgtime .timedMcq__widget").css("visibility","visible");$(".enabledimgtime .timedMcq-body-items").removeClass("started");$(".enabledimgtime .timedMcq-time-start").removeClass("started").prop("disabled",false);$(".enabledimgtime .timedMcq-time-instruction").removeClass("started");$(".enabledimgtime .timedMcq-time").removeClass("display-none").removeClass("started");$(".enabledimgtime .aria-instruct").addClass("display-none");$(".enabledimgtime .timedMcq-time-start").addClass("disabled").prop("disabled",true);this.model.set("_seconds",--seconds);$("."+currentimedmcq+" .timedMcq-time").attr("tabindex","0").attr("aria-label","time left to answer "+seconds+" seconds").text(seconds);if(seconds<=0){this.stopTimer2();$("."+currentimedmcq+".timedmcq").addClass("embedimgtimeup");$("."+currentimedmcq+".embedimgtimeup .timedMcq__widget").css("visibility","visible");$("."+currentimedmcq+".embedimgtimeup .timedMcq-body-items").addClass("started");$("."+currentimedmcq+".embedimgtimeup .timedMcq-time-start").addClass("started").prop("disabled",true);$("."+currentimedmcq+".embedimgtimeup .timedMcq-time-instruction").addClass("started");$("."+currentimedmcq+".embedimgtimeup .timedMcq-time").addClass("display-none").addClass("started").text("0");$("."+currentimedmcq+".embedimgtimeup .aria-instruct").removeClass("display-none");$("."+currentimedmcq+".embedimgtimeup .btn__action").removeClass("disabled").prop("disabled",false);$("."+currentimedmcq+".embedimgtimeup .timedMcq-item input").removeClass("disabled").prop("disabled",false);$(".enabledimgtime .timedMcq-time-start").addClass("disabled").prop("disabled",true);var currentimedmcq=this.model.get("_id");window.setTimeout(function(){if($("html").hasClass("accessibility")){$(".accessibility ."+currentimedmcq+" .timedMcq__body-inner").a11y_focus()}},500)}},setupQuestionItemIndexes:function setupQuestionItemIndexes(){var items=this.model.get("_items");for(var i=0,l=items.length;i<l;i++){if(items[i]._index===undefined)items[i]._index=i}},setupRandomisation:function setupRandomisation(){if(this.model.get("_isRandom")&&this.model.get("_isEnabled")){this.model.set("_items",_.shuffle(this.model.get("_items")))}},setupInitialimgTimer:function setupInitialimgTimer(){if(this.model.get("_timedimgEnabled")&&this.model.get("_isEnabled")){var currentimedmcq=this.model.get("_id");var seconds=this.model.get("_seconds");var timedimg_height=$("."+currentimedmcq+".enabledimgtime .timedMcq-time-start img").height();if(seconds<=0){$(".enabledimgtime .timedMcq-time").removeClass("stoppedimgtimer")}else{$("."+currentimedmcq+".enabledimgtime .timedMcq-time").addClass("stoppedimgtimer")}if(this.model.get("_timedimgEnabled")&&this.model.get("_graphic").src){if(timedimg_height==0){$("."+currentimedmcq+".enabledimgtime .timedMcq__inner").css("min-height","")}else{$("."+currentimedmcq+".enabledimgtime .timedMcq__inner").css("min-height",timedimg_height+"px")}}if($("."+currentimedmcq+" .timedMcq__widget").hasClass("submitted")||$("."+currentimedmcq+" .timedMcq__widget").hasClass("complete")){$("."+currentimedmcq+" .timedMcq-time").addClass("display-none").addClass("started").attr("tabindex","0").attr("aria-label","time left to answer 0 seconds").text("0");$(".embedimgtimeup .timedMcq-time-start").removeClass("disabled").prop("disabled",false);this.decreaseTime2()}else{parent2=this;timer2=setInterval(function(){parent2.decreaseTime2();$("."+currentimedmcq+".enabledimgtime .imgcounton").removeClass("stoppedimgtimer")},1000)}}else{}},restoreUserAnswers:function restoreUserAnswers(){if(!this.model.get("_isSubmitted"))return;var selectedItems=[];var items=this.model.get("_items");var userAnswer=this.model.get("_userAnswer");var themcqtotalscore=parseFloat(this.model.get("_themcqtotalscore"));var therequiredscore=parseFloat(this.model.get("_therequiredscore"));var outofahundred=parseFloat(this.model.get("_outofahundred"));_.each(items,function(item,index){item._isSelected=userAnswer[item._index];if(item._isSelected){selectedItems.push(item)}});this.model.set("_selectedItems",selectedItems);this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.showMarking();$(".timedmcq").addClass("mcqscoringpercent");if(this.model.get("_isSubmitted")&&this.model.has("_userAnswer")){var currentimedmcq=this.model.get("_id");var myarticleis=this.$el.parents(".article");var myarticleId=myarticleis.attr("data-adapt-id");var toshowScore=this.model.get("_feedback")._showmyScore;var percentageBar=this.model.get("_showPercentagebar");var percentBartxt=this.model.get("_showPercenttext");var themcqtotalscore2=parseFloat($("."+myarticleId+" .masterscorehold .mymcqtotalscore").text());var therequiredscore2=parseFloat($("."+myarticleId+" .masterscorehold .mymcqrequiredscore").text());var outofahundred2=themcqtotalscore2/therequiredscore2*100;if(toshowScore==true||percentageBar==true){window.setTimeout(function(){$("."+myarticleId+" .mcqscoringaddup."+currentimedmcq+" .masterscorehold .mcqmovingbar").css("width",outofahundred2.toFixed(2)+"%").html("&nbsp;<span>"+percentBartxt+"</span> "+outofahundred2.toFixed(2)+"%").attr("aria-label",percentBartxt+outofahundred2.toFixed(2)+"%");$("."+myarticleId+" .assessmentResults__instruction-inner").html("<p class='yourachievement1' style='font-size: 125%'>Your Overall Score is <span class='leavemyscore'>"+outofahundred2.toFixed(2)+"%</span></p><p class='yourachievement2' style='font-size: 125%'>You selected <span class='leavemyscore'>"+themcqtotalscore2+"/"+therequiredscore2+"</span> answers correctly.</p>")},878)}}this.setupFeedback()},disableQuestion:function disableQuestion(){this.stopTimer();if(this.checkTimeUp()){this.timeUp()}this.setAllItemsEnabled(false)},enableQuestion:function enableQuestion(){this.setAllItemsEnabled(true)},timeUp:function timeUp(){var currentimedmcq=this.model.get("_id");if($("."+currentimedmcq+".timedmcq").hasClass("embedimgtimeup")){$("."+currentimedmcq+".embedimgtimeup .btn__action").removeClass("disabled").prop("disabled",false)}else{this.setupTimeUpFeedback();this.model.set("_isCorrect",false);$("."+currentimedmcq+".timedmcq .btn__action").prop("disabled",true);this.showMarking();Adapt.trigger("questionView:showFeedback",this);this.updateButtons()}},setAllItemsEnabled:function setAllItemsEnabled(isEnabled){_.each(this.model.get("_items"),function(item,index){var $itemLabel=this.$("label").eq(index);var $itemInput=this.$("input").eq(index);if(isEnabled){$itemLabel.removeClass("disabled");$itemInput.prop("disabled",false)}else{$itemLabel.addClass("disabled");$itemInput.prop("disabled",true)}},this)},onQuestionRendered:function onQuestionRendered(){this.setReadyStatus();var seconds=this.model.get("_seconds");var currentimedmcq=this.model.get("_id");if(this.model.get("_timedimgEnabled")&&this.model.get("_isEnabled")){$("."+currentimedmcq+".timedmcq").addClass("enabledimgtime");$(".enabledimgtime .timedMcq-time-start").addClass("disabled").prop("disabled",true);var timedimg_height=$("."+currentimedmcq+".enabledimgtime .timedMcq-time-start img").height();if(this.model.get("_timedimgEnabled")&&this.model.get("_graphic").src){if(timedimg_height==0){$("."+currentimedmcq+".enabledimgtime .timedMcq__inner").css("min-height","")}else{$("."+currentimedmcq+".enabledimgtime .timedMcq__inner").css("min-height",timedimg_height+"px")}}}if(this.$(".timedMcq__widget").hasClass("submitted")||this.$(".timedMcq__widget").hasClass("complete")){this.$(".timedMcq-time").attr("tabindex","0").attr("aria-label","time left to answer 0 seconds").text("0");window.setTimeout(function(){this.$(".embedimgtimeup .timedMcq__widget").css("visibility","visible");this.$(".embedimgtimeup .btn__container").css("visibility","visible");this.$(".embedimgtimeup .timedMcq-body-items").addClass("started");this.$(".embedimgtimeup .timedMcq-time-start").addClass("started").prop("disabled",true);this.$(".embedimgtimeup .timedMcq-time-instruction").addClass("started");this.$(".embedimgtimeup .timedMcq-time").addClass("display-none").addClass("started").text("0");this.$(".embedimgtimeup .aria-instruct").removeClass("display-none");this.$(".embedimgtimeup .btn__action").removeClass("disabled").prop("disabled",false);this.$(".embedimgtimeup .timedMcq-item input").removeClass("disabled").prop("disabled",false)},233)}if($("."+currentimedmcq+".timedmcq").hasClass("enabledimgtime")){if(seconds<=0){$("."+currentimedmcq+".enabledimgtime .timedMcq__widget").css("visibility","visible");$("."+currentimedmcq+".enabledimgtime .timedMcq-body-items").css({"visibility":"visible","opacity":"1"}).addClass("started");$("."+currentimedmcq+".enabledimgtime .btn__container").css("visibility","visible");$("."+currentimedmcq+".enabledimgtime .timedMcq-time-start").addClass("display-none");$("."+currentimedmcq+".enabledimgtime .timedMcq-time-instruction").css({"visibility":"visible","opacity":"1"}).addClass("started");$("."+currentimedmcq+".enabledimgtime .timedMcq-time").addClass("display-none").removeClass("started");$("."+currentimedmcq+".enabledimgtime .aria-instruct").addClass("display-none")}}else if(this.$(".timedMcq-time").text()=="0"){$("."+currentimedmcq+".timedmcq").addClass("timeuplock");$("."+currentimedmcq+".timeuplock .timedMcq-body-items").addClass("started");$("."+currentimedmcq+".timeuplock .timedMcq-time-start").addClass("started").prop("disabled",true);window.setTimeout(function(){$("."+currentimedmcq+".timeuplock .timedMcq-item input").addClass("disabled").prop("disabled",true);$("."+currentimedmcq+".timeuplock .timedMcq-item label").css("cursor","default").addClass("disabled").prop("disabled",true);$("."+currentimedmcq+".timeuplock .btn__action").addClass("disabled").prop("disabled",true)},253);$("."+currentimedmcq+".timeuplock .timedMcq-time-instruction").addClass("started");$("."+currentimedmcq+".timeuplock .aria-instruct").removeClass("display-none")}if(this.model.get("_timeroffEnabled")&&this.model.get("_isEnabled")){$("."+currentimedmcq+".timedmcq").addClass("timeuplock").addClass("notimenabled");$("."+currentimedmcq+".timeuplock .timedMcq-body-items").addClass("started");$("."+currentimedmcq+".timeuplock .timedMcq-time-start").addClass("started").prop("disabled",true);$("."+currentimedmcq+".timeuplock .timedMcq-item label").css("cursor","pointer");$("."+currentimedmcq+".timeuplock .btn__action").removeClass("disabled").prop("disabled",false);$("."+currentimedmcq+".timeuplock .timedMcq-time-instruction").addClass("started");$("."+currentimedmcq+".timeuplock .aria-instruct").removeClass("display-none")}$(".timedmcq").addClass("mcqscoringpercent");if(this.model.get("_isSubmitted")&&this.model.has("_userAnswer")){var currentimedmcq=this.model.get("_id");var myarticleis=this.$el.parents(".article");var myarticleId=myarticleis.attr("data-adapt-id");var toshowScore=this.model.get("_feedback")._showmyScore;var percentageBar=this.model.get("_showPercentagebar");var percentBartxt=this.model.get("_showPercenttext");var themcqtotalscore2=parseFloat($("."+myarticleId+" .masterscorehold .mymcqtotalscore").text());var therequiredscore2=parseFloat($("."+myarticleId+" .masterscorehold .mymcqrequiredscore").text());var outofahundred2=themcqtotalscore2/therequiredscore2*100;if(toshowScore==true||percentageBar==true){window.setTimeout(function(){$("."+myarticleId+" .mcqscoringaddup."+currentimedmcq+" .masterscorehold .mcqmovingbar").css("width",outofahundred2.toFixed(2)+"%").html("&nbsp;<span>"+percentBartxt+"</span> "+outofahundred2.toFixed(2)+"%").attr("aria-label",percentBartxt+outofahundred2.toFixed(2)+"%");$("."+myarticleId+" .assessmentResults__instruction-inner").html("<p class='yourachievement1' style='font-size: 125%'>Your Overall Score is <span class='leavemyscore'>"+outofahundred2.toFixed(2)+"%</span></p><p class='yourachievement2' style='font-size: 125%'>You selected <span class='leavemyscore'>"+themcqtotalscore2+"/"+therequiredscore2+"</span> answers correctly.</p>")},878)}}},onKeyPress:function onKeyPress(event){if(event.which===13){this.onItemSelected(event)}},onItemFocus:function onItemFocus(event){if(this.model.get("_isEnabled")&&!this.model.get("_isSubmitted")){$("label[for='"+$(event.currentTarget).attr("id")+"']").addClass("highlighted")}},onItemBlur:function onItemBlur(event){$("label[for='"+$(event.currentTarget).attr("id")+"']").removeClass("highlighted")},onItemSelected:function onItemSelected(event){if(this.model.get("_isEnabled")&&!this.model.get("_isSubmitted")){var selectedItemObject=this.model.get("_items")[$(event.currentTarget).parent(".component-item").index()];this.toggleItemSelected(selectedItemObject,event)}},toggleItemSelected:function toggleItemSelected(item,clickEvent){var selectedItems=this.model.get("_selectedItems");var itemIndex=_.indexOf(this.model.get("_items"),item),$itemLabel=this.$("label").eq(itemIndex),$itemInput=this.$("input").eq(itemIndex),selected=!$itemLabel.hasClass("selected");if(selected){if(this.model.get("_selectable")===1){this.$("label").removeClass("selected");this.$("input").prop("checked",false);this.deselectAllItems();selectedItems[0]=item}else if(selectedItems.length<this.model.get("_selectable")){selectedItems.push(item)}else{clickEvent.preventDefault();return}$itemLabel.addClass("selected");$itemLabel.a11y_selected(true)}else{selectedItems.splice(_.indexOf(selectedItems,item),1);$itemLabel.removeClass("selected");$itemLabel.a11y_selected(false)}$itemInput.prop("checked",selected);item._isSelected=selected;this.model.set("_selectedItems",selectedItems)},canSubmit:function canSubmit(){var count=0;var currentimedmcq=this.model.get("_id");_.each(this.model.get("_items"),function(item){if(item._isSelected){count++}},this);$(".timedMcq-time-start").removeClass("disabled").prop("disabled",false);return count>=0?true:false},onCannotSubmit:function onCannotSubmit(){},storeUserAnswer:function storeUserAnswer(){var userAnswer=[];var items=this.model.get("_items").slice(0);items.sort(function(a,b){return a._index-b._index});_.each(items,function(item,index){userAnswer.push(item._isSelected)},this);this.model.set("_userAnswer",userAnswer)},isCorrect:function isCorrect(){var numberOfRequiredAnswers=0;var numberOfCorrectAnswers=0;var numberOfIncorrectAnswers=0;_.each(this.model.get("_items"),function(item,index){var itemSelected=item._isSelected||false;if(item._shouldBeSelected){numberOfRequiredAnswers++;if(itemSelected){numberOfCorrectAnswers++;item._isCorrect=true;this.model.set("_isAtLeastOneCorrectSelection",true)}}else if(!item._shouldBeSelected&&itemSelected){numberOfIncorrectAnswers++}},this);this.model.set("_numberOfCorrectAnswers",numberOfCorrectAnswers);this.model.set("_numberOfRequiredAnswers",numberOfRequiredAnswers);var answeredCorrectly=numberOfCorrectAnswers===numberOfRequiredAnswers&&numberOfIncorrectAnswers===0;return answeredCorrectly},_setupLinkedModel:function _setupLinkedModel(){var currentimedmcq=this.model.get("_id");var numberOfCorrectAnswers=this.model.get("_numberOfCorrectAnswers");var numberOfRequiredAnswers=this.model.get("_numberOfRequiredAnswers");var toshowScore=this.model.get("_feedback")._showmyScore;var percentageBar=this.model.get("_showPercentagebar");var percentBartxt=this.model.get("_showPercenttext");var themcqtotalscore=parseFloat(this.model.get("_themcqtotalscore"));var therequiredscore=parseFloat(this.model.get("_therequiredscore"));var mypercentcount=parseFloat($(".mcqscoringpercent").length);var myscorecount=parseFloat($(".mcqscoringaddup").length)+1;var outofahundred=parseFloat(this.model.get("_outofahundred"));var myarticleis=this.$el.parents(".article");var myarticleId=myarticleis.attr("data-adapt-id");if(toshowScore==true||percentageBar==true){$("."+myarticleId+" .timedmcq."+currentimedmcq).addClass("mcqscoringaddup");$("."+myarticleId+" .mcqscoringaddup."+currentimedmcq+" .masterscorehold .mymcqtotalscore").text(numberOfCorrectAnswers);$("."+myarticleId+" .mcqscoringaddup .mymcqtotalscore").each(function(){themcqtotalscore+=parseFloat($(this).text())});console.log("Total MCQ score is now: "+themcqtotalscore);$("."+myarticleId+" .mcqscoringaddup."+currentimedmcq+" .masterscorehold .mymcqrequiredscore").text(numberOfRequiredAnswers);$("."+myarticleId+" .mcqscoringaddup .mymcqrequiredscore").each(function(){therequiredscore+=parseFloat($(this).text())});var outofahundred=themcqtotalscore/therequiredscore*100;window.setTimeout(function(){$("."+myarticleId+" .mcqscoringaddup."+currentimedmcq+" .masterscorehold .mcqmovingbar").css("width",outofahundred.toFixed(2)+"%").html("&nbsp;<span>"+percentBartxt+"</span> "+outofahundred.toFixed(2)+"%").attr("aria-label",percentBartxt+outofahundred.toFixed(2)+"%");$("."+myarticleId+" .assessmentResults__instruction-inner").html("<p class='yourachievement1' style='font-size: 125%'>Your Overall Score is <span class='leavemyscore'>"+outofahundred.toFixed(2)+"%</span></p><p class='yourachievement2' style='font-size: 125%'>You selected <span class='leavemyscore'>"+themcqtotalscore+"/"+therequiredscore+"</span> answers correctly.</p>")},777);if(myscorecount==mypercentcount){this.model.set("_themcqtotalscore",themcqtotalscore);this.model.set("_therequiredscore",therequiredscore);this.model.set("_outofahundred",outofahundred)}console.log("The Require Total MCQ score is: "+therequiredscore);console.log("Percentage MCQ score is: "+outofahundred.toFixed(2))}},mycorrectScoring:function mycorrectScoring(){var numberOfCorrectAnswers=this.model.get("_numberOfCorrectAnswers");var numberOfRequiredAnswers=this.model.get("_numberOfRequiredAnswers");var toshowScore=this.model.get("_feedback")._showmyScore;var rightoScore=this.model.get("_feedback").correct;if(toshowScore==true){this.model.set({feedbackMessage:rightoScore+"<div class='scoreoutof'><p>You selected <span class='leavemyscore'>"+numberOfCorrectAnswers+"/"+numberOfRequiredAnswers+"</span> answers correctly.</p></div>"})}else{}},mypartlyScoring:function mypartlyScoring(){var numberOfCorrectAnswers=this.model.get("_numberOfCorrectAnswers");var numberOfRequiredAnswers=this.model.get("_numberOfRequiredAnswers");var toshowScore=this.model.get("_feedback")._showmyScore;var partlyScore=this.model.get("_feedback")._partlyCorrect.final;if(toshowScore==true){this.model.set({feedbackMessage:partlyScore+"<div class='scoreoutof'><p>You selected <span class='leavemyscore'>"+numberOfCorrectAnswers+"/"+numberOfRequiredAnswers+"</span> answers correctly.</p></div>"})}else{}},myincorrectScoring:function myincorrectScoring(){var numberOfCorrectAnswers=this.model.get("_numberOfCorrectAnswers");var numberOfRequiredAnswers=this.model.get("_numberOfRequiredAnswers");var toshowScore=this.model.get("_feedback")._showmyScore;var wrongoScore=this.model.get("_feedback")._incorrect.final;if(toshowScore==true){this.model.set({feedbackMessage:wrongoScore+"<div class='scoreoutof'><p>You selected <span class='leavemyscore'>"+numberOfCorrectAnswers+"/"+numberOfRequiredAnswers+"</span> answers correctly.</p></div>"})}else{}},myindividualScoring:function myindividualScoring(){var numberOfCorrectAnswers=this.model.get("_numberOfCorrectAnswers");var numberOfRequiredAnswers=this.model.get("_numberOfRequiredAnswers");var toshowScore=this.model.get("_feedback")._showmyScore;var individualScore=this.model.get("_selectedItems")[0].feedback;if(toshowScore==true){this.model.set({feedbackMessage:individualScore+"<div class='scoreoutof'><p>You selected <span class='leavemyscore'>"+numberOfCorrectAnswers+"/"+numberOfRequiredAnswers+"</span> answers correctly.</p></div>"})}else{}},setScore:function setScore(){var questionWeight=this.model.get("_questionWeight");var answeredCorrectly=this.model.get("_isCorrect");var score=answeredCorrectly?questionWeight:0;this.model.set("_score",score)},setupFeedback:function setupFeedback(){if(this.model.get("_isCorrect")){this.setupCorrectFeedback()+this.mycorrectScoring()}else if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback()+this.mypartlyScoring()}else{if(this.model.get("_selectable")===1&&this.model.get("_selectedItems")[0].feedback){this.setupIndividualFeedback(this.model.get("_selectedItems")[0])+this.myindividualScoring();return}else{this.setupIncorrectFeedback()+this.myincorrectScoring()}}$(".enabledimgtime .timedMcq-time-start").addClass("disabled").prop("disabled",true);this._setupLinkedModel()},setupTimeUpFeedback:function setupTimeUpFeedback(){this.model.set({feedbackTitle:this.model.get("title"),feedbackMessage:this.model.get("_feedback").timeUp});$(".enabledimgtime .timedMcq-time-start").addClass("disabled").prop("disabled",true)},setupIndividualFeedback:function setupIndividualFeedback(selectedItem){this.model.set({feedbackTitle:this.model.get("title"),feedbackMessage:selectedItem.feedback});$(".enabledimgtime .timedMcq-time-start").addClass("disabled").prop("disabled",true)},showMarking:function showMarking(){_.each(this.model.get("_items"),function(item,i){var $item=this.$(".component-item").eq(i);$item.removeClass("correct incorrect").addClass(item._isCorrect?"correct":"incorrect")},this)},isPartlyCorrect:function isPartlyCorrect(){return this.model.get("_isAtLeastOneCorrectSelection")},resetUserAnswer:function resetUserAnswer(){this.model.set({_userAnswer:[]})},resetQuestion:function resetQuestion(){this.deselectAllItems();this.resetItems()},deselectAllItems:function deselectAllItems(){this.$el.a11y_selected(false);_.each(this.model.get("_items"),function(item){item._isSelected=false},this)},resetItems:function resetItems(){this.$(".component-item label").removeClass("selected");this.$(".component-item").removeClass("correct incorrect");this.$("input").prop("checked",false);this.model.set({_selectedItems:[],_isAtLeastOneCorrectSelection:false})},showCorrectAnswer:function showCorrectAnswer(){_.each(this.model.get("_items"),function(item,index){this.setOptionSelected(index,item._shouldBeSelected)},this)},setOptionSelected:function setOptionSelected(index,selected){var $itemLabel=this.$("label").eq(index);var $itemInput=this.$("input").eq(index);if(selected){$itemLabel.addClass("selected");$itemInput.prop("checked",true)}else{$itemLabel.removeClass("selected");$itemInput.prop("checked",false)}},hideCorrectAnswer:function hideCorrectAnswer(){_.each(this.model.get("_items"),function(item,index){this.setOptionSelected(index,this.model.get("_userAnswer")[item._index])},this)},getResponse:function getResponse(){var selected=_.where(this.model.get("_items"),{"_isSelected":true});var selectedIndexes=_.pluck(selected,"_index");for(var i=0,count=selectedIndexes.length;i<count;i++){selectedIndexes[i]++}return selectedIndexes.join(",")},getResponseType:function getResponseType(){return"choice"}});return TimedMcqView});define("components/adapt-timed-mcq/js/adapt-timed-mcq",["core/js/adapt","./timedMcqView","core/js/models/questionModel"],function(Adapt,TimedMcqView,QuestionModel){return Adapt.register("timedMcq",{view:TimedMcqView,model:QuestionModel})});define("extensions/adapt-aboutUs/js/adapt-aboutUsItemView",["core/js/adapt"],function(Adapt){var AboutUsItemView=Backbone.View.extend({className:"aboutus__item",attributes:{role:"listitem"},events:{"click .js-aboutus-item-topic-click":"onAboutUsItemClicked"},initialize:function initialize(){this.listenTo(Adapt,{"remove drawer:closed":this.remove,"aboutUs:descriptionOpen":this.descriptionOpen});this.setupModel();this.listenTo(this.model,"change:_isVisible",this.onAboutUsItemVisibilityChange);this.render()},setupModel:function setupModel(){this.model.set({"_isVisible":true,"_isDescriptionOpen":false})},render:function render(){var template=Handlebars.templates["aboutUsItem"];this.$el.html(template(this.model.toJSON()));_.defer(_.bind(function(){this.postRender()},this));return this},postRender:function postRender(){this.listenTo(Adapt,{"drawer:openedItemView":this.remove,"drawer:triggerCustomView":this.remove})},onAboutUsItemClicked:function onAboutUsItemClicked(event){event&&event.preventDefault();Adapt.trigger("aboutUs:descriptionOpen",this.model.cid)},toggleAboutUsItemDescription:function toggleAboutUsItemDescription(){if(this.model.get("_isDescriptionOpen")){this.hideAboutUsItemDescription()}else{this.showAboutUsItemDescription()}},showAboutUsItemDescription:function showAboutUsItemDescription(){var $aboutUsItemTopic=this.$(".js-aboutus-item-topic-click");var description=$aboutUsItemTopic.addClass("is-selected").siblings(".aboutus__item-body").slideDown(200,function(){Adapt.a11y.focusFirst(this.$el,{defer:true})}.this);$aboutUsItemTopic.attr("aria-expanded",true);this.model.set("_isDescriptionOpen",true)},hideAboutUsItemDescription:function hideAboutUsItemDescription(){this.$(".aboutus__item-body").stop(true,true).slideUp(200);this.model.set("_isDescriptionOpen",false);this.$(".js-aboutus-item-topic-click").removeClass("is-selected").attr("aria-expanded",false)},descriptionOpen:function descriptionOpen(viewId){if(viewId===this.model.cid){this.toggleAboutUsItemDescription()}else if(this.model.get("_isDescriptionOpen")){this.hideAboutUsItemDescription()}},onAboutUsItemVisibilityChange:function onAboutUsItemVisibilityChange(){if(this.model.get("_isDescriptionOpen")){this.hideAboutUsItemDescription()}if(this.model.get("_isVisible")){this.$el.removeClass("u-display-none")}else{this.$el.addClass("u-display-none")}}});return AboutUsItemView});define("extensions/adapt-aboutUs/js/adapt-aboutUsSocialLinksView",["core/js/adapt"],function(Adapt){var AboutUsSocialLinksView=Backbone.View.extend({className:"aboutus__item",attributes:{role:"listitem"},initialize:function initialize(){this.render()},render:function render(){var modelData=this.model;var template=Handlebars.templates["aboutUsSocialLinks"];this.$el.html(template(modelData));_.defer(_.bind(function(){this.postRender()},this));return this},postRender:function postRender(){this.listenTo(Adapt,"drawer:openedItemView",this.remove);this.listenTo(Adapt,"drawer:triggerCustomView",this.remove)}});return AboutUsSocialLinksView});define("extensions/adapt-aboutUs/js/adapt-aboutUsView",["core/js/adapt","./adapt-aboutUsItemView","./adapt-aboutUsSocialLinksView"],function(Adapt,AboutUsItemView,SocialLinksView){var AboutUsView=Backbone.View.extend({className:"aboutus",initialize:function initialize(){this.listenTo(Adapt,"remove drawer:closed",this.remove);this.render()},render:function render(){var template=Handlebars.templates["aboutUs"];this.$el.html(template(this.model.toJSON()));this.renderAboutUsItems();_.defer(_.bind(function(){this.postRender()},this));return this},renderAboutUsItems:function renderAboutUsItems(){var $aboutUsItemContainer=this.$(".aboutus__items-container").empty();_.each(this.collection.models,function(item,index){var itemView=new AboutUsItemView({model:item});itemView.$el.appendTo($aboutUsItemContainer)},this);new SocialLinksView({model:Adapt.course.get("_aboutUs")._socialLinks}).$el.appendTo($aboutUsItemContainer)},postRender:function postRender(){this.listenTo(Adapt,"drawer:openedItemView",this.remove);this.listenTo(Adapt,"drawer:triggerCustomView",this.remove)}});return AboutUsView});define("extensions/adapt-aboutUs/js/adapt-aboutUs",["core/js/adapt","./adapt-aboutUsView"],function(Adapt,AboutUsView){function setupAboutUs(aboutUsModel,aboutUsItems,socialLinks){var aboutUsModel=new Backbone.Model(aboutUsModel);var itemsCollection=new Backbone.Collection(aboutUsItems);var socialLinksCollection=new Backbone.Collection(socialLinks);var options={model:aboutUsModel,collection:itemsCollection,sociallinks:socialLinksCollection};Adapt.on("aboutUs:showAboutUs",function(){Adapt.drawer.triggerCustomView(new AboutUsView(options).$el)})}function initAboutUs(){var courseAboutUs=Adapt.course.get("_aboutUs");if(!courseAboutUs||!courseAboutUs._isEnabled){return}var drawerObject={title:courseAboutUs.title,description:courseAboutUs.description,className:"is-aboutus",drawerOrder:courseAboutUs._drawerOrder||0};Adapt.drawer.addItem(drawerObject,"aboutUs:showAboutUs");setupAboutUs(courseAboutUs,courseAboutUs._aboutUsItems,courseAboutUs._socialLinks)}Adapt.on("app:dataReady",initAboutUs)});define("extensions/adapt-articleBlockSlider/js/adapt-articleView",["core/js/adapt","core/js/views/articleView"],function(Adapt,AdaptArticleView){function debounce(callback,timeout){var handle=null;var debounced=function debounced(){clearTimeout(handle);handle=setTimeout(callback,timeout)};debounced.cancel=function cancelDebounce(){clearTimeout(handle)};return debounced}var BlockSliderView={_isReady:false,_disableAnimationOnce:false,events:{"click [data-block-slider]":"_onBlockSliderClick"},preRender:function preRender(){AdaptArticleView.prototype.preRender.call(this);if(!this.model.isBlockSliderEnabled()){this.$el.addClass("is-disabled");return}this._blockSliderPreRender()},_blockSliderPreRender:function _blockSliderPreRender(){Adapt.wait.for(function(done){this.resolveQueue=done}.bind(this));this._blockSliderSetupEventListeners()},_blockSliderSetupEventListeners:function _blockSliderSetupEventListeners(){this._blockSliderResizeHeight=this._blockSliderResizeHeight.bind(this);this.listenTo(Adapt,{"device:resize":this._onBlockSliderResize,"device:changed":this._onBlockSliderDeviceChanged,"page:scrollTo":this._onBlockSliderPageScrollTo,"page:scrolledTo":this._onBlockSliderPageScrolledTo});this.listenToOnce(Adapt,"remove",this._onBlockSliderRemove);this.listenToOnce(this.model,"change:_isReady",this._onBlockSliderReady);var duration=this.model.get("_articleBlockSlider")._slideAnimationDuration||200;this._blockSliderHideOthers=debounce(this._blockSliderHideOthers.bind(this),duration)},render:function render(){if(this.model.isBlockSliderEnabled()){this._blockSliderRender()}else AdaptArticleView.prototype.render.call(this)},_blockSliderRender:function _blockSliderRender(){Adapt.trigger(this.constructor.type+"View:preRender",this);this._blockSliderConfigureVariables();var data=this.model.toJSON();var template=Handlebars.templates["articleBlockSlider-article"];this.$el.html(template(data));Adapt.trigger(this.constructor.type+"View:render",this);this.addChildren();this.$el.addClass("abs");this.delegateEvents();this.$el.imageready(function(){_.delay(this._blockSliderPostRender.bind(this),500)}.bind(this));return this},_blockSliderConfigureVariables:function _blockSliderConfigureVariables(){var blocks=this.model.getChildren().models;var totalBlocks=blocks.length;var itemButtons=[];for(var i=0,l=totalBlocks;i<l;i++){itemButtons.push({_className:(i===0?"home":"not-home")+(" i"+i),_index:i,_includeNumber:i!==0,_title:blocks[i].get("title")})}this.model.set({_currentBlock:0,_totalBlocks:totalBlocks,_itemButtons:itemButtons})},_blockSliderConfigureControls:function _blockSliderConfigureControls(){var duration=this.model.get("_articleBlockSlider")._slideAnimationDuration||200;if(this._disableAnimationOnce)animate=false;var _currentBlock=this.model.get("_currentBlock");var _totalBlocks=this.model.get("_totalBlocks");var $left=this.$el.find("[data-block-slider='left']");var $right=this.$el.find("[data-block-slider='right']");if(_currentBlock===0){$left.a11y_cntrl_enabled(false);$right.a11y_cntrl_enabled(true)}else if(_currentBlock==_totalBlocks-1){$left.a11y_cntrl_enabled(true);$right.a11y_cntrl_enabled(false)}else{$left.a11y_cntrl_enabled(true);$right.a11y_cntrl_enabled(true)}var $indexes=this.$el.find("[data-block-slider='index']");$indexes.a11y_cntrl_enabled(true).removeClass("is-selected");$indexes.eq(_currentBlock).a11y_cntrl_enabled(false).addClass("is-selected is-visited");var $blocks=this.$el.find(".block");if(!$blocks.length)return;$blocks.a11y_on(false).eq(_currentBlock).a11y_on(true)},_blockSliderSetButtonLayout:function _blockSliderSetButtonLayout(){var buttonsLength=this.model.get("_itemButtons").length;var itemwidth=100/buttonsLength;this.$(".js-abs-btn-tab").css({width:itemwidth+"%"})},_blockSliderPostRender:function _blockSliderPostRender(){this._blockSliderConfigureControls(false);this._onBlockSliderDeviceChanged();var startIndex=this.model.get("_articleBlockSlider")._startIndex||0;this._blockSliderMoveIndex(startIndex,false);Adapt.trigger(this.constructor.type+"View:postRender",this)},_onBlockSliderReady:function _onBlockSliderReady(){this._blockSliderHideOthers();_.delay(function(){this._blockSliderConfigureControls(false);this._onBlockSliderResize();this.resolveQueue();this._isReady=true}.bind(this),250);this.$(".component").on("resize",this._blockSliderResizeHeight)},_onBlockSliderClick:function _onBlockSliderClick(event){event.preventDefault();var id=$(event.currentTarget).attr("data-block-slider");switch(id){case"left":this._blockSliderMoveLeft();break;case"index":var index=parseInt($(event.currentTarget).attr("data-block-slider-index"));this._blockSliderMoveIndex(index);break;case"right":this._blockSliderMoveRight();break;}},_blockSliderMoveLeft:function _blockSliderMoveLeft(){if(this.model.get("_currentBlock")===0)return;var index=this.model.get("_currentBlock");this._blockSliderMoveIndex(--index)},_blockSliderMoveIndex:function _blockSliderMoveIndex(index,animate){if(this.model.get("_currentBlock")!=index){this.model.set("_currentBlock",index);Adapt.trigger("media:stop");this._blockSliderSetVisible(this.model.getChildren().models[index],true);this._blockSliderResizeHeight(animate);this._blockSliderScrollToCurrent(animate);this._blockSliderConfigureControls(animate)}var duration=this.model.get("_articleBlockSlider")._slideAnimationDuration||200;if(this._disableAnimationOnce)animate=false;if(animate!==false){_.delay(function(){$(window).resize()},duration);return}$(window).resize()},_blockSliderMoveRight:function _blockSliderMoveRight(){if(this.model.get("_currentBlock")==this.model.get("_totalBlocks")-1)return;var index=this.model.get("_currentBlock");this._blockSliderMoveIndex(++index)},_blockSliderScrollToCurrent:function _blockSliderScrollToCurrent(animate){var isEnabled=this._blockSliderIsEnabledOnScreenSizes();var $container=this.$el.find(".js-abs-slide-container");if(!isEnabled){return $container.scrollLeft(0)}var blocks=this.$el.find(".block");var blockWidth=$(blocks[0]).outerWidth();var lastIndex=blocks.length-1;var currentBlock=this.model.get("_currentBlock");var isRTL=Adapt.config.get("_defaultDirection")==="rtl";var totalLeft=isRTL?(lastIndex-currentBlock)*blockWidth:currentBlock*blockWidth;this._blockSliderShowAll();var duration=this.model.get("_articleBlockSlider")._slideAnimationDuration||200;if(this._disableAnimationOnce)animate=false;if(animate===false){_.defer(function(){$container.scrollLeft(totalLeft);this._blockSliderHideOthers()}.bind(this));return}$container.stop(true).animate({scrollLeft:totalLeft},duration,function(){$container.scrollLeft(totalLeft);this._blockSliderHideOthers()}.bind(this))},_blockSliderIsEnabledOnScreenSizes:function _blockSliderIsEnabledOnScreenSizes(){var isEnabledOnScreenSizes=this.model.get("_articleBlockSlider")._isEnabledOnScreenSizes;var sizes=isEnabledOnScreenSizes.split(" ");if(sizes.indexOf(Adapt.device.screenSize)>-1){return true}return false},_blockSliderShowAll:function _blockSliderShowAll(){this._blockSliderHideOthers.cancel();this.model.getChildren().models.forEach(function(block){this._blockSliderSetVisible(block,true)}.bind(this))},_blockSliderHideOthers:function _blockSliderHideOthers(){var currentIndex=this.model.get("_currentBlock");this.model.getChildren().models.forEach(function(block,index){var makeVisible=index===currentIndex;this._blockSliderSetVisible(block,makeVisible)}.bind(this))},_blockSliderSetVisible:function _blockSliderSetVisible(model,makeVisible){this.$el.find("."+model.get("_id")+" *").css("visibility",makeVisible?"":"hidden")},_onBlockSliderResize:function _onBlockSliderResize(){this._blockSliderResizeWidth(false);this._blockSliderResizeHeight(false);this._blockSliderScrollToCurrent(false);this._blockSliderResizeTab()},_blockSliderResizeHeight:function _blockSliderResizeHeight(animate){if(!this._isReady)animate=false;var $container=this.$el.find(".js-abs-slide-container");var isEnabled=this._blockSliderIsEnabledOnScreenSizes();if(!isEnabled){this._blockSliderShowAll();return $container.velocity("stop").css({"height":"","min-height":""})}var currentBlock=this.model.get("_currentBlock");var $blocks=this.$el.find(".block");var currentHeight=$container.height();var blockHeight=$blocks.eq(currentBlock).height();var maxHeight=-1;$container.find(".block").each(function(){if($(this).height()>maxHeight){maxHeight=$(this).height()}});var duration=(this.model.get("_articleBlockSlider")._heightAnimationDuration||200)*2;if(this._disableAnimationOnce)animate=false;if(this.model.get("_articleBlockSlider")._hasUniformHeight){if(animate===false){$container.css({"height":maxHeight+"px"})}else{$container.velocity("stop").velocity({"height":maxHeight+"px"},{duration:duration})}}else if(currentHeight<=blockHeight){if(animate===false){$container.css({"height":blockHeight+"px"})}else{$container.velocity("stop").velocity({"height":blockHeight+"px"},{duration:duration})}}else if(currentHeight>blockHeight){if(animate===false){$container.css({"height":blockHeight+"px"})}else{$container.velocity("stop").velocity({"height":blockHeight+"px"},{duration:duration})}}var minHeight=this.model.get("_articleBlockSlider")._minHeight;if(minHeight){$container.css({"min-height":minHeight+"px"})}},_blockSliderResizeTab:function _blockSliderResizeTab(){if(!this.model.get("_articleBlockSlider")._hasTabs)return;this._blockSliderSetButtonLayout();this.$(".js-abs-btn-tab").css({height:""});var parentHeight=this.$(".js-abs-btn-tab").parent().height();this.$(".js-abs-btn-tab").css({height:parentHeight+"px"});var toolbarHeight=this.$(".js-abs-btn-tab-container").height();var additionalMargin="30";this.$(".js-abs-btn-tab-container").css({top:"-"+(toolbarHeight+additionalMargin/2)+"px"});var toolbarMargin=parseFloat(toolbarHeight)+parseFloat(additionalMargin);this.$(".js-abs-slide-container").css({marginTop:toolbarMargin+"px"})},_blockSliderResizeWidth:function _blockSliderResizeWidth(){var isEnabled=this._blockSliderIsEnabledOnScreenSizes();var $blockContainer=this.$el.find(".js-abs-block-container");var $blocks=this.$el.find(".block");if(!isEnabled){$blocks.css("width","");return $blockContainer.css({"width":"100%"})}var $container=this.$el.find(".js-abs-slide-container");$blocks.css("width",$container.width()+"px");var blockWidth=$($blocks[0]).outerWidth();var totalWidth=$blocks.length*blockWidth;$blockContainer.width(totalWidth+"px")},_onBlockSliderDeviceChanged:function _onBlockSliderDeviceChanged(){var showToolbar=this._blockSliderIsEnabledOnScreenSizes();this.$(".js-abs-toolbar, .js-abs-toolbar-bottom").toggleClass("u-display-none",!showToolbar);_.delay(function(){$(window).resize()},250)},_onBlockSliderPageScrollTo:function _onBlockSliderPageScrollTo(selector){this._disableAnimationOnce=true;_.defer(function(){this._disableAnimationOnce=false}.bind(this));if(_typeof(selector)==="object")selector=selector.selector;if(!this._blockSliderIsEnabledOnScreenSizes()){return}if(this.$el.find(selector).length===0)return;var id=selector.substr(1);var model=Adapt.findById(id);if(!model)return;var block;if(model.get("_type")=="block")block=model;else block=model.findAncestor("blocks");if(!block)return;var children=this.model.getChildren();for(var i=0,item;item=children.models[i++];){if(item.get("_id")===block.get("_id")){_.defer(function(){this._blockSliderMoveIndex(i-1,false)}.bind(this));return}}},_onBlockSliderPageScrolledTo:function _onBlockSliderPageScrolledTo(){_.defer(function(){this._blockSliderScrollToCurrent(false)}.bind(this))},_onBlockSliderRemove:function _onBlockSliderRemove(){this._blockSliderRemoveEventListeners()},_blockSliderRemoveEventListeners:function _blockSliderRemoveEventListeners(){this.$(".component").off("resize",this._blockSliderResizeHeight);this.stopListening(Adapt,"device:changed",this._onBlockSliderDeviceChanged)}};return BlockSliderView});define("extensions/adapt-articleBlockSlider/js/adapt-articleModel",["core/js/adapt"],function(Adapt){var BlockSliderModel={isBlockSliderEnabled:function isBlockSliderEnabled(){var config=this.get("_articleBlockSlider");if(!config||!config._isEnabled||config._isDisabledWhenAccessibilityActive&&Adapt.accessibility.isActive()){return false}return true}};return BlockSliderModel});define("extensions/adapt-articleBlockSlider/js/adapt-articleExtension",["core/js/views/articleView","core/js/models/articleModel","./adapt-articleView","./adapt-articleModel"],function(ArticleView,ArticleModel,ArticleViewExtension,ArticleModelExtension){var ArticleViewInitialize=ArticleView.prototype.initialize;ArticleView.prototype.initialize=function(options){if(this.model.get("_articleBlockSlider")){_.extend(this,ArticleViewExtension)}return ArticleViewInitialize.apply(this,arguments)};var ArticleModelInitialize=ArticleModel.prototype.initialize;ArticleModel.prototype.initialize=function(options){if(this.get("_articleBlockSlider")){_.extend(this,ArticleModelExtension);var returnValue=ArticleModelInitialize.apply(this,arguments);return returnValue}return ArticleModelInitialize.apply(this,arguments)}});define("extensions/adapt-articleBlockSlider/js/articleBlockSlider",["core/js/adapt","./adapt-articleExtension"],function(Adapt){});define("extensions/adapt-close/js/adapt-close",["core/js/adapt"],function(Adapt){var CloseView=Backbone.View.extend({initialize:function initialize(){this.listenTo(Adapt,{"navigation:closeButton":this.onCloseButton,"close:confirm":this.onCloseConfirm,"app:languageChanged":this.remove}).render()},render:function render(){var data=this.model.toJSON();data._globals=Adapt.course.get("_globals");var template=Handlebars.templates.close;this.setElement(template(data)).$el.insertAfter($(".js-nav-back-btn"))},onCloseButton:function onCloseButton(){var prompt=!Adapt.course.get("_isComplete")?this.model.get("_notifyPromptIfIncomplete"):this.model.get("_notifyPromptIfComplete");if(!prompt||!prompt._isEnabled)return Adapt.trigger("close:confirm");Adapt.trigger("notify:prompt",{title:prompt.title,body:prompt.body,_prompts:[{promptText:prompt.confirm,_callbackEvent:"close:confirm"},{promptText:prompt.cancel}]})},onCloseConfirm:function onCloseConfirm(){var config=Adapt.course.get("_close");config.browserPromptIfIncomplete=config.browserPromptIfComplete=false;if(config._button._closeViaLMSFinish){var scorm=require("extensions/adapt-contrib-spoor/js/scorm/wrapper");if(scorm)scorm.getInstance().finish()}else{top.window.close()}}});function onBeforeUnload(config){return!Adapt.course.get("_isComplete")?config.browserPromptIfIncomplete||undefined:config.browserPromptIfComplete||undefined}function initialise(){var config=Adapt.course.get("_close");if(!config||!config._isEnabled)return;var button=config._button;if(button&&button._isEnabled){new CloseView({model:new Backbone.Model(button)})}if(config.browserPromptIfIncomplete||config.browserPromptIfComplete){$(window).off("beforeunload");$(window).on("beforeunload.close",_.partial(onBeforeUnload,config))}}Adapt.once("adapt:start",function(){initialise();Adapt.on("app:languageChanged",function(){$(window).off("beforeunload.close");Adapt.once("router:location",initialise)})})});define("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleView",["core/js/adapt","core/js/views/articleView"],function(Adapt,AdaptArticleView){var AssessmentView={postRender:function postRender(){AdaptArticleView.prototype.postRender.call(this);if(this.model.isAssessmentEnabled()){this._setupEventListeners();var config=this.model.getConfig();if(config&&config._questions&&config._questions._canShowMarking===false){this.$el.addClass("has-no-marking")}}this.$el.addClass("is-assessment")},_setupEventListeners:function _setupEventListeners(){this.listenTo(Adapt,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset,remove:this._onRemove})},_removeEventListeners:function _removeEventListeners(){this.stopListening(Adapt,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset})},_onAssessmentComplete:function _onAssessmentComplete(state,model){if(state.id!=this.model.get("_assessment")._id)return;console.log("assessment complete",state,model)},_onAssessmentReset:function _onAssessmentReset(state,model){if(state.id!=this.model.get("_assessment")._id)return;console.log("assessment reset",state,model)},_onRemove:function _onRemove(){this._removeEventListeners()}};return AssessmentView});define("extensions/adapt-contrib-assessment/js/adapt-assessmentQuestionBank",["require"],function(require){var QuestionBank=function QuestionBank(quizBankid,articleId,numQuestionBlocks,uniqueQuestions){this._id=quizBankid;this._articleId=articleId;this._numQuestionBlocks=numQuestionBlocks;this._uniqueQuestions=uniqueQuestions;this.questionBlocks=[];this.unUsedQuestionBlocks=undefined;this.usedQuestionBlocks=[]};QuestionBank.prototype={getID:function getID(){return this._id},addBlock:function addBlock(block){this.questionBlocks.push(block)},getRandomQuestionBlocks:function getRandomQuestionBlocks(){this.checkResetUnunsedBlocks();var questionBlocks=[];var usedQuestionBlocks=this.usedQuestionBlocks.slice(0);for(var i=0;i<this._numQuestionBlocks;i++){var question=this.getRandomQuestion();if(question!==undefined){questionBlocks.push(question)}else{if(usedQuestionBlocks.length===0)break;var index=Math.floor(Math.random()*(usedQuestionBlocks.length-1));question=usedQuestionBlocks.splice(index,1)[0];questionBlocks.push(question)}}return questionBlocks},checkResetUnunsedBlocks:function checkResetUnunsedBlocks(){if(this.unUsedQuestionBlocks!==undefined&&this._uniqueQuestions)return;this.unUsedQuestionBlocks=this.questionBlocks.slice(0)},getRandomQuestion:function getRandomQuestion(){if(this.unUsedQuestionBlocks!==undefined&&this.unUsedQuestionBlocks.length<1){console.warn("assessment:"+this._articleId+" No more unique questions for _assessment._quizBankID "+this._id);return undefined}var index=Math.round(Math.random()*(this.unUsedQuestionBlocks.length-1));var questionBlock=this.unUsedQuestionBlocks[index];this.usedQuestionBlocks.push(questionBlock);this.unUsedQuestionBlocks.splice(index,1);return questionBlock}};return QuestionBank});define("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleModel",["core/js/adapt","./adapt-assessmentQuestionBank"],function(Adapt,QuestionBank){var givenIdCount=0;var assessmentConfigDefaults={_isEnabled:true,_questions:{_resetType:"soft",_canShowFeedback:false,_canShowMarking:false,_canShowModelAnswer:false},_suppressMarking:false,_isPercentageBased:true,_scoreToPass:100,_includeInTotalScore:true,_assessmentWeight:1,_isResetOnRevisit:true,_reloadPageOnReset:true,_attempts:"infinite",_allowResetIfPassed:false};var AssessmentModel={_postInitialize:function _postInitialize(){if(!this.isAssessmentEnabled())return;var assessmentConfig=this.getConfig();_.extend(this,{_currentQuestionComponents:null,_originalChildModels:null,_questionBanks:null,_forceResetOnRevisit:false});var attemptsLeft;switch(assessmentConfig._attempts){case"infinite":case 0:case undefined:case-1:case null:attemptsLeft="infinite";break;default:attemptsLeft=assessmentConfig._attempts;break;}this.set({_currentQuestionComponentIds:[],_assessmentCompleteInSession:false,_attemptInProgress:false,_isAssessmentComplete:false,_numberOfQuestionsAnswered:0,_lastAttemptScoreAsPercent:0,_attempts:attemptsLeft,_attemptsLeft:attemptsLeft,_attemptsSpent:0});this.listenToOnce(Adapt,"app:dataReady",this._onDataReady);this.listenTo(Adapt,"remove",this._onRemove)},init:function init(){this._originalChildModels=this.getChildren().models;this._currentQuestionComponents=this.findDescendantModels("components",{where:{_isQuestionType:true}});this.set("_currentQuestionComponentIds",this._currentQuestionComponents.map(function(comp){return comp.get("_id")}));this._setAssessmentOwnershipOnChildrenModels()},_setAssessmentOwnershipOnChildrenModels:function _setAssessmentOwnershipOnChildrenModels(){var assessmentConfig=this.get("_assessment");var childConfig={_isPartOfAssessment:true,_assessmentId:assessmentConfig._id};for(var i=0,l=this._originalChildModels.length;i<l;i++){var blockModel=this._originalChildModels[i];blockModel.set(childConfig);blockModel.setOnChildren(childConfig)}},_onDataReady:function _onDataReady(){Adapt.assessment.register(this)},_setupAssessmentData:function _setupAssessmentData(force,callback){var assessmentConfig=this.getConfig();var state=this.getState();var shouldResetAssessment=!this.get("_attemptInProgress")&&!state.isPass||force===true;var shouldResetQuestions=assessmentConfig._isResetOnRevisit&&(state.allowResetIfPassed||!state.isPass)||force===true;if(shouldResetAssessment||shouldResetQuestions){Adapt.trigger("assessments:preReset",this.getState(),this)}var quizModels;if(shouldResetAssessment){this.set({_numberOfQuestionsAnswered:0,_isAssessmentComplete:false,_assessmentCompleteInSession:false,_score:0});this.getChildren().models=this._originalChildModels;if(assessmentConfig._banks&&assessmentConfig._banks._isEnabled&&assessmentConfig._banks._split.length>1){quizModels=this._setupBankedAssessment()}else if(assessmentConfig._randomisation&&assessmentConfig._randomisation._isEnabled){quizModels=this._setupRandomisedAssessment()}}if(!quizModels){quizModels=this.getChildren().models}else if(quizModels.length===0){quizModels=this.getChildren().models;console.warn("assessment: Not enough unique questions to create a fresh assessment, using last selection")}this.getChildren().models=quizModels;this._currentQuestionComponents=this.findDescendantModels("components",{where:{_isQuestionType:true}});this.set("_currentQuestionComponentIds",this._currentQuestionComponents.map(function(comp){return comp.get("_id")}));if(shouldResetAssessment||shouldResetQuestions){this._resetQuestions(function(){this.set("_attemptInProgress",true);Adapt.trigger("assessments:reset",this.getState(),this);finalise.apply(this)}.bind(this))}else{finalise.apply(this)}function finalise(){if(!state.isComplete){this.set("_attemptInProgress",true)}this._overrideQuestionComponentSettings();this._setupQuestionListeners();this._checkNumberOfQuestionsAnswered();this._updateQuestionsState();Adapt.assessment.saveState();if(typeof callback=="function")callback.apply(this);if(shouldResetAssessment||shouldResetQuestions){Adapt.trigger("assessments:postReset",this.getState(),this)}}},_setupBankedAssessment:function _setupBankedAssessment(){var assessmentConfig=this.getConfig();this._setupBanks();var questionModels=[];for(var bankId in this._questionBanks){if(this._questionBanks.hasOwnProperty(bankId)){var questionBank=this._questionBanks[bankId];var questions=questionBank.getRandomQuestionBlocks();questionModels=questionModels.concat(questions)}}if(assessmentConfig._banks._randomisation){questionModels=_.shuffle(questionModels)}return questionModels},_setupBanks:function _setupBanks(){var assessmentConfig=this.getConfig();var banks=assessmentConfig._banks._split.split(",");var bankId;this._questionBanks=[];for(var i=0,l=banks.length;i<l;i++){var bank=banks[i];bankId=i+1;var questionBank=new QuestionBank(bankId,this.get("_id"),bank,true);this._questionBanks[bankId]=questionBank}var children=this.getChildren().models;for(var j=0,count=children.length;j<count;j++){var blockModel=children[j];var blockAssessmentConfig=blockModel.get("_assessment");bankId=blockAssessmentConfig._quizBankID;this._questionBanks[bankId].addBlock(blockModel)}},_setupRandomisedAssessment:function _setupRandomisedAssessment(){var assessmentConfig=this.getConfig();var randomisationModel=assessmentConfig._randomisation;var blockModels=this.getChildren().models;var questionModels=_.shuffle(blockModels);if(randomisationModel._blockCount>0){questionModels=questionModels.slice(0,randomisationModel._blockCount)}return questionModels},_overrideQuestionComponentSettings:function _overrideQuestionComponentSettings(){var newSettings=this._getMarkingSettings();var questionConfig=this.getConfig()._questions;if(questionConfig.hasOwnProperty("_canShowFeedback")){newSettings._canShowFeedback=questionConfig._canShowFeedback}if(!_.isEmpty(newSettings)){for(var i=0,l=this._currentQuestionComponents.length;i<l;i++){this._currentQuestionComponents[i].set(newSettings,{pluginName:"_assessment"})}}},_setupQuestionListeners:function _setupQuestionListeners(){var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_isInteractionComplete"))continue;this.listenTo(question,"change:_isInteractionComplete",this._onQuestionCompleted)}},_checkNumberOfQuestionsAnswered:function _checkNumberOfQuestionsAnswered(){var questionComponents=this._currentQuestionComponents;var numberOfQuestionsAnswered=0;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_isInteractionComplete")){numberOfQuestionsAnswered++}}this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered)},_removeQuestionListeners:function _removeQuestionListeners(){var questionComponents=this._currentQuestionComponents;if(!questionComponents)return;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];this.stopListening(question,"change:_isInteractionComplete",this._onQuestionCompleted)}},_onQuestionCompleted:function _onQuestionCompleted(questionModel,value){if(value===false)return;if(!questionModel.get("_isInteractionComplete"))return;var numberOfQuestionsAnswered=this.get("_numberOfQuestionsAnswered");numberOfQuestionsAnswered++;this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered);this._updateQuestionsState();Adapt.assessment.saveState();this._checkAssessmentComplete()},_checkAssessmentComplete:function _checkAssessmentComplete(){var numberOfQuestionsAnswered=this.get("_numberOfQuestionsAnswered");var allQuestionsAnswered=numberOfQuestionsAnswered>=this._currentQuestionComponents.length;if(!allQuestionsAnswered)return;this._onAssessmentComplete()},_onAssessmentComplete:function _onAssessmentComplete(){var assessmentConfig=this.getConfig();this.set("_attemptInProgress",false);this._spendAttempt();var scoreAsPercent=this._getScoreAsPercent();var score=this._getScore();var maxScore=this._getMaxScore();this.set({_scoreAsPercent:scoreAsPercent,_score:score,_maxScore:maxScore,_lastAttemptScoreAsPercent:scoreAsPercent,_assessmentCompleteInSession:true,_isAssessmentComplete:true});this._updateQuestionsState();this._checkIsPass();this._removeQuestionListeners();if(this._isMarkingSuppressionEnabled()&&!this._isAttemptsLeft()){_.defer(function(){this._overrideMarkingSettings();this._refreshQuestions()}.bind(this))}Adapt.trigger("assessments:complete",this.getState(),this)},_updateQuestionsState:function _updateQuestionsState(){var questions=[];var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var questionComponent=questionComponents[i];var questionModel={_id:questionComponent.get("_id"),_isCorrect:questionComponent.get("_isCorrect")===undefined?null:questionComponent.get("_isCorrect")};questions.push(questionModel)}this.set("_questions",questions)},_checkIsPass:function _checkIsPass(){var assessmentConfig=this.getConfig();var isPercentageBased=assessmentConfig._isPercentageBased;var scoreToPass=assessmentConfig._scoreToPass;var scoreAsPercent=this.get("_scoreAsPercent");var score=this.get("_score");var isPass=isPercentageBased?scoreAsPercent>=scoreToPass:score>=scoreToPass;this.set("_isPass",isPass)},_getMarkingSettings:function _getMarkingSettings(){var markingSettings={};if(this._shouldSuppressMarking()){markingSettings={_canShowMarking:false,_canShowModelAnswer:false}}else{var questionConfig=this.getConfig()._questions;if(questionConfig.hasOwnProperty("_canShowModelAnswer")){markingSettings._canShowModelAnswer=questionConfig._canShowModelAnswer}if(questionConfig.hasOwnProperty("_canShowMarking")){markingSettings._canShowMarking=questionConfig._canShowMarking}}return markingSettings},_overrideMarkingSettings:function _overrideMarkingSettings(){var newMarkingSettings=this._getMarkingSettings();for(var i=0,l=this._currentQuestionComponents.length;i<l;i++){this._currentQuestionComponents[i].set(newMarkingSettings,{pluginName:"_assessment"})}},_refreshQuestions:function _refreshQuestions(){for(var a=0,b=this._currentQuestionComponents.length;a<b;a++){var question=this._currentQuestionComponents[a];question.refresh()}},_shouldSuppressMarking:function _shouldSuppressMarking(){return this._isMarkingSuppressionEnabled()&&this._isAttemptsLeft()},_isMarkingSuppressionEnabled:function _isMarkingSuppressionEnabled(){var assessmentConfig=this.getConfig();return assessmentConfig._suppressMarking},_isAttemptsLeft:function _isAttemptsLeft(){if(this.get("_isAssessmentComplete")&&this.get("_isPass"))return false;if(this.get("_attemptsLeft")===0)return false;return true},_spendAttempt:function _spendAttempt(){if(!this._isAttemptsLeft())return false;var attemptsSpent=this.get("_attemptsSpent");this.set("_attemptsSpent",++attemptsSpent);if(this.get("_attempts")=="infinite")return true;var attemptsLeft=this.get("_attemptsLeft");this.set("_attemptsLeft",--attemptsLeft);return true},_getScore:function _getScore(){var score=0;var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_isCorrect")&&question.get("_questionWeight")){score+=question.get("_questionWeight")}}return score},_getMaxScore:function _getMaxScore(){var maxScore=0;var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_questionWeight")){maxScore+=question.get("_questionWeight")}}return maxScore},_getScoreAsPercent:function _getScoreAsPercent(){if(this._getMaxScore()===0)return 0;return Math.round(this._getScore()/this._getMaxScore()*100)},_getLastAttemptScoreAsPercent:function _getLastAttemptScoreAsPercent(){return this.get("_lastAttemptScoreAsPercent")},_checkReloadPage:function _checkReloadPage(){if(!this.canResetInPage())return false;var parentId=this.getParent().get("_id");var currentLocation=Adapt.location._currentId;if(currentLocation!=parentId)return false;if(!this.get("_isReady"))return false;return true},_reloadPage:function _reloadPage(callback){this._forceResetOnRevisit=true;this.listenToOnce(Adapt,"pageView:ready",callback);_.delay(function(){Backbone.history.navigate("#/id/"+Adapt.location._currentId,{replace:true,trigger:true})},250)},_resetQuestions:function _resetQuestions(callback){var assessmentConfig=this.getConfig();var syncIterations=1;var i=0,qs=this._currentQuestionComponents,len=qs.length;function step(){for(var j=0,count=Math.min(syncIterations,len-i);j<count;i++,j++){var question=qs[i];question.reset(assessmentConfig._questions._resetType,true)}i==len?callback():setTimeout(step)}step()},_onRemove:function _onRemove(){this._removeQuestionListeners()},_setCompletionStatus:function _setCompletionStatus(){this.set({_isComplete:true,_isInteractionComplete:true})},_checkIfQuestionsWereRestored:function _checkIfQuestionsWereRestored(){if(this.get("_assessmentCompleteInSession"))return;if(!this.get("_isAssessmentComplete"))return;var wereQuestionsRestored=true;var questions=this.get("_questions");for(var i=0,l=questions.length;i<l;i++){var question=questions[i];var questionModel=Adapt.findById(question._id);if(!questionModel.get("_isSubmitted")){wereQuestionsRestored=false;break}}if(!wereQuestionsRestored){this.set("_assessmentCompleteInSession",true);return true}return false},isAssessmentEnabled:function isAssessmentEnabled(){if(this.get("_assessment")&&this.get("_assessment")._isEnabled)return true;return false},canResetInPage:function canResetInPage(){var assessmentConfig=this.getConfig();if(assessmentConfig._reloadPageOnReset===false)return false;return true},reset:function reset(force,callback){if(this._isResetInProgress){this.once("reset",function(){this._isResetInProgress=false;if(typeof callback=="function"){callback(true)}});return}var assessmentConfig=this.getConfig();force=this._forceResetOnRevisit||force===true;this._forceResetOnRevisit=false;var isPageReload=this._checkReloadPage();if(this.get("_assessmentCompleteInSession")&&!assessmentConfig._isResetOnRevisit&&!isPageReload&&!force){if(typeof callback=="function"){callback(false)}return false}var wereQuestionsRestored=this._checkIfQuestionsWereRestored();force=force||wereQuestionsRestored;if(force&&!this._isAttemptsLeft()){this.set({_attemptsLeft:this.get("_attempts"),_attemptsSpent:0})}var allowResetIfPassed=this.get("_assessment")._allowResetIfPassed;if(!this._isAttemptsLeft()&&!force&&!allowResetIfPassed){if(typeof callback=="function")callback(false);return false}if(!isPageReload){this.once("reset",function(){this._isResetInProgress=false;if(typeof callback=="function"){callback(true)}});this._isResetInProgress=true;this._setupAssessmentData(force,function(){this.trigger("reset")})}else{this._reloadPage(function(){if(typeof callback=="function"){callback(true)}})}return true},getSaveState:function getSaveState(){var state=this.getState();var indexByIdQuestions=[];var cfg=this.getConfig();var banksActive=cfg._banks&&cfg._banks._isEnabled&&cfg._banks._split.length>1;var randomisationActive=cfg._randomisation&&cfg._randomisation._isEnabled;if(!banksActive&&!randomisationActive){this.findDescendantModels("components").forEach(function(component){var componentModel={_id:component.get("_id"),_isCorrect:component.get("_isCorrect")===undefined?null:component.get("_isCorrect")};indexByIdQuestions.push(componentModel)});indexByIdQuestions=_.indexBy(indexByIdQuestions,"_id")}else{indexByIdQuestions=_.indexBy(state.questions,"_id")}for(var id in indexByIdQuestions){if(indexByIdQuestions.hasOwnProperty(id)){indexByIdQuestions[id]=indexByIdQuestions[id]._isCorrect}}var saveState=[state.isComplete?1:0,state.attemptsSpent,state.maxScore,state.score,state.attemptInProgress?1:0,indexByIdQuestions];return saveState},setRestoreState:function setRestoreState(restoreState){var id;var isComplete=restoreState[0]==1?true:false;var attempts=this.get("_attempts");var attemptsSpent=restoreState[1];var maxScore=restoreState[2];var score=restoreState[3];var attemptInProgress=restoreState[4]==1?true:false;var scoreAsPercent;var indexByIdQuestions=restoreState[5];var blockIds={};for(id in indexByIdQuestions){if(indexByIdQuestions.hasOwnProperty(id)){var blockId=Adapt.findById(id).get("_parentId");blockIds[blockId]=Adapt.findById(blockId)}}var restoredChildrenModels=_.values(blockIds);if(indexByIdQuestions)this.getChildren().models=restoredChildrenModels;this.set({_isAssessmentComplete:isComplete,_assessmentCompleteInSession:false,_attemptsSpent:attemptsSpent,_attemptInProgress:attemptInProgress,_attemptsLeft:attempts==="infinite"?attempts:attempts-attemptsSpent,_maxScore:maxScore||this._getMaxScore(),_score:score||0});if(score){scoreAsPercent=Math.round(score/maxScore*100)}else{scoreAsPercent=0}this.set({_scoreAsPercent:scoreAsPercent,_lastAttemptScoreAsPercent:scoreAsPercent});var questions=[];for(id in indexByIdQuestions){if(indexByIdQuestions.hasOwnProperty(id)&&Adapt.findById(id).get("_isQuestionType")){questions.push({_id:id,_isCorrect:indexByIdQuestions[id]})}}this.set("_questions",questions);if(isComplete)this._checkIsPass();Adapt.trigger("assessments:restored",this.getState(),this)},getState:function getState(){var assessmentConfig=this.getConfig();var state={id:assessmentConfig._id,type:"article-assessment",pageId:this.getParent().get("_id"),articleId:this.get("_id"),isEnabled:assessmentConfig._isEnabled,isComplete:this.get("_isAssessmentComplete"),isPercentageBased:assessmentConfig._isPercentageBased,scoreToPass:assessmentConfig._scoreToPass,score:this.get("_score"),scoreAsPercent:this.get("_scoreAsPercent"),maxScore:this.get("_maxScore"),isPass:this.get("_isPass"),includeInTotalScore:assessmentConfig._includeInTotalScore,assessmentWeight:assessmentConfig._assessmentWeight,attempts:this.get("_attempts"),attemptsSpent:this.get("_attemptsSpent"),attemptsLeft:this.get("_attemptsLeft"),attemptInProgress:this.get("_attemptInProgress"),lastAttemptScoreAsPercent:this.get("_lastAttemptScoreAsPercent"),questions:this.get("_questions"),resetType:assessmentConfig._questions._resetType,allowResetIfPassed:assessmentConfig._allowResetIfPassed,questionModels:new Backbone.Collection(this._currentQuestionComponents)};return state},getConfig:function getConfig(){var assessmentConfig=this.get("_assessment");if(!assessmentConfig){assessmentConfig=$.extend(true,{},assessmentConfigDefaults)}else{assessmentConfig=$.extend(true,{},assessmentConfigDefaults,assessmentConfig)}if(assessmentConfig._id===undefined){assessmentConfig._id="givenId"+givenIdCount++}this.set("_assessment",assessmentConfig);return assessmentConfig}};return AssessmentModel});define("extensions/adapt-contrib-assessment/js/assessment",["core/js/adapt"],function(Adapt){var assessmentsConfigDefaults={_isPercentageBased:true,_scoreToPass:100,_isDefaultsLoaded:true};Adapt.assessment=_.extend({_assessments:_.extend([],{_byPageId:{},_byAssessmentId:{}}),initialize:function initialize(){this.listenTo(Adapt,{"assessments:complete":this._onAssessmentsComplete,"router:location":this._checkResetAssessmentsOnRevisit,"router:plugin":this._handleRoute,"app:dataReady":this._onDataReady})},_onAssessmentsComplete:function _onAssessmentsComplete(state){var assessmentId=state.id;state.isComplete=true;if(assessmentId===undefined)return;if(!this._getStateByAssessmentId(assessmentId)){Adapt.log.warn("assessments: state was not registered when assessment was created")}this.saveState();this._setPageProgress();this._checkAssessmentsComplete()},_restoreModelState:function _restoreModelState(assessmentModel){if(!this._saveStateModel){this._saveStateModel=Adapt.offlineStorage.get("assessment")}if(this._saveStateModel){var state=assessmentModel.getState();if(this._saveStateModel[state.id]){assessmentModel.setRestoreState(this._saveStateModel[state.id])}}},_handleRoute:function _handleRoute(plugin,id){if(plugin!=="assessment"&&plugin!=="article-assessment"||id===undefined){return}if(!Adapt.findById(id)){var assessment=Adapt.assessment._assessments._byAssessmentId[id];if(assessment){id=assessment.get("_id")}else{Adapt.log.warn("Assessment not found with _id: "+id);return}}_.defer(function(){Backbone.history.navigate("#/id/"+id,{trigger:true,replace:true})})},_checkResetAssessmentsOnRevisit:function _checkResetAssessmentsOnRevisit(toObject){if(toObject._contentType!=="page")return;var pageAssessmentModels=this._getAssessmentByPageId(toObject._currentId);if(pageAssessmentModels===undefined)return;Adapt.wait.for(function resetAllAssessments(allAssessmentHaveReset){var numberOfAssessments=pageAssessmentModels.length;var numberOfResetAssessments=0;var forceAssessmentReset=false;pageAssessmentModels.forEach(function(model){model.reset(forceAssessmentReset,function(){numberOfResetAssessments++;var haveAllModelsReset=numberOfResetAssessments===numberOfAssessments;if(!haveAllModelsReset){return}allAssessmentHaveReset()})})});this._setPageProgress()},_onDataReady:function _onDataReady(){this._assessments=_.extend([],{_byPageId:{},_byAssessmentId:{}});this._restoredCount=0},_checkAssessmentsComplete:function _checkAssessmentsComplete(){var allAssessmentsComplete=true;var assessmentToPostBack=0;var states=this._getStatesByAssessmentId();var assessmentStates=[];for(var id in states){var state=states[id];if(!state.includeInTotalScore)continue;if(!state.isComplete){allAssessmentsComplete=false;break}assessmentToPostBack++;assessmentStates.push(state)}if(!allAssessmentsComplete||assessmentToPostBack===0)return false;if(assessmentToPostBack===1){this._setupSingleAssessmentConfiguration(assessmentStates[0])}_.defer(function(){Adapt.trigger("assessment:complete",this.getState())}.bind(this));return true},_setupSingleAssessmentConfiguration:function _setupSingleAssessmentConfiguration(assessmentState){var assessmentsConfig=Adapt.course.get("_assessment");$.extend(true,assessmentsConfig,{_isPercentageBased:assessmentState.isPercentageBased,_scoreToPass:assessmentState.scoreToPass});Adapt.course.set("_assessment",assessmentsConfig)},_getAssessmentByPageId:function _getAssessmentByPageId(pageId){return this._assessments._byPageId[pageId]},_getStateByAssessmentId:function _getStateByAssessmentId(assessmentId){if(assessmentId===undefined){return null}return this._assessments._byAssessmentId[assessmentId].getState()},_getStatesByAssessmentId:function _getStatesByAssessmentId(){var states={};for(var i=0,l=this._assessments.length;i<l;i++){var assessmentModel=this._assessments[i];if(!assessmentModel.get("_isAvailable"))continue;var state=assessmentModel.getState();states[state.id]=state}return states},_setPageProgress:function _setPageProgress(){for(var k in this._assessments._byPageId){var assessments=this._assessments._byPageId[k];var assessmentsTotal=assessments.length;var assessmentsPassed=0;for(var i=0,l=assessments.length;i<l;i++){var assessmentState=assessments[i].getState();if(assessmentState.includeInTotalScore&&!assessmentState.isPass)continue;if(assessmentState.isComplete){assessmentsPassed++}}try{var pageModel=Adapt.findById(k);pageModel.set({_subProgressTotal:assessmentsTotal,_subProgressComplete:assessmentsPassed})}catch(e){}}},_addToAssessmentIdMap:function _addToAssessmentIdMap(id,model){if(id===undefined){Adapt.log.warn("An assessment has been registered with an undefined value for \"_id\"");return}if(id===""){Adapt.log.warn("An assessment has been registered with an empty value for \"_id\"")}if(!this._assessments._byAssessmentId[id]){this._assessments._byAssessmentId[id]=model}else{Adapt.log.warn("An assessment with an _id of \""+id+"\" already exists!")}},_setupQuestionNumbering:function _setupQuestionNumbering(){var getRelatedQuestions=function getRelatedQuestions(data){var currentAssessmentId=data._assessmentId;var currentAssessment=Adapt.assessment.get(currentAssessmentId);return currentAssessment.getState().questions};Handlebars.registerHelper("questionNumber",function getQuestionNumber(){var data=this.view?this.view.model.toJSON():this;if(!data._isPartOfAssessment)return;var related=_.pluck(getRelatedQuestions(data),"_id");return related.indexOf(data._id)+1});Handlebars.registerHelper("questionCount",function getTotalQuestions(){var data=this.view?this.view.model.toJSON():this;if(!data._isPartOfAssessment)return;return getRelatedQuestions(data).length})},register:function register(assessmentModel){var state=assessmentModel.getState();var assessmentId=state.id;var pageId=state.pageId;if(this._assessments._byPageId[pageId]===undefined){this._assessments._byPageId[pageId]=[]}this._assessments._byPageId[pageId].push(assessmentModel);this._addToAssessmentIdMap(assessmentId,assessmentModel);this._assessments.push(assessmentModel);this._restoreModelState(assessmentModel);this._restoredCount++;Adapt.trigger("assessments:register",state,assessmentModel);this._setPageProgress();this._setupQuestionNumbering();if(this._restoredCount===this._assessments.length){Adapt.trigger("assessment:restored",this.getState())}},get:function get(id){if(id===undefined){return this._assessments.slice(0)}else{return this._assessments._byAssessmentId[id]}},saveState:function saveState(){this._saveStateModel={};for(var i=0,assessmentModel;assessmentModel=this._assessments[i++];){var state=assessmentModel.getState();this._saveStateModel[state.id]=assessmentModel.getSaveState()}Adapt.offlineStorage.set("assessment",this._saveStateModel)},getConfig:function getConfig(){var assessmentsConfig=Adapt.course.get("_assessment");if(assessmentsConfig&&assessmentsConfig._isDefaultsLoaded){return assessmentsConfig}if(assessmentsConfig===undefined){assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults)}else{assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults,assessmentsConfig)}Adapt.course.set("_assessment",assessmentsConfig);return assessmentsConfig},getState:function getState(){var assessmentsConfig=this.getConfig();var score=0;var maxScore=0;var isPass=false;var totalAssessments=0;var states=this._getStatesByAssessmentId();var assessmentsComplete=0;for(var id in states){var state=states[id];if(!state.includeInTotalScore)continue;if(state.isComplete)assessmentsComplete++;totalAssessments++;maxScore+=state.maxScore/state.assessmentWeight;score+=state.score/state.assessmentWeight}var isComplete=assessmentsComplete==totalAssessments;var scoreAsPercent=Math.round(score/maxScore*100);if((assessmentsConfig._scoreToPass||100)&&isComplete){if(assessmentsConfig._isPercentageBased!==false){if(scoreAsPercent>=assessmentsConfig._scoreToPass)isPass=true}else{if(score>=assessmentsConfig._scoreToPass)isPass=true}}return{isComplete:isComplete,isPercentageBased:assessmentsConfig._isPercentageBased,isPass:isPass,scoreAsPercent:scoreAsPercent,maxScore:maxScore,score:score,scoreToPass:assessmentsConfig._scoreToPass,assessmentsComplete:assessmentsComplete,assessments:totalAssessments}}},Backbone.Events);Adapt.assessment.initialize()});define("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleExtension",["core/js/views/articleView","core/js/models/articleModel","./adapt-assessmentArticleView","./adapt-assessmentArticleModel","./assessment"],function(ArticleView,ArticleModel,AdaptAssessmentArticleView,AdaptAssessmentArticleModel){var ArticleViewInitialize=ArticleView.prototype.initialize;ArticleView.prototype.initialize=function(options){if(this.model.get("_assessment")&&this.model.get("_assessment")._isEnabled===true){_.extend(this,AdaptAssessmentArticleView)}return ArticleViewInitialize.apply(this,arguments)};var ArticleModelInitialize=ArticleModel.prototype.initialize;ArticleModel.prototype.initialize=function(options){if(this.get("_assessment")&&this.get("_assessment")._isEnabled===true){_.extend(this,AdaptAssessmentArticleModel);var returnValue=ArticleModelInitialize.apply(this,arguments);this._postInitialize();return returnValue}return ArticleModelInitialize.apply(this,arguments)}});define("extensions/adapt-contrib-bookmarking/js/adapt-contrib-bookmarking",["core/js/adapt"],function(Adapt){var Bookmarking=Backbone.Controller.extend({bookmarkLevel:null,watchViewIds:null,watchViews:[],restoredLocationID:null,currentLocationID:null,initialize:function initialize(){this.listenToOnce(Adapt,"router:location",this.onAdaptInitialize)},onAdaptInitialize:function onAdaptInitialize(){if(!this.checkIsEnabled())return;this.setupEventListeners();this.checkRestoreLocation()},checkIsEnabled:function checkIsEnabled(){var courseBookmarkModel=Adapt.course.get("_bookmarking");if(!courseBookmarkModel||!courseBookmarkModel._isEnabled)return false;if(!Adapt.offlineStorage)return false;return true},setupEventListeners:function setupEventListeners(){this._onScroll=_.debounce(this.checkLocation.bind(this),1000);this.listenTo(Adapt,{"menuView:ready":this.setupMenu,"pageView:preRender":this.setupPage})},checkRestoreLocation:function checkRestoreLocation(){this.restoredLocationID=Adapt.offlineStorage.get("location");if(!this.restoredLocationID||this.restoredLocationID==="undefined")return;this.listenToOnce(Adapt,"pageView:ready menuView:ready",this.restoreLocation)},restoreLocation:function restoreLocation(){_.defer(function(){this.stopListening(Adapt,"pageView:ready menuView:ready",this.restoreLocation);if(this.restoredLocationID===Adapt.location._currentId||!Adapt.findById(this.restoredLocationID)){return}var locationOnscreen=$("."+this.restoredLocationID).onscreen();var isLocationOnscreen=locationOnscreen&&locationOnscreen.percentInview>0;var isLocationFullyInview=locationOnscreen&&locationOnscreen.percentInview===100;if(isLocationOnscreen&&isLocationFullyInview){return}if(Adapt.course.get("_bookmarking")._showPrompt===false){this.navigateToPrevious();return}this.showPrompt()}.bind(this))},showPrompt:function showPrompt(){var courseBookmarkModel=Adapt.course.get("_bookmarking");var buttons=courseBookmarkModel._buttons||{yes:"Yes",no:"No"};this.listenToOnce(Adapt,{"bookmarking:continue":this.navigateToPrevious,"bookmarking:cancel":this.navigateCancel});var promptObject={title:courseBookmarkModel.title,body:courseBookmarkModel.body,_prompts:[{promptText:buttons.yes||"Yes",_callbackEvent:"bookmarking:continue"},{promptText:buttons.no||"No",_callbackEvent:"bookmarking:cancel"}],_showIcon:true};var accessibility=Adapt.config.get("_accessibility");if(!accessibility||!accessibility._isActive){Adapt.trigger("notify:prompt",promptObject);return}$(".js-loading").show();$("#a11y-focuser").focus();$("body").attr("aria-hidden",true);_.delay(function(){$(".js-loading").hide();$("body").removeAttr("aria-hidden");Adapt.trigger("notify:prompt",promptObject)},3000)},navigateToPrevious:function navigateToPrevious(){_.defer(_asyncToGenerator(regeneratorRuntime.mark(function _callee14(){var isSinglePage;return regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:isSinglePage=Adapt.contentObjects.models.length==1;_context14.next=3;return Adapt.navigateToElement("."+this.restoredLocationID,{trigger:true,replace:isSinglePage,duration:400});case 3:case"end":return _context14.stop();}}},_callee14,this)})).bind(this));this.stopListening(Adapt,"bookmarking:cancel")},navigateCancel:function navigateCancel(){this.stopListening(Adapt,"bookmarking:continue")},resetLocationID:function resetLocationID(){this.setLocationID("")},setupMenu:function setupMenu(menuView){var menuModel=menuView.model;if(!menuModel.get("_parentId")){this.resetLocationID();return}this.setLocationID(menuModel.get("_id"))},getBookmarkLevel:function getBookmarkLevel(pageModel){var defaultLevel=Adapt.course.get("_bookmarking")._level||"component";var bookmarkModel=pageModel.get("_bookmarking");var isInherit=!bookmarkModel||!bookmarkModel._level||bookmarkModel._level==="inherit";return isInherit?defaultLevel:bookmarkModel._level},setupPage:function setupPage(pageView){var pageBookmarkModel=pageView.model.get("_bookmarking");if(pageBookmarkModel&&pageBookmarkModel._isEnabled===false){this.resetLocationID();return}this.setLocationID(pageView.model.get("_id"));this.bookmarkLevel=this.getBookmarkLevel(pageView.model);if(this.bookmarkLevel==="page"){return}this.watchViewIds=pageView.model.findDescendantModels(this.bookmarkLevel+"s").map(function(desc){return desc.get("_id")});this.listenTo(Adapt,this.bookmarkLevel+"View:postRender",this.captureViews);this.listenToOnce(Adapt,"remove",this.releaseViews);$(window).on("scroll",this._onScroll)},captureViews:function captureViews(view){this.watchViews.push(view)},setLocationID:function setLocationID(id){if(!Adapt.offlineStorage)return;if(this.currentLocationID==id)return;Adapt.offlineStorage.set("location",id);this.currentLocationID=id},releaseViews:function releaseViews(){this.watchViews.length=0;this.watchViewIds.length=0;this.stopListening(Adapt,"remove",this.releaseViews);this.stopListening(Adapt,this.bookmarkLevel+"View:postRender",this.captureViews);$(window).off("scroll",this._onScroll)},checkLocation:function checkLocation(){var highestOnscreen=0;var highestOnscreenLocation="";for(var i=0,l=this.watchViews.length;i<l;i++){var view=this.watchViews[i];var isViewAPageChild=this.watchViewIds.indexOf(view.model.get("_id"))>-1;if(!isViewAPageChild)continue;var element=$("."+view.model.get("_id"));var measurements=element.onscreen();if(!measurements.onscreen)continue;if(measurements.percentInview>highestOnscreen){highestOnscreen=measurements.percentInview;highestOnscreenLocation=view.model.get("_id")}}if(highestOnscreenLocation)this.setLocationID(highestOnscreenLocation)}});return new Bookmarking});define("extensions/adapt-contrib-contentObjectTransition/js/adapt-contrib-contentObjectTransition",["core/js/adapt"],function(Adapt){var ContentObjectTransition=function(_Backbone$Controller7){"use strict";_inherits(ContentObjectTransition,_Backbone$Controller7);var _super48=_createSuper(ContentObjectTransition);function ContentObjectTransition(){_classCallCheck(this,ContentObjectTransition);return _super48.apply(this,arguments)}_createClass(ContentObjectTransition,[{key:"initialize",value:function initialize(){this.href=window.location.href.replace(/#.*/,"");this.views=[];this.lastState={scroll:0};this.keepScroll=false;_.bindAll(this,"endAnimation","updateHash","onScroll","onPopState");this.listenTo(Adapt,"app:dataReady",this.onDataReady)}},{key:"onDataReady",value:function onDataReady(){var config=Adapt.course.get("_contentObjectTransition");if(!config||!config._isEnabled)return;this.setupOverrides();this.setupEventListeners()}},{key:"setupOverrides",value:function setupOverrides(){Adapt.set({"_shouldDestroyContentObjects":false,"_shouldContentObjectScrollTop":false});Backbone.history._updateHash=this.updateHash;history.scrollRestoration="manual";window.addEventListener("scroll",this.onScroll,{passive:false,capture:true});window.addEventListener("popstate",this.onPopState,{passive:false,capture:true})}},{key:"updateHash",value:function updateHash(location,fragment,replace){this.lastState={scroll:0};history[replace?"replaceState":"pushState"](this.lastState,"",this.href+"#"+fragment)}},{key:"onScroll",value:function onScroll(){this.keepScroll=$(window).scrollTop();history.replaceState({scroll:$(window).scrollTop()},"",window.location.hash)}},{key:"onPopState",value:function onPopState(e){this.lastState=e.state||{scroll:0};if(this.keepScroll===false)return;$(window).scrollTop(this.keepScroll)}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(Adapt,{"preRemove":this.onPreRemove,"contentObjectView:preRender":this.onContentObjectViewPreRender,"contentObjectView:preReady":this.onContentObjectViewPreReady,"contentObjectView:postRemove":this.onContentObjectViewPostRemove})}},{key:"onPreRemove",value:function onPreRemove(contentObjectView){if(!contentObjectView)return;this.views.push(contentObjectView)}},{key:"onContentObjectViewPreRender",value:function onContentObjectViewPreRender(contentObjectView){var _this87=this;if(this.views.length<1)return;if(this.lastState&&this.lastState.scroll!==undefined){var scrollTo=this.lastState.scroll-$(".nav").height();contentObjectView.$el.css("top",-scrollTo)}var index=this.views.length;contentObjectView.disableAnimation=true;contentObjectView.$el.css("opacity","");this.views.push(contentObjectView);contentObjectView.$el.addClass("contentobjecttransition__initial");var models=[Adapt.course].concat(Adapt.course.getAllDescendantModels(true));var previousModel=this.views[index-1].model;var currentModel=contentObjectView.model;var previousIndex=models.findIndex(function(model){_newArrowCheck(this,_this87);return model===previousModel}.bind(this));var currentIndex=models.findIndex(function(model){_newArrowCheck(this,_this87);return model===currentModel}.bind(this));var isScrollForward=currentIndex>=previousIndex;if(isScrollForward){contentObjectView.$el.addClass("contentobjecttransition__initial__forward")}else{contentObjectView.$el.addClass("contentobjecttransition__initial__backward")}}},{key:"onContentObjectViewPreReady",value:function onContentObjectViewPreReady(contentObjectView){var _this88=this;if(this.views.length<2)return;var index=this.views.findIndex(function(view){_newArrowCheck(this,_this88);return view===contentObjectView}.bind(this));if(index===-1)return;Adapt.wait.begin();var incomingContentObject=this.views[index];incomingContentObject.$el[0].addEventListener("transitionend",this.endAnimation);incomingContentObject.$el[0].addEventListener("animationend",this.endAnimation);incomingContentObject.$el.addClass("contentobjecttransition__start");var outgoingContentObject=this.views[index-1];outgoingContentObject.$el.css("transform-origin","center calc(".concat($(window).scrollTop(),"px + (100vh / 2))"));outgoingContentObject.$el.addClass("contentobjecttransition__preremove");outgoingContentObject.$el.addClass("contentobjecttransition__remove")}},{key:"endAnimation",value:function endAnimation(event){var _this89=this;var index=this.views.findIndex(function(view){_newArrowCheck(this,_this89);return view.$el[0]===event.srcElement}.bind(this));if(index===-1)return;var incomingContentObject=this.views[index];if(!incomingContentObject.$el.hasClass("contentobjecttransition__start"))return;incomingContentObject.$el[0].removeEventListener("transitionend",this.endAnimation);incomingContentObject.$el[0].removeEventListener("animationend",this.endAnimation);window.requestAnimationFrame(function(){_newArrowCheck(this,_this89);incomingContentObject.$el.removeClass(["contentobjecttransition__start","contentobjecttransition__initial","contentobjecttransition__initial__backward","contentobjecttransition__initial__forward"].join(" "));var scrollTo=this.lastState&&this.lastState.scroll!==undefined?this.lastState.scroll:0;$(window).scrollTop(scrollTo);incomingContentObject.$el.css("top","");Adapt.wait.end()}.bind(this));var outgoingContentObject=this.views[index-1];outgoingContentObject.$el.remove();_.defer(function(){_newArrowCheck(this,_this89);$(window).resize();outgoingContentObject.destroy()}.bind(this))}},{key:"onContentObjectViewPostRemove",value:function onContentObjectViewPostRemove(contentObjectView){var _this90=this;var index=this.views.findIndex(function(view){_newArrowCheck(this,_this90);return view===contentObjectView}.bind(this));this.views.splice(index,2);if(this.views.length)return}}]);return ContentObjectTransition}(Backbone.Controller);return new ContentObjectTransition});define("extensions/adapt-contrib-languagePicker/js/languagePickerNavigationView",["core/js/adapt"],function(Adapt){var NavigationView=Backbone.View.extend({className:"nav",attributes:{role:"navigation"},initialize:function initialize(){this.template="languagePickerNavigation";this.setupHelpers();this.preRender()},preRender:function preRender(){Adapt.trigger("navigationView:preRender",this);this.render()},render:function render(){var template=Handlebars.templates[this.template];this.$el.html(template({_config:this.model.get("_accessibility"),_accessibility:Adapt.config.get("_accessibility")})).insertBefore("#app");_.defer(function(){Adapt.trigger("navigationView:postRender",this)}.bind(this));return this},setupHelpers:function setupHelpers(){Handlebars.registerHelper("a11y_aria_label",function(text){return"<div class=\"aria-label\">"+text+"</div>"})}});return NavigationView});define("extensions/adapt-contrib-languagePicker/js/languagePickerView",["core/js/adapt","./languagePickerNavigationView"],function(Adapt,NavigationView){var LanguagePickerView=Backbone.View.extend({events:{"click .js-languagepicker-btn-click":"onLanguageClick"},className:"languagepicker",initialize:function initialize(){this.initializeNavigation();$("html").addClass("in-languagepicker");this.listenTo(Adapt,"remove",this.remove);this.render()},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data));this.$el.addClass(data._classes);document.title=this.model.get("title")||"";_.defer(this.postRender.bind(this))},postRender:function postRender(){$(".js-loading").hide()},onLanguageClick:function onLanguageClick(event){this.destroyNavigation();this.model.setLanguage($(event.target).val())},initializeNavigation:function initializeNavigation(){this.navigationView=new NavigationView({model:this.model})},destroyNavigation:function destroyNavigation(){this.navigationView.remove()},remove:function remove(){$("html").removeClass("in-languagepicker");Backbone.View.prototype.remove.apply(this,arguments)}},{template:"languagePickerView"});return LanguagePickerView});define("extensions/adapt-contrib-languagePicker/js/languagePickerDrawerView",["core/js/adapt"],function(Adapt){var LanguagePickerDrawerView=Backbone.View.extend({events:{"click .js-languagepicker-item-btn":"onButtonClick"},initialize:function initialize(){this.listenTo(Adapt,{remove:this.remove,"languagepicker:changelanguage:yes":this.onDoChangeLanguage,"languagepicker:changelanguage:no":this.onDontChangeLanguage});this.render()},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))},onButtonClick:function onButtonClick(event){var newLanguage=$(event.currentTarget).attr("data-language");this.model.set("newLanguage",newLanguage);var data=this.model.getLanguageDetails(newLanguage);var promptObject={_attributes:{lang:newLanguage},_classes:"is-lang-".concat(newLanguage," ").concat(data._direction==="rtl"?"is-rtl":"is-ltr"),title:data.warningTitle,body:data.warningMessage,_prompts:[{promptText:data._buttons.yes,_callbackEvent:"languagepicker:changelanguage:yes"},{promptText:data._buttons.no,_callbackEvent:"languagepicker:changelanguage:no"}],_showIcon:true};if($.a11y){this.$finishFocus=$.a11y.state.focusStack.pop();$.a11y.state.focusStack.push($("#focuser"))}else{this.$finishFocus=Adapt.a11y._popup._focusStack.pop();Adapt.a11y._popup._focusStack.push($("#a11y-focuser"))}Adapt.once("drawer:closed",function(){_.delay(function(){Adapt.once("popup:opened",function(){if($.a11y){$.a11y.state.focusStack.pop();$.a11y.state.focusStack.push($("#focuser"));return}Adapt.a11y._popup._focusStack.pop();Adapt.a11y._popup._focusStack.push($("#a11y-focuser"))});Adapt.trigger("notify:prompt",promptObject)},250)});Adapt.trigger("drawer:closeDrawer")},onDoChangeLanguage:function onDoChangeLanguage(){var newLanguage=this.model.get("newLanguage");this.model.setTrackedData();this.model.setLanguage(newLanguage);this.remove()},onDontChangeLanguage:function onDontChangeLanguage(){this.remove();_.delay(function(){this.$finishFocus.a11y_focus()}.bind(this),500)}},{template:"languagePickerDrawerView"});return LanguagePickerDrawerView});define("extensions/adapt-contrib-languagePicker/js/languagePickerNavView",["core/js/adapt","./languagePickerDrawerView"],function(Adapt,LanguagePickerDrawerView){var LanguagePickerNavView=Backbone.View.extend({tagName:"button",className:function className(){var classNames="btn-icon nav__btn nav__languagepicker-btn js-languagepicker-nav-btn icon";var customClass=this.model.get("_languagePickerIconClass")||"icon-language-2";return classNames+" "+customClass},events:{"click":"onClick"},initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove)},onClick:function onClick(event){Adapt.drawer.triggerCustomView(new LanguagePickerDrawerView({model:this.model}).$el,false)}});return LanguagePickerNavView});define("extensions/adapt-contrib-languagePicker/js/languagePickerModel",["core/js/adapt"],function(Adapt){var LanguagePickerModel=Backbone.Model.extend({defaults:{_isEnabled:false,displayTitle:"",body:"",_languages:[]},trackedData:{components:[],blocks:[]},locationId:null,initialize:function initialize(){this.listenTo(Adapt.config,"change:_activeLanguage",this.markLanguageAsSelected);this.listenTo(Adapt,"app:dataLoaded",this.onDataLoaded)},getLanguageDetails:function getLanguageDetails(language){var _languages=this.get("_languages");return _.find(_languages,function(item){return item._language===language})},setLanguage:function setLanguage(language){Adapt.config.set({"_activeLanguage":language,"_defaultDirection":this.getLanguageDetails(language)._direction})},markLanguageAsSelected:function markLanguageAsSelected(model,language){this.get("_languages").forEach(function(item){item._isSelected=item._language===language})},onDataLoaded:function onDataLoaded(){if(!this.get("_restoreStateOnLanguageChange")){return}_.defer(function(){this.locationId=Adapt.offlineStorage.get("location")||null;this.restoreState()}.bind(this))},restoreLocation:function restoreLocation(){if(!Adapt.mapById(this.locationId))return;_.defer(function(){Adapt.navigateToElement("."+this.locationId)}.bind(this))},restoreState:function restoreState(){if(this.isTrackedDataEmpty())return;if(this.trackedData.components){this.trackedData.components.forEach(this.setTrackableState)}if(this.trackedData.blocks){this.trackedData.blocks.forEach(this.setTrackableState)}},isTrackedDataEmpty:function isTrackedDataEmpty(){return _.isEqual(this.trackedData,{components:[],blocks:[]})},getTrackableState:function getTrackableState(){var components=this.getState(Adapt.components.models);var blocks=this.getState(Adapt.blocks.models);return{components:_.compact(components),blocks:_.compact(blocks)}},getState:function getState(models){return models.map(function(model){if(model.get("_isComplete")){return model.getTrackableState()}})},setTrackedData:function setTrackedData(){if(this.get("_restoreStateOnLanguageChange")){this.listenToOnce(Adapt,"menuView:ready",this.restoreLocation);this.trackedData=this.getTrackableState()}},setTrackableState:function setTrackableState(stateObject){var restoreModel=Adapt.findById(stateObject._id);if(restoreModel){restoreModel.setTrackableState(stateObject)}else{Adapt.log.warn("LanguagePicker unable to restore state for: "+stateObject._id)}}});return LanguagePickerModel});define("extensions/adapt-contrib-languagePicker/js/adapt-languagePicker",["core/js/adapt","./languagePickerView","./languagePickerNavView","./languagePickerModel"],function(Adapt,LanguagePickerView,LanguagePickerNavView,LanguagePickerModel){var languagePickerModel;Adapt.once("configModel:dataLoaded",onConfigLoaded);function onConfigLoaded(){if(!Adapt.config.has("_languagePicker"))return;if(!Adapt.config.get("_languagePicker")._isEnabled)return;Adapt.config.set("_canLoadData",false);languagePickerModel=new LanguagePickerModel(Adapt.config.get("_languagePicker"));Adapt.on("router:menu router:page",setupNavigationView);if(Adapt.offlineStorage.ready){onOfflineStorageReady()}else{Adapt.once("offlineStorage:ready",onOfflineStorageReady)}}function onOfflineStorageReady(){var storedLanguage=Adapt.offlineStorage.get("lang");if(storedLanguage){languagePickerModel.setLanguage(storedLanguage)}else if(languagePickerModel.get("_showOnCourseLoad")===false){languagePickerModel.setLanguage(Adapt.config.get("_defaultLanguage"))}else{showLanguagePickerView()}}function showLanguagePickerView(){var languagePickerView=new LanguagePickerView({model:languagePickerModel});languagePickerView.$el.appendTo("#wrapper")}function setupNavigationView(){var courseGlobals=Adapt.course.get("_globals")._extensions;var navigationBarLabel="";if(courseGlobals._languagePicker){navigationBarLabel=courseGlobals._languagePicker.navigationBarLabel}var languagePickerNavView=new LanguagePickerNavView({model:languagePickerModel,attributes:{"aria-label":navigationBarLabel}});languagePickerNavView.$el.appendTo(".nav__inner")}});define("extensions/adapt-contrib-pageLevelProgress/js/completionCalculations",["core/js/adapt"],function(Adapt){var Completion=Backbone.Controller.extend({subProgressCompleted:0,subProgressTotal:0,nonAssessmentCompleted:0,nonAssessmentTotal:0,assessmentCompleted:0,assessmentTotal:0});function calculateCompletion(contentObjectModel){var completion=new Completion;var viewType=contentObjectModel.get("_type");var isComplete=contentObjectModel.get("_isComplete")?1:0;var children;switch(viewType){case"page":children=contentObjectModel.getAllDescendantModels().filter(function(model){return model.get("_isAvailable")&&!model.get("_isOptional")});var availableChildren=filterAvailableChildren(children);var components=getPageLevelProgressEnabledModels(availableChildren);var nonAssessmentComponents=getNonAssessmentComponents(components);completion.nonAssessmentTotal=nonAssessmentComponents.length;completion.nonAssessmentCompleted=getComponentsCompleted(nonAssessmentComponents).length;var assessmentComponents=getAssessmentComponents(components);completion.assessmentTotal=assessmentComponents.length;completion.assessmentCompleted=getComponentsInteractionCompleted(assessmentComponents).length;if(contentObjectModel.get("_pageLevelProgress")._excludeAssessments!==true){completion.subProgressCompleted=contentObjectModel.get("_subProgressComplete")||0;completion.subProgressTotal=contentObjectModel.get("_subProgressTotal")||0}var showPageCompletionCourse=Adapt.course.get("_pageLevelProgress")&&Adapt.course.get("_pageLevelProgress")._showPageCompletion!==false;var showPageCompletionPage=contentObjectModel.get("_pageLevelProgress")&&contentObjectModel.get("_pageLevelProgress")._showPageCompletion!==false;if(showPageCompletionCourse&&showPageCompletionPage){completion.nonAssessmentCompleted+=isComplete;completion.nonAssessmentTotal+=1}break;case"menu":case"course":children=contentObjectModel.get("_children").models;children.forEach(function(contentObject){var completionObject=calculateCompletion(contentObject);completion.subProgressCompleted+=completionObject.subProgressCompleted||0;completion.subProgressTotal+=completionObject.subProgressTotal||0;completion.nonAssessmentTotal+=completionObject.nonAssessmentTotal;completion.nonAssessmentCompleted+=completionObject.nonAssessmentCompleted;completion.assessmentTotal+=completionObject.assessmentTotal;completion.assessmentCompleted+=completionObject.assessmentCompleted});break;}return completion}function getNonAssessmentComponents(models){return models.filter(function(model){return!model.get("_isPartOfAssessment")})}function getAssessmentComponents(models){return models.filter(function(model){return model.get("_isPartOfAssessment")})}function getComponentsCompleted(models){return models.filter(function(item){return item.get("_isComplete")})}function getComponentsInteractionCompleted(models){return models.filter(function(item){return item.get("_isComplete")})}function getPageLevelProgressEnabledModels(models){return models.filter(function(model){var config=model.get("_pageLevelProgress");return config&&config._isEnabled})}function unavailableInHierarchy(parents){if(!parents)return;return parents.some(function(parent){return!parent.get("_isAvailable")})}function filterAvailableChildren(children){var availableChildren=[];for(var i=0,count=children.length;i<count;i++){var parents=children[i].getAncestorModels();if(unavailableInHierarchy(parents))continue;availableChildren.push(children[i])}return availableChildren}function calculatePercentageComplete(model){var completionObject=calculateCompletion(model);var completed=completionObject.nonAssessmentCompleted+completionObject.assessmentCompleted+completionObject.subProgressCompleted;var total=completionObject.nonAssessmentTotal+completionObject.assessmentTotal+completionObject.subProgressTotal;var percentageComplete=Math.floor(completed/total*100);return percentageComplete}return{calculateCompletion:calculateCompletion,calculatePercentageComplete:calculatePercentageComplete,getPageLevelProgressEnabledModels:getPageLevelProgressEnabledModels,filterAvailableChildren:filterAvailableChildren}});define("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressIndicatorView",["core/js/adapt"],function(Adapt){var PageLevelProgressIndicatorView=Backbone.View.extend({initialize:function initialize(options){options=options||{};this.parent=options.parent;this.calculatePercentage=options.calculatePercentage||this.calculatePercentage;this.ariaLabel=options.ariaLabel||"";this.type=options.type||this.model.get("_type");this.addClasses();this.setUpEventListeners();this.setPercentageComplete();this.render();this.refresh()},addClasses:function addClasses(){this.$el.addClass(["pagelevelprogress__indicator","is-"+this.type].join(" "))},checkAria:function checkAria(){if(!this.ariaLabel){this.$el.attr("aria-hidden",true);return}var data=this.getRenderData();this.$(".js-indicator-aria-label").html(Handlebars.compile(this.ariaLabel)(data))},setUpEventListeners:function setUpEventListeners(){if(this.parent){this.listenToOnce(this.parent,"postRemove",this.remove)}else{this.listenTo(Adapt,"remove",this.remove)}this.listenTo(this.model,"change:_isComplete",this.refresh);if(!this.collection)return;this.listenTo(this.collection,"change:_isComplete",this.refresh)},setPercentageComplete:function setPercentageComplete(){var percentage=this.calculatePercentage();this.model.set("percentageComplete",percentage);return percentage},calculatePercentage:function calculatePercentage(){return this.model.get("_isComplete")?100:0},render:function render(){var data=this.getRenderData();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))},getRenderData:function getRenderData(){var data=this.model.toJSON();data.ariaLabel=this.ariaLabel;data.type=this.type;return data},refresh:function refresh(){this.checkCompletion();this.checkAria();this.$(".js-indicator-bar").css({width:this.calculatePercentage()+"%"})},checkCompletion:function checkCompletion(){var percentage=this.setPercentageComplete();this.$el.toggleClass("is-complete",percentage===100).toggleClass("is-incomplete",percentage!==100)}},{template:"pageLevelProgressIndicator"});return PageLevelProgressIndicatorView});define("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressItemView",["core/js/adapt","./PageLevelProgressIndicatorView"],function(Adapt,PageLevelProgressIndicatorView){var PageLevelProgressItemView=Backbone.View.extend({className:function className(){return["pagelevelprogress__item drawer__item",this.model.get("_type")+"__indicator"].join(" ")},attributes:{"role":"listitem"},initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.render();this.addIndicator()},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))},addIndicator:function addIndicator(){if(this.model.get("_isOptional"))return;var item=new PageLevelProgressIndicatorView({model:this.model});this.$(".js-indicator").append(item.$el)}},{template:"pageLevelProgressItem"});return PageLevelProgressItemView});define("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressView",["core/js/adapt","./PageLevelProgressItemView"],function(Adapt,PageLevelProgressItemView){var PageLevelProgressView=Backbone.View.extend({className:"pagelevelprogress",events:{"click .js-pagelevelprogress-item-click":"scrollToPageElement"},initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.render();this.addChildren()},scrollToPageElement:function scrollToPageElement(event){if(event&&event.preventDefault)event.preventDefault();var $target=$(event.currentTarget);if($target.is(".is-disabled"))return;var currentComponentSelector="."+$target.attr("data-pagelevelprogress-id");Adapt.once("drawer:closed",function(){Adapt.scrollTo(currentComponentSelector,{duration:400})}).trigger("drawer:closeDrawer",$(currentComponentSelector))},render:function render(){var template=Handlebars.templates["pageLevelProgress"];this.$el.html(template({}))},addChildren:function addChildren(){var $children=this.$(".js-children");this.collection.each(function(model){$children.append(new PageLevelProgressItemView({model:model}).$el)}.bind(this))}});return PageLevelProgressView});define("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressNavigationView",["core/js/adapt","./completionCalculations","./PageLevelProgressView","./PageLevelProgressIndicatorView"],function(Adapt,completionCalculations,PageLevelProgressView,PageLevelProgressIndicatorView){var PageLevelProgressNavigationView=Backbone.View.extend({tagName:"button",className:"btn-icon nav__btn nav__pagelevelprogress-btn pagelevelprogress__nav-btn",events:{"click":"onProgressClicked"},initialize:function initialize(){_.bindAll(this,"updateProgressBar");this.setUpEventListeners();this.render();this.addIndicator();this.deferredUpdate()},setUpEventListeners:function setUpEventListeners(){this.listenTo(Adapt,{"remove":this.remove,"router:location":this.updateProgressBar,"pageLevelProgress:update":this.refreshProgressBar})},render:function render(){var template=Handlebars.templates["pageLevelProgressNavigation"];this.$el.html(template({}))},addIndicator:function addIndicator(){this.indicatorView=new PageLevelProgressIndicatorView({model:this.model,collection:this.collection,calculatePercentage:this._getPageCompletionPercentage,ariaLabel:Adapt.course.get("_globals")._extensions._pageLevelProgress.pageLevelProgressIndicatorBar});this.$el.prepend(this.indicatorView.$el)},_getPageCompletionPercentage:function _getPageCompletionPercentage(){return completionCalculations.calculatePercentageComplete(this.model)},deferredUpdate:function deferredUpdate(){_.defer(this.updateProgressBar)},updateProgressBar:function updateProgressBar(){this.indicatorView.refresh()},refreshProgressBar:function refreshProgressBar(){this.collection.repopulate();this.updateProgressBar()},onProgressClicked:function onProgressClicked(event){if(event&&event.preventDefault)event.preventDefault();Adapt.drawer.triggerCustomView(new PageLevelProgressView({collection:this.collection}).$el,false)},remove:function remove(){Backbone.View.prototype.remove.call(this);this.collection.reset()}});return PageLevelProgressNavigationView});define("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressCollection",["core/js/adapt","./completionCalculations"],function(Adapt,completionCalculations){var PageLevelProgressCollection=Backbone.Collection.extend({initialize:function initialize(models,options){this.listenTo(Adapt,"remove",this.reset);if(!options||!options.pageModel)return;this._pageModel=options.pageModel;this.repopulate()},repopulate:function repopulate(){this.reset();if(!this._pageModel)return;var allDescendants=this._pageModel.getAllDescendantModels(true);var currentPageItems=allDescendants.filter(function(item){return item.get("_isAvailable")===true});var availableItems=completionCalculations.filterAvailableChildren(currentPageItems);var enabledProgressItems=completionCalculations.getPageLevelProgressEnabledModels(availableItems);this.add(enabledProgressItems)}});return PageLevelProgressCollection});define("extensions/adapt-contrib-pageLevelProgress/js/adapt-contrib-pageLevelProgress",["core/js/adapt","./completionCalculations","./PageLevelProgressNavigationView","./PageLevelProgressIndicatorView","./PageLevelProgressCollection"],function(Adapt,completionCalculations,PageLevelProgressNavigationView,PageLevelProgressIndicatorView,PageLevelProgressCollection){var PageLevelProgress=Backbone.Controller.extend({initialize:function initialize(){Adapt.on({"app:dataReady":this.onDataReady.bind(this),"app:languageChanged":function(){this.stopListening()}.bind(this)})},getCourseConfig:function getCourseConfig(){return Adapt.course.get("_pageLevelProgress")},onDataReady:function onDataReady(){var coursePLPConfig=this.getCourseConfig();if(!coursePLPConfig||!coursePLPConfig._isEnabled){return}this.setUpEventListeners()},setUpEventListeners:function setUpEventListeners(){var headerIndicatorTypes=["menu","menuItem","page","article","block","component"];var headerIndicatorEventNames=headerIndicatorTypes.concat([""]).join("View:render ");this.listenTo(Adapt,headerIndicatorEventNames,this.renderHeaderIndicatorView);this.listenTo(Adapt,{"menuItemView:postRender":this.renderMenuItemIndicatorView,"router:page":this.renderNavigationView});this.listenTo(Adapt.course,"bubble:change:_isComplete",this.onCompletionChange)},onCompletionChange:function onCompletionChange(event){if(!Adapt.location._currentId)return;var currentModel=Adapt.findById(Adapt.location._currentId);var completionState={currentLocation:completionCalculations.calculatePercentageComplete(currentModel),course:completionCalculations.calculatePercentageComplete(Adapt.course)};var hasChanged=!_.isMatch(this._previousCompletionState,completionState);if(!hasChanged)return;this._previousCompletionState=completionState;Adapt.trigger("pageLevelProgress:percentageCompleteChange",completionState)},renderHeaderIndicatorView:function renderHeaderIndicatorView(view){var model=view.model;var config=model.get("_pageLevelProgress");if(!config||!config._isEnabled||!config._isCompletionIndicatorEnabled){return}var pageModel=model.findAncestor("contentObjects");var pageConfig=pageModel&&pageModel.get("_pageLevelProgress");if(pageConfig&&!pageConfig._isEnabled){return}var $headings=view.$(".js-heading");$headings.each(function(index,el){var $el=$(el);var indicatorView=new PageLevelProgressIndicatorView({parent:view,model:model});indicatorView.$el.insertAfter($el)})},renderMenuItemIndicatorView:function renderMenuItemIndicatorView(view){if(view.model.get("_id")===Adapt.location._currentId){return}var viewType=view.model.get("_type");if(viewType==="course"){return}var pageLevelProgress=view.model.get("_pageLevelProgress");if(!pageLevelProgress||!pageLevelProgress._isEnabled){return}view.$el.find(".js-menu-item-progress").append(new PageLevelProgressIndicatorView({parent:view,model:view.model,type:"menu-item",calculatePercentage:this._getMenuItemCompletionPercentage.bind(view),ariaLabel:Adapt.course.get("_globals")._extensions._pageLevelProgress.pageLevelProgressMenuBar}).$el)},_getMenuItemCompletionPercentage:function _getMenuItemCompletionPercentage(){return completionCalculations.calculatePercentageComplete(this.model)},renderNavigationView:function renderNavigationView(pageModel){var coursePLPConfig=this.getCourseConfig();if(coursePLPConfig&&coursePLPConfig._isShownInNavigationBar===false){return}var pagePLPConfig=pageModel.get("_pageLevelProgress");if(!pagePLPConfig||!pagePLPConfig._isEnabled){return}var collection=new PageLevelProgressCollection(null,{pageModel:pageModel});if(collection.length===0){return}$(".nav__drawer-btn").after(new PageLevelProgressNavigationView({model:pageModel,collection:collection}).$el)}});Adapt.pageLevelProgress=new PageLevelProgress});define("extensions/adapt-contrib-resources/js/adapt-contrib-resourcesView",["core/js/adapt"],function(Adapt){var ResourcesView=Backbone.View.extend({className:"resources",initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.render()},events:{"click .js-resources-filter-btn-click":"onFilterClicked"},render:function render(){this.$el.html(Handlebars.templates.resources({model:this.model.toJSON(),resources:this.collection.toJSON()}));_.defer(function(){this.listenTo(Adapt,"drawer:triggerCustomView",this.remove)}.bind(this));return this},onFilterClicked:function onFilterClicked(e){if(e&&e.preventDefault)e.preventDefault();this.$(".js-resources-filter-btn-click").removeClass("is-selected");var items;var filter=$(e.currentTarget).addClass("is-selected").attr("data-filter");if(filter==="all"){items=this.$(".js-resources-item").removeClass("u-display-none")}else{this.$(".js-resources-item").removeClass("u-display-none").not(".is-"+filter).addClass("u-display-none");items=this.$(".js-resources-item.is-"+filter)}if(items.length>0)$(items[0]).a11y_focus()}});return ResourcesView});define("extensions/adapt-contrib-resources/js/adapt-contrib-resourcesHelpers",["handlebars","core/js/adapt"],function(Handlebars,Adapt){var helpers={resources_has_type:function resources_has_type(resources,type,block){var hasType=_.some(resources,_.matcher({_type:type}));return hasType?block.fn(this):block.inverse(this)},resources_has_multiple_types:function resources_has_multiple_types(resources,block){if(resources.length===1)return block.inverse(this);var allSameType=_.every(resources,_.matcher({_type:resources[0]._type}));return allSameType?block.inverse(this):block.fn(this)},resources_get_column_count:function resources_get_column_count(resources){return _.uniq(_.pluck(resources,"_type")).length+1},resources_force_download:function resources_force_download(resource,block){if(Adapt.device.browser==="internet explorer"||Adapt.device.OS==="ios"){return block.inverse(this)}return resource._forceDownload||resource.filename?block.fn(this):block.inverse(this)}};for(var name in helpers){if(helpers.hasOwnProperty(name)){Handlebars.registerHelper(name,helpers[name])}}});define("extensions/adapt-contrib-resources/js/adapt-contrib-resources",["core/js/adapt","./adapt-contrib-resourcesView","./adapt-contrib-resourcesHelpers"],function(Adapt,ResourcesView,ResourcesHelpers){function setupResources(resourcesData){var resourcesModel=new Backbone.Model(resourcesData);var resourcesCollection=new Backbone.Collection(resourcesModel.get("_resourcesItems"));Adapt.on("resources:showResources",function(){Adapt.drawer.triggerCustomView(new ResourcesView({model:resourcesModel,collection:resourcesCollection}).$el)})}function initResources(){var courseResources=Adapt.course.get("_resources");if(!courseResources||courseResources._isEnabled===false)return;var drawerObject={title:courseResources.title,description:courseResources.description,className:"is-resources",drawerOrder:courseResources._drawerOrder||0};Adapt.drawer.addItem(drawerObject,"resources:showResources");setupResources(courseResources)}Adapt.on("adapt:start",initResources)});define("extensions/adapt-contrib-spoor/js/scorm/logger",[],function(){var Logger=function(){"use strict";function Logger(){_classCallCheck(this,Logger);this.logArr=[];this.registeredViews=[]}_createClass(Logger,[{key:"getEntries",value:function getEntries(){return this.logArr}},{key:"getLastEntry",value:function getLastEntry(){return this.logArr[this.logArr.length-1]}},{key:"info",value:function info(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_INFO,time:Date.now()};this.updateViews()}},{key:"warn",value:function warn(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_WARN,time:Date.now()};this.updateViews()}},{key:"error",value:function error(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_ERROR,time:Date.now()};this.updateViews()}},{key:"debug",value:function debug(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_DEBUG,time:Date.now()};this.updateViews()}},{key:"registerView",value:function registerView(_view){this.registeredViews[this.registeredViews.length]=_view}},{key:"unregisterView",value:function unregisterView(_view){for(var _i8=0,l=this.registeredViews.length;_i8<l;_i8++){if(this.registeredViews[_i8]!==_view)continue;this.registeredViews.splice(_i8,1);_i8--}}},{key:"updateViews",value:function updateViews(){for(var _i9=0,l=this.registeredViews.length;_i9<l;_i9++){if(!this.registeredViews[_i9])continue;this.registeredViews[_i9].update(this)}}}],[{key:"getInstance",value:function getInstance(){if(Logger.instance===null){Logger.instance=new Logger}return Logger.instance}}]);return Logger}();Logger.instance=null;Logger.LOG_TYPE_INFO=0;Logger.LOG_TYPE_WARN=1;Logger.LOG_TYPE_ERROR=2;Logger.LOG_TYPE_DEBUG=3;return Logger});define("extensions/adapt-contrib-spoor/js/scorm/wrapper",["libraries/SCORM_API_wrapper","./logger"],function(pipwerks,Logger){var ScormWrapper=function(){"use strict";function ScormWrapper(){_classCallCheck(this,ScormWrapper);this.setCompletedWhenFailed=true;this.commitOnStatusChange=true;this.timedCommitFrequency=10;this.maxCommitRetries=5;this.commitRetryDelay=1000;this.commitRetryPending=false;this.commitRetries=0;this.lastCommitSuccessTime=null;this.exitStateIfIncomplete="auto";this.exitStateIfComplete="auto";this.timedCommitIntervalID=null;this.retryCommitTimeoutID=null;this.logOutputWin=null;this.startTime=null;this.endTime=null;this.lmsConnected=false;this.finishCalled=false;this.logger=Logger.getInstance();this.scorm=pipwerks.SCORM;this.scorm.handleExitMode=false;this.suppressErrors=false;if(window.__debug){this.showDebugWindow()}if(window.API&&window.API.__offlineAPIWrapper||window.API_1484_11&&window.API_1484_11.__offlineAPIWrapper){this.logger.error("Offline SCORM API is being used. No data will be reported to the LMS!")}}_createClass(ScormWrapper,[{key:"getVersion",value:function getVersion(){return this.scorm.version}},{key:"setVersion",value:function setVersion(value){this.logger.debug("ScormWrapper::setVersion: ".concat(value));this.scorm.version=value}},{key:"initialize",value:function initialize(){this.logger.debug("ScormWrapper::initialize");this.lmsConnected=this.scorm.init();if(this.lmsConnected){this.startTime=new Date;this.initTimedCommit()}else{this.handleError("Course could not connect to the LMS")}return this.lmsConnected}},{key:"isFirstSession",value:function isFirstSession(){return this.getValue(this.isSCORM2004()?"cmi.entry":"cmi.core.entry")==="ab-initio"}},{key:"setIncomplete",value:function setIncomplete(){this.setValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status","incomplete");if(this.commitOnStatusChange)this.commit()}},{key:"setCompleted",value:function setCompleted(){this.setValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status","completed");if(this.commitOnStatusChange)this.commit()}},{key:"setPassed",value:function setPassed(){if(this.isSCORM2004()){this.setValue("cmi.completion_status","completed");this.setValue("cmi.success_status","passed")}else{this.setValue("cmi.core.lesson_status","passed")}if(this.commitOnStatusChange)this.commit()}},{key:"setFailed",value:function setFailed(){if(this.isSCORM2004()){this.setValue("cmi.success_status","failed");if(this.setCompletedWhenFailed){this.setValue("cmi.completion_status","completed")}}else{this.setValue("cmi.core.lesson_status","failed")}if(this.commitOnStatusChange)this.commit()}},{key:"getStatus",value:function getStatus(){var status=this.getValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status");switch(status.toLowerCase()){case"passed":case"completed":case"incomplete":case"failed":case"browsed":case"not attempted":case"not_attempted":case"unknown":return status;default:this.handleError("ScormWrapper::getStatus: invalid lesson status '".concat(status,"' received from LMS"));return null;}}},{key:"setStatus",value:function setStatus(status){switch(status.toLowerCase()){case"incomplete":this.setIncomplete();break;case"completed":this.setCompleted();break;case"passed":this.setPassed();break;case"failed":this.setFailed();break;default:this.handleError("ScormWrapper::setStatus: the status '".concat(status,"' is not supported."));}}},{key:"getScore",value:function getScore(){return this.getValue(this.isSCORM2004()?"cmi.score.raw":"cmi.core.score.raw")}},{key:"setScore",value:function setScore(_score,_minScore,_maxScore){if(this.isSCORM2004()){this.setValue("cmi.score.raw",_score);this.setValue("cmi.score.min",_minScore);this.setValue("cmi.score.max",_maxScore);var range=_maxScore-_minScore;var scaledScore=((_score-_minScore)/range).toFixed(7);this.setValue("cmi.score.scaled",scaledScore);return}this.setValue("cmi.core.score.raw",_score);if(this.isSupported("cmi.core.score.min"))this.setValue("cmi.core.score.min",_minScore);if(this.isSupported("cmi.core.score.max"))this.setValue("cmi.core.score.max",_maxScore)}},{key:"getLessonLocation",value:function getLessonLocation(){return this.getValue(this.isSCORM2004()?"cmi.location":"cmi.core.lesson_location")}},{key:"setLessonLocation",value:function setLessonLocation(_location){this.setValue(this.isSCORM2004()?"cmi.location":"cmi.core.lesson_location",_location)}},{key:"getSuspendData",value:function getSuspendData(){return this.getValue("cmi.suspend_data")}},{key:"setSuspendData",value:function setSuspendData(_data){this.setValue("cmi.suspend_data",_data)}},{key:"getStudentName",value:function getStudentName(){return this.getValue(this.isSCORM2004()?"cmi.learner_name":"cmi.core.student_name")}},{key:"getStudentId",value:function getStudentId(){return this.getValue(this.isSCORM2004()?"cmi.learner_id":"cmi.core.student_id")}},{key:"setLanguage",value:function setLanguage(_lang){if(this.isSCORM2004()){this.setValue("cmi.learner_preference.language",_lang);return}if(this.isSupported("cmi.student_preference.language")){this.setValue("cmi.student_preference.language",_lang)}}},{key:"commit",value:function commit(){this.logger.debug("ScormWrapper::commit");if(!this.lmsConnected){this.handleError("Course is not connected to the LMS");return}if(this.commitRetryPending){this.logger.debug("ScormWrapper::commit: skipping this commit call as one is already pending.")}else{if(this.scorm.save()){this.commitRetries=0;this.lastCommitSuccessTime=new Date}else{if(this.commitRetries<this.maxCommitRetries&&!this.finishCalled){this.commitRetries++;this.initRetryCommit()}else{var _errorCode=this.scorm.debug.getCode();var _errorMsg="Course could not commit data to the LMS";_errorMsg+="\nError ".concat(_errorCode,": ").concat(this.scorm.debug.getInfo(_errorCode));_errorMsg+="\nLMS Error Info: ".concat(this.scorm.debug.getDiagnosticInfo(_errorCode));this.handleError(_errorMsg)}}}}},{key:"finish",value:function finish(){this.logger.debug("ScormWrapper::finish");if(!this.lmsConnected||this.finishCalled){this.handleError("Course is not connected to the LMS");return}this.finishCalled=true;if(this.timedCommitIntervalID!==null){window.clearInterval(this.timedCommitIntervalID)}if(this.commitRetryPending){window.clearTimeout(this.retryCommitTimeoutID);this.commitRetryPending=false}if(this.logOutputWin&&!this.logOutputWin.closed){this.logOutputWin.close()}this.endTime=new Date;if(this.isSCORM2004()){this.scorm.set("cmi.session_time",this.convertToSCORM2004Time(this.endTime.getTime()-this.startTime.getTime()));this.scorm.set("cmi.exit",this.getExitState())}else{this.scorm.set("cmi.core.session_time",this.convertToSCORM12Time(this.endTime.getTime()-this.startTime.getTime()));this.scorm.set("cmi.core.exit",this.getExitState())}this.lmsConnected=false;if(!this.scorm.quit()){this.handleError("Course could not finish")}}},{key:"recordInteraction",value:function recordInteraction(id,response,correct,latency,type){if(!this.isSupported("cmi.interactions._count")){this.logger.info("ScormWrapper::recordInteraction: cmi.interactions are not supported by this LMS...");return}switch(type){case"choice":this.recordInteractionMultipleChoice.apply(this,arguments);break;case"matching":this.recordInteractionMatching.apply(this,arguments);break;case"numeric":this.isSCORM2004()?this.recordInteractionScorm2004.apply(this,arguments):this.recordInteractionScorm12.apply(this,arguments);break;case"fill-in":this.recordInteractionFillIn.apply(this,arguments);break;default:console.error("ScormWrapper.recordInteraction: unknown interaction type of '".concat(type,"' encountered..."));}}},{key:"getValue",value:function getValue(_property){this.logger.debug("ScormWrapper::getValue: _property=".concat(_property));if(this.finishCalled){this.logger.debug("ScormWrapper::getValue: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError("Course is not connected to the LMS");return}var _value=this.scorm.get(_property);var _errorCode=this.scorm.debug.getCode();var _errorMsg="";if(_errorCode!==0){if(_errorCode===403){this.logger.warn("ScormWrapper::getValue: data model element not initialized")}else{_errorMsg+="Course could not get ".concat(_property);_errorMsg+="\nError Info: ".concat(this.scorm.debug.getInfo(_errorCode));_errorMsg+="\nLMS Error Info: ".concat(this.scorm.debug.getDiagnosticInfo(_errorCode));this.handleError(_errorMsg)}}this.logger.debug("ScormWrapper::getValue: returning ".concat(_value));return _value+""}},{key:"setValue",value:function setValue(_property,_value){this.logger.debug("ScormWrapper::setValue: _property=".concat(_property," _value=").concat(_value));if(this.finishCalled){this.logger.debug("ScormWrapper::setValue: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError("Course is not connected to the LMS");return}var _success=this.scorm.set(_property,_value);var _errorCode=this.scorm.debug.getCode();var _errorMsg="";if(!_success){if(_errorCode!==0){_errorMsg+="Course could not set ".concat(_property," to ").concat(_value);_errorMsg+="\nError Info: ".concat(this.scorm.debug.getInfo(_errorCode));_errorMsg+="\nLMS Error Info: ".concat(this.scorm.debug.getDiagnosticInfo(_errorCode));this.handleError(_errorMsg)}else{this.logger.warn("ScormWrapper::setValue: LMS reported that the 'set' call failed but then said there was no error!")}}return _success}},{key:"isSupported",value:function isSupported(_property){this.logger.debug("ScormWrapper::isSupported: _property=".concat(_property));if(this.finishCalled){this.logger.debug("ScormWrapper::isSupported: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError("Course is not connected to the LMS");return false}this.scorm.get(_property);return this.scorm.debug.getCode()===401}},{key:"initTimedCommit",value:function initTimedCommit(){this.logger.debug("ScormWrapper::initTimedCommit");if(this.timedCommitFrequency>0){var delay=this.timedCommitFrequency*(60*1000);this.timedCommitIntervalID=window.setInterval(this.commit.bind(this),delay)}}},{key:"initRetryCommit",value:function initRetryCommit(){this.logger.debug("ScormWrapper::initRetryCommit ".concat(this.commitRetries," out of ").concat(this.maxCommitRetries));this.commitRetryPending=true;this.retryCommitTimeoutID=window.setTimeout(this.doRetryCommit.bind(this),this.commitRetryDelay)}},{key:"doRetryCommit",value:function doRetryCommit(){this.logger.debug("ScormWrapper::doRetryCommit");this.commitRetryPending=false;this.commit()}},{key:"handleError",value:function handleError(_msg){this.logger.error(_msg);if(!this.suppressErrors&&(!this.logOutputWin||this.logOutputWin.closed)&&confirm("An error has occured:\n\n".concat(_msg,"\n\nPress 'OK' to view debug information to send to technical support."))){this.showDebugWindow()}}},{key:"getInteractionCount",value:function getInteractionCount(){var count=this.getValue("cmi.interactions._count");return count===""?0:count}},{key:"recordInteractionScorm12",value:function recordInteractionScorm12(id,response,correct,latency,type){id=this.trim(id);var cmiPrefix="cmi.interactions.".concat(this.getInteractionCount());this.setValue("".concat(cmiPrefix,".id"),id);this.setValue("".concat(cmiPrefix,".type"),type);this.setValue("".concat(cmiPrefix,".student_response"),response);this.setValue("".concat(cmiPrefix,".result"),correct?"correct":"wrong");if(latency!==null&&latency!==undefined)this.setValue("".concat(cmiPrefix,".latency"),this.convertToSCORM12Time(latency));this.setValue("".concat(cmiPrefix,".time"),this.getCMITime())}},{key:"recordInteractionScorm2004",value:function recordInteractionScorm2004(id,response,correct,latency,type){id=this.trim(id);var cmiPrefix="cmi.interactions.".concat(this.getInteractionCount());this.setValue("".concat(cmiPrefix,".id"),id);this.setValue("".concat(cmiPrefix,".type"),type);this.setValue("".concat(cmiPrefix,".learner_response"),response);this.setValue("".concat(cmiPrefix,".result"),correct?"correct":"incorrect");if(latency!==null&&latency!==undefined)this.setValue("".concat(cmiPrefix,".latency"),this.convertToSCORM2004Time(latency));this.setValue("".concat(cmiPrefix,".timestamp"),this.getISO8601Timestamp())}},{key:"recordInteractionMultipleChoice",value:function recordInteractionMultipleChoice(id,response,correct,latency,type){if(this.isSCORM2004()){response=response.replace(/,|#/g,"[,]")}else{response=response.replace(/#/g,",");response=this.checkResponse(response,"choice")}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}},{key:"recordInteractionMatching",value:function recordInteractionMatching(id,response,correct,latency,type){response=response.replace(/#/g,",");if(this.isSCORM2004()){response=response.replace(/,/g,"[,]");response=response.replace(/\./g,"[.]")}else{response=this.checkResponse(response,"matching")}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}},{key:"recordInteractionFillIn",value:function recordInteractionFillIn(id,response,correct,latency,type){var maxLength=this.isSCORM2004()?250:255;if(response.length>maxLength){response=response.substr(0,maxLength);this.logger.warn("ScormWrapper::recordInteractionFillIn: response data for ".concat(id," is longer than the maximum allowed length of ").concat(maxLength," characters; data will be truncated to avoid an error."))}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}},{key:"showDebugWindow",value:function showDebugWindow(){if(this.logOutputWin&&!this.logOutputWin.closed){this.logOutputWin.close()}this.logOutputWin=window.open("log_output.html","Log","width=600,height=300,status=no,scrollbars=yes,resizable=yes,menubar=yes,toolbar=yes,location=yes,top=0,left=0");if(this.logOutputWin){this.logOutputWin.focus()}}},{key:"convertToSCORM12Time",value:function convertToSCORM12Time(msConvert){var msPerSec=1000;var msPerMin=msPerSec*60;var msPerHour=msPerMin*60;var ms=msConvert%msPerSec;msConvert=msConvert-ms;var secs=msConvert%msPerMin;msConvert=msConvert-secs;secs=secs/msPerSec;var mins=msConvert%msPerHour;msConvert=msConvert-mins;mins=mins/msPerMin;var hrs=msConvert/msPerHour;if(hrs>9999){return"9999:99:99.99"}var str=[this.padWithZeroes(hrs,4),this.padWithZeroes(mins,2),this.padWithZeroes(secs,2)].join(":");return"".concat(str,".").concat(Math.floor(ms/10))}},{key:"convertToSCORM2004Time",value:function convertToSCORM2004Time(msConvert){var csConvert=Math.floor(msConvert/10);var csPerSec=100;var csPerMin=csPerSec*60;var csPerHour=csPerMin*60;var csPerDay=csPerHour*24;var days=Math.floor(csConvert/csPerDay);csConvert-=days*csPerDay;days=days?days+"D":"";var hours=Math.floor(csConvert/csPerHour);csConvert-=hours*csPerHour;hours=hours?hours+"H":"";var mins=Math.floor(csConvert/csPerMin);csConvert-=mins*csPerMin;mins=mins?mins+"M":"";var secs=Math.floor(csConvert/csPerSec);csConvert-=secs*csPerSec;secs=secs||"0";var cs=csConvert;cs=cs?"."+cs:"";var seconds=secs+cs+"S";var hms=[hours,mins,seconds].join("");return"P"+days+"T"+hms}},{key:"getCMITime",value:function getCMITime(){var date=new Date;var hours=this.padWithZeroes(date.getHours(),2);var min=this.padWithZeroes(date.getMinutes(),2);var sec=this.padWithZeroes(date.getSeconds(),2);return[hours,min,sec].join(":")}},{key:"getISO8601Timestamp",value:function getISO8601Timestamp(){var date=new Date().toISOString();return date.replace(/.\d\d\dZ/,"")}},{key:"padWithZeroes",value:function padWithZeroes(numToPad,padBy){var len=padBy;while(--len){numToPad="0"+numToPad}return numToPad.slice(-padBy)}},{key:"trim",value:function trim(str){return str.replace(/^\s*|\s*$/g,"")}},{key:"isSCORM2004",value:function isSCORM2004(){return this.scorm.version==="2004"}},{key:"checkResponse",value:function checkResponse(response,responseType){var _this91=this;if(!response)return response;if(responseType!=="choice"&&responseType!=="matching")return response;response=response.split(/,|#/);var self=this;if(responseType==="choice"){response=response.map(checkIdentifier)}else{response=response.map(function(r){_newArrowCheck(this,_this91);var identifiers=r.split(".");return checkIdentifier(identifiers[0])+"."+checkIdentifier(identifiers[1])}.bind(this))}function checkIdentifier(r){var i;if(r.length===1&&r>="0"&&r<="9")return r;if(r.length===1&&r>="a"&&r<="z")return r;i=parseInt(r);if(isNaN(i)||i<10||i>35){self.handleError("Numeric choice/matching response elements must use a value from 0 to 35 in SCORM 1.2")}return Number(i).toString(36)}return response.join(",")}},{key:"getExitState",value:function getExitState(){var completionStatus=this.scorm.data.completionStatus;var isIncomplete=completionStatus==="incomplete"||completionStatus==="not attempted";var exitState=isIncomplete?this.exitStateIfIncomplete:this.exitStateIfComplete;if(exitState!=="auto")return exitState;if(this.isSCORM2004())return isIncomplete?"suspend":"normal";return""}}],[{key:"getInstance",value:function getInstance(){if(ScormWrapper.instance===null){ScormWrapper.instance=new ScormWrapper}return ScormWrapper.instance}}]);return ScormWrapper}();ScormWrapper.instance=null;return ScormWrapper});define("extensions/adapt-contrib-spoor/js/serializers/SCORMSuspendData",["underscore"],function(_){var _this100=this;var ZeroString={};function makeZeroString(length){ZeroString[length]=ZeroString[length]||new Array(length+1).join("0");return ZeroString[length]}for(var _i10=1,l=64;_i10<=l;_i10++){makeZeroString(_i10)}function zeroPadRightToLength(string,length){var padLength=length-string.length;if(padLength>0){string+=makeZeroString(padLength)}return string}function zeroPadLeftToLength(string,length){var padLength=length-string.length;if(padLength>0){string=makeZeroString(padLength)+string}return string}function zeroPadRightToMultiple(string,multiple){var padLength=multiple-string.length%multiple;if(padLength!==multiple){string+=makeZeroString(padLength)}return string}function binaryToUnsignedInteger(binary,binaryLength){if(binaryLength===0){return 0}binary=zeroPadLeftToLength(binary,binaryLength);var integer=parseInt(binary.slice(0,binaryLength),2);return integer}function shiftUnsignedIntegerFromBinary(binary,binaryLength){if(binaryLength===0){return[0,binary]}binary=zeroPadLeftToLength(binary,binaryLength);var integer=parseInt(binary.slice(0,binaryLength),2);binary=binary.slice(binaryLength);return[integer,binary]}function shiftBinary(binary,binaryLength){if(binaryLength===0){return["",binary]}binary=zeroPadLeftToLength(binary,binaryLength);var shifted=binary.slice(0,binaryLength);binary=binary.slice(binaryLength);return[shifted,binary]}function unsignedIntegerToBinary(integer,binaryLength){if(binaryLength===0){return""}var binary=Math.abs(integer).toString(2);if(typeof binaryLength==="undefined"){return binary}var length=binary.length;if(length>binaryLength){throw new Error("Integer too big for specified binary length. integer: ".concat(integer," binarylen: ").concat(binaryLength))}binary=zeroPadLeftToLength(binary,binaryLength);return binary}function byteArrayToString(array){var arrayLength=array.length;var string=new Array(arrayLength);for(var _i11=0,_l=arrayLength;_i11<_l;_i11++){string[_i11]=String.fromCharCode(array[_i11])}string=string.join("");return string}function stringToByteArray(string){var stringLength=string.length;var array=new Array(stringLength);for(var _i12=0,_l2=stringLength;_i12<_l2;_i12++){array[_i12]=string.charCodeAt(_i12)}return array}var BYTE_BIT_LENGTH=8;function binaryToBase64(binary){binary=_.flatten(binary).join("");binary=zeroPadRightToMultiple(binary,BYTE_BIT_LENGTH);var bytesCount=binary.length/BYTE_BIT_LENGTH;var charCodes=new Array(bytesCount);for(var _i13=0,_l3=bytesCount;_i13<_l3;_i13++){var _shiftUnsignedInteger=shiftUnsignedIntegerFromBinary(binary,BYTE_BIT_LENGTH);var _shiftUnsignedInteger2=_slicedToArray(_shiftUnsignedInteger,2);charCodes[_i13]=_shiftUnsignedInteger2[0];binary=_shiftUnsignedInteger2[1]}var base64=btoa(byteArrayToString(charCodes));base64=base64.replace(/=/g,"");base64=base64.replace(/\+/g,"-");return base64}function base64ToBinary(base64){base64=base64.replace(/-/g,"+");var charCodes=stringToByteArray(atob(base64));var bytesCount=charCodes.length;var binary=new Array(bytesCount);for(var _i14=0,_l4=bytesCount;_i14<_l4;_i14++){binary[_i14]=unsignedIntegerToBinary(charCodes[_i14],BYTE_BIT_LENGTH)}binary=binary.join("");return binary}var logs={usedTypes:{},typeLengths:{},binarySamples:{}};var AbstractValueType=function(){"use strict";function AbstractValueType(options){_classCallCheck(this,AbstractValueType);Object.assign(this,options);this.binaryTypeLength=this.binaryType.length}_createClass(AbstractValueType,[{key:"log",value:function log(binary){var name=this.name;logs.usedTypes[name]=logs.usedTypes[name]||0;logs.usedTypes[name]++;logs.binarySamples[name]=logs.binarySamples[name]||[];logs.binarySamples[name].push(binary)}}]);return AbstractValueType}();;var FixedIntegerType=function(_AbstractValueType){"use strict";_inherits(FixedIntegerType,_AbstractValueType);var _super49=_createSuper(FixedIntegerType);function FixedIntegerType(options){var _this92;_classCallCheck(this,FixedIntegerType);_this92=_super49.call(this,options);_this92.esType="number";if(!_this92.valueBinaryLength){return _possibleConstructorReturn(_this92)}_this92.minValue=options.minValue||0;_this92.maxValue=options.maxValue||Math.pow(2,_this92.valueBinaryLength)-1;return _this92}_createClass(FixedIntegerType,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var binary=unsignedIntegerToBinary(integer,this.valueBinaryLength);if(logStats){this.log(binary)}binary=[binary];return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var integer;var _shiftUnsignedInteger3=shiftUnsignedIntegerFromBinary(binary,this.valueBinaryLength);var _shiftUnsignedInteger4=_slicedToArray(_shiftUnsignedInteger3,2);integer=_shiftUnsignedInteger4[0];binary=_shiftUnsignedInteger4[1];return[integer,binary]}}]);return FixedIntegerType}(AbstractValueType);var FixedBooleanType=function(_FixedIntegerType){"use strict";_inherits(FixedBooleanType,_FixedIntegerType);var _super50=_createSuper(FixedBooleanType);function FixedBooleanType(options){var _this93;_classCallCheck(this,FixedBooleanType);options.valueBinaryLength=1;_this93=_super50.call(this,options);_this93.esType="boolean";return _this93}_createClass(FixedBooleanType,[{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var bool=binary[0]==="1";binary=binary.slice(1);return[bool,binary]}}]);return FixedBooleanType}(FixedIntegerType);var LengthAndValueBinary=function(){"use strict";function LengthAndValueBinary(parent,name,bitSizes){var _this94=this;_classCallCheck(this,LengthAndValueBinary);this.parent=parent;this.name=name;this.bitSizes=bitSizes;this.maxValues=_.flatten(this.bitSizes).map(function(value){_newArrowCheck(this,_this94);return Math.pow(2,value)-1}.bind(this));this.maxValue=this.maxValues[this.maxValues.length-1];this.sizeBinaryLength=unsignedIntegerToBinary(this.bitSizes.length-1).length}_createClass(LengthAndValueBinary,[{key:"valueToBinary",value:function valueToBinary(integer){var _this95=this;var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var parentName=this.parent.name;var sizeIndex=this.maxValues.findIndex(function(maxValue){_newArrowCheck(this,_this95);return integer<=maxValue}.bind(this));if(sizeIndex===-1){throw new Error("Value is too large for type: ".concat(parentName," value: ").concat(integer," max: ").concat(this.maxValue))}var sizeBinary=unsignedIntegerToBinary(sizeIndex,this.sizeBinaryLength);var valueLength=this.bitSizes[sizeIndex];var name=this.name;if(logStats){logs.typeLengths[parentName]=logs.typeLengths[parentName]||{};logs.typeLengths[parentName][name]=logs.typeLengths[parentName][name]||{};logs.typeLengths[parentName][name][valueLength]=logs.typeLengths[parentName][name][valueLength]||0;logs.typeLengths[parentName][name][valueLength]++}var integerBinary=unsignedIntegerToBinary(integer,valueLength);var binary=[sizeBinary,integerBinary];return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var sizeBinary;var _shiftBinary=shiftBinary(binary,this.sizeBinaryLength);var _shiftBinary2=_slicedToArray(_shiftBinary,2);sizeBinary=_shiftBinary2[0];binary=_shiftBinary2[1];var sizeIndex=binaryToUnsignedInteger(sizeBinary);var valueLength=this.bitSizes[sizeIndex];var integer;var _shiftUnsignedInteger5=shiftUnsignedIntegerFromBinary(binary,valueLength);var _shiftUnsignedInteger6=_slicedToArray(_shiftUnsignedInteger5,2);integer=_shiftUnsignedInteger6[0];binary=_shiftUnsignedInteger6[1];return[integer,binary]}}]);return LengthAndValueBinary}();var VariableIntegerType=function(_FixedIntegerType2){"use strict";_inherits(VariableIntegerType,_FixedIntegerType2);var _super51=_createSuper(VariableIntegerType);function VariableIntegerType(options){var _this96;_classCallCheck(this,VariableIntegerType);_this96=_super51.call(this,options);_this96.isNegative=_this96.minValue<0&&_this96.maxValue===0;_this96.integer=new LengthAndValueBinary(_assertThisInitialized(_this96),"integer",options.integerBitSizes);return _this96}_createClass(VariableIntegerType,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;integer=integer.toFixed(0);var binary=this.integer.valueToBinary(Math.abs(integer),logStats);if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var integer;var _this$integer$shiftVa=this.integer.shiftValueFromBinary(binary);var _this$integer$shiftVa2=_slicedToArray(_this$integer$shiftVa,2);integer=_this$integer$shiftVa2[0];binary=_this$integer$shiftVa2[1];if(this.isNegative){integer=-integer}return[integer,binary]}}]);return VariableIntegerType}(FixedIntegerType);var VariableArrayType=function(_VariableIntegerType){"use strict";_inherits(VariableArrayType,_VariableIntegerType);var _super52=_createSuper(VariableArrayType);function VariableArrayType(options){var _this97;_classCallCheck(this,VariableArrayType);_this97=_super52.call(this,options);_this97.esType="array";return _this97}_createClass(VariableArrayType,[{key:"valueToBinary",value:function valueToBinary(array){var _this98=this;var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var arrayLength=array.length;var binary=_get(_getPrototypeOf(VariableArrayType.prototype),"valueToBinary",this).call(this,arrayLength);if(arrayLength){var valueType=findValueTypeFromValues(array);binary.push(valueType.binaryType);binary.type=valueType.name;binary.push(array.map(function(value){_newArrowCheck(this,_this98);return valueType.valueToBinary(value,logStats)}.bind(this)))}if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var arrayLength;var _get$call=_get(_getPrototypeOf(VariableArrayType.prototype),"shiftValueFromBinary",this).call(this,binary);var _get$call2=_slicedToArray(_get$call,2);arrayLength=_get$call2[0];binary=_get$call2[1];var value=new Array(arrayLength);if(arrayLength){var valueType;var _shiftValueTypeFromBi=shiftValueTypeFromBinary(binary);var _shiftValueTypeFromBi2=_slicedToArray(_shiftValueTypeFromBi,2);valueType=_shiftValueTypeFromBi2[0];binary=_shiftValueTypeFromBi2[1];for(var _i15=0,_l5=arrayLength;_i15<_l5;_i15++){var _valueType$shiftValue=valueType.shiftValueFromBinary(binary);var _valueType$shiftValue2=_slicedToArray(_valueType$shiftValue,2);value[_i15]=_valueType$shiftValue2[0];binary=_valueType$shiftValue2[1]}}return[value,binary]}}]);return VariableArrayType}(VariableIntegerType);var VariableSignedIntegerType=function(_VariableIntegerType2){"use strict";_inherits(VariableSignedIntegerType,_VariableIntegerType2);var _super53=_createSuper(VariableSignedIntegerType);function VariableSignedIntegerType(){_classCallCheck(this,VariableSignedIntegerType);return _super53.apply(this,arguments)}_createClass(VariableSignedIntegerType,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;integer=integer.toFixed(0);var isNegative=integer<0;var signBinary=isNegative?"1":"0";var integerBinary=this.integer.valueToBinary(Math.abs(integer),logStats);var binary=[signBinary,integerBinary];if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var isNegative;var _shiftUnsignedInteger7=shiftUnsignedIntegerFromBinary(binary,1);var _shiftUnsignedInteger8=_slicedToArray(_shiftUnsignedInteger7,2);isNegative=_shiftUnsignedInteger8[0];binary=_shiftUnsignedInteger8[1];var integer;var _this$integer$shiftVa3=this.integer.shiftValueFromBinary(binary);var _this$integer$shiftVa4=_slicedToArray(_this$integer$shiftVa3,2);integer=_this$integer$shiftVa4[0];binary=_this$integer$shiftVa4[1];if(isNegative){integer=-integer}return[integer,binary]}}]);return VariableSignedIntegerType}(VariableIntegerType);var VariableDecimalType=function(_VariableIntegerType3){"use strict";_inherits(VariableDecimalType,_VariableIntegerType3);var _super54=_createSuper(VariableDecimalType);function VariableDecimalType(options){var _this99;_classCallCheck(this,VariableDecimalType);_this99=_super54.call(this,options);_this99.isFloat=true;_this99.decimal=new LengthAndValueBinary(_assertThisInitialized(_this99),"decimal",options.decimalBitSizes);return _this99}_createClass(VariableDecimalType,[{key:"valueToBinary",value:function valueToBinary(float){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;float=float.toFixed(2);var isNegative=float<0;float=Math.abs(float);var parts=String(float).split(".");var higherInteger=parseInt(parts[0]);var lowerInteger=parseInt(zeroPadRightToLength(parts[1]||0,2));var signBinary=isNegative?"1":"0";var integerValueBinary=this.integer.valueToBinary(higherInteger,logStats);var decimalValueBinary=this.decimal.valueToBinary(lowerInteger,logStats);var binary=[signBinary,integerValueBinary,decimalValueBinary];if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var isNegative;var _shiftUnsignedInteger9=shiftUnsignedIntegerFromBinary(binary,1);var _shiftUnsignedInteger10=_slicedToArray(_shiftUnsignedInteger9,2);isNegative=_shiftUnsignedInteger10[0];binary=_shiftUnsignedInteger10[1];var higherInteger;var _this$integer$shiftVa5=this.integer.shiftValueFromBinary(binary);var _this$integer$shiftVa6=_slicedToArray(_this$integer$shiftVa5,2);higherInteger=_this$integer$shiftVa6[0];binary=_this$integer$shiftVa6[1];var lowerInteger;var _this$decimal$shiftVa=this.decimal.shiftValueFromBinary(binary);var _this$decimal$shiftVa2=_slicedToArray(_this$decimal$shiftVa,2);lowerInteger=_this$decimal$shiftVa2[0];binary=_this$decimal$shiftVa2[1];lowerInteger=zeroPadLeftToLength(String(lowerInteger),2);var float=parseFloat(higherInteger+"."+lowerInteger);if(isNegative){float=-float}return[float,binary]}}]);return VariableDecimalType}(VariableIntegerType);var arrayType=new VariableArrayType({name:"array",binaryType:"10",integerBitSizes:[4,16]});var booleanType=new FixedBooleanType({name:"boolean",binaryType:"0"});var integerTypes=[new FixedIntegerType({name:"uint3",binaryType:"1110",valueBinaryLength:3}),new VariableIntegerType({name:"vint8+",binaryType:"110",minValue:0,maxValue:255,integerBitSizes:[2,8]}),new VariableIntegerType({name:"vint8-",binaryType:"111100",minValue:-255,maxValue:0,integerBitSizes:[2,8]}),new VariableSignedIntegerType({name:"sint32",binaryType:"111110",minValue:-4294967295,maxValue:4294967295,integerBitSizes:[2,4,16,32]})];var decimalTypes=[new VariableDecimalType({name:"sdec15",binaryType:"111101",minValue:-255.99,maxValue:255.99,integerBitSizes:[2,8],decimalBitSizes:[0,7]}),new VariableDecimalType({name:"sdec39",binaryType:"111111",minValue:-4294967295.99,maxValue:4294967295.99,integerBitSizes:[2,4,16,32],decimalBitSizes:[0,7]})];var ValueTypes=[booleanType,arrayType].concat(integerTypes).concat(decimalTypes);ValueTypes.nameIndex={};ValueTypes.forEach(function(valueType){_newArrowCheck(this,_this100);return ValueTypes.nameIndex[valueType.name]=valueType}.bind(this));function esTypeOf(value){if(Array.isArray(value)){return"array"}if(value===null){return"null"}return _typeof(value)}function findValueTypeFromName(name){return ValueTypes.nameIndex[name.toLowerCase()]}function findValueTypeFromValue(value){var _this101=this;var esType=esTypeOf(value);switch(esType){case"array":return arrayType;case"boolean":return booleanType;}value=value.toFixed(2);var isFloat=!Number.isInteger(value);var isValueInValueTypeRange=function isValueInValueTypeRange(valueType){_newArrowCheck(this,_this101);return value>=valueType.minValue&&value<=valueType.maxValue}.bind(this);var valueType=isFloat?decimalTypes.find(isValueInValueTypeRange):integerTypes.find(isValueInValueTypeRange);if(!valueType){throw new Error("Cannot find type from value: ".concat(value))}return valueType}function findValueTypeFromValues(values){var _this102=this;if(!values.length){return}var minValue=0;var maxValue=0;var isFloat=false;var esTypes=values.map(function(value){_newArrowCheck(this,_this102);var valueType=findValueTypeFromValue(value,isFloat);if(valueType.esType==="number"){minValue=_.min([value,minValue]);maxValue=_.max([value,maxValue]);isFloat=isFloat||!Number.isInteger(value)}return valueType.esType}.bind(this));var uniqESTypes=_.uniq(esTypes);if(uniqESTypes.length>1){throw new Error("Cannot resolve array to one type: ".concat(uniqESTypes.join()))}var esType=uniqESTypes[0];switch(esType){case"array":return arrayType;case"boolean":return booleanType;}var isRangeInValueTypeRange=function isRangeInValueTypeRange(valueType){_newArrowCheck(this,_this102);return minValue>=valueType.minValue&&maxValue<=valueType.maxValue}.bind(this);var valueType=isFloat?decimalTypes.find(isRangeInValueTypeRange):integerTypes.find(isRangeInValueTypeRange);if(!valueType){throw new Error("Cannot find type from value. min: ".concat(minValue," max: ").concat(maxValue," isfloat: ").concat(isFloat))}return valueType}function shiftValueTypeFromBinary(binary){var _this103=this;var valueType=ValueTypes.find(function(valueType){_newArrowCheck(this,_this103);var binaryType=binary.slice(0,valueType.binaryTypeLength);return binaryType===valueType.binaryType}.bind(this));if(!valueType){throw new Error("Cannot find type from binary: ".concat(binary.slice(0,6),"..."))}binary=binary.slice(valueType.binaryTypeLength);return[valueType,binary]}function convertValuesToNumbers(value){var esType=esTypeOf(value);switch(esType){case"array":return value.map(convertValuesToNumbers);case"undefined":case"null":return value?1:0;case"boolean":case"number":return value;}throw new Error("Cannot convert ".concat(esType," to number"))}var Converter=function(){"use strict";function Converter(){_classCallCheck(this,Converter)}_createClass(Converter,[{key:"getInvalidTypeError",value:function getInvalidTypeError(value){try{value=convertValuesToNumbers(value);esTypeOf(value)==="array"?findValueTypeFromValues(value):findValueTypeFromValue(value);return}catch(err){return err}}},{key:"valueToBinary",value:function valueToBinary(value){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var logStats=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;this.clearLog();var hasInitialType=typeof typeName==="string";value=convertValuesToNumbers(value);var valueType=hasInitialType?findValueTypeFromName(typeName):findValueTypeFromValue(value);if(!valueType){throw new Error("Could not find value type from ".concat(hasInitialType?"name ".concat(typeName):"value ".concat(value)," accepts: ").concat(Object.keys(ValueTypes.nameIndex),". Leave typeName empty for auto-detect."))}var binary=valueType.valueToBinary(value,logStats);if(!hasInitialType){binary.unshift(valueType.binaryType)}if(logStats){this.printLog()}return binary}},{key:"valueFromBinary",value:function valueFromBinary(binary){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;binary=_.flatten(binary).join("");var hasInitialType=typeof typeName==="string";var valueType;if(hasInitialType){valueType=findValueTypeFromName(typeName)}else{var _shiftValueTypeFromBi3=shiftValueTypeFromBinary(binary);var _shiftValueTypeFromBi4=_slicedToArray(_shiftValueTypeFromBi3,2);valueType=_shiftValueTypeFromBi4[0];binary=_shiftValueTypeFromBi4[1]}if(!valueType||!(valueType instanceof AbstractValueType)){throw new Error("Could not find value type from ".concat(hasInitialType?"name \"".concat(typeName,"\""):"binary \"".concat(binary.slice(0,8),"\"...")," accepts: ").concat(Object.keys(ValueTypes.nameIndex),". Leave typeName empty for auto-detect."))}var _valueType$shiftValue3=valueType.shiftValueFromBinary(binary),_valueType$shiftValue4=_slicedToArray(_valueType$shiftValue3,1),value=_valueType$shiftValue4[0];return value}},{key:"clearLog",value:function clearLog(){logs.usedTypes={};logs.typeLengths={};logs.binarySamples={}}},{key:"printLog",value:function printLog(){console.log("Types used count:",logs.usedTypes);console.log("Type lengths used count:",logs.typeLengths);console.log("Type binary samples:",logs.binarySamples)}},{key:"serialize",value:function serialize(value){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var logStats=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var binary=this.valueToBinary(value,typeName,logStats);var base64=binaryToBase64(binary);return base64}},{key:"deserialize",value:function deserialize(base64){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var binary=base64ToBinary(base64);var value=this.valueFromBinary(binary,typeName);return value}}]);return Converter}();return window.SCORMSuspendData=new Converter});define("extensions/adapt-contrib-spoor/js/serializers/ComponentSerializer",["core/js/adapt","./SCORMSuspendData"],function(Adapt,SCORMSuspendData){var ComponentSerializer=function(_Backbone$Controller8){"use strict";_inherits(ComponentSerializer,_Backbone$Controller8);var _super55=_createSuper(ComponentSerializer);function ComponentSerializer(){_classCallCheck(this,ComponentSerializer);return _super55.apply(this,arguments)}_createClass(ComponentSerializer,[{key:"initialize",value:function initialize(trackingIdType){this.trackingIdType=trackingIdType}},{key:"serialize",value:function serialize(){var _this104=this;var states=[];Adapt.data.each(function(model){var _this105=this;_newArrowCheck(this,_this104);if(model.get("_type")!==this.trackingIdType){return}var trackingId=model.get("_trackingId");if(typeof trackingId==="undefined"){return}var isContainer=model.hasManagedChildren;var components=isContainer?model.findDescendantModels("component"):[model];components.forEach(function(component,index){_newArrowCheck(this,_this105);var modelState=null;if(!component.getAttemptState){modelState=component.get("_isQuestionType")?[[component.get("_score")||0,component.get("_attemptsLeft")||0],[component.get("_isComplete")||false,component.get("_isInteractionComplete")||false,component.get("_isSubmitted")||false,component.get("_isCorrect")||false],[component.get("_userAnswer")]]:[[],[component.get("_isComplete")||false,component.get("_isInteractionComplete")||false],[component.get("_userAnswer")]]}else{modelState=component.getAttemptState()}var userAnswer=modelState[2][0];var hasUserAnswer=typeof userAnswer!=="undefined"&&userAnswer!==null;var isUserAnswerArray=Array.isArray(userAnswer);if(!hasUserAnswer){modelState[2][0]=[]}else if(!isUserAnswerArray){modelState[2][0]=[modelState[2][0]]}var attemptStates=modelState[2][0];var hasAttemptStates=!Array.isArray(attemptStates);if(!hasAttemptStates){modelState[2][1]=[]}var state=[[trackingId,index],[hasUserAnswer,isUserAnswerArray,hasAttemptStates],modelState];states.push(state)}.bind(this))}.bind(this));return SCORMSuspendData.serialize(states)}},{key:"deserialize",value:function deserialize(binary){var _this106=this;var trackingIdMap=Adapt.data.toArray().reduce(function(trackingIdMap,model){_newArrowCheck(this,_this106);var trackingId=model.get("_trackingId");if(typeof trackingId==="undefined")return trackingIdMap;trackingIdMap[trackingId]=model;return trackingIdMap}.bind(this),{});var states=SCORMSuspendData.deserialize(binary);states.forEach(function(state){_newArrowCheck(this,_this106);var _state$=_slicedToArray(state[0],2),trackingId=_state$[0],index=_state$[1];var _state$2=_slicedToArray(state[1],3),hasUserAnswer=_state$2[0],isUserAnswerArray=_state$2[1],hasAttemptStates=_state$2[2];var modelState=state[2];if(!hasUserAnswer){modelState[2][0]=null}else if(!isUserAnswerArray){modelState[2][0]=modelState[2][0][0]}if(!hasAttemptStates){modelState[2][1]=null}var model=trackingIdMap[trackingId];var isContainer=model.hasManagedChildren;var components=isContainer?model.findDescendantModels("component"):[model];var component=components[index];if(component.setAttemptObject){var attemptObject=component.getAttemptObject(modelState);component.setAttemptObject(attemptObject,false);return}component.get("_isQuestionType")?component.set({_score:modelState[0][0],_attemptsLeft:modelState[0][1],_isComplete:modelState[1][0],_isInteractionComplete:modelState[1][1],_isSubmitted:modelState[1][2],_isCorrect:modelState[1][3],_userAnswer:modelState[2][0]}):component.set({_isComplete:modelState[1][0],_isInteractionComplete:modelState[1][1],_userAnswer:modelState[2][0]})}.bind(this))}}]);return ComponentSerializer}(Backbone.Controller);return ComponentSerializer});define("extensions/adapt-contrib-spoor/js/adapt-stateful-session",["core/js/adapt","./scorm/wrapper","core/js/enums/completionStateEnum","./serializers/ComponentSerializer","./serializers/SCORMSuspendData"],function(Adapt,ScormWrapper,COMPLETION_STATE,ComponentSerializer,SCORMSuspendData){var StatefulSession=function(_Backbone$Controller9){"use strict";_inherits(StatefulSession,_Backbone$Controller9);var _super56=_createSuper(StatefulSession);function StatefulSession(){_classCallCheck(this,StatefulSession);return _super56.apply(this,arguments)}_createClass(StatefulSession,[{key:"initialize",value:function initialize(){_.bindAll(this,"beginSession","onVisibilityChange","endSession");this.scorm=ScormWrapper.getInstance();this._trackingIdType="block";this._componentSerializer=null;this._shouldStoreResponses=true;this._shouldRecordInteractions=true;this.beginSession()}},{key:"beginSession",value:function beginSession(){this.listenTo(Adapt,"app:dataReady",this.restoreSession);this._trackingIdType=Adapt.build.get("trackingIdType")||"block";this._componentSerializer=new ComponentSerializer(this._trackingIdType);if(window.location.search.indexOf("nolmserrors")!==-1){this.scorm.suppressErrors=true}var config=Adapt.spoor.config;if(!config)return;var tracking=config._tracking;this._shouldStoreResponses=tracking&&tracking._shouldStoreResponses;if(tracking&&tracking._shouldRecordInteractions===false){this._shouldRecordInteractions=false}var settings=config._advancedSettings;if(!settings){this.scorm.setVersion("1.2");this.scorm.initialize();return}if(settings._showDebugWindow){this.scorm.showDebugWindow()}this.scorm.setVersion(settings._scormVersion||"1.2");if(settings._suppressErrors){this.scorm.suppressErrors=settings._suppressErrors}if(settings._commitOnStatusChange){this.scorm.commitOnStatusChange=settings._commitOnStatusChange}if(_.isFinite(settings._timedCommitFrequency)){this.scorm.timedCommitFrequency=settings._timedCommitFrequency}if(_.isFinite(settings._maxCommitRetries)){this.scorm.maxCommitRetries=settings._maxCommitRetries}if(_.isFinite(settings._commitRetryDelay)){this.scorm.commitRetryDelay=settings._commitRetryDelay}if("_exitStateIfIncomplete"in settings){this.scorm.exitStateIfIncomplete=settings._exitStateIfIncomplete}if("_exitStateIfComplete"in settings){this.scorm.exitStateIfComplete=settings._exitStateIfComplete}this.scorm.initialize()}},{key:"restoreSession",value:function restoreSession(){this.setupLearnerInfo();this.restoreSessionState();_.defer(this.setupEventListeners.bind(this))}},{key:"setupLearnerInfo",value:function setupLearnerInfo(){var globals=Adapt.course.get("_globals");if(!globals._learnerInfo){globals._learnerInfo={}}Object.assign(globals._learnerInfo,Adapt.offlineStorage.get("learnerinfo"))}},{key:"restoreSessionState",value:function restoreSessionState(){var sessionPairs=Adapt.offlineStorage.get();var hasNoPairs=!Object.keys(sessionPairs).length;if(hasNoPairs)return;if(sessionPairs.c){var _SCORMSuspendData$des=SCORMSuspendData.deserialize(sessionPairs.c),_SCORMSuspendData$des2=_slicedToArray(_SCORMSuspendData$des,2),_isComplete=_SCORMSuspendData$des2[0],_isAssessmentPassed=_SCORMSuspendData$des2[1];Adapt.course.set({_isComplete:_isComplete,_isAssessmentPassed:_isAssessmentPassed})}if(sessionPairs.q&&this._shouldStoreResponses){this._componentSerializer.deserialize(sessionPairs.q)}}},{key:"setupEventListeners",value:function setupEventListeners(){var debouncedSaveSession=_.debounce(this.saveSessionState.bind(this),1);this.listenTo(Adapt.data,"change:_isComplete",debouncedSaveSession);if(this._shouldStoreResponses){this.listenTo(Adapt.data,"change:_isSubmitted change:_userAnswer",debouncedSaveSession)}this.listenTo(Adapt,{"app:languageChanged":this.onLanguageChanged,"questionView:recordInteraction":this.onQuestionRecordInteraction,"assessment:complete":this.onAssessmentComplete,"tracking:complete":this.onTrackingComplete});var config=Adapt.spoor.config;var advancedSettings=config._advancedSettings;var shouldCommitOnVisibilityChange=!advancedSettings||advancedSettings._commitOnVisibilityChangeHidden!==false;if(shouldCommitOnVisibilityChange){document.addEventListener("visibilitychange",this.onVisibilityChange)}$(window).on("beforeunload unload",this.endSession)}},{key:"saveSessionState",value:function saveSessionState(){var courseState=SCORMSuspendData.serialize([Boolean(Adapt.course.get("_isComplete")),Boolean(Adapt.course.get("_isAssessmentPassed"))]);var componentStates=this._shouldStoreResponses===true?this._componentSerializer.serialize():"";var sessionPairs={"c":courseState,"q":componentStates};this.printCompletionInformation();Adapt.offlineStorage.set(sessionPairs)}},{key:"printCompletionInformation",value:function printCompletionInformation(){var _this107=this;var courseComplete=Boolean(Adapt.course.get("_isComplete"));var assessmentPassed=Boolean(Adapt.course.get("_isAssessmentPassed"));var trackingIdModels=Adapt.data.filter(function(model){_newArrowCheck(this,_this107);return model.get("_type")===this._trackingIdType&&model.has("_trackingId")}.bind(this));var trackingIds=trackingIdModels.map(function(model){_newArrowCheck(this,_this107);return model.get("_trackingId")}.bind(this));if(!trackingIds.length){Adapt.log.info("course._isComplete: ".concat(courseComplete,", course._isAssessmentPassed: ").concat(assessmentPassed,", ").concat(this._trackingIdType," completion: no tracking ids found"));return}var max=Math.max.apply(Math,_toConsumableArray(trackingIds));var completion=trackingIdModels.reduce(function(completion,model){_newArrowCheck(this,_this107);var trackingId=model.get("_trackingId");completion[trackingId]=model.get("_isComplete")?"1":"0";return completion}.bind(this),new Array(max+1).join("-").split("")).join("");Adapt.log.info("course._isComplete: ".concat(courseComplete,", course._isAssessmentPassed: ").concat(assessmentPassed,", ").concat(this._trackingIdType," completion: ").concat(completion))}},{key:"onLanguageChanged",value:function onLanguageChanged(){var config=Adapt.spoor.config;this.removeEventListeners();this.setupEventListeners();this.saveSessionState();if(config&&config._reporting&&config._reporting._resetStatusOnLanguageChange===true){Adapt.offlineStorage.set("status","incomplete")}}},{key:"onVisibilityChange",value:function onVisibilityChange(){if(document.visibilityState==="hidden")this.scorm.commit()}},{key:"onQuestionRecordInteraction",value:function onQuestionRecordInteraction(questionView){if(!this._shouldRecordInteractions)return;var responseType=questionView.getResponseType();if(_.isEmpty(responseType))return;var id=questionView.model.get("_id");var response=questionView.getResponse();var result=questionView.isCorrect();var latency=questionView.getLatency();Adapt.offlineStorage.set("interaction",id,response,result,latency,responseType)}},{key:"onAssessmentComplete",value:function onAssessmentComplete(stateModel){var _Adapt$offlineStorage;var config=Adapt.spoor.config;Adapt.course.set("_isAssessmentPassed",stateModel.isPass);this.saveSessionState();var shouldSubmitScore=config&&config._tracking&&config._tracking._shouldSubmitScore;if(!shouldSubmitScore)return;var scoreArgs=stateModel.isPercentageBased?[stateModel.scoreAsPercent,0,100]:[stateModel.score,0,stateModel.maxScore];(_Adapt$offlineStorage=Adapt.offlineStorage).set.apply(_Adapt$offlineStorage,["score"].concat(scoreArgs))}},{key:"onTrackingComplete",value:function onTrackingComplete(completionData){var config=Adapt.spoor.config;this.saveSessionState();var completionStatus=completionData.status.asLowerCase;switch(completionData.status){case COMPLETION_STATE.COMPLETED:case COMPLETION_STATE.PASSED:{if(!config||!config._reporting||!config._reporting._onTrackingCriteriaMet){Adapt.log.warn("No value defined for '_onTrackingCriteriaMet', so defaulting to '".concat(completionStatus,"'"))}else{completionStatus=config._reporting._onTrackingCriteriaMet}break}case COMPLETION_STATE.FAILED:{if(!config||!config._reporting||!config._reporting._onAssessmentFailure){Adapt.log.warn("No value defined for '_onAssessmentFailure', so defaulting to '".concat(completionStatus,"'"))}else{completionStatus=config._reporting._onAssessmentFailure}}}Adapt.offlineStorage.set("status",completionStatus)}},{key:"endSession",value:function endSession(){if(!this.scorm.finishCalled){this.scorm.finish()}this.removeEventListeners()}},{key:"removeEventListeners",value:function removeEventListeners(){$(window).off("beforeunload unload",this.endSession);document.removeEventListener("visibilitychange",this.onVisibilityChange);this.stopListening()}}]);return StatefulSession}(Backbone.Controller);return StatefulSession});define("extensions/adapt-contrib-spoor/js/adapt-offlineStorage-scorm",["core/js/adapt","./scorm/wrapper","./serializers/SCORMSuspendData","core/js/offlineStorage"],function(Adapt,ScormWrapper,SCORMSuspendData){var OfflineStorage=function(_Backbone$Controller10){"use strict";_inherits(OfflineStorage,_Backbone$Controller10);var _super57=_createSuper(OfflineStorage);function OfflineStorage(){_classCallCheck(this,OfflineStorage);return _super57.apply(this,arguments)}_createClass(OfflineStorage,[{key:"initialize",value:function initialize(statefulSession){this.scorm=ScormWrapper.getInstance();this.statefulSession=statefulSession;this.temporaryStore={};this.suspendDataStore={};this.suspendDataRestored=false;Adapt.offlineStorage.initialize(this)}},{key:"save",value:function save(){this.statefulSession.saveSessionState()}},{key:"serialize",value:function serialize(){return SCORMSuspendData.serialize.apply(SCORMSuspendData,arguments)}},{key:"deserialize",value:function deserialize(){return SCORMSuspendData.deserialize.apply(SCORMSuspendData,arguments)}},{key:"get",value:function get(name){if(name===undefined){if(this.useTemporaryStore())return this.temporaryStore;this.suspendDataStore=this.getCustomStates();var data=Object.assign(_.clone(this.suspendDataStore),{location:this.scorm.getLessonLocation(),score:this.scorm.getScore(),status:this.scorm.getStatus(),student:this.scorm.getStudentName(),learnerInfo:this.getLearnerInfo()});this.suspendDataRestored=true;return data}if(this.useTemporaryStore())return this.temporaryStore[name];var courseState;switch(name.toLowerCase()){case"location":return this.scorm.getLessonLocation();case"score":return this.scorm.getScore();case"status":return this.scorm.getStatus();case"student":return this.scorm.getStudentName();case"learnerinfo":return this.getLearnerInfo();case"coursestate":courseState=this.getCustomState("c");var stateArray=courseState&&SCORMSuspendData.deserialize(courseState)||[];return{_isCourseComplete:Boolean(stateArray.slice(0,1).map(Number)[0]),_isAssessmentPassed:Boolean(stateArray.slice(1,2).map(Number)[0]),completion:stateArray.slice(2).map(Number).map(String).join("")||""};case"completion":courseState=this.getCustomState("c");return courseState&&SCORMSuspendData.deserialize(courseState).slice(2).map(Number).map(String).join("")||"";case"_iscoursecomplete":courseState=this.getCustomState("c");return Boolean(courseState&&SCORMSuspendData.deserialize(courseState).slice(0,1).map(Number)[0]);case"_isassessmentpassed":courseState=this.getCustomState("c");return Boolean(courseState&&SCORMSuspendData.deserialize(courseState).slice(1,2).map(Number)[0]);case"questions":var questionsState=this.getCustomState("q");return questionsState||"";default:return this.getCustomState(name);}}},{key:"set",value:function set(name,value){var _this$scorm,_this$scorm2,_this$scorm3,_this$scorm4;var args=Array.prototype.slice.call(arguments).slice(1);var isObject=_typeof(name)==="object";if(isObject){value=name;name="suspendData"}if(this.useTemporaryStore()){if(isObject){Object.assign(this.temporaryStore,value)}else{this.temporaryStore[name]=value}return true}switch(name.toLowerCase()){case"interaction":return(_this$scorm=this.scorm).recordInteraction.apply(_this$scorm,_toConsumableArray(args));case"location":return(_this$scorm2=this.scorm).setLessonLocation.apply(_this$scorm2,_toConsumableArray(args));case"score":return(_this$scorm3=this.scorm).setScore.apply(_this$scorm3,_toConsumableArray(args));case"status":return(_this$scorm4=this.scorm).setStatus.apply(_this$scorm4,_toConsumableArray(args));case"student":case"learnerinfo":return false;case"lang":this.scorm.setLanguage(value);break;case"suspenddata":break;}if(isObject){Object.assign(this.suspendDataStore,value)}else{this.suspendDataStore[name]=value}var dataAsString=JSON.stringify(this.suspendDataStore);return this.suspendDataRestored?this.scorm.setSuspendData(dataAsString):false}},{key:"getCustomStates",value:function getCustomStates(){var isSuspendDataStoreEmpty=_.isEmpty(this.suspendDataStore);if(!isSuspendDataStoreEmpty&&this.suspendDataRestored){return _.clone(this.suspendDataStore)}var dataAsString=this.scorm.getSuspendData();if(dataAsString===""||dataAsString===" "||dataAsString===undefined){return{}}var dataAsJSON=JSON.parse(dataAsString);if(!isSuspendDataStoreEmpty&&!this.suspendDataRestored){Object.assign(dataAsJSON,this.suspendDataStore)}return dataAsJSON}},{key:"getCustomState",value:function getCustomState(name){var dataAsJSON=this.getCustomStates();return dataAsJSON[name]}},{key:"useTemporaryStore",value:function useTemporaryStore(){var cfg=Adapt.config.get("_spoor");if(!this.scorm.lmsConnected||cfg&&cfg._isEnabled===false)return true;return false}},{key:"getLearnerInfo",value:function getLearnerInfo(){var _this108=this;var id=this.scorm.getStudentId();var name=this.scorm.getStudentName();var firstname="";var lastname="";var hasName=name&&name!=="undefined";var isNameCommaSeparated=hasName&&name.includes(",");var isNameSpaceSeparated=hasName&&name.includes(" ");hasName=hasName&&(isNameCommaSeparated||isNameSpaceSeparated);if(!hasName){console.log("SPOOR: LMS learner_name not in 'lastname, firstname' or 'firstname lastname' format");return{id:id,name:name,firstname:firstname,lastname:lastname}}var separator=isNameCommaSeparated?",":" ";var nameParts=name.split(separator);if(isNameCommaSeparated){nameParts.reverse()}var _nameParts$map=nameParts.map(function(part){_newArrowCheck(this,_this108);return part.trim()}.bind(this));var _nameParts$map2=_slicedToArray(_nameParts$map,2);firstname=_nameParts$map2[0];lastname=_nameParts$map2[1];name="".concat(firstname," ").concat(lastname);return{id:id,name:name,firstname:firstname,lastname:lastname}}}]);return OfflineStorage}(Backbone.Controller);return OfflineStorage});define("extensions/adapt-contrib-spoor/js/adapt-contrib-spoor",["core/js/adapt","./scorm/wrapper","./adapt-stateful-session","./adapt-offlineStorage-scorm"],function(Adapt,ScormWrapper,StatefulSession,OfflineStorage){var Spoor=function(_Backbone$Controller11){"use strict";_inherits(Spoor,_Backbone$Controller11);var _super58=_createSuper(Spoor);function Spoor(){_classCallCheck(this,Spoor);return _super58.apply(this,arguments)}_createClass(Spoor,[{key:"initialize",value:function initialize(){this.config=null;this.scorm=ScormWrapper.getInstance();this.listenToOnce(Adapt,"offlineStorage:prepare",this._prepare)}},{key:"_prepare",value:function _prepare(){this.config=Adapt.config.get("_spoor");if(!this.isEnabled){Adapt.offlineStorage.setReadyStatus();return}this.statefulSession=new StatefulSession;this.offlineStorage=new OfflineStorage(this.statefulSession);Adapt.offlineStorage.get();Adapt.offlineStorage.setReadyStatus();require(["libraries/jquery.keycombo"],function(){$.onKeyCombo([68,69,86],function(){Adapt.spoor.scorm.showDebugWindow()})})}},{key:"isEnabled",get:function get(){return this.config&&this.config._isEnabled}}]);return Spoor}(Backbone.Controller);Adapt.spoor=new Spoor;return Spoor});define("extensions/adapt-contrib-trickle/js/trickleView",["core/js/adapt"],function(Adapt){var TrickleView=Backbone.View.extend({isSteplocked:false,completionAttribute:null,initialize:function initialize(options){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){var AdaptEvents={"trickle:kill":this.onKill,"remove":this.onRemove};this.onPreRender(this);AdaptEvents[this.model.get("_type")+"View:postRender"]=this.onPostRender;this.listenTo(Adapt,AdaptEvents);this.on("steplock",this.onStepLock);this.on("stepunlock",this.onStepUnlock)},onPreRender:function onPreRender(view){this.completionAttribute=Adapt.trickle.getCompletionAttribute();if(!this.isElementEnabled())return;Adapt.trigger("trickle:preRender",this)},onPostRender:function onPostRender(view){if(view.model.get("_id")!==this.model.get("_id"))return;if(!this.isElementEnabled())return;Adapt.trigger("trickle:postRender",this)},isElementEnabled:function isElementEnabled(){var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle)return false;if(this.model.get(this.completionAttribute))return false;var isArticleWithOnChildren=this.model.get("_type")==="article"&&trickle._onChildren;if(isArticleWithOnChildren){return false}if(trickle._isEnabled===true)return true;return false},onStepLock:function onStepLock(){if(!this.isElementEnabled()){this.continueToNext();return}var trickle=Adapt.trickle.getModelConfig(this.model);var isSteplocking=trickle._stepLocking&&trickle._stepLocking._isEnabled;if(!isSteplocking){this.continueToNext();return}Adapt.trigger("trickle:steplock",this);this.isSteplocked=true},continueToNext:function continueToNext(){Adapt.trigger("trickle:continue",this)},onStepUnlock:function onStepUnlock(){if(!this.isSteplocked)return;this.isSteplocked=false;Adapt.trigger("trickle:stepunlock",this)},onKill:function onKill(){this.detachFromElement()},onRemove:function onRemove(){this.detachFromElement()},detachFromElement:function detachFromElement(){this.undelegateEvents();this.stopListening();this.model=null;this.articleModel=null;this.$el=null;this.el=null}});return TrickleView});define("extensions/adapt-contrib-trickle/js/pageView",["core/js/adapt","./trickleView"],function(Adapt,TrickleView){var PageView=Backbone.View.extend({currentDescendantIndex:0,currentLocksOnDescendant:0,currentDescendant:null,initialize:function initialize(options){if(!this.isPageEnabled()){return this.detachFromPage()}this.setupDescendants();if(!this.haveDescendantsGotTrickle()){return this.detachFromPage()}this.addClassToHtml();this.setupEventListeners()},isPageEnabled:function isPageEnabled(){var trickleConfig=Adapt.trickle.getModelConfig(this.model);if(trickleConfig&&trickleConfig._isEnabled===false)return false;return true},setupDescendants:function setupDescendants(){this.currentDescendant=null;this.descendantViews={};this.getDescendants();Adapt.trigger("trickle:descendants",this)},descendantsChildFirst:null,descendantsParentFirst:null,descendantViews:null,getDescendants:function getDescendants(){this.descendantsChildFirst=this.model.getAllDescendantModels();this.descendantsParentFirst=this.model.getAllDescendantModels(true);this.setDescendantsTrickleDefaults();this.descendantsChildFirst=this.filterComponents(this.descendantsChildFirst);this.descendantsParentFirst=this.filterComponents(this.descendantsParentFirst)},filterComponents:function filterComponents(descendants){return descendants.filter(function(descendant){if(descendant.get("_type")==="component")return false;if(!descendant.get("_isAvailable"))return false;return true})},setDescendantsTrickleDefaults:function setDescendantsTrickleDefaults(){this.descendantsParentFirst.forEach(function(descendant){var trickle=Adapt.trickle.getModelConfig(descendant);if(!trickle){return}trickle._stepLocking=_.extend({"_isEnabled":true,"_isCompletionRequired":true,"_isLockedOnRevisit":false},trickle._stepLocking);trickle=_.extend({"_isEnabled":true,"_autoScroll":true,"_scrollDuration":500,"_onChildren":true,"_scrollTo":"@block +1"},trickle);Adapt.trickle.setModelConfig(descendant,trickle);if(trickle._onChildren&&descendant.get("_type")==="article"){this.setupArticleOnChildren(descendant,trickle)}descendant.set("_isTrickleConfigured",true)}.bind(this))},setupArticleOnChildren:function setupArticleOnChildren(articleModel,articleTrickleConfig){var articleBlocks=articleModel.getChildren();articleBlocks.each(function(blockModel,index){var blockTrickleConfig=Adapt.trickle.getModelConfig(blockModel);for(var k in blockTrickleConfig){if(_typeof(blockTrickleConfig[k])==="object"){blockTrickleConfig[k]=_.extend({},articleTrickleConfig[k],blockTrickleConfig[k])}}blockTrickleConfig=_.extend({},articleTrickleConfig,blockTrickleConfig);if(articleBlocks.length===index+1){blockTrickleConfig._isFinal=true}if(index===0){blockTrickleConfig._isStart=true}Adapt.trickle.setModelConfig(blockModel,blockTrickleConfig)})},haveDescendantsGotTrickle:function haveDescendantsGotTrickle(){return this.descendantsChildFirst.some(function(descendant){var trickle=Adapt.trickle.getModelConfig(descendant);return trickle&&trickle._isEnabled===true})},addClassToHtml:function addClassToHtml(){$("html").addClass("trickle")},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"remove":this.onRemove,"articleView:preRender":this.onDescendantPreRender,"blockView:preRender":this.onDescendantPreRender,"trickle:unwait":this.onUnwait,"trickle:wait":this.onWait,"trickle:continue":this.onContinue,"trickle:skip":this.onSkip,"trickle:kill":this.onKill});this.listenToOnce(this.model,"change:_isReady",this.onPageReady)},onDescendantPreRender:function onDescendantPreRender(view){if(view.model.get("_type")==="component")return;var descendantView=new TrickleView({model:view.model,el:view.el});this.descendantViews[view.model.get("_id")]=descendantView},onPageReady:function onPageReady(model,value){if(!value)return;this.currentDescendant=null;Adapt.trigger("trickle:started");this.gotoNextDescendant()},gotoNextDescendant:function gotoNextDescendant(){this.getDescendants();if(this.currentDescendant){this.currentDescendant.trigger("stepunlock");this.currentDescendant=null}for(var index=this.currentDescendantIndex||0,l=this.descendantsChildFirst.length;index<l;index++){var descendant=this.descendantsChildFirst[index];switch(descendant.get("_type")){case"block":case"article":this.currentLocksOnDescendant=0;this.currentDescendantIndex=index;var currentId=descendant.get("_id");this.currentDescendant=this.descendantViews[currentId];this.currentDescendant.trigger("steplock");return;}}this.finished()},onContinue:function onContinue(view){if(!this.currentDescendant)return;if(view.model.get("_id")!==this.currentDescendant.model.get("_id"))return;this.onSkip()},onWait:function onWait(){this.currentLocksOnDescendant++},onUnwait:function onUnwait(){this.currentLocksOnDescendant--;if(this.currentLocksOnDescendant>0)return;var lastDescendant=this.currentDescendant.model;this.currentDescendantIndex++;this.gotoNextDescendant();Adapt.trickle.scroll(lastDescendant)},onSkip:function onSkip(){this.currentDescendantIndex++;this.gotoNextDescendant()},onKill:function onKill(){this.finished();this.detachFromPage()},finished:function finished(){Adapt.trigger("trickle:finished");this.detachFromPage()},onRemove:function onRemove(){this.finished()},detachFromPage:function detachFromPage(){$("html").removeClass("trickle");this.undelegateEvents();this.stopListening();this.model=null;this.$el=null;this.el=null;this.currentDescendant=null;this.descendantViews=null;this.descendantsChildFirst=null;this.descendantsParentFirst=null;Adapt.trickle.pageView=null}});return PageView});define("extensions/adapt-contrib-trickle/js/handlers/buttonView",["core/js/adapt","core/js/views/componentView"],function(Adapt,ComponentView){var completionAttribute="_isComplete";var TrickleButtonView=Backbone.View.extend({isStepLocking:false,hasStepLocked:false,isStepLocked:false,isStepLockFinished:false,hasStepPreCompleted:false,isWaitingForClick:false,allowVisible:false,allowEnabled:true,overlayShownCount:0,el:function el(){this.setupPreRender();return Handlebars.templates["trickle-button"](this.model.toJSON())},setupPreRender:function setupPreRender(){this.setupButtonVisible();this.setupButtonEnabled()},setupButtonVisible:function setupButtonVisible(){var trickle=Adapt.trickle.getModelConfig(this.model);this.allowVisible=false;trickle._button._isVisible=false;if(trickle._button._styleBeforeCompletion==="visible"){this.allowVisible=true;if(trickle._button._autoHide&&trickle._button._isFullWidth){trickle._button._isVisible=false}else{trickle._button._isVisible=true}}},setupButtonEnabled:function setupButtonEnabled(){var trickle=Adapt.trickle.getModelConfig(this.model);if(trickle._stepLocking._isCompletionRequired===false){this.allowEnabled=true;trickle._button._isDisabled=false}else if(trickle._button._styleBeforeCompletion==="visible"){this.allowEnabled=false;trickle._button._isDisabled=true}else{trickle._button._isDisabled=false;this.allowEnabled=true}},events:{"click .js-trickle-btn":"onButtonClick"},initialize:function initialize(options){this.getCompletionAttribute();this.debounceCheckAutoHide();this.setupStepLocking();this.setupEventListeners()},getCompletionAttribute:function getCompletionAttribute(){var trickle=Adapt.trickle.getModelConfig(Adapt.config);if(!trickle)return;if(!trickle._completionAttribute)return;completionAttribute=trickle._completionAttribute},setupStepLocking:function setupStepLocking(){var trickle=Adapt.trickle.getModelConfig(this.model);this.isStepLocked=Boolean(trickle._stepLocking._isEnabled)},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:overlay":this.onOverlay,"trickle:unoverlay":this.onUnoverlay,"trickle:steplock":this.onStepLock,"trickle:stepunlock":this.onStepUnlock,"trickle:skip":this.onSkip,"trickle:kill":this.onKill,"trickle:update":this.onUpdate,"remove":this.onRemove});this.listenTo(this.model,"change:"+completionAttribute,this.onCompletion)},debounceCheckAutoHide:function debounceCheckAutoHide(){this.checkButtonAutoHideSync=this.checkButtonAutoHide.bind(this);this.checkButtonAutoHide=_.debounce(this.checkButtonAutoHideSync,100)},checkButtonAutoHide:function checkButtonAutoHide(){if(!this.allowVisible){this.setButtonVisible(false);return}var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle._button._autoHide){this.setButtonVisible(true);return}else if(this.overlayShownCount>0){this.setButtonVisible(false);return}var measurements=this.$el.onscreen();var isJustOffscreen=measurements.bottom>-100;if(measurements.onscreen||isJustOffscreen){this.setButtonVisible(true)}else{this.setButtonVisible(false)}},setButtonVisible:function setButtonVisible(isVisible){var trickle=Adapt.trickle.getModelConfig(this.model);trickle._button._isVisible=Boolean(isVisible);this.$(".js-trickle-btn-container").toggleClass("u-display-none",!trickle._button._isVisible)},checkButtonEnabled:function checkButtonEnabled(){this.setButtonEnabled(this.allowEnabled)},setButtonEnabled:function setButtonEnabled(isEnabled){var trickle=Adapt.trickle.getModelConfig(this.model);var $button=this.$(".js-trickle-btn");if(isEnabled){$button.removeClass("is-disabled").removeAttr("disabled");trickle._button._isDisabled=true;if(document.activeElement&&document.activeElement.isSameNode(this.$(".aria-label")[0])){this.$(".aria-label").focusNext()}this.$(".aria-label").a11y_cntrl(false)}else{$button.addClass("is-disabled").attr("disabled","disabled");trickle._button._isDisabled=false}},onStepLock:function onStepLock(view){if(!this.isViewMatch(view))return;this.hasStepLocked=true;this.isStepLocking=true;this.overlayShownCount=0;var trickle=Adapt.trickle.getModelConfig(this.model);if(!this.isButtonEnabled())return;var isCompleteAndShouldRelock=trickle._stepLocking._isLockedOnRevisit&&this.model.get(completionAttribute);if(isCompleteAndShouldRelock){this.isStepLocked=true;this.model.set("_isTrickleAutoScrollComplete",false);Adapt.trigger("trickle:wait");this.allowVisible=true;this.checkButtonAutoHide()}else if(this.hasStepPreCompleted){this.isStepLocked=true;this.model.set("_isTrickleAutoScrollComplete",false);this.allowVisible=true;this.stepCompleted()}this.setupOnScreenListener()},onOverlay:function onOverlay(){this.overlayShownCount++},onUnoverlay:function onUnoverlay(){this.overlayShownCount--;this.checkButtonAutoHide()},setupOnScreenListener:function setupOnScreenListener(){var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle._button._autoHide)return;this.$el.on("onscreen",this.checkButtonAutoHideSync)},isViewMatch:function isViewMatch(view){return view.model.get("_id")===this.model.get("_id")},isButtonEnabled:function isButtonEnabled(){var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle._isEnabled||!trickle._button._isEnabled)return false;return true},onCompletion:function onCompletion(model,value){if(value===false)return;this.hasStepPreCompleted=true;if(!this.hasStepLocked)return;this.stepCompleted()},stepCompleted:function stepCompleted(){if(this.isStepLockFinished)return;this.isStepLocked=false;this.allowVisible=false;this.allowEnabled=false;if(this.isButtonEnabled()){if(this.isStepLocking){this.isStepLocked=true;this.isWaitingForClick=true;Adapt.trigger("trickle:wait")}else{this.isStepLockFinished=true}this.allowVisible=true;this.allowEnabled=true}this.model.set("_isTrickleAutoScrollComplete",false);this.checkButtonAutoHideSync();this.checkButtonEnabled()},onButtonClick:function onButtonClick(){if(this.isStepLocked){Adapt.trigger("trickle:unwait");this.isStepLocked=false;this.isStepLockFinished=true}else{this.model.set("_isTrickleAutoScrollComplete",false);Adapt.trickle.scroll(this.model)}var trickle=this.model.get("_trickle");switch(trickle._button._styleAfterClick){case"hidden":this.allowVisible=false;this.checkButtonAutoHideSync();break;case"disabled":this.allowEnabled=false;this.checkButtonAutoHideSync();}},onUpdate:function onUpdate(){var trickle=Adapt.trickle.getModelConfig(this.model);if(trickle._button._autoHide&&this.isStepLocking){this.$el.off("onscreen",this.checkButtonAutoHideSync)}var $original=this.$el;var $newEl=$(Handlebars.templates["trickle-button"](this.model.toJSON()));$original.replaceWith($newEl);this.setElement($newEl);if(trickle._button._autoHide&&this.isStepLocking){this.$el.on("onscreen",this.checkButtonAutoHideSync)}},onStepUnlock:function onStepUnlock(view){if(!this.isViewMatch(view))return;this.$el.off("onscreen",this.checkButtonAutoHideSync);this.isStepLocking=false;this.overlayShownCount=0;if(document.activeElement&&document.activeElement.isSameNode(this.$(".aria-label")[0])){this.$(".aria-label").focusNext()}this.$(".aria-label").a11y_cntrl(false)},onSkip:function onSkip(){if(!this.isStepLocking)return;this.onKill()},onKill:function onKill(){this.$el.off("onscreen",this.checkButtonAutoHideSync);if(this.isWaitingForClick){this.model.set("_isTrickleAutoScrollComplete",true)}this.isWaitingForClick=false;this.isStepLocked=false;this.isStepLocking=false;this.allowVisible=false;this.allowEnabled=false;this.isStepLockFinished=true;this.model.set("_isTrickleAutoScrollComplete",false);this.checkButtonAutoHide();this.checkButtonEnabled()},onRemove:function onRemove(){if(this.isWaitingForClick){this.model.set("_isTrickleAutoScrollComplete",true)}this.isWaitingForClick=false;this.$el.off("onscreen",this.checkButtonAutoHideSync);this.isStepLocking=true;this.remove()}});return TrickleButtonView});define("extensions/adapt-contrib-trickle/js/handlers/button",["core/js/adapt","./buttonView"],function(Adapt,ButtonView){var TrickleButtonHandler=Backbone.Controller.extend({buttonViews:null,initialize:function initialize(){this.listenToOnce(Adapt,{"app:dataReady":this.onAppDataReady,remove:this.onRemove})},onAppDataReady:function onAppDataReady(){this.buttonViews={};this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:preRender":this.onPreRender,"trickle:postRender":this.onPostRender})},onPreRender:function onPreRender(view){if(!this.isTrickleEnabled(view.model))return;this.setupConfigDefaults(view.model);this.buttonViews[view.model.get("_id")]=new ButtonView({model:view.model})},onPostRender:function onPostRender(view){if(!this.isTrickleEnabled(view.model))return;view.$el.append(this.buttonViews[view.model.get("_id")].$el)},isTrickleEnabled:function isTrickleEnabled(model){var trickle=Adapt.trickle.getModelConfig(model);if(!trickle||!trickle._isEnabled)return false;if(trickle._onChildren&&model.get("_type")==="article")return false;return true},setupConfigDefaults:function setupConfigDefaults(model){if(model.get("_isTrickleButtonConfigured"))return;var defaults={_isEnabled:true,_styleBeforeCompletion:"hidden",_styleAfterClick:"hidden",_isFullWidth:true,_autoHide:false,_className:"",_hasIcon:false,text:"Continue",startText:"Begin",finalText:"Finish",_component:"trickle-button",_isLocking:true,_isVisible:false,_isDisabled:false};var trickle=Adapt.trickle.getModelConfig(model);trickle._button=_.extend(defaults,trickle._button);if(trickle._button._isFullWidth){trickle._stepLocking._isEnabled=true;trickle._button._styleAfterClick="hidden"}else{trickle._button._autoHide=false}Adapt.trickle.setModelConfig(model,trickle);model.set("_isTrickleButtonConfigured",true)},onRemove:function onRemove(){this.buttonViews={}}});return new TrickleButtonHandler});define("extensions/adapt-contrib-trickle/js/handlers/completion",["core/js/adapt"],function(Adapt){var completionAttribute="_isComplete";var TrickleCompletionHandler=Backbone.Controller.extend({isStepLocking:false,isCompleted:false,stepModel:null,initialize:function initialize(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function onAppDataReady(){this.getCompletionAttribute();this.setupEventListeners()},getCompletionAttribute:function getCompletionAttribute(){var trickle=Adapt.trickle.getModelConfig(Adapt.config);if(!trickle)return;if(!trickle._completionAttribute)return;completionAttribute=trickle._completionAttribute},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:descendants":this.onDescendants,"trickle:steplock":this.onStepLock,"trickle:stepunlock":this.onStepUnlock,"trickle:kill":this.onKill,"remove":this.onRemove})},onDescendants:function onDescendants(view){view.descendantsParentFirst.forEach(function(descendant){var trickle=Adapt.trickle.getModelConfig(descendant);if(!trickle)return;trickle._wasCompletedPreRender=descendant.get(completionAttribute)})},onStepLock:function onStepLock(view){var isModelComplete=view.model.get(completionAttribute);var trickle=Adapt.trickle.getModelConfig(view.model);if(!trickle._stepLocking._isCompletionRequired&&!trickle._stepLocking._isLockedOnRevisit){if(!isModelComplete)return;Adapt.trigger("trickle:continue",view);return}if(trickle._stepLocking._isCompletionRequired&&isModelComplete&&trickle._wasCompletedPreRender){Adapt.trigger("trickle:continue",view);return}Adapt.trigger("trickle:wait");if(isModelComplete){Adapt.trigger("trickle:unwait");return}view.model.set("_isTrickleAutoScrollComplete",false);this.isCompleted=false;this.isStepLocking=true;this.stepModel=view.model;this.listenTo(this.stepModel,"change:"+completionAttribute,this.onCompletion)},onCompletion:function onCompletion(model,value){if(value===false)return;this.stepCompleted()},stepCompleted:function stepCompleted(){if(!this.isStepLocking)return;if(this.isCompleted)return;this.isCompleted=true;this.stopListening(this.stepModel,"change:"+completionAttribute,this.onCompletion);Adapt.trigger("trickle:unwait")},onKill:function onKill(){this.onStepUnlock()},onRemove:function onRemove(){this.onStepUnlock()},onStepUnlock:function onStepUnlock(){this.stopListening(this.stepModel,"change:"+completionAttribute,this.onCompletion);this.isStepLocking=false;this.stepModel=null;this.isCompleted=false}});return new TrickleCompletionHandler});define("extensions/adapt-contrib-trickle/js/handlers/notify",["core/js/adapt"],function(Adapt){var TrickleNotifyHandler=Backbone.Controller.extend({isStepLocking:false,isNotifyOpen:false,initialize:function initialize(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function onAppDataReady(){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"notify:opened":this.onNotifyOpened,"notify:closed":this.onNotifyClosed,"trickle:stepunlock":this.onStepUnlock,"remove":this.onRemove})},onStepLock:function onStepLock(view){this.isStepLocking=true},onNotifyOpened:function onNotifyOpened(){if(!this.isStepLocking)return;this.isNotifyOpen=true;Adapt.trigger("trickle:overlay");Adapt.trigger("trickle:wait")},onNotifyClosed:function onNotifyClosed(){if(!this.isStepLocking)return;if(!this.isNotifyOpen)return;this.isNotifyOpen=false;Adapt.trigger("trickle:unoverlay");Adapt.trigger("trickle:unwait")},onStepUnlock:function onStepUnlock(){this.isStepLocking=false},onRemove:function onRemove(){this.onStepUnlock()}});return new TrickleNotifyHandler});define("extensions/adapt-contrib-trickle/js/handlers/resize",["core/js/adapt"],function(Adapt){var TrickleBodyResizeHandler=Backbone.Controller.extend({isStepLocking:false,stepView:null,initialize:function initialize(){this.listenToOnce(Adapt,{"app:dataReady":this.onAppDataReady,"adapt:initialize":this.onAdaptInitialized})},onAppDataReady:function onAppDataReady(){this.onResize=this.onResize.bind(this);this.preventWrapperScroll=this.preventWrapperScroll.bind(this);this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"trickle:resize":this.onTrickleResize,"trickle:stepunlock":this.onStepUnlock,"trickle:kill":this.onKill,"trickle:finished":this.onFinished,"remove":this.onRemove})},onAdaptInitialized:function onAdaptInitialized(){this.wrapper=document.getElementById("wrapper");this.wrapper.addEventListener("scroll",this.preventWrapperScroll)},onStepLock:function onStepLock(view){this.isStepLocking=true;this.stepView=view;$(window).on("resize",this.onResize);$(".page").on("resize",this.onResize);Adapt.trigger("trickle:resize")},preventWrapperScroll:function preventWrapperScroll(event){if(!this.isStepLocking)return;var top=this.wrapper.scrollTop;if(top===0)return;this.wrapper.scrollTop=0;window.scrollTo(0,window.pageYOffset+top)},onResize:function onResize(){if(!this.isStepLocking)return;Adapt.trigger("trickle:resize")},onTrickleResize:function onTrickleResize(){if(!this.isStepLocking)return;var offset=this.stepView.$el.offset();var height=this.stepView.$el.height();var $wrapper=$(this.wrapper);var bottom=offset["top"]+height;$wrapper.css("height",bottom)},onStepUnlock:function onStepUnlock(view){this.isStepLocking=false;this.stepView=null;$(window).off("resize",this.onResize);$(".page").off("resize",this.onResize)},onKill:function onKill(){this.onFinished();this.onStepUnlock()},onFinished:function onFinished(){this.wrapper.removeEventListener("scroll",this.preventWrapperScroll);$(this.wrapper).css("height","")},onRemove:function onRemove(){this.onStepUnlock();this.stepView=null}});return new TrickleBodyResizeHandler});define("extensions/adapt-contrib-trickle/js/handlers/tutor",["core/js/adapt"],function(Adapt){var TrickleTutorHandler=Backbone.Controller.extend({stepLockedId:null,isStepLocking:false,isTutorOpen:false,initialize:function initialize(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function onAppDataReady(){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"tutor:opened":this.onTutorOpened,"tutor:closed":this.onTutorClosed,"trickle:stepunlock":this.onStepUnlock,"remove":this.onRemove})},onStepLock:function onStepLock(view){if(view){this.stepLockedId=view.model.get("_id")}this.isStepLocking=true},onTutorOpened:function onTutorOpened(view,alertObject){if(!this.isStepLocking)return;if(!this.isOriginStepLocked(view))return;this.isTutorOpen=true;Adapt.trigger("trickle:overlay");Adapt.trigger("trickle:wait")},isOriginStepLocked:function isOriginStepLocked(view){if(!view||!this.stepLockedId)return true;var parents=view.model.getAncestorModels();var hasStepLockedParent=_.find(parents,function(ancestor){return ancestor.get("_id")===this.stepLockedId},this);if(!hasStepLockedParent)return false;return true},onTutorClosed:function onTutorClosed(view,alertObject){if(!this.isStepLocking)return;if(!this.isTutorOpen)return;if(!this.isOriginStepLocked(view))return;this.isTutorOpen=false;Adapt.trigger("trickle:unoverlay");Adapt.trigger("trickle:unwait")},onStepUnlock:function onStepUnlock(){this.isStepLocking=false;this.stepLockedId=null},onRemove:function onRemove(){this.onStepUnlock()}});return new TrickleTutorHandler});define("extensions/adapt-contrib-trickle/js/handlers/visibility",["core/js/adapt"],function(Adapt){var TrickleVisibilityHandler=Backbone.Controller.extend({isStepLocking:false,trickleModel:null,initialize:function initialize(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function onAppDataReady(){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"trickle:visibility":this.onVisibility,"trickle:stepunlock":this.onStepUnlock,"trickle:kill":this.onKill,"trickle:finished":this.onFinished,"remove":this.onRemove})},onStepLock:function onStepLock(view){this.isStepLocking=true;this.trickleModel=view.model;Adapt.trigger("trickle:visibility")},onVisibility:function onVisibility(){if(!this.isStepLocking)return;if(!Adapt.trickle.pageView)return;var descendantsParentFirst=Adapt.trickle.pageView.descendantsParentFirst;var trickleModelId=this.trickleModel.get("_id");var trickleType=this.trickleModel.get("_type");var atIndex=_.findIndex(descendantsParentFirst,function(descendant){if(descendant.get("_id")===trickleModelId)return true});descendantsParentFirst.forEach(function(descendant,index){var components=descendant.findDescendantModels("components");if(index<=atIndex){descendant.set("_isVisible",true,{pluginName:"trickle"});components.forEach(function(componentModel){componentModel.set("_isVisible",true,{pluginName:"trickle"})});return}if(trickleType==="article"&&descendant.get("_type")==="block"){if(descendant.get("_parentId")===trickleModelId){descendant.set("_isVisible",true,{pluginName:"trickle"});components.forEach(function(componentModel){componentModel.set("_isVisible",true,{pluginName:"trickle"})});return}}descendant.set("_isVisible",false,{pluginName:"trickle"});components.forEach(function(componentModel){componentModel.set("_isVisible",false,{pluginName:"trickle"})})})},onStepUnlock:function onStepUnlock(view){this.isStepLocking=false;this.trickleModel=null},onKill:function onKill(){this.onFinished();this.onStepUnlock()},onFinished:function onFinished(){var descendantsParentFirst=Adapt.trickle.pageView.descendantsParentFirst;descendantsParentFirst.forEach(function(descendant){descendant.set("_isVisible",true,{pluginName:"trickle"});var components=descendant.findDescendantModels("components");components.forEach(function(componentModel){componentModel.set("_isVisible",true,{pluginName:"trickle"})})})},onRemove:function onRemove(){this.onStepUnlock()}});return new TrickleVisibilityHandler});define("extensions/adapt-contrib-trickle/js/handlers/done",["core/js/adapt"],function(Adapt){var TrickleDone=Backbone.Controller.extend({initialize:function initialize(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function onAppDataReady(){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.onDone=_.debounce(this.onDone.bind(this),50);this.listenTo(Adapt,{"trickle:steplock":this.onDone,"trickle:stepunlock":this.onDone,"trickle:continue":this.onDone,"trickle:finished":this.onDone})},onDone:function onDone(){Adapt.trigger("trickle:done")}});return new TrickleDone});define("extensions/adapt-contrib-trickle/js/adapt-contrib-trickle",["core/js/adapt","./pageView","./handlers/button","./handlers/completion","./handlers/notify","./handlers/resize","./handlers/tutor","./handlers/visibility","./handlers/done"],function(Adapt,PageView){var Trickle=Backbone.Controller.extend({model:null,pageView:null,initialize:function initialize(){this.listenToOnce(Adapt,{"app:dataReady":this.onAppDataReady})},onAppDataReady:function onAppDataReady(){this.getCourseModel();if(!this.isCourseEnabled())return;this.setupListeners()},getCourseModel:function getCourseModel(){this.model=Adapt.course},isCourseEnabled:function isCourseEnabled(){var trickleConfig=this.getModelConfig(this.model);if(trickleConfig&&trickleConfig._isEnabled===false)return false;return true},getModelConfig:function getModelConfig(model){return model.get("_trickle")},getCompletionAttribute:function getCompletionAttribute(){var trickle=this.getModelConfig(Adapt.config);if(!trickle)return"_isComplete";return trickle._completionAttribute||"_isComplete"},setModelConfig:function setModelConfig(model,config){return model.set("_trickle",config)},setupListeners:function setupListeners(){this.listenTo(Adapt,"pageView:preRender",this.onPagePreRender)},onPagePreRender:function onPagePreRender(view){this.pageView=new PageView({model:view.model,el:view.el})},scroll:function scroll(fromModel){if(!this.shouldScrollPage(fromModel))return;fromModel.set("_isTrickleAutoScrollComplete",true);var trickle=Adapt.trickle.getModelConfig(fromModel);var isAutoScrollOff=!trickle._autoScroll;var hasTrickleButton=trickle._button._isEnabled;if(isAutoScrollOff&&!hasTrickleButton){return}var scrollTo=trickle._scrollTo;if(scrollTo===undefined)scrollTo="@block +1";var scrollToId="";switch(scrollTo.substr(0,1)){case"@":var relativeModel=fromModel.findRelativeModel(scrollTo,{filter:function filter(model){return model.get("_isAvailable")}});if(relativeModel===undefined)return;scrollToId=relativeModel.get("_id");break;case".":scrollToId=scrollTo.substr(1,scrollTo.length-1);break;default:scrollToId=scrollTo;}if(scrollToId==="")return;if(hasTrickleButton){Adapt.a11y.focusFirst($("."+scrollToId))}if(isAutoScrollOff)return;var duration=fromModel.get("_trickle")._scrollDuration||500;Adapt.scrollTo("."+scrollToId,{duration:duration})},shouldScrollPage:function shouldScrollPage(fromModel){var trickle=Adapt.trickle.getModelConfig(fromModel);if(!trickle||!trickle._isEnabled)return false;var hasScrolled=fromModel.get("_isTrickleAutoScrollComplete");if(hasScrolled)return false;var isArticleWithOnChildren=fromModel.get("_type")==="article"&&trickle._onChildren;if(isArticleWithOnChildren)return false;return true}});return Adapt.trickle=new Trickle});define("extensions/adapt-contrib-tutor/js/adapt-contrib-tutor",["core/js/adapt"],function(Adapt){Adapt.on("questionView:showFeedback",function(view){var alertObject={title:view.model.get("feedbackTitle"),body:view.model.get("feedbackMessage")};var attributes={};var classes=[];if(view.model.has("_isCorrect")){if(view.model.get("_isCorrect")){classes.push("is-correct")}else{if(view.model.has("_isAtLeastOneCorrectSelection")){if(view.model.get("_isAtLeastOneCorrectSelection")){classes.push("is-partially-correct")}else{classes.push("is-incorrect")}}else{classes.push("is-incorrect")}}}if(view.model.has("_component")){classes.push("is-component is-"+view.model.get("_component").toLowerCase())}else if(view.model.has("_extension")){classes.push("is-extension is-"+view.model.get("_extension").toLowerCase())}attributes["data-adapt-id"]=view.model.get("_id");alertObject._classes=classes.join(" ");alertObject._attributes=attributes;Adapt.once("notify:closed",function(){Adapt.trigger("tutor:closed",view,alertObject)});Adapt.trigger("notify:popup",alertObject);Adapt.trigger("tutor:opened",view,alertObject)})});define("extensions/adapt-contrib-xapi/js/adapt-contrib-xapi",["core/js/adapt","core/js/enums/completionStateEnum","libraries/async.min","libraries/xapiwrapper.min","libraries/url-polyfill.min"],function(Adapt,COMPLETION_STATE,Async){'use strict';var xAPI=Backbone.Model.extend({defaults:{lang:"en-US",displayLang:"en-US",generateIds:false,activityId:null,actor:null,shouldTrackState:true,shouldUseRegistration:false,componentBlacklist:"blank,graphic",isInitialised:false,state:{}},startAttemptDuration:0,startTimeStamp:null,courseName:"",courseDescription:"",defaultLang:"en-US",isComplete:false,coreEvents:{Adapt:{"router:page":false,"router:menu":false,"assessments:complete":true,"questionView:recordInteraction":true},contentObjects:{"change:_isComplete":false},articles:{"change:_isComplete":false},blocks:{"change:_isComplete":false},components:{"change:_isComplete":true}},coreObjects:{course:"course",contentObjects:["menu","page"],articles:"article",blocks:"block",components:"component",offlineStorage:"offlineStorage"},initialize:function initialize(){if(!Adapt.config){return}this.config=Adapt.config.get("_xapi");if(!this.getConfig("_isEnabled")){return this}Adapt.wait.begin();this.initializeWrapper(_.bind(function(error){if(error){this.onInitialised(error);return this}this.set({activityId:this.getLRSAttribute("activity_id")||this.getConfig("_activityID")||this.getBaseUrl(),displayLang:Adapt.config.get("_defaultLanguage"),lang:this.getConfig("_lang"),generateIds:this.getConfig("_generateIds"),shouldTrackState:this.getConfig("_shouldTrackState"),shouldUseRegistration:this.getConfig("_shouldUseRegistration")||false,componentBlacklist:this.getConfig("_componentBlacklist")||[]});var componentBlacklist=this.get("componentBlacklist");if(!_.isArray(componentBlacklist)){componentBlacklist=componentBlacklist.split(/,\s?/).map(function(component){return component.toLowerCase()})}this.set("componentBlacklist",componentBlacklist);if(!this.validateProps()){var error=new Error("Missing required properties");Adapt.log.error("adapt-contrib-xapi: xAPI Wrapper initialisation failed",error);this.onInitialised(error);return this}this.startTimeStamp=new Date;this.courseName=Adapt.course.get("displayTitle")||Adapt.course.get("title");this.courseDescription=Adapt.course.get("description")||"";var statements=[this.getCourseStatement(ADL.verbs.launched),this.getCourseStatement(ADL.verbs.initialized)];this.sendStatements(statements,_.bind(function(error){if(error){this.onInitialised(error);return this}if(["ios","android"].indexOf(Adapt.device.OS)>-1){$(document).on("visibilitychange",this.onVisibilityChange.bind(this))}else{$(window).on("beforeunload unload",this.sendUnloadStatements.bind(this))}if(!this.get("shouldTrackState")){this.onInitialised();return this}this.getState(_.bind(function(error){if(error){this.onInitialised(error);return this}if(_.isEmpty(this.get("state"))){this.sendStatement(this.getCourseStatement(ADL.verbs.attempted))}else{this.sendStatement(this.getCourseStatement(ADL.verbs.resumed))}this.restoreState();this.onInitialised();return this},this))},this))},this))},getLearnerInfo:function getLearnerInfo(){var globals=Adapt.course.get("_globals");if(!globals._learnerInfo){globals._learnerInfo={}}_.extend(globals._learnerInfo,Adapt.offlineStorage.get("learnerinfo"))},initializeWrapper:function initializeWrapper(callback){if(!this.getConfig("_endpoint")){this.xapiWrapper=window.xapiWrapper||ADL.XAPIWrapper;if(this.checkWrapperConfig()){this.set({registration:this.getLRSAttribute("registration"),actor:this.getLRSAttribute("actor")});this.xapiWrapper.strictCallbacks=true;callback()}else{ADL.launch(_.bind(function(error,launchData,xapiWrapper){if(error){return callback(error)}this.xapiWrapper=xapiWrapper;this.set({actor:launchData.actor});this.xapiWrapper.strictCallbacks=true;callback()},this),true,true)}}else{this.xapiWrapper=window.xapiWrapper||ADL.XAPIWrapper;var configError;try{this.setWrapperConfig()}catch(error){configError=error}if(configError){return callback(error)}this.set({registration:this.getLRSAttribute("registration"),actor:this.getLRSAttribute("actor")});this.xapiWrapper.strictCallbacks=true;callback()}},onInitialised:function onInitialised(error){this.set({isInitialised:!!!error});Adapt.wait.end();_.defer(function(){if(error){Adapt.trigger("xapi:lrs:initialize:error",error);return}Adapt.trigger("xapi:lrs:initialize:success")})},onLanguageChanged:function onLanguageChanged(newLanguage){this.set({displayLang:newLanguage});this.deleteState(function(){this.sendStatement(this.getCourseStatement(ADL.verbs.launched))})},onVisibilityChange:function onVisibilityChange(){if(document.visibilityState==="visible"){this.isTerminated=false;return this.sendStatement(this.getCourseStatement(ADL.verbs.resumed))}this.sendUnloadStatements()},sendUnloadStatements:function sendUnloadStatements(){if(this.isTerminated){return}var statements=[];if(!this.isComplete){statements.push(this.getCourseStatement(ADL.verbs.suspended))}statements.push(this.getCourseStatement(ADL.verbs.terminated));this.sendStatementsSync(statements);this.isTerminated=true},checkWrapperConfig:function checkWrapperConfig(){if(this.xapiWrapper.lrs.endpoint&&this.xapiWrapper.lrs.actor&&this.xapiWrapper.lrs.auth&&this.xapiWrapper.lrs.activity_id){return true}else{return false}},setWrapperConfig:function setWrapperConfig(){var keys=["endpoint","user","password"];var newConfig={};_.each(keys,function(key){var val=this.getConfig("_"+key);if(val){if(key==="endpoint"){val=val.replace(/\/?$/,"/");if(!/^https?:\/\//i.test(val)){Adapt.log.warn("adapt-contrib-xapi: \"_endpoint\" value is missing protocol (defaulting to http://)");val="http://"+val}}newConfig[key]=val}},this);if(!_.isEmpty(newConfig)){this.xapiWrapper.changeConfig(newConfig);if(!this.xapiWrapper.testConfig()){throw new Error("Incorrect xAPI configuration detected")}}},getBaseUrl:function getBaseUrl(){var url=window.location.origin+window.location.pathname;Adapt.log.info("adapt-contrib-xapi: Using detected URL ("+url+") as ActivityID");return url},getAttemptDuration:function getAttemptDuration(){return this.startAttemptDuration+this.getSessionDuration()},getSessionDuration:function getSessionDuration(){return Math.abs(new Date-this.startTimeStamp)},convertMillisecondsToISO8601Duration:function convertMillisecondsToISO8601Duration(inputMilliseconds){var hours;var minutes;var seconds;var i_inputMilliseconds=parseInt(inputMilliseconds,10);var i_inputCentiseconds;var inputIsNegative="";var rtnStr="";i_inputCentiseconds=Math.round(i_inputMilliseconds/10);if(i_inputCentiseconds<0){inputIsNegative="-";i_inputCentiseconds=i_inputCentiseconds*-1}hours=parseInt(i_inputCentiseconds/360000,10);minutes=parseInt(i_inputCentiseconds%360000/6000,10);seconds=i_inputCentiseconds%360000%6000/100;rtnStr=inputIsNegative+"PT";if(hours>0){rtnStr+=hours+"H"}if(minutes>0){rtnStr+=minutes+"M"}rtnStr+=seconds+"S";return rtnStr},setupListeners:function setupListeners(){if(!this.get("isInitialised")){Adapt.log.warn("adapt-contrib-xapi: Unable to setup listeners for xAPI");return}this.getLearnerInfo();this.listenTo(Adapt,"app:languageChanged",this.onLanguageChanged);if(this.get("shouldTrackState")){this.listenTo(Adapt,"state:change",this.sendState)}this.coreEvents=_.extend(this.coreEvents,this.getConfig("_coreEvents"));this.listenTo(Adapt,"tracking:complete",this.onTrackingComplete);if(this.coreEvents["Adapt"]["router:menu"]){this.listenTo(Adapt,"router:menu",this.onItemExperience)}if(this.coreEvents["Adapt"]["router:page"]){this.listenTo(Adapt,"router:page",this.onItemExperience)}if(this.coreEvents["Adapt"]["questionView:recordInteraction"]){this.listenTo(Adapt,"questionView:recordInteraction",this.onQuestionInteraction)}if(this.coreEvents["Adapt"]["assessments:complete"]){this.listenTo(Adapt,"assessments:complete",this.onAssessmentComplete)}_.each(_.keys(this.coreEvents),function(key){if(key!=="Adapt"){var val=this.coreEvents[key];if(_typeof(val)==="object"&&val["change:_isComplete"]===true){this.listenTo(Adapt[key],"change:_isComplete",this.onItemComplete)}}},this)},getCourseActivity:function getCourseActivity(){var object=new ADL.XAPIStatement.Activity(this.get("activityId"));var name={};var description={};name[this.get("displayLang")]=this.courseName;description[this.get("displayLang")]=this.courseDescription;object.definition={type:ADL.activityTypes.course,name:name,description:description};return object},getCourseStatement:function getCourseStatement(verb,result){if(typeof result==="undefined"){result={}}var object=this.getCourseActivity();switch(verb){case ADL.verbs.launched:case ADL.verbs.initialized:case ADL.verbs.attempted:{result.duration="PT0S";break}case ADL.verbs.failed:case ADL.verbs.passed:case ADL.verbs.suspended:{result.duration=this.convertMillisecondsToISO8601Duration(this.getAttemptDuration());break}case ADL.verbs.terminated:{result.duration=this.convertMillisecondsToISO8601Duration(this.getSessionDuration());break}}return this.getStatement(this.getVerb(verb),object,result)},getNameObject:function getNameObject(model){var name={};name[this.get("displayLang")]=model.get("displayTitle")||model.get("title");return name},getActivityType:function getActivityType(model){var type="";switch(model.get("_type")){case"component":{type=model.get("_isQuestionType")?ADL.activityTypes.interaction:ADL.activityTypes.media;break}case"block":case"article":{type=ADL.activityTypes.interaction;break}case"course":{type=ADL.activityTypes.course;break}case"menu":{type=ADL.activityTypes.module;break}case"page":{type=ADL.activityTypes.lesson;break}}return type},onQuestionInteraction:function onQuestionInteraction(view){if(!view.model||view.model.get("_type")!=="component"&&!view.model.get("_isQuestionType")){return}if(this.isComponentOnBlacklist(view.model.get("_component"))){return}var object=new ADL.XAPIStatement.Activity(this.getUniqueIri(view.model));var isComplete=view.model.get("_isComplete");var lang=this.get("displayLang");var statement;var description={};description[this.get("displayLang")]=this.stripHtml(view.model.get("body"));object.definition={name:this.getNameObject(view.model),description:description,type:ADL.activityTypes.question,interactionType:view.getResponseType()};if(typeof view.getInteractionObject==="function"){_.extend(object.definition,view.getInteractionObject());_.each(_.keys(object.definition),function(key){if(_.isArray(object.definition[key])&&object.definition[key].length!==0){for(var i=0;i<object.definition[key].length;i++){if(!object.definition[key][i].hasOwnProperty("description")){break}if(typeof object.definition[key][i].description==="string"){var description={};description[lang]=object.definition[key][i].description;object.definition[key][i].description=description}}}})}var result={score:{raw:view.model.get("_score")||0},success:view.model.get("_isCorrect"),completion:isComplete,response:this.processInteractionResponse(object.definition.interactionType,view.getResponse())};statement=this.getStatement(this.getVerb(ADL.verbs.answered),object,result);this.addGroupingActivity(view.model,statement);this.sendStatement(statement)},stripHtml:function stripHtml(html){var tempDiv=document.createElement("div");tempDiv.innerHTML=html;return tempDiv.textContent||tempDiv.innerText||""},processInteractionResponse:function processInteractionResponse(responseType,response){switch(responseType){case"choice":{response=response.replace(/,|#/g,"[,]");break}case"matching":{response=response.split("#").map(function(val,i){return i+1+"[.]"+val.replace(".","_")}).join("[,]");break}}return response},onItemExperience:function onItemExperience(model){if(model.get("_id")==="course"){return}var object=new ADL.XAPIStatement.Activity(this.getUniqueIri(model));var statement;object.definition={name:this.getNameObject(model),type:this.getActivityType(model)};statement=this.getStatement(this.getVerb(ADL.verbs.experienced),object);this.addGroupingActivity(model,statement);this.sendStatement(statement)},isComponentOnBlacklist:function isComponentOnBlacklist(component){return this.get("componentBlacklist").indexOf(component)!==-1},onItemComplete:function onItemComplete(model,isComplete){if(isComplete===false){return}if(model.get("_type")==="component"&&model.get("_isQuestionType")===true&&this.coreEvents["Adapt"]["questionView:recordInteraction"]===true&&this.coreEvents["components"]["change:_isComplete"]===true){return}if(model.get("_type")==="component"&&this.isComponentOnBlacklist(model.get("_component"))){return}var result={completion:true};var object=new ADL.XAPIStatement.Activity(this.getUniqueIri(model));var statement;object.definition={name:this.getNameObject(model),type:this.getActivityType(model)};statement=this.getStatement(this.getVerb(ADL.verbs.completed),object,result);this.addGroupingActivity(model,statement);this.sendStatement(statement)},getLessonActivity:function getLessonActivity(page){var pageModel=typeof page==="string"?Adapt.findById(page):page;var activity=new ADL.XAPIStatement.Activity(this.getUniqueIri(pageModel));var name=this.getNameObject(pageModel);activity.definition={name:name,type:ADL.activityTypes.lesson};return activity},addGroupingActivity:function addGroupingActivity(model,statement){var type=model.get("_type");if(type!=="course"){statement.addGroupingActivity(this.getCourseActivity())}if(["article","block","component"].indexOf(type)!==-1){var pageModel=model.findAncestor("pages");statement.addGroupingActivity(this.getLessonActivity(pageModel))}if(type==="component"&&model.get("_isPartOfAssessment")){var articleModel=model.findAncestor("articles");if(articleModel&&articleModel.has("_assessment")&&articleModel.get("_assessment")._isEnabled){var assessment={id:articleModel.get("_assessment")._id,articleId:articleModel.get("_id"),type:"article-assessment",pageId:articleModel.get("_parentId")};statement.addParentActivity(this.getAssessmentObject(assessment))}}},getAssessmentResultObject:function getAssessmentResultObject(assessment){var result={score:{scaled:assessment.scoreAsPercent/100,raw:assessment.score,min:0,max:assessment.maxScore},success:assessment.isPass,completion:assessment.isComplete};return result},getAssessmentObject:function getAssessmentObject(assessment){var fakeModel=new Backbone.Model({_id:assessment.id||assessment.articleId,_type:assessment.type,pageId:assessment.pageId});var object=new ADL.XAPIStatement.Activity(this.getUniqueIri(fakeModel));var name={};name[this.get("displayLang")]=assessment.id||"Assessment";object.definition={name:name,type:ADL.activityTypes.assessment};return object},onAssessmentComplete:function onAssessmentComplete(assessment){var self=this;var object=this.getAssessmentObject(assessment);var result=this.getAssessmentResultObject(assessment);var statement;if(assessment.isPass){statement=this.getStatement(this.getVerb(ADL.verbs.passed),object,result)}else{statement=this.getStatement(this.getVerb(ADL.verbs.failed),object,result)}statement.addGroupingActivity(this.getCourseActivity());statement.addGroupingActivity(this.getLessonActivity(assessment.pageId));_.delay(function(){self.sendStatement(statement)},500)},getVerb:function getVerb(verb){if(typeof verb==="string"){var key=verb.toLowerCase();verb=ADL.verbs[key];if(!verb){Adapt.log.error("adapt-contrib-xapi: Verb \""+key+"\" does not exist in ADL.verbs object")}}if(_typeof(verb)!=="object"){throw new Error("Unrecognised verb: "+verb)}var lang=this.get("lang")||this.defaultLang;var singleLanguageVerb={id:verb.id,display:{}};var description=verb.display[lang];if(description){singleLanguageVerb.display[lang]=description}else{singleLanguageVerb.display[this.defaultLang]=verb.display[this.defaultLang]}return singleLanguageVerb},getUniqueIri:function getUniqueIri(model){var iri=this.get("activityId");var type=model.get("_type");if(type!=="course"){if(type==="article-assessment"){iri=iri+["#","assessment",model.get("_id")].join("/")}else{iri=iri+["#/id",model.get("_id")].join("/")}}return iri},onTrackingComplete:function onTrackingComplete(completionData){var self=this;var result={};var completionVerb;switch(completionData.status){case COMPLETION_STATE.PASSED:{completionVerb=ADL.verbs.passed;break}case COMPLETION_STATE.FAILED:{completionVerb=ADL.verbs.failed;break}default:{completionVerb=ADL.verbs.completed}}if(completionVerb===ADL.verbs.completed){result={completion:true}}else{result=this.getAssessmentResultObject(completionData.assessment)}this.isComplete=true;_.defer(function(){self.sendStatement(self.getCourseStatement(completionVerb,result))})},restoreState:function restoreState(){var state=this.get("state");if(_.isEmpty(state)){return}var Adapt=require("core/js/adapt");if(state.components){_.each(state.components,function(stateObject){var restoreModel=Adapt.findById(stateObject._id);if(restoreModel){restoreModel.setTrackableState(stateObject)}else{Adapt.log.warn("adapt-contrib-xapi: Unable to restore state for component: "+stateObject._id)}})}if(state.blocks){_.each(state.blocks,function(stateObject){var restoreModel=Adapt.findById(stateObject._id);if(restoreModel){restoreModel.setTrackableState(stateObject)}else{Adapt.log.warn("adapt-contrib-xapi: Unable to restore state for block: "+stateObject._id)}})}},getStatement:function getStatement(verb,object,result,context){var statement=new ADL.XAPIStatement(new ADL.XAPIStatement.Agent(this.get("actor")),verb,object);if(result&&!_.isEmpty(result)){statement.result=result}if(context){statement.context=context}if(this.get("_generateIds")){statement.generateId()}return statement},sendState:function sendState(model,modelState){if(this.get("shouldTrackState")!==true){return}var activityId=this.get("activityId");var actor=this.get("actor");var type=model.get("_type");var state=this.get("state");var registration=this.get("shouldUseRegistration")===true?this.get("registration"):null;var collectionName=_.findKey(this.coreObjects,function(o){return o===type||o.indexOf(type)>-1});var stateCollection=_.isArray(state[collectionName])?state[collectionName]:[];var newState;if(collectionName!=="course"&&collectionName!=="offlineStorage"){var index=_.findIndex(stateCollection,{_id:model.get("_id")});if(index!==-1){stateCollection.splice(index,1,modelState)}else{stateCollection.push(modelState)}newState=stateCollection}else{newState=modelState}state[collectionName]=newState;this.set({state:state});this.xapiWrapper.sendState(activityId,actor,collectionName,registration,newState,null,null,function(error,xhr){if(error){Adapt.trigger("xapi:lrs:sendState:error",error)}Adapt.trigger("xapi:lrs:sendState:success",newState)})},getState:function getState(callback){callback=_.isFunction(callback)?callback:function(){};var self=this;var activityId=this.get("activityId");var actor=this.get("actor");var registration=this.get("shouldUseRegistration")===true?this.get("registration"):null;var state={};Async.each(_.keys(this.coreObjects),function(type,nextType){self.xapiWrapper.getState(activityId,actor,type,registration,null,function(error,xhr){_.defer(function(){if(error){Adapt.log.warn("adapt-contrib-xapi: getState() failed for "+activityId+" ("+type+")");return nextType(error)}if(!xhr){Adapt.log.warn("adapt-contrib-xapi: getState() failed for "+activityId+" ("+type+")");return nextType(new Error("'xhr' parameter is missing from callback"))}if(xhr.status===404){return nextType()}if(xhr.status!==200){Adapt.log.warn("adapt-contrib-xapi: getState() failed for "+activityId+" ("+type+")");return nextType(new Error("Invalid status code "+xhr.status+" returned from getState() call"))}var response;var parseError;if(xhr.response===""){return nextType()}try{response=JSON.parse(xhr.response)}catch(e){parseError=e}if(parseError){return nextType(parseError)}if(!_.isEmpty(response)){state[type]=response}return nextType()})})},function(error){if(error){Adapt.log.error("adapt-contrib-xapi:",error);return callback(error)}if(!_.isEmpty(state)){self.set({state:state})}Adapt.trigger("xapi:stateLoaded");callback()})},deleteState:function deleteState(callback){callback=_.isFunction(callback)?callback:function(){};var self=this;var activityId=this.get("activityId");var actor=this.get("actor");var registration=this.get("shouldUseRegistration")===true?this.get("registration"):null;Async.each(_.keys(this.coreObjects),function(type,nextType){self.xapiWrapper.deleteState(activityId,actor,type,registration,null,null,function(error,xhr){if(error){Adapt.log.warn("adapt-contrib-xapi: deleteState() failed for "+activityId+" ("+type+")");return nextType(error)}if(!xhr){Adapt.log.warn("adapt-contrib-xapi: deleteState() failed for "+activityId+" ("+type+")");return nextType(new Error("'xhr' parameter is missing from callback"))}if(xhr.status!==204){Adapt.log.warn("adapt-contrib-xapi: deleteState() failed for "+activityId+" ("+type+")");return nextType(new Error("Invalid status code "+xhr.status+" returned from getState() call"))}return nextType()})},function(error){if(error){Adapt.log.error("adapt-contrib-xapi:",error);return callback(error)}callback()})},getConfig:function getConfig(key){if(!this.config||key===""||typeof this.config[key]==="undefined"){return false}return this.config[key]},getLRSAttribute:function getLRSAttribute(key){if(!this.xapiWrapper||!this.xapiWrapper.lrs||undefined===this.xapiWrapper.lrs[key]){return null}try{switch(key){case"actor":{var actor=JSON.parse(this.xapiWrapper.lrs[key]);if(_.isArray(actor.name)){actor.name=actor.name[0]}if(_.isArray(actor.mbox)){actor.mbox=actor.mbox[0]}if(_.isArray(actor.account)){var account={};if(typeof actor.account[0].accountServiceHomePage!=="undefined"){account.homePage=actor.account[0].accountServiceHomePage}else if(actor.account[0].homePage!=="undefined"){account.homePage=actor.account[0].homePage}if(typeof actor.account[0].accountName!=="undefined"){account.name=actor.account[0].accountName}else if(typeof actor.account[0].name!=="undefined"){account.name=actor.account[0].name}delete actor.account;actor.account=account}return actor}default:return this.xapiWrapper.lrs[key];}}catch(e){return null}},getLRSExtendedAttribute:function getLRSExtendedAttribute(key){var extended=this.getLRSAttribute("extended");if(extended==null){return null}try{if(key==="definition"){return JSON.parse(extended.definition)}return extended[key]}catch(e){return null}},validateProps:function validateProps(){var errorCount=0;if(!this.get("actor")||_typeof(this.get("actor"))!=="object"){Adapt.log.warn("adapt-contrib-xapi: \"actor\" attribute not found!");errorCount++}if(!this.get("activityId")){Adapt.log.warn("adapt-contrib-xapi: \"activityId\" attribute not found!");errorCount++}if(errorCount>0){return false}return true},sendStatement:function sendStatement(statement,callback,attachments){callback=_.isFunction(callback)?callback:function(){};if(!statement){return}Adapt.trigger("xapi:preSendStatement",statement);if(_.isUndefined(attachments)&&statement.attachments){return this.processAttachments(statement,callback)}else{this.onStatementReady(statement,callback,attachments)}},sendStatementsSync:function sendStatementsSync(statements){var lrs=ADL.XAPIWrapper.lrs;if(!window.fetch||this.isCORS(lrs.endpoint)){return this.sendStatements(statements)}var url=lrs.endpoint+"statements";var credentials=ADL.XAPIWrapper.withCredentials?"include":"omit";var headers={"Content-Type":"application/json","Authorization":lrs.auth,"X-Experience-API-Version":ADL.XAPIWrapper.xapiVersion};var extended=_.map(lrs.extended,function(value,key){return key+"="+encodeURIComponent(value)});if(extended.length>0){url+=(url.indexOf("?")>-1?"&":"?")+extended.join("&")}fetch(url,{body:JSON.stringify(statements),cache:"no-cache",credentials:credentials,headers:headers,mode:"same-origin",keepalive:true,method:"POST"}).then(function(){Adapt.trigger("xapi:lrs:sendStatement:success",statements)}).catch(function(error){Adapt.trigger("xapi:lrs:sendStatement:error",error)})},isCORS:function isCORS(url){var urlparts=url.toLowerCase().match(/^(.+):\/\/([^:\/]*):?(\d+)?(\/.*)?$/);var isCORS=location.protocol.toLowerCase().replace(":","")!==urlparts[1]||location.hostname.toLowerCase()!==urlparts[2];if(!isCORS){var urlPort=urlparts[3]===null?urlparts[1]==="http"?"80":"443":urlparts[3];isCORS=urlPort===location.port}return isCORS},onStatementReady:function onStatementReady(statement,callback,attachments){this.xapiWrapper.sendStatement(statement,function(error){if(error){Adapt.trigger("xapi:lrs:sendStatement:error",error);return callback(error)}Adapt.trigger("xapi:lrs:sendStatement:success",statement);return callback()},attachments)},processAttachments:function processAttachments(statement,callback){var attachments=statement.attachments;Async.each(attachments,function(attachment,nextAttachment){if(attachment.value){nextAttachment()}else if(attachment.url){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(this.readyState===4&&this.status===200){var reader=new FileReader;reader.onload=function(){attachment.value=reader.result;delete attachment.url;nextAttachment()};reader.readAsBinaryString(this.response)}};xhr.open("GET",attachment.url);xhr.responseType="blob";xhr.send()}else{Adapt.log.warn("Attachment object contained neither a value or url property.")}},function(){delete statement.attachments;this.onStatementReady(statement,callback,attachments)}.bind(this))},sendStatements:function sendStatements(statements,callback){callback=_.isFunction(callback)?callback:function(){};if(!statements||statements.length===0){return}Adapt.trigger("xapi:preSendStatements",statements);Async.each(statements,function(statement,nextStatement){this.sendStatement(statement,nextStatement)}.bind(this),function(error){if(error){Adapt.log.error("adapt-contrib-xapi:",error);return callback(error)}callback()})},getGlobals:function getGlobals(){return _.defaults(Adapt&&Adapt.course&&Adapt.course.get("_globals")&&Adapt.course.get("_globals")._extensions&&Adapt.course.get("_globals")._extensions._xapi||{},{"confirm":"OK","lrsConnectionErrorTitle":"LRS not available","lrsConnectionErrorMessage":"We were unable to connect to your Learning Record Store (LRS). This means that your progress cannot be recorded."})},showError:function showError(){if(this.getConfig("_lrsFailureBehaviour")==="ignore"){return}var notifyObject={title:this.getGlobals().lrsConnectionErrorTitle,body:this.getGlobals().lrsConnectionErrorMessage,confirmText:this.getGlobals().confirm};Adapt.wait.begin();Adapt.trigger("notify:alert",notifyObject);$(".notify").css({position:"relative",zIndex:5001});Adapt.once("notify:closed",Adapt.wait.end)}});xAPI.getInstance=function(){if(!xAPI.instance){xAPI.instance=new xAPI}return xAPI.instance};Adapt.once("app:dataLoaded",function(){var xapi=xAPI.getInstance();xapi.initialize();Adapt.on("adapt:initialize",function(){xapi.setupListeners()});Adapt.on("xapi:lrs:initialize:error",function(error){Adapt.log.error("adapt-contrib-xapi: xAPI Wrapper initialisation failed",error);xapi.showError()});Adapt.on("xapi:lrs:sendStatement:error",function(error){xapi.showError()});Adapt.on("xapi:lrs:sendState:error",function(error){xapi.showError()})});return xAPI.getInstance()});define("extensions/adapt-contrib-xapi/js/adapt-offlineStorage-xapi",["core/js/adapt","./adapt-contrib-xapi"],function(Adapt,xapi){var offlineStorage={load:function load(){var fakeModel={get:function get(){return"offlineStorage"}};var store=new Backbone.Model;var isDataRestored=false;Adapt.offlineStorage.initialize({get:function get(name){if(!name){return this.getAll()}if(!this.useTemporaryStore()&&name.toLowerCase()==="learnerinfo"){return this.getLearnerInfo()}return store.get(name)},getAll:function getAll(){if(!isDataRestored){var state=xapi.get("state")||{};store.set(state.offlineStorage);isDataRestored=true}if(this.useTemporaryStore()){return store.toJSON()}return _.extend(store.toJSON(),{learnerInfo:this.getLearnerInfo()})},set:function set(name,value){store.set(name,value);Adapt.trigger("state:change",fakeModel,store.toJSON())},useTemporaryStore:function useTemporaryStore(){return!xapi.get("isInitialised")},getLearnerInfo:function getLearnerInfo(){var actor=xapi.get("actor")||{};var name=actor.name||"";var lastname;var firstname;var matches=name.match(/(\S+)\s(.+)/);if(matches&&matches.length>2){lastname=matches[2];firstname=matches[1]}else{console.log("xAPI: actor name not in \"firstname lastname\" format")}return{id:this.getLearnerId(actor),name:name,lastname:lastname,firstname:firstname}},getLearnerId:function getLearnerId(actor){var name=actor.account&&actor.account.name;if(name){return name}if(actor.openid){return actor.openid}if(typeof actor.mbox==="string"&&actor.mbox.length>0){return actor.mbox.replace("mailto:","")}console.log("xAPI: could not determine the learner's ID");return null}})}};return offlineStorage});define("extensions/adapt-contrib-xapi/js/index",["core/js/adapt","./adapt-offlineStorage-xapi","./adapt-contrib-xapi"],function(Adapt,offlineStorage){Adapt.on("app:dataLoaded",initialise);function initialise(){var config=Adapt.config.get("_xapi")||{};if(!config._isEnabled){return}offlineStorage.load();var successEvent=config._shouldTrackState?"xapi:stateLoaded":"xapi:lrs:initialize:success";Adapt.once("xapi:lrs:initialize:error "+successEvent,function(){Adapt.offlineStorage.get();Adapt.offlineStorage.setReadyStatus()})}});define("extensions/adapt-devtools/js/devtools-model",["require","coreJS/adapt"],function(require){var Adapt=require("coreJS/adapt");var DevtoolsModel=Backbone.Model.extend({initialize:function initialize(){var config=Adapt.config.has("_devtools")?Adapt.config.get("_devtools"):this.getDefaultConfig();this.set(_.extend({"_trickleEnabled":false,"_hintingAvailable":true,"_hintingEnabled":false,"_toggleFeedbackAvailable":true,"_feedbackEnabled":true,"_autoCorrectAvailable":true,"_autoCorrectEnabled":false,"_altTextAvailable":true,"_altTextEnabled":false,"_tutorListener":null,"_unlockAvailable":true,"_unlocked":false,"_toggleBankingAvailable":true,"_traceFocusAvailable":true,"_traceFocusEnabled":false,"_extended":true},config))},getDefaultConfig:function getDefaultConfig(){return{"_isEnabled":false,"_extended":true}},toggleFeedback:function toggleFeedback(){this.set("_feedbackEnabled",!this.get("_feedbackEnabled"))},toggleHinting:function toggleHinting(){this.set("_hintingEnabled",!this.get("_hintingEnabled"))},toggleAutoCorrect:function toggleAutoCorrect(){this.set("_autoCorrectEnabled",!this.get("_autoCorrectEnabled"))},toggleAltText:function toggleAltText(){this.set("_altTextEnabled",!this.get("_altTextEnabled"))},toggleTraceFocus:function toggleTraceFocus(){this.set("_traceFocusEnabled",!this.get("_traceFocusEnabled"))}});return DevtoolsModel});define("extensions/adapt-devtools/js/hinting",["require","coreJS/adapt"],function(require){var Adapt=require("coreJS/adapt");var Hinting=_.extend({initialize:function initialize(){this.listenTo(Adapt.devtools,"change:_hintingEnabled",this.toggleHints)},toggleHints:function toggleHints(){var contentObject=Adapt.findById(Adapt.location._currentId);var components=contentObject.findDescendantModels("components");var renderedQuestions=_.filter(components,function(m){return m.get("_isQuestionType")===true&&m.get("_isReady")===true});_.each(renderedQuestions,function(model){this.setHinting($("."+model.get("_id")),model,Adapt.devtools.get("_hintingEnabled"))},this);if(Adapt.devtools.get("_hintingEnabled"))this.listenTo(Adapt,"componentView:postRender",this.onComponentRendered);else this.stopListening(Adapt,"componentView:postRender")},onComponentRendered:function onComponentRendered(view,hintingEnabled){if(view.model.get("_isQuestionType"))this.setHinting(view.$el,view.model)},setHinting:function setHinting($el,model,hintingEnabled){switch(model.get("_component")){case"mcq":this.setMcqHinting($el,model,hintingEnabled!==false);break;case"gmcq":this.setGmcqHinting($el,model,hintingEnabled!==false);break;case"matching":this.setMatchingHinting($el,model,hintingEnabled!==false);break;case"ppq":this.setPpqHinting($el,model,hintingEnabled!==false);break;case"slider":this.setSliderHinting($el,model,hintingEnabled!==false);break;case"textinput":this.setTextInputHinting($el,model,hintingEnabled!==false);break;case"questionStrip":this.setQuestionStripHinting($el,model,hintingEnabled!==false);break;}},setMcqHinting:function setMcqHinting($el,model,hintingEnabled){if(hintingEnabled){_.each(model.get("_items"),function(item,index){$el.find(".js-mcq-item").eq(index).addClass(item._shouldBeSelected?"hint-is-correct":"hint-is-incorrect")})}else{$el.find(".js-mcq-item").removeClass("hint-is-correct hint-is-incorrect")}},setGmcqHinting:function setGmcqHinting($el,model,hintingEnabled){if(hintingEnabled){_.each(model.get("_items"),function(item,index){$el.find(".js-mcq-item").eq(index).addClass(item._shouldBeSelected?"hint-is-correct":"hint-is-incorrect")})}else{$el.find(".js-mcq-item").removeClass("hint-is-correct hint-is-incorrect")}},setMatchingHinting:function setMatchingHinting($el,model,hintingEnabled){if(hintingEnabled){_.each(model.get("_items"),function(item,itemIndex){var $item=$el.find(".item").eq(itemIndex);var $options=$item.find(".js-dropdown-list-item");_.each(item._options,function(option,optionIndex){if(option._isCorrect)$options.eq(optionIndex+1).find(".js-dropdown-list-item-inner").append("<span class=\"hint\"> (correct)</span>")})})}else{$el.find(".js-dropdown-list-item-inner .hint").remove()}},setSliderHinting:function setSliderHinting($el,model,hintingEnabled){if(hintingEnabled){var correctAnswer=model.get("_correctAnswer");if(correctAnswer){$el.find(".js-slider-number").addClass("hint-is-incorrect");$el.find(".js-slider-number[data-id=\""+correctAnswer+"\"]").removeClass("hint-is-incorrect").addClass("hint-is-correct")}else{$el.find(".js-slider-number").addClass("hint-is-incorrect");var bottom=model.get("_correctRange")._bottom;var top=model.get("_correctRange")._top;for(var i=bottom;i<=top;i++){$el.find(".js-slider-number[data-id=\""+i+"\"]").removeClass("hint-is-incorrect").addClass("hint-is-correct")}}}else{$el.find(".js-slider-number").removeClass("hint-is-correct hint-is-incorrect")}},setTextInputHinting:function setTextInputHinting($el,model,hintingEnabled){if(hintingEnabled){_.each(model.get("_items"),function(item,index){if(model.get("_answers")){$el.find(".js-textinput-item").eq(index).find("input").attr("placeholder",model.get("_answers")[index][0])}else{$el.find(".js-textinput-item").eq(index).find("input").attr("placeholder",item._answers[0])}})}else{_.each(model.get("_items"),function(item,index){if(model.get("_answers")){$el.find(".js-textinput-item").eq(index).find("input").attr("placeholder",item.placeholder)}})}},setQuestionStripHinting:function setQuestionStripHinting($el,model,hintingEnabled){if(hintingEnabled){_.each(model.get("_items"),function(item,itemIndex){var $item=$el.find(".component-item").eq(itemIndex);var $subItems=$item.find(".qs-strapline-header-inner:not(.qs-noop) .qs-strapline-title-inner");_.each(item._subItems,function(subItem,subItemIndex){if(subItem._isCorrect)$subItems.eq(subItemIndex).append("<span class=\"hint\"> (correct)</span>")})})}else{$el.find(".qs-strapline-title-inner .hint").remove()}},setPpqHinting:function setPpqHinting($el,model,hintingEnabled){console.log("setPpqHinting",hintingEnabled);if(!model.get("_developerMode")){$el.find(".ppq-correct-zone").toggleClass("display-none",!hintingEnabled);$el.find(".ppq-pinboard").toggleClass("developer-mode",hintingEnabled)}}},Backbone.Events);Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;Hinting.initialize()});return Hinting});define("extensions/adapt-devtools/js/is-question-supported",["require"],function(require){function isQuestionSupported(model){switch(model.get("_component")){case"mcq":case"gmcq":case"matching":case"ppq":case"slider":case"textinput":case"questionStrip":return true;default:return false;}}return isQuestionSupported});define("extensions/adapt-devtools/js/auto-answer",["require","coreJS/adapt","./hinting","./is-question-supported"],function(require){var Adapt=require("coreJS/adapt");var ItemsQuestionModel=undefined;var Hinting=require("./hinting");var isQuestionSupported=require("./is-question-supported");var AutoAnswer=_.extend({mousedownHandlers:[],initialize:function initialize(){this.listenTo(Adapt,{"componentView:postRender":this.componentRendered,"remove":this.onRemove})},componentRendered:function componentRendered(view){if(isQuestionSupported(view.model)){if(view.buttonsView){var handler=_.bind(this.onQuestionMouseDown,this,view);view.$el.on("mousedown",handler);this.mousedownHandlers.push({element:view.$el,handler:handler})}else if(Adapt.devtools.get("_debug")){console.warn("adapt-devtools: could not find submit button on "+view.model.get("_id"))}}},onQuestionMouseDown:function onQuestionMouseDown(view,e){if(Adapt.devtools.get("_hintingEnabled"))Hinting.setHinting(view.$el,view.model,false);if(e.ctrlKey&&!e.shiftKey||Adapt.devtools.get("_autoCorrectEnabled")){this.answer(view)}else if(e.ctrlKey&&e.shiftKey){this.answer(view,true)}},isItemsQuestionModel:function isItemsQuestionModel(model){if(ItemsQuestionModel){return model instanceof ItemsQuestionModel}else if(ItemsQuestionModel===null){return false}if(require.defined("core/js/models/"+"itemsQuestionModel")){ItemsQuestionModel=require("core/js/models/"+"itemsQuestionModel");return model instanceof ItemsQuestionModel}else{ItemsQuestionModel=null;return false}},answer:function answer(view,incorrectly){if(view.model.get("_isSubmitted"))return;if(Adapt.devtools.get("_debug")){console.log("adapt-devtools: answer "+view.model.get("_id")+(incorrectly===true?" incorrectly":""))}if(incorrectly===true){switch(view.model.get("_component")){case"mcq":this.answerMultipleChoiceIncorrectly(view);break;case"gmcq":this.answerMultipleChoiceIncorrectly(view,true);break;case"matching":this.answerMatchingIncorrectly(view);break;case"ppq":this.answerPpqIncorrectly(view);break;case"slider":this.answerSliderIncorrectly(view);break;case"textinput":this.answerTextInputIncorrectly(view);break;case"questionStrip":this.answerQuestionStripIncorrectly(view);break;default:this.answerUnsupportedIncorrectly(view);}}else{switch(view.model.get("_component")){case"mcq":this.answerMultipleChoice(view);break;case"gmcq":this.answerMultipleChoice(view,true);break;case"matching":this.answerMatching(view);break;case"ppq":this.answerPpq(view);break;case"slider":this.answerSlider(view);break;case"textinput":this.answerTextInput(view);break;case"questionStrip":this.answerQuestionStrip(view);break;default:this.answerUnsupported(view);}}view.$(".js-btn-action").trigger("click")},answerMultipleChoice:function answerMultipleChoice(view,isGraphical){var items=this.isItemsQuestionModel(view.model)?view.model.getChildren().toJSON():view.model.get("_items");var noCorrectOptions=_.where(items,{"_shouldBeSelected":true}).length==0;if(noCorrectOptions){if(_.where(items,{"_isSelected":true}).length==0){view.$(isGraphical?".js-item-input":".js-item-input").eq(_.random(items.length-1)).trigger("change")}}else{_.each(items,function(item,index){if(item._shouldBeSelected&&!item._isSelected||!item._shouldBeSelected&&item._isSelected){view.$(isGraphical?".js-item-input":".js-item-input").eq(index).trigger("change")}})}},answerMultipleChoiceIncorrectly:function answerMultipleChoiceIncorrectly(view,isGraphical){var model=view.model;var items=this.isItemsQuestionModel(model)?model.getChildren().toJSON():model.get("_items");var itemCount=items.length;var selectionStates=_.times(itemCount,function(){return false});var nShould=_.where(items,{_shouldBeSelected:true}).length;var nShouldNot=itemCount-nShould;var nSelect=model.get("_selectable");var nIncorrect=nShouldNot==0?0:_.random(nShould==1?1:0,Math.min(nShouldNot,nSelect));var nCorrect=nIncorrect==0?_.random(1,Math.min(nShould-1,nSelect)):_.random(0,Math.min(nShould,nSelect-nIncorrect));if(itemCount==1||nSelect==0){console.warn("adapt-devtools: not possible to answer "+model.get("_id")+" incorrectly");return}for(var j=0;j<nIncorrect;j++){for(var k=_.random(itemCount),err=itemCount,found=false;!found&&err>=0;k++,err--){var index=k%itemCount;if(selectionStates[index]===false){if(!items[index]._shouldBeSelected)selectionStates[index]=found=true}}}for(var j=0;j<nCorrect;j++){for(var k=_.random(itemCount),err=itemCount,found=false;!found&&err>=0;k++,err--){var index=k%itemCount;if(selectionStates[index]===false){if(items[index]._shouldBeSelected)selectionStates[index]=found=true}}}_.each(items,function(item,index){if(selectionStates[index]&&!item._isSelected||!selectionStates[index]&&item._isSelected){view.$(isGraphical?".js-item-input":".js-item-input").eq(index).trigger("change")}})},answerMatching:function answerMatching(view){_.each(view.model.get("_items"),function(item,itemIndex){var noCorrectOptions=_.where(item._options,{"_isCorrect":true}).length==0;if(noCorrectOptions){if(!view.dropdowns[itemIndex].getFirstSelectedItem()){var i=_.random(item._options.length-1);view.selectValue(itemIndex,i)}}else{_.each(item._options,function(option,optionIndex){if(option._isCorrect){view.selectValue(itemIndex,option._index)}})}})},answerMatchingIncorrectly:function answerMatchingIncorrectly(view){var items=view.model.get("_items"),itemCount=items.length,nIncorrect=_.random(1,itemCount);var selectionStates=_.shuffle(_.times(itemCount,function(i){return i<nIncorrect}));_.each(items,function(item,itemIndex){var $select=view.$("select").eq(itemIndex);var $options=$select.find("option");if(selectionStates[itemIndex]){for(var count=item._options.length,i=_.random(count),err=count;err>=0;i++,err--){if(!item._options[i%count]._isCorrect){if(view.selectValue){var option=item._options[i%count];view.selectValue(itemIndex,option._index)}else if(view.model.setOptionSelected){var option=item._options[i%count];$select.val(option.text);$select.trigger("change");view.model.setOptionSelected(itemIndex,i%count,true)}else{$options.eq(i%count+1).prop("selected",true)}return}}}else{_.each(item._options,function(option,optionIndex){if(option._isCorrect){if(view.selectValue){view.selectValue(itemIndex,option._index)}else if(view.model.setOptionSelected){$select.val(option.text);$select.trigger("change");view.model.setOptionSelected(itemIndex,optionIndex,true)}else{$options.eq(optionIndex+1).prop("selected",true)}}})}})},answerSlider:function answerSlider(view){var correctAnswer=view.model.get("_correctAnswer");if(correctAnswer){view.$(".js-slider-number[data-id=\""+correctAnswer+"\"]").trigger("click")}else{var bottom=view.model.get("_correctRange")._bottom;var top=view.model.get("_correctRange")._top;var d=top-bottom;view.$(".js-slider-number[data-id=\""+(bottom+Math.floor(Math.random()*(d+1)))+"\"]").trigger("click")}},answerSliderIncorrectly:function answerSliderIncorrectly(view){var correctAnswer=view.model.get("_correctAnswer");var start=view.model.get("_scaleStart"),end=view.model.get("_scaleEnd");var incorrect=_.times(end-start+1,function(i){return start+i});if(correctAnswer){incorrect.splice(correctAnswer-start,1)}else{var bottom=view.model.get("_correctRange")._bottom;var top=view.model.get("_correctRange")._top;incorrect.splice(bottom-start,top-bottom+1)}view.$(".js-slider-number[data-id=\""+_.shuffle(incorrect)[0]+"\"]").trigger("click")},answerTextInput:function answerTextInput(view){var answers=view.model.get("_answers");_.each(view.model.get("_items"),function(item,index){if(answers)view.$(".js-textinput-textbox").eq(index).val(answers[index][0]).trigger("change");else view.$(".js-textinput-textbox").eq(index).val(item._answers[0]).trigger("change")})},answerTextInputIncorrectly:function answerTextInputIncorrectly(view){var items=view.model.get("_items"),itemCount=items.length,nIncorrect=_.random(1,itemCount);var selectionStates=_.shuffle(_.times(itemCount,function(i){return i<nIncorrect}));var answers=view.model.get("_answers");_.each(items,function(item,index){if(selectionStates[index]){view.$(".js-textinput-textbox").eq(index).val("***4n 1nc0rr3ct 4nsw3r***").trigger("change")}else{if(answers)view.$(".js-textinput-textbox").eq(index).val(answers[index][0]).trigger("change");else view.$(".js-textinput-textbox").eq(index).val(item._answers[0]).trigger("change")}})},answerQuestionStrip:function answerQuestionStrip(view){_.each(view.model.get("_items"),function(item,itemIndex){_.each(item._subItems,function(subItem,subItemIndex){if(subItem._isCorrect)view.setStage(itemIndex,subItemIndex,true)})})},answerQuestionStripIncorrectly:function answerQuestionStripIncorrectly(view){var items=view.model.get("_items"),itemCount=items.length,nIncorrect=_.random(1,itemCount);var selectionStates=_.shuffle(_.times(itemCount,function(i){return i<nIncorrect}));_.each(items,function(item,itemIndex){if(selectionStates[itemIndex]){for(var count=item._subItems.length,i=_.random(count),err=count;err>=0;i++,err--){if(!item._subItems[i%count]._isCorrect){view.setStage(itemIndex,i%count,true);return}}}else{_.each(item._subItems,function(subItem,subItemIndex){if(subItem._isCorrect)view.setStage(itemIndex,subItemIndex,true)})}})},answerPpq:function answerPpq(view){var model=view.model,items=model.get("_items"),itemCount=items.length;var isDesktop=Adapt.device.screenSize!="small";var items=_.pluck(model.get("_items"),isDesktop?"desktop":"mobile");var $pinboard=view.$(".ppq-pinboard");var boardw=$pinboard.width();var boardh=$pinboard.height();for(i=0;i<itemCount;i++){var zone=items[i];var pin=view.getNextUnusedPin();var x=zone.left+zone.width/2;var y=zone.top+zone.height/2;console.log("using correct position",x+","+y);pin.setPosition(x,y);pin.$el.css({"left":boardw*x/100-pin.$el.width()/2,"top":boardh*y/100-pin.$el.height()})}},answerPpqIncorrectly:function answerPpqIncorrectly(view){var model=view.model,items=model.get("_items"),itemCount=items.length;var isDesktop=Adapt.device.screenSize!="small";var items=_.pluck(model.get("_items"),isDesktop?"desktop":"mobile");var nSelect=_.random(model.get("_minSelection"),model.get("_maxSelection"));var nIncorrect=_.random(1,nSelect);var nCorrect=nSelect-nIncorrect;var $pinboard=view.$(".ppq-pinboard");var boardw=$pinboard.width();var boardh=$pinboard.height();console.log("nIncorrect=",nIncorrect,"nCorrect=",nCorrect);var maxSize=function maxSize(zone){return zone.left<1&&zone.top<1&&zone.width>9999&&zone.height>9999};items=_.map(items,function(item){return{"left":Math.round(item.left*100),"top":Math.round(item.top*100),"width":Math.round(item.width*100),"height":Math.round(item.height*100)}});if(_.some(items,maxSize)||nSelect==0){console.warn("adapt-devtools: not possible to answer "+model.get("_id")+" incorrectly");return}view.resetPins();for(var i=0;i<nIncorrect;i++){var ok=false;var x,y;while(!ok){x=_.random(1,10000);ok=!_.some(items,function(zone){return x>=zone.left&&x<zone.left+zone.width&&zone.top<1&&zone.height>9999})}ok=false;while(!ok){y=_.random(1,10000);ok=!_.some(items,function(zone){return x>=zone.left&&x<zone.left+zone.width&&y>=zone.top&&y<zone.top+zone.height})}x=x/100;y=y/100;console.log("using incorrect position",x+","+y);var pin=view.getNextUnusedPin();pin.setPosition(x,y);pin.$el.css({"left":boardw*x/100-pin.$el.width()/2,"top":boardh*y/100-pin.$el.height()})}var correct=_.shuffle(_.times(itemCount,function(i){return i}));for(i=0;i<nCorrect;i++){var zone=items[correct[i]];var pin=view.getNextUnusedPin();var x=zone.left+zone.width/2;var y=zone.top+zone.height/2;x=x/100;y=y/100;console.log("using correct position",x+","+y);pin.setPosition(x,y);pin.$el.css({"left":boardw*x/100-pin.$el.width()/2,"top":boardh*y/100-pin.$el.height()})}},answerUnsupported:function answerUnsupported(view){var model=view.model;model.set({"_isComplete":true,"_isInteractionComplete":true,"_isCorrect":true,"_isSubmitted":true,"_score":1});model.set("_attemptsLeft",Math.max(0,model.get("_attempts")-1))},answerUnsupportedIncorrectly:function answerUnsupportedIncorrectly(view){var model=view.model;model.set({"_isComplete":true,"_isInteractionComplete":true,"_isCorrect":false,"_isSubmitted":true,"_score":0});model.set("_attemptsLeft",Math.max(0,model.get("_attempts")-1))},onRemove:function onRemove(){var _this109=this;this.mousedownHandlers.forEach(function(tuple){_newArrowCheck(this,_this109);tuple.element.off("mousedown",tuple.handler)}.bind(this))}},Backbone.Events);Adapt.on("app:dataReady devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;AutoAnswer.initialize()});return AutoAnswer});define("extensions/adapt-devtools/js/pass-half-fail",["require","coreJS/adapt","./auto-answer"],function(require){var Adapt=require("coreJS/adapt");var AutoAnswer=require("./auto-answer");var PassHalfFail=_.extend({syncIterations:1,initialize:function initialize(){this._questionViews=[];this._currentPageId=null;this.listenTo(Adapt,"pageView:preRender",this.onPagePreRender);this.listenTo(Adapt,"remove",this.onRemove)},_completeNonQuestions:function _completeNonQuestions(){var currentModel=Adapt.findById(Adapt.location._currentId);var nonQuestions=_.filter(currentModel.findDescendantModels("components"),function(m){return m.get("_isQuestionType")!==true});_.each(nonQuestions,function(item){item.set("_isComplete",true);item.set("_isInteractionComplete",true)})},pass:function pass(callback){var i=0,qs=this._questionViews,len=qs.length;function step(){for(var j=0,count=Math.min(PassHalfFail.syncIterations,len-i);j<count;i++,j++){AutoAnswer.answer(qs[i]);if(!qs[i].model.get("_isSubmitted"))qs[i].$(".js-btn-action").trigger("click")}i==len?callback():setTimeout(step)}step()},half:function half(callback){var notSubmitted=function notSubmitted(view){return!view.model.get("_isSubmitted")};var qs=_.shuffle(_.filter(this._questionViews,notSubmitted));var i=0,len=qs.length;function step(){for(var j=0,count=Math.min(PassHalfFail.syncIterations,len-i);j<count;i++,j++){AutoAnswer.answer(qs[i],i%2==0);if(!qs[i].model.get("_isSubmitted"))qs[i].$(".js-btn-action").trigger("click")}i==len?callback():setTimeout(step)}step()},fail:function fail(callback){var i=0,qs=this._questionViews,len=qs.length;function step(){for(var j=0,count=Math.min(PassHalfFail.syncIterations,len-i);j<count;i++,j++){AutoAnswer.answer(qs[i],true);if(!qs[i].model.get("_isSubmitted"))qs[i].$(".js-btn-action").trigger("click")}i==len?callback():setTimeout(step)}step()},onPagePreRender:function onPagePreRender(view){this._currentPageId=view.model.get("_id");this.listenTo(Adapt,"componentView:postRender",this.onComponentRendered)},onRemove:function onRemove(){this.stopListening(Adapt,"componentView:postRender",this.onComponentRendered);this._questionViews=[]},onComponentRendered:function onComponentRendered(view){if(view.model.has("_parentId")&&view.model.findAncestor("contentObjects").get("_id")==this._currentPageId){if(view.model.get("_isQuestionType")){this._questionViews.push(view)}}}},Backbone.Events);Adapt.on("app:dataReady devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;PassHalfFail.initialize()});return PassHalfFail});define("extensions/adapt-devtools/js/toggle-banking",["require","coreJS/adapt","coreJS/router"],function(require){var Adapt=require("coreJS/adapt");var Router=require("coreJS/router");var ToggleBanking={initialize:function initialize(){Adapt.articles.each(function(m){var config=this.getConfig(m);if(m.has("_assessment")&&m.get("_assessment")._banks&&!m.get("_assessment")._banks._isEnabled){config._assessmentBankDisabled=true}},this)},getConfig:function getConfig(articleModel){if(!articleModel.has("_devtools"))articleModel.set("_devtools",{});return articleModel.get("_devtools")},getBankedAssessmentsInCurrentPage:function getBankedAssessmentsInCurrentPage(){var pageModel=Adapt.findById(Adapt.location._currentId);var f=function f(m){config=this.getConfig(m);if(!config._assessmentBankDisabled&&m.has("_assessment")&&m.get("_assessment")._isEnabled&&m.get("_assessment")._banks._split.length>1)return true;return false};return Adapt.location._contentType=="menu"?[]:_.filter(pageModel.findDescendantModels("articles"),f,this)},toggle:function toggle(){var bankedAssessments=this.getBankedAssessmentsInCurrentPage();var isBankingEnabled=function isBankingEnabled(m){return m.get("_assessment")._banks._isEnabled};var enable=!_.some(bankedAssessments,isBankingEnabled);_.each(bankedAssessments,function(articleModel){articleModel.get("_assessment")._banks._isEnabled=enable;articleModel.set({"_attemptInProgress":false,"_isPass":false})});Router.handleId(Adapt.location._currentId)}};Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;ToggleBanking.initialize()});return ToggleBanking});define("extensions/adapt-devtools/js/map",["require","coreJS/adapt","coreJS/router"],function(require){var Adapt=require("coreJS/adapt");var Router=require("coreJS/router");var MapView=Backbone.View.extend({events:{"click a":"onLinkClicked"},initialize:function initialize(){this.$("html").addClass("has-devtools-map");this._renderIntervalId=setInterval(_.bind(this._checkRenderInterval,this),500);this.listenTo(Adapt.components,"change:_isComplete",this.onModelCompletionChanged);this.listenTo(Adapt.blocks,"change:_isComplete",this.onModelCompletionChanged);this.listenTo(Adapt.articles,"change:_isComplete",this.onModelCompletionChanged);this.listenTo(Adapt.contentObjects,"change:_isComplete",this.onModelCompletionChanged);this.render()},render:function render(){var config=Adapt.devtools;var data=this.model;var startTime=new Date().getTime();var template=Handlebars.templates["devtoolsMap"];this.$("body").html(template(data))},remove:function remove(){clearInterval(this._renderIntervalId);this.$("body").html("Course closed!");this.stopListening();return this},_checkRenderInterval:function _checkRenderInterval(){if(this._invalid){this._invalid=false;this.render()}},_getConfig:function _getConfig(pageModel){if(!pageModel.has("_devtools"))pageModel.set("_devtools",{});return pageModel.get("_devtools")},_disablePageIncompletePrompt:function _disablePageIncompletePrompt(pageModel){var config=this._getConfig(pageModel);if(pageModel.has("_pageIncompletePrompt")){config._pageIncompletePromptExists=true;if(pageModel.get("_pageIncompletePrompt").hasOwnProperty("_isEnabled")){config._pageIncompletePromptEnabled=pageModel.get("_pageIncompletePrompt")._isEnabled}}else{config._pageIncompletePromptExists=false;pageModel.set("_pageIncompletePrompt",{})}pageModel.get("_pageIncompletePrompt")._isEnabled=false},_restorePageIncompletePrompt:function _restorePageIncompletePrompt(pageModel){var config=this._getConfig(pageModel);if(config._pageIncompletePromptExists){if(config.hasOwnProperty("_pageIncompletePromptEnabled"))pageModel.get("_pageIncompletePrompt")._isEnabled=config._pageIncompletePromptEnabled;else delete pageModel.get("_pageIncompletePrompt")._isEnabled}else{pageModel.unset("_pageIncompletePrompt")}delete config._pageIncompletePromptExists;delete config._pageIncompletePromptEnabled},onModelCompletionChanged:function onModelCompletionChanged(){this.invalidate()},onLinkClicked:function onLinkClicked(e){var $target=$(e.currentTarget);var id=$target.attr("href").slice(1);var model=Adapt.findById(id);e.preventDefault();if(e.ctrlKey&&this.el.defaultView){id=id.replace(/-/g,"");this.el.defaultView[id]=model;this.el.defaultView.console.log("devtools: add property window."+id+":");this.el.defaultView.console.log(model)}else if(e.shiftKey){this.navigateAndDisableTrickle(id)}else{this.navigateAndDisableTrickleUpTo(id)}},invalidate:function invalidate(){this._invalid=true},navigateAndDisableTrickleUpTo:function navigateAndDisableTrickleUpTo(id){var model=Adapt.findById(id);var pageModel=Adapt.findById(Adapt.location._currentId);this._disablePageIncompletePrompt(pageModel);if(model._siblings=="contentObjects"){Backbone.history.navigate("#/id/"+id,{trigger:true})}else{var level=model.get("_type")=="component"?model.getParent():model;var siblings=level.getParent().getChildren(),sibling=null;for(var i=0,count=siblings.indexOf(level);i<count;i++){sibling=siblings.at(i);console.log("disabling trickle on "+sibling.get("_id"));if(sibling.has("_trickle")){sibling.get("_trickle")._isEnabled=false}else{sibling.set("_trickle",{_isEnabled:false})}}if(Adapt.location._currentId==model.findAncestor("contentObjects").get("_id")){this.listenToOnce(Adapt,"pageView:ready",function(view){_.defer(_.bind(function(){Adapt.scrollTo($("."+id));this.checkVisibility(id)},this))});if(Adapt.location._currentId==Adapt.course.get("_id"))Router.handleRoute?Router.handleRoute():Router.handleCourse();else Router.handleId(Adapt.location._currentId)}else{this.listenToOnce(Adapt,"pageView:ready",function(){_.defer(_.bind(function(){this.checkVisibility(id)},this))});Backbone.history.navigate("#/id/"+id,{trigger:true})}}this._restorePageIncompletePrompt(pageModel);this.invalidate()},navigateAndDisableTrickle:function navigateAndDisableTrickle(id){var model=Adapt.findById(id);var pageModel=Adapt.findById(Adapt.location._currentId);this._disablePageIncompletePrompt(pageModel);if(model._siblings=="contentObjects"){Backbone.history.navigate("#/id/"+id,{trigger:true})}else{if(Adapt.location._currentId==model.findAncestor("contentObjects").get("_id")){Adapt.devtools.set("_trickleEnabled",false);Adapt.scrollTo($("."+id));this.checkVisibility(id)}else{var targetModel=Adapt.trickle?model.findAncestor("contentObjects"):Adapt.course;if(!targetModel.has("_trickle")){targetModel.set("_trickle",{_isEnabled:false});this.listenToOnce(Adapt,"pageView:ready",function(){_.defer(_.bind(function(){targetModel.get("_trickle")._isEnabled=true;this.checkVisibility(id)},this))})}else if(targetModel.get("_trickle")._isEnabled){targetModel.get("_trickle")._isEnabled=false;this.listenToOnce(Adapt,"pageView:ready",function(){_.defer(_.bind(function(){targetModel.get("_trickle")._isEnabled=true;this.checkVisibility(id)},this))})}Backbone.history.navigate("#/id/"+id,{trigger:true})}}this._restorePageIncompletePrompt(pageModel);this.invalidate()},checkVisibility:function checkVisibility(id){var model=Adapt.findById(id);if($("."+id).is(":visible")||model==Adapt.course)return;while(!$("."+id).is(":visible")&&model!=Adapt.course){model=model.getParent();id=model.get("_id")}console.log("adapt-devtools::checkVisibility scrolling to ancestor "+id);Adapt.scrollTo($("."+id))}});var Map=_.extend({initialize:function initialize(){this.listenTo(Adapt,"devtools:mapLoaded",this.onMapLoaded);$(window).on("unload",_.bind(this.onCourseClosed,this));function isMenu(options){if(this.get("_type")!=="page"){return options.fn(this)}else{return options.inverse(this)}}function eachChild(options){var ret="";var children=this.get("_children").models;for(var i=0,j=children.length;i<j;i++){ret=ret+options.fn(children[i],{data:{index:i,first:i==0,last:i===j-1}})}return ret}function getProp(prop,options){return this.get(prop)}function isStringEmpty(str){return!str||str.trim&&str.trim().length==0||$.trim(str).length==0}function getTitle(options){var t=this.get("displayTitle");if(isStringEmpty(t))t=this.get("title");if(isStringEmpty(t))t=this.get("_id");return t}function when(prop,options){if(this.get(prop)){return options.fn(this)}else{return options.inverse(this)}}function isTrickled(options){var trickleConfig=this.get("_trickle");var trickled=false;var isBlock=this.get("_type")=="block";if(trickleConfig)trickled=(isBlock||trickleConfig._onChildren!==true)&&trickleConfig._isEnabled;else if(isBlock){trickleConfig=this.getParent().get("_trickle");if(trickleConfig)trickled=trickleConfig._onChildren&&trickleConfig._isEnabled}if(trickled){return options.fn(this)}else{return options.inverse(this)}}Handlebars.registerHelper("isMenu",isMenu);Handlebars.registerHelper("eachChild",eachChild);Handlebars.registerHelper("getProp",getProp);Handlebars.registerHelper("getTitle",getTitle);Handlebars.registerHelper("when",when);Handlebars.registerHelper("isTrickled",isTrickled)},open:function open(){if(!this.mapWindow){this.mapWindow=window.open("assets/map.html","Map")}else{this.mapWindow.focus()}},onMapClosed:function onMapClosed(){console.log("onMapClosed");this.mapWindow=null},onMapLoaded:function onMapLoaded(mapWindow){console.log("onMapLoaded");this.mapWindow=mapWindow;this.mapWindow.focus();$("html",this.mapWindow.document).addClass($("html",window.document).attr("class"));this.mapView=new MapView({model:Adapt,el:this.mapWindow.document});$(this.mapWindow).on("unload",_.bind(this.onMapClosed,this))},onCourseClosed:function onCourseClosed(){if(this.mapView){this.mapView.remove()}}},Backbone.Events);Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;Map.initialize()});return Map});define("extensions/adapt-devtools/js/utils",["require","coreJS/adapt","coreModels/adaptModel","coreViews/questionView"],function(require){var Adapt=require("coreJS/adapt");var AdaptModel=require("coreModels/adaptModel");var QuestionView=require("coreViews/questionView");var mouseTarget=null;function onMouseDown(e){if(e.which==1)mouseTarget=e.target}function onMouseUp(e){if(e.which==1)mouseTarget=null}function onKeypress(e){var char=String.fromCharCode(e.which).toLowerCase();if(mouseTarget){if(char=="m"){var model=Utils.getModelForElement(mouseTarget);if(model){id=model.get("_id").replace(/-/g,"");window[id]=model;console.log("devtools: add property window."+id+":");console.log(model.attributes)}}}}function getAdaptCoreVersion(){try{if(Adapt.build&&Adapt.build.has("package"))return Adapt.build.get("package").version||">=v3.0.0";if(typeof AdaptModel.prototype.checkCompletionStatusFor=="function")return">=v2.2.3";if(typeof AdaptModel.prototype.setCompletionStatus=="function")return">=v2.0.10";if(typeof AdaptModel.prototype.checkLocking=="function")return"v2.0.9";if(typeof Adapt.checkingCompletion=="function")return"v2.0.8";if(typeof AdaptModel.prototype.getParents=="function")return"v2.0.7";if($.a11y&&$.a11y.options.hasOwnProperty("isIOSFixesEnabled"))return"v2.0.5-v2.0.6";if(Adapt instanceof Backbone.Model)return"v2.0.4";if(typeof QuestionView.prototype.recordInteraction=="function")return"v2.0.2-v2.0.3";if(typeof Adapt.findById=="function")return"v2.0.0-v2.0.1";return"v1.x"}catch(e){return"unknown version"}}var Utils={getModelForElement:function getModelForElement(element){var $target=$(element);if($target.length==0)return false;var id=$target.parents("[data-adapt-id]").data("adapt-id");return!id?false:Adapt.findById(id)}};Adapt.once("adapt:initialize",function(){var str="Version of Adapt core detected: "+getAdaptCoreVersion();var horz=getHorzLine();console.log(horz+"\nVersion of Adapt core detected: "+getAdaptCoreVersion()+"\n"+horz);function getHorzLine(){for(var s="",i=0,c=str.length;i<c;i++){s+="*"}return s}});Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;$(window).on("keypress",onKeypress);$(window).on("mousedown",onMouseDown);$(window).on("mouseup",onMouseUp);if(!window.a)window.a=Adapt});return Utils});define("extensions/adapt-devtools/js/end-trickle",["require","coreJS/adapt"],function(require){var Adapt=require("coreJS/adapt");function onTrickleBegun(){if(!Adapt.devtools.get("_trickleEnabled")){console.log("Trickle started");Adapt.devtools.set("_trickleEnabled",true);Adapt.devtools.once("change:_trickleEnabled",onTrickleChange)}}function onTrickleEnded(){console.log("Trickle ended");Adapt.devtools.off("change:_trickleEnabled",onTrickleChange);Adapt.devtools.set("_trickleEnabled",false)}function onTrickleChange(){if(!Adapt.devtools.get("_trickleEnabled")){Adapt.trigger("trickle:kill")}}function remove(){if(Adapt.devtools.get("_trickleEnabled")){onTrickleEnded()}}Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;Adapt.on("trickle:interactionInitialize trickle:started",onTrickleBegun);Adapt.on("trickle:kill trickle:finished",onTrickleEnded);Adapt.on("remove",remove)})});define("extensions/adapt-devtools/js/toggle-feedback",["require","coreJS/adapt"],function(require){var Adapt=require("coreJS/adapt");function onShowFeedback(){Adapt.trigger("tutor:closed")}function hushTutor(){Adapt.devtools.set("_tutorListener",Adapt._events["questionView:showFeedback"].pop());Adapt.on("questionView:showFeedback",onShowFeedback)}function reinstateTutor(){Adapt.off("questionView:showFeedback",onShowFeedback);if(!Adapt._events.hasOwnProperty("questionView:showFeedback")){Adapt._events["questionView:showFeedback"]=[]}Adapt._events["questionView:showFeedback"].push(Adapt.devtools.get("_tutorListener"))}function onFeedbackToggled(){if(Adapt.devtools.get("_feedbackEnabled")){reinstateTutor();$(document).off("mouseup",".js-btn-feedback")}else{hushTutor();$(document).on("mouseup",".js-btn-feedback",onFeedbackButtonClicked)}}function onFeedbackButtonClicked(e){var classes=$(e.currentTarget).parents(".component").attr("class");var componentId=/[\s]+(c\-[^\s]+)/.exec(classes)[1];if(componentId){reinstateTutor();Adapt.trigger("questionView:showFeedback",{model:Adapt.findById(componentId)});hushTutor()}else console.error("devtools:onFeedbackButtonClicked: malformed component class name")}Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;if(Adapt.devtools.get("_toggleFeedbackAvailable")){if(Adapt._events.hasOwnProperty("questionView:showFeedback")&&Adapt._events["questionView:showFeedback"].length==1){Adapt.devtools.on("change:_feedbackEnabled",onFeedbackToggled)}else{console.warn("devtools: no tutor or multiple registrants of questionView:showFeedback so disabling ability to toggle feedback.");Adapt.devtools.set("_toggleFeedbackAvailable",false)}}})});define("extensions/adapt-devtools/js/toggle-alt-text",["require","coreJS/adapt"],function(require){var Adapt=require("coreJS/adapt");var AltText=_.extend({initialize:function initialize(){this.listenTo(Adapt.devtools,"change:_altTextEnabled",this.toggleAltText);if(typeof MutationObserver=="function"){this.observer=new MutationObserver(_.bind(this.onDomMutation,this))}},addTimer:function addTimer(fireNow){this.timerId=setInterval(_.bind(this.onTimer,this),1000);if(fireNow)this.onTimer()},removeTimer:function removeTimer(){clearInterval(this.timerId)},connectObserver:function connectObserver(){if(this.observer)this.observer.observe(document.getElementById("wrapper"),{childList:true,subtree:true,attributes:true,attributeFilter:["class","style"]})},disconnectObserver:function disconnectObserver(){if(this.observer)this.observer.disconnect()},toggleAltText:function toggleAltText(){if(Adapt.devtools.get("_altTextEnabled")){this.addTimer(true);this.connectObserver()}else{this.removeTimer();this.removeAllAnnotations();this.disconnectObserver()}},addAnnotation:function addAnnotation($img,$annotation){var template=Handlebars.templates["devtoolsAnnotation"];var text=$img.attr("alt");if(!text)text=$img.attr("aria-label");var $annotation=$(template({text:text}));if(!text)$annotation.addClass("has-annotation-warning");$img.after($annotation);$img.data("annotation",$annotation);this.updateAnnotation($img,$annotation)},removeAnnotation:function removeAnnotation($img,$annotation){$annotation.remove();$img.removeData("annotation")},removeAllAnnotations:function removeAllAnnotations(){$("img").each(_.bind(function(index,element){var $img=$(element);var $annotation=$img.data("annotation");if($annotation)this.removeAnnotation($img,$annotation)},this))},updateAnnotation:function updateAnnotation($img,$annotation){var position=$img.position();position.left+=parseInt($img.css("marginLeft"),10)+parseInt($img.css("paddingLeft"),10);position.top+=parseInt($img.css("marginTop"),10)+parseInt($img.css("paddingTop"),10);$annotation.css(position)},onDomMutation:function onDomMutation(mutations){this.mutated=true},onTimer:function onTimer(){if(this.mutated===false)return;if(this.observer)this.mutated=false;this.disconnectObserver();$("img").each(_.bind(function(index,element){var $img=$(element);var $annotation=$img.data("annotation");var isVisible=$img.is(":visible");if(isVisible){if(!$annotation)this.addAnnotation($img,$annotation);else this.updateAnnotation($img,$annotation)}else if($annotation){this.removeAnnotation($img,$annotation)}},this));this.connectObserver()}},Backbone.Events);Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;AltText.initialize()});return AltText});define("extensions/adapt-devtools/js/unlock",["require","coreJS/adapt","coreJS/router"],function(require){var Adapt=require("coreJS/adapt");var Router=require("coreJS/router");function breakCoreLocking(){Adapt.course.unset("_lockType");breakLocks(Adapt.contentObjects);breakLocks(Adapt.articles);breakLocks(Adapt.blocks);function breakLocks(collection){collection.each(function(model){model.unset("_lockType");model.unset("_isLocked")})}}function onUnlocked(){if(Adapt.devtools.get("_unlocked")){breakCoreLocking();if(Adapt.location._currentId==Adapt.course.get("_id"))Router.handleRoute?Router.handleRoute():Router.handleCourse();else Router.handleId(Adapt.location._currentId)}}function onMenuPreRender(view){if(Adapt.devtools.get("_unlocked")){if(Adapt.location._currentId==view.model.get("_id")){view.model.once("change:_isReady",_.bind(onMenuReady,view));view.model.getChildren().each(function(item){if(item.has("_lock"))item.set("_lock",item.get("_lock").length>-1?[]:false);if(item._lock)item._lock=item._lock.length>-1?[]:false;if(item._locked===true)item._locked=false;if(item._isLocked===true)item._isLocked=false})}}}function onMenuReady(){if(Adapt.devtools.get("_unlocked")){this.$("a, button").prop("disabled",false).css("pointer-events","auto")}}Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;if(Adapt.devtools.get("_unlockAvailable")){Adapt.devtools.on("change:_unlocked",onUnlocked);Adapt.on("menuView:preRender",onMenuPreRender)}})});define("extensions/adapt-devtools/js/enable",["require","coreJS/adapt","coreJS/router"],function(require){var Adapt=require("coreJS/adapt");var Router=require("coreJS/router");var buffer="";var isMouseDown=false;var hitArea=100;var coords={};var topLeftTapHold=false;var topRightTapHold=false;var listenType=0;var timeoutId;var focusableElements="a,button,input,select,textarea,[tabindex],label";function onKeypress(e){var c=String.fromCharCode(e.which).toLowerCase();buffer+=c;if(isMouseDown&&c=="5"&&!Adapt.devtools.get("_isEnabled"))enable();else processBuffer()}function onMouseDown(){isMouseDown=true}function onMouseUp(){isMouseDown=false}function processBuffer(){var blen=buffer.length;if(blen>100)buffer=buffer.substr(1,100);blen=buffer.length;if(buffer.substr(blen-"kcheat".length,"kcheat".length)=="kcheat"){if(!Adapt.devtools.get("_isEnabled"))enable()}}function enable(){removeHooks();Adapt.devtools.set("_isEnabled",true);Adapt.trigger("devtools:enable");if(Adapt.location._currentId==Adapt.course.get("_id"))Router.handleRoute?Router.handleRoute():Router.handleCourse();else Router.handleId(Adapt.location._currentId)}function addHooks(){$(window).on("keypress",onKeypress);$(window).on("mousedown",onMouseDown);$(window).on("mouseup",onMouseUp);window.kcheat=function(){buffer="kcheat";processBuffer()};Router.route("kcheat","kcheat",function(){if(window.kcheat)window.kcheat()});if(Modernizr.touch)addTouchHook()}function removeHooks(){$(window).off("keypress",onKeypress);$(window).off("mousedown",onMouseDown);$(window).off("mouseup",onMouseUp);window.kcheat=undefined;if(Modernizr.touch)removeTouchHook()}function addTouchHook(){$("body").on("touchstart",onTouchStart);$("body").on("touchend",onTouchEnd);$("body").on("touchstart",focusableElements,onTouchStart)}function removeTouchHook(){clearTimeout(timeoutId);$("body").off("touchstart",onTouchStart);$("body").off("touchend",onTouchEnd);$("body").off("touchstart",focusableElements,onTouchStart)}function onTouchStart(event){var touches=event.originalEvent.touches;if(touches.length!=1)return;coords.x=touches[0].pageX;coords.y=touches[0].pageY;if(coords.x>=0&&coords.x<hitArea&&coords.y>=0&&coords.y<hitArea){listenType=1}else if(coords.x>=$(window).width()-hitArea&&coords.x<$(window).width()&&coords.y>=0&&coords.y<hitArea){listenType=2}else{listenType=topLeftTapHold=topRightTapHold=false}if(listenType){timeoutId=setTimeout(function(){if(listenType){if(listenType==1)topLeftTapHold=true;else if(listenType==2)topRightTapHold=true;if(topLeftTapHold&&topRightTapHold){if(window.kcheat)window.kcheat()}}},200)}}function onTouchEnd(event){listenType=false;clearTimeout(timeoutId)}Adapt.once("adapt:initialize",function(){if(Adapt.devtools.get("_isEnabled"))return;_.defer(function(){addHooks()})})});define("extensions/adapt-devtools/js/toggle-trace-focus",["require","coreJS/adapt"],function(require){var Adapt=require("coreJS/adapt");var TraceFocus=_.extend({openingTags:new RegExp("<[\\w-]+((\\s+[\\w-]+(\\s*=\\s*(?:\".*?\"|'.*?'|[^'\">\\s]+))*)+\\s*|\\s*)/?>"),consoleStyle:"background: lightgray; color: blue",initialize:function initialize(){this.onFocusIn=_.bind(this.onFocusIn,this);this.listenTo(Adapt.devtools,"change:_traceFocusEnabled",this.toggleTraceFocus);this.toggleTraceFocus()},toggleTraceFocus:function toggleTraceFocus(){if(Adapt.devtools.get("_traceFocusEnabled")){$("body").on("focusin",this.onFocusIn)}else{$("body").off("focusin",this.onFocusIn)}},onFocusIn:function onFocusIn(e){if(!$("html").is(".ie, .Edge"))return console.log("%cfocussed",this.consoleStyle,e.target);var $el=$(e.target);if(!$el[0]||!$el[0].outerHTML)return console.log("focussed: ",e.target);var openingTag=this.openingTags.exec($el[0].outerHTML)[0];if(openingTag){var tokens=$el.text().replace(/[\s\xA0]*/,"").split(/\r\n|\r|\n/);if(tokens[0])openingTag=openingTag.slice(0,20)+"[...]";if($("html").is(".ie8")){console.log("focussed: ",openingTag,tokens[0])}else{console.log("focussed: ",openingTag,tokens[0],$el)}}else{console.log("focussed: "+e.target)}}},Backbone.Events);Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;TraceFocus.initialize()});return TraceFocus});define("extensions/adapt-devtools/js/toggle-completion",["require","coreJS/adapt","./utils"],function(require){var Adapt=require("coreJS/adapt");var Utils=require("./utils");var mouseTarget=null;function init(){$(window).on("keypress",onKeypress);$(window).on("mousedown",onMouseDown);$(window).on("mouseup",onMouseUp)}function onKeypress(e){var char=String.fromCharCode(e.which).toLowerCase();if(mouseTarget){switch(char){case"c":return complete(mouseTarget);case"r":return reset(mouseTarget);}}}function complete(element){var model=Utils.getModelForElement(element);if(model){var descendantComponents=model.findDescendantModels("components");if(!descendantComponents||descendantComponents.length===0){console.log("devtools: completing",model.get("_id"));doCompletion(model)}else{console.log("devtools: completing all components in",model.get("_id"));_.each(descendantComponents,function(model){doCompletion(model)})}}function doCompletion(component){component.set("_isComplete",true)}}function reset(element){var model=Utils.getModelForElement(element);if(model){var descendantComponents=model.findDescendantModels("components");if(!descendantComponents||descendantComponents.length===0){console.log("devtools: resetting",model.get("_id"));model.reset(true,true)}else{console.log("devtools: resetting all components in",model.get("_id"));_.each(descendantComponents,function(model){model.reset(true,true)})}}}function onMouseDown(e){if(e.which==1)mouseTarget=e.target}function onMouseUp(e){if(e.which==1)mouseTarget=null}Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;init()})});define("extensions/adapt-devtools/js/adapt-devtools",["core/js/adapt","core/js/models/adaptModel","./devtools-model","./pass-half-fail","./toggle-banking","./map","./auto-answer","./utils","./end-trickle","./hinting","./toggle-feedback","./toggle-alt-text","./unlock","./enable","./toggle-trace-focus","./toggle-completion"],function(Adapt,AdaptModel,DevtoolsModel,PassHalfFail,ToggleBanking,Map){var navigationView;var DevtoolsView=Backbone.View.extend({className:"devtools",events:{"click .end-trickle":"onEndTrickle","change .hinting input":"onToggleHinting","change .banking input":"onToggleBanking","change .feedback input":"onToggleFeedback","change .auto-correct input":"onToggleAutoCorrect","change .alt-text input":"onToggleAltText","click .unlock":"onUnlock","click .open-map":"onOpenMap","click .open-spoor-log":"onOpenSpoorLog","click .complete-page":"onCompletePage","click .complete-menu":"onCompleteMenu","click .pass":"onPassHalfFail","click .half":"onPassHalfFail","click .fail":"onPassHalfFail","change .trace-focus input":"onToggleTraceFocus"},initialize:function initialize(){this.render();this._checkUnlockVisibility();this._checkSpoorLogVisibility();this._checkTrickleEndVisibility();this._checkBankingVisibility();this._checkFeedbackVisibility();this._checkHintingVisibility();this._checkAutoCorrectVisibility();this._checkAltTextVisibility();this._checkPassHalfFailVisibility();this._checkCompletePageVisibility();this._checkCompleteMenuVisibility();this._checkTraceFocusVisibility()},render:function render(){var data=Adapt.devtools.toJSON();var template=Handlebars.templates["devtools"];this.$el.html(template(data));return this},_checkUnlockVisibility:function _checkUnlockVisibility(){if(!Adapt.devtools.get("_unlockAvailable")||Adapt.devtools.get("_unlocked"))this.$(".unlock").addClass("u-display-none");else this.$(".unlock").toggleClass("u-display-none",!this._checkForLocks())},_checkForLocks:function _checkForLocks(){if(typeof AdaptModel.prototype.checkLocking!="function")return Adapt.location._contentType=="menu";var hasLock=function hasLock(model){return model.has("_lockType")};if(hasLock(Adapt.course))return true;if(Adapt.contentObjects.some(hasLock))return true;if(Adapt.articles.some(hasLock))return true;if(Adapt.blocks.some(hasLock))return true;return false},onUnlock:function onUnlock(){Adapt.devtools.set("_unlocked",true);this._checkUnlockVisibility()},onOpenMap:function onOpenMap(){Map.open();Adapt.trigger("drawer:closeDrawer")},_checkSpoorLogVisibility:function _checkSpoorLogVisibility(){this.$(".open-spoor-log").prop("disabled",!require.defined("extensions/adapt-contrib-spoor/js/scorm"))},onOpenSpoorLog:function onOpenSpoorLog(){require("extensions/adapt-contrib-spoor/js/scorm").showDebugWindow();Adapt.trigger("drawer:closeDrawer")},_checkTrickleEndVisibility:function _checkTrickleEndVisibility(){this.$(".end-trickle").toggleClass("u-display-none",!Adapt.devtools.get("_trickleEnabled"))},onEndTrickle:function onEndTrickle(){Adapt.devtools.set("_trickleEnabled",false);this._checkTrickleEndVisibility()},_checkBankingVisibility:function _checkBankingVisibility(){if(!Adapt.devtools.get("_toggleFeedbackAvailable")){this.$(".banking").addClass("u-display-none");return}var bankedAssessments=ToggleBanking.getBankedAssessmentsInCurrentPage();var isBankingEnabled=function isBankingEnabled(m){return m.get("_assessment")._banks._isEnabled};if(bankedAssessments.length>0){this.$(".banking").removeClass("u-display-none");this.$(".banking label").toggleClass("is-selected",_.some(bankedAssessments,isBankingEnabled))}else{this.$(".banking").addClass("u-display-none")}},onToggleBanking:function onToggleBanking(){ToggleBanking.toggle();this._checkBankingVisibility()},_checkFeedbackVisibility:function _checkFeedbackVisibility(){if(Adapt.devtools.get("_toggleFeedbackAvailable")){this.$(".feedback").removeClass("u-display-none");this.$(".feedback label").toggleClass("is-selected",Adapt.devtools.get("_feedbackEnabled"))}else{this.$(".feedback").addClass("u-display-none")}},onToggleFeedback:function onToggleFeedback(){Adapt.devtools.toggleFeedback();this._checkFeedbackVisibility()},_checkHintingVisibility:function _checkHintingVisibility(){if(Adapt.devtools.get("_hintingAvailable")){this.$(".hinting").removeClass("u-display-none");this.$(".hinting label").toggleClass("is-selected",Adapt.devtools.get("_hintingEnabled"))}else{this.$(".hinting").addClass("u-display-none")}},onToggleHinting:function onToggleHinting(){Adapt.devtools.toggleHinting();this._checkHintingVisibility()},_checkAutoCorrectVisibility:function _checkAutoCorrectVisibility(){if(Adapt.devtools.get("_autoCorrectAvailable")){this.$(".is-toggle.auto-correct").removeClass("u-display-none");this.$(".is-toggle.auto-correct label").toggleClass("is-selected",Adapt.devtools.get("_autoCorrectEnabled"));this.$(".is-tip.auto-correct").toggleClass("u-display-none",Adapt.devtools.get("_autoCorrectEnabled"))}else{this.$(".auto-correct").addClass("u-display-none")}},onToggleAutoCorrect:function onToggleAutoCorrect(){Adapt.devtools.toggleAutoCorrect();this._checkAutoCorrectVisibility()},_checkAltTextVisibility:function _checkAltTextVisibility(){if(Adapt.devtools.get("_altTextAvailable")){this.$(".is-toggle.alt-text").removeClass("u-display-none");this.$(".is-toggle.alt-text label").toggleClass("is-selected",Adapt.devtools.get("_altTextEnabled"));this.$(".is-tip.alt-text").toggleClass("u-display-none",Adapt.devtools.get("_altTextEnabled"))}else{this.$(".alt-text").addClass("u-display-none")}},onToggleAltText:function onToggleAltText(){Adapt.devtools.toggleAltText();this._checkAltTextVisibility()},_checkCompletePageVisibility:function _checkCompletePageVisibility(){var currentModel=Adapt.findById(Adapt.location._currentId);if(currentModel.get("_type")!="page"){this.$(".complete-page").addClass("u-display-none");return}var incomplete=_.filter(currentModel.findDescendantModels("components"),function(m){return m.get("_isInteractionComplete")===false});this.$(".complete-page").toggleClass("u-display-none",incomplete.length==0)},onCompletePage:function onCompletePage(e){var currentModel=Adapt.findById(Adapt.location._currentId);if(Adapt.devtools.get("_trickleEnabled"))Adapt.trigger("trickle:kill");var incomplete=_.filter(currentModel.findDescendantModels("components"),function(m){return m.get("_isInteractionComplete")===false});_.each(incomplete,function(component){if(component.get("_isQuestionType")){component.set("_isCorrect",true);component.set("_isSubmitted",true);component.set("_score",1);component.set("_attemptsLeft",Math.max(0,component.set("_attempts")-1))}component.set("_isComplete",true);component.set(currentModel.has("_isInteractionsComplete")?"_isInteractionsComplete":"_isInteractionComplete",true)});Adapt.trigger("drawer:closeDrawer")},_checkCompleteMenuVisibility:function _checkCompleteMenuVisibility(){var currentModel=Adapt.findById(Adapt.location._currentId);if(currentModel.get("_type")!="menu"&&currentModel.get("_type")!=="course"){this.$(".complete-menu").addClass("u-display-none");return}var incomplete=_.filter(currentModel.findDescendantModels("components"),function(model){return!model.get("_isComplete")});this.$(".complete-menu").toggleClass("u-display-none",incomplete.length==0)},onCompleteMenu:function onCompleteMenu(e){var currentModel=Adapt.findById(Adapt.location._currentId);if(Adapt.devtools.get("_trickleEnabled"))Adapt.trigger("trickle:kill");var incomplete=_.filter(currentModel.findDescendantModels("components"),function(model){return!model.get("_isComplete")});_.each(incomplete,function(component){component.set("_isComplete",true)});Adapt.trigger("drawer:closeDrawer")},_checkPassHalfFailVisibility:function _checkPassHalfFailVisibility(){var currentModel=Adapt.findById(Adapt.location._currentId);if(currentModel.get("_type")!="page"){this.$(".pass, .half, .fail").addClass("u-display-none");return}var unanswered=_.filter(currentModel.findDescendantModels("components"),function(m){return m.get("_isQuestionType")===true&&m.get("_isSubmitted")===false});if(unanswered.length==0)this.$(".tip.pass-half-fail").html("");else this.$(".is-tip.pass-half-fail").html("With the "+unanswered.length+" unanswered question(s) in this page do the following:");this.$(".pass, .half, .fail").toggleClass("u-display-none",unanswered.length==0)},onPassHalfFail:function onPassHalfFail(e){if(Adapt.devtools.get("_trickleEnabled"))Adapt.trigger("trickle:kill");$(".js-loading").show();var tutorEnabled=Adapt.devtools.get("_feedbackEnabled");if(tutorEnabled)Adapt.devtools.set("_feedbackEnabled",false);if($(e.currentTarget).hasClass("pass"))PassHalfFail.pass(_.bind(this.onPassHalfFailComplete,this,tutorEnabled));else if($(e.currentTarget).hasClass("half"))PassHalfFail.half(_.bind(this.onPassHalfFailComplete,this,tutorEnabled));else PassHalfFail.fail(_.bind(this.onPassHalfFailComplete,this,tutorEnabled));Adapt.trigger("drawer:closeDrawer")},onPassHalfFailComplete:function onPassHalfFailComplete(tutorEnabled){console.log("onPassHalfFailComplete");if(tutorEnabled)Adapt.devtools.set("_feedbackEnabled",true);$(".js-loading").hide()},_checkTraceFocusVisibility:function _checkTraceFocusVisibility(){if(Adapt.devtools.get("_traceFocusAvailable")){this.$(".is-toggle.trace-focus").removeClass("u-display-none");this.$(".is-toggle.trace-focus label").toggleClass("is-selected",Adapt.devtools.get("_traceFocusEnabled"))}else{this.$(".trace-focus").addClass("u-display-none")}},onToggleTraceFocus:function onToggleTraceFocus(){Adapt.devtools.toggleTraceFocus();this._checkTraceFocusVisibility()}});var DevtoolsNavigationView=Backbone.View.extend({initialize:function initialize(){var template=Handlebars.templates.devtoolsNavigation;this.$el=$(template());$("html").addClass("devtools-enabled");$("html").toggleClass("devtools-extended",Adapt.devtools.get("_extended"));if(this.$el.is("a")||this.$el.is("button"))this.$el.on("click",_.bind(this.onDevtoolsClicked,this));else this.$el.find("a, button").on("click",_.bind(this.onDevtoolsClicked,this));this.listenTo(Adapt,"pageView:postRender menuView:postRender",this.onContentRendered);this.listenToOnce(Adapt,"pageView:postRender menuView:postRender",this.render)},render:function render(){$(".nav__inner").append(this.$el);return this},remove:function remove(){this.$el.remove();this.stopListening();return this},deferredRender:function deferredRender(){_.defer(_.bind(this.render,this))},onContentRendered:function onContentRendered(view){if(view.model.get("_id")==Adapt.location._currentId){this.stopListening(view.model,"change:_isReady",this.deferredRender);this.listenToOnce(view.model,"change:_isReady",this.deferredRender)}},onDevtoolsClicked:function onDevtoolsClicked(event){if(event&&event.preventDefault)event.preventDefault();Adapt.drawer.triggerCustomView(new DevtoolsView().$el,false)}});Adapt.once("courseModel:dataLoaded",function(){Adapt.devtools=new DevtoolsModel});function initNavigationView(){if(!Adapt.devtools.get("_isEnabled"))return;if(navigationView)navigationView.remove();navigationView=new DevtoolsNavigationView}Adapt.once("adapt:initialize devtools:enable",function(){initNavigationView();Adapt.on("app:languageChanged",initNavigationView)})});define("extensions/adapt-homeButton/js/adapt-homeButton",["core/js/adapt"],function(Adapt){var HomeButton=Backbone.Controller.extend({_$html:null,initialize:function initialize(){this.listenTo(Adapt,"app:dataReady",this._onDataReady)},_onDataReady:function _onDataReady(){var config=Adapt.config.get("_homeButton");if(!config||!config._isEnabled)return;this._$html=$("html");this.listenTo(Adapt,{"remove":this._onRemove,"router:menu router:page":this._onRouterEvent,"navigation:redirectedHomeButton":this._redirected})},_onRouterEvent:function _onRouterEvent(model){this._config=model.get("_homeButton");var isEnabled=this._config&&this._config._isEnabled;if(!isEnabled)return this._disabled();this._enabled()},_onRemove:function _onRemove(){this._disabled()},_disabled:function _disabled(){this._$html.removeClass("hide-nav-home-btn");if(this._dataEvent){$(".js-nav-home-btn").attr("data-event",this._dataEvent);this._dataEvent=null}},_enabled:function _enabled(){this._$html.toggleClass("hide-nav-home-btn",!!this._config._hideHomeButton);this._$html.toggleClass("hide-nav-back-btn",!!this._config._hideBackButton);if(!$(".js-nav-home-btn")[0]){this._createHomeButton()}if(this._config._redirectToId){this._dataEvent=$(".js-nav-home-btn").attr("data-event");$(".js-nav-home-btn").attr("data-event","redirectedHomeButton")}},_createHomeButton:function _createHomeButton(){var config=Adapt.course.get("_homeButton");var altText=config&&config.alt;var $backButton=$("button[data-event=\"backButton\"]");var $icon=$("<div>",{"class":"icon"});var $homeButton=$("<button>",{attr:{"data-event":"homeButton"},"class":"btn-icon nav__btn nav__homebutton-btn js-nav-home-btn","aria-label":altText,role:"link"}).append($icon);$homeButton.insertAfter($backButton)},_redirected:function _redirected(){if(!this._config._redirectToId)return;var model=Adapt.findById(this._config._redirectToId);if(!model)return;switch(model.get("_type")){case"course":Backbone.history.navigate("#/",{trigger:true,replace:false});break;case"menu":case"page":Backbone.history.navigate("#/id/"+model.get("_id"),{trigger:true,replace:false});break;}}});return new HomeButton});define("extensions/adapt-keepScrollPosition/js/adapt-keepScrollPosition",["core/js/adapt"],function(Adapt){var position={};function savePosition(){if(!isEnabled())return;position[Adapt.location._currentId]=$(window).scrollTop()}function restorePosition(){if(!isEnabled())return;var savedPosition=position[Adapt.location._currentId];if(!savedPosition)return;$(window).scrollTop(savedPosition)}function isEnabled(){if(!Adapt.location._currentId)return false;var model=Adapt.findById(Adapt.location._currentId);var config=model.get("_keepScrollPosition");return config&&config._isEnabled}Adapt.on({"menuView:ready pageView:ready":restorePosition,"remove":savePosition})});define("extensions/adapt-navigationLogo/js/LogoView",["core/js/adapt"],function(Adapt){var LogoView=Backbone.View.extend({className:"navigation-logo",initialize:function initialize(){this.render();this.listenTo(Adapt,"device:changed",this.onDeviceResize)},onDeviceResize:function onDeviceResize(){this.postRender()},postRender:function postRender(){var config=this.model.get("_graphic");if(this.model.get("_hideLogoForMobile")){this.hideLogoForMobile()}if(config&&config._mobileSrc){this.setLogoImageSrc(config)}},hideLogoForMobile:function hideLogoForMobile(){var isDeviceSmall=Adapt.device.screenSize==="small";$(".navigation-logo__image").toggleClass("u-display-none",isDeviceSmall)},setLogoImageSrc:function setLogoImageSrc(config){var src=Adapt.device.screenSize==="small"?config._mobileSrc:config.src;$(".navigation-logo__image").attr("src",src)},render:function render(){var data=this.model.toJSON();this.$el.html(Handlebars.templates[this.constructor.template](data));_.defer(this.postRender.bind(this));return this}},{template:"navigationLogo"});return LogoView});define("extensions/adapt-navigationLogo/js/adapt-navigationLogo",["core/js/adapt","./LogoView"],function(Adapt,LogoView){var NavigationLogo=Backbone.Controller.extend({initialize:function initialize(){this.listenTo(Adapt,"adapt:initialize",this.onDataReady)},onDataReady:function onDataReady(){if(this.logoView)this.logoView.remove();var config=Adapt.course.get("_navigationLogo");if(!config||!config._isEnabled)return;this.logoView=new LogoView({model:new Backbone.Model(config)});var selector=".js-nav-back-btn";this.logoView.$el.insertAfter($(selector))}});return new NavigationLogo});define("extensions/adapt-navigationTitle/js/TitleView",["core/js/adapt"],function(Adapt){var TitleView=Backbone.View.extend({className:"navigation-title",initialize:function initialize(){this.render()},render:function render(){var data=this.model.toJSON();this.$el.html(Handlebars.templates[this.constructor.template](data))}},{template:"navigationTitle"});return TitleView});define("extensions/adapt-navigationTitle/js/adapt-navigationTitle",["core/js/adapt","./TitleView"],function(Adapt,TitleView){var NavigationTitle=Backbone.Controller.extend({initialize:function initialize(){this.listenTo(Adapt,"adapt:initialize",this.onDataReady)},onDataReady:function onDataReady(){if(this.titleView)this.titleView.remove();var config=Adapt.course.get("_navigationTitle");if(!config||!config._isEnabled)return;this.titleView=new TitleView({model:new Backbone.Model(config)});var $navLogo=$(".navigation-logo");if($navLogo.length>0){this.titleView.$el.insertAfter($navLogo);return}var $backBtn=".js-nav-back-btn";this.titleView.$el.insertAfter($backBtn)}});return new NavigationTitle});define("extensions/adapt-pageIncompletePrompt/js/adapt-pageIncompletePrompt",["core/js/adapt"],function(Adapt){var PageIncompletePrompt=Backbone.Controller.extend({PLUGIN_NAME:"_pageIncompletePrompt",handleRoute:true,inPage:false,inPopup:false,isChangingLanguage:false,pageModel:null,model:null,_ignoreAccessibilityNavigation:false,initialize:function initialize(){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"app:languageChanged":this.onLanguageChanging,"pageView:ready":this.onPageViewReady,"pageIncompletePrompt:leavePage":this.onLeavePage,"pageIncompletePrompt:cancel":this.onLeaveCancel,"router:navigate":this.onRouterNavigate});this.listenToOnce(Adapt,"app:dataLoaded",function(){this.setupModel();this.listenTo(Adapt,"accessibility:toggle",this.onAccessibilityToggle)})},onLanguageChanging:function onLanguageChanging(){this.isChangingLanguage=true;this.setupModel();Adapt.once("router:page",function(){this.isChangingLanguage=false}.bind(this))},setupModel:function setupModel(){this.model=Adapt.course.get(this.PLUGIN_NAME)},onPageViewReady:function onPageViewReady(){this.inPage=true;this.pageModel=Adapt.findById(Adapt.location._currentId)},onLeavePage:function onLeavePage(){if(!this.inPopup)return;this.inPopup=false;this.stopListening(Adapt,"notify:cancelled");this.enableRouterNavigation(true);this.handleRoute=false;this.inPage=false;window.location.href=this.href;this.handleRoute=true},onLeaveCancel:function onLeaveCancel(){if(!this.inPopup)return;this.inPopup=false;this.stopListening(Adapt,"notify:cancelled");this.enableRouterNavigation(true);this.handleRoute=true},onRouterNavigate:function onRouterNavigate(routeArguments){if(!this.isEnabled()||this.pageModel.get("_isComplete"))return;this.href=window.location.href;var id=routeArguments[0];if(id){if(id===Adapt.location._currentId)return;var model=Adapt.findById(id);var parent=model&&model.findAncestor("contentObjects");if(parent&&parent.get("_id")===this.pageModel.get("_id")){return}}if(this._ignoreAccessibilityNavigation){this._ignoreAccessibilityNavigation=false;return}this.enableRouterNavigation(false);this.showPrompt()},onAccessibilityToggle:function onAccessibilityToggle(){if(Adapt.device.touch){this._ignoreAccessibilityNavigation=false;return}this._ignoreAccessibilityNavigation=true},showPrompt:function showPrompt(){var classes="is-pageincomplete ";classes+=this.model._classes||"";var promptObject={title:this.model.title,body:this.model.message,_classes:classes,_prompts:[{promptText:this.model._buttons.yes,_callbackEvent:"pageIncompletePrompt:leavePage"},{promptText:this.model._buttons.no,_callbackEvent:"pageIncompletePrompt:cancel"}],_showIcon:true};var pipConfig=this.pageModel.get("_pageIncompletePrompt");if(pipConfig&&pipConfig._buttons){promptObject.title=pipConfig.title;promptObject.body=pipConfig.message;promptObject._classes=pipConfig._classes;promptObject._prompts[0].promptText=pipConfig._buttons.yes;promptObject._prompts[1].promptText=pipConfig._buttons.no}this.listenToOnce(Adapt,"notify:cancelled",this.onLeaveCancel);Adapt.trigger("notify:prompt",promptObject);this.inPopup=true},isEnabled:function isEnabled(){if(!Adapt.location._currentId)return false;if(!this.handleRoute)return false;if(!this.inPage)return false;if(this.inPopup)return false;if(this.isChangingLanguage)return false;switch(Adapt.location._contentType){case"menu":case"course":this.inPage=false;return false;}var pageModel=Adapt.findById(Adapt.location._currentId);if(pageModel.get("_isOptional"))return false;var isEnabledForCourse=this.model&&!!this.model._isEnabled;var isEnabledForPage=pageModel.get("_pageIncompletePrompt")&&!!pageModel.get("_pageIncompletePrompt")._isEnabled;return isEnabledForCourse&&isEnabledForPage!==false||isEnabledForPage},enableRouterNavigation:function enableRouterNavigation(value){Adapt.router.set("_canNavigate",value,{pluginName:this.PLUGIN_NAME})}});return new PageIncompletePrompt});define("extensions/adapt-search/js/searchDrawerItemView",["core/js/adapt"],function(Adapt){var SearchDrawerItemView=Backbone.View.extend({className:"search",events:{"click .js-search-textbox-change":"search","keyup .js-search-textbox-change":"search"},initialize:function initialize(options){this.listenTo(Adapt,"drawer:empty",this.remove);this.render();this.search=_.debounce(this.search.bind(this),1000);if(options.query){this.$(".js-search-textbox-change").val(options.query)}},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates["searchBox"];$(this.el).html(template(data));return this},search:function search(event){if(event&&event.preventDefault)event.preventDefault();var searchVal=this.$(".js-search-textbox-change").val();Adapt.trigger("search:filterTerms",searchVal)}});return SearchDrawerItemView});define("extensions/adapt-search/js/search-algorithm",["core/js/adapt"],function(Adapt){var searchDefaults={_searchAttributes:[{"_attributeName":"_search","_level":1,"_allowTextPreview":false},{"_attributeName":"_keywords","_level":1,"_allowTextPreview":false},{"_attributeName":"keywords","_level":1,"_allowTextPreview":false},{"_attributeName":"displayTitle","_level":2,"_allowTextPreview":true},{"_attributeName":"title","_level":2,"_allowTextPreview":false},{"_attributeName":"body","_level":3,"_allowTextPreview":true},{"_attributeName":"alt","_level":4,"_allowTextPreview":false},{"_attributeName":"_alt","_level":4,"_allowTextPreview":false},{"_attributeName":"_items","_level":5,"_allowTextPreview":false},{"_attributeName":"items","_level":5,"_allowTextPreview":false},{"_attributeName":"text","_level":5,"_allowTextPreview":true}],_hideComponents:["blank"],_hideTypes:[],_ignoreWords:["a","an","and","are","as","at","be","by","for","from","has","he","in","is","it","its","of","on","that","the","to","was","were","will","wish",""],_matchOn:{_contentWordBeginsPhraseWord:false,_contentWordContainsPhraseWord:false,_contentWordEqualsPhraseWord:true,_phraseWordBeginsContentWord:true},_scoreQualificationThreshold:20,_minimumWordLength:2,_frequencyImportance:5};var wordCharacters=["A-Z","0-9","a-z","\xAA","\xB5","\xBA","\xC0-\xD6","\xD8-\xF6","\xF8-\u02C1","\u02C6-\u02D1","\u02E0-\u02E4","\u02EC","\u02EE","\u0370-\u0374","\u0376","\u0377","\u037A-\u037D","\u0386","\u0388-\u038A","\u038C","\u038E-\u03A1","\u03A3-\u03F5","\u03F7-\u0481","\u048A-\u0527","\u0531-\u0556","\u0559","\u0561-\u0587","\u05D0-\u05EA","\u05F0-\u05F2","\u0620-\u064A","\u066E","\u066F","\u0671-\u06D3","\u06D5","\u06E5","\u06E6","\u06EE","\u06EF","\u06FA-\u06FC","\u06FF","\u0710","\u0712-\u072F","\u074D-\u07A5","\u07B1","\u07CA-\u07EA","\u07F4","\u07F5","\u07FA","\u0800-\u0815","\u081A","\u0824","\u0828","\u0840-\u0858","\u08A0","\u08A2-\u08AC","\u0904-\u0939","\u093D","\u0950","\u0958-\u0961","\u0971-\u0977","\u0979-\u097F","\u0985-\u098C","\u098F","\u0990","\u0993-\u09A8","\u09AA-\u09B0","\u09B2","\u09B6-\u09B9","\u09BD","\u09CE","\u09DC","\u09DD","\u09DF-\u09E1","\u09F0","\u09F1","\u0A05-\u0A0A","\u0A0F","\u0A10","\u0A13-\u0A28","\u0A2A-\u0A30","\u0A32","\u0A33","\u0A35","\u0A36","\u0A38","\u0A39","\u0A59-\u0A5C","\u0A5E","\u0A72-\u0A74","\u0A85-\u0A8D","\u0A8F-\u0A91","\u0A93-\u0AA8","\u0AAA-\u0AB0","\u0AB2","\u0AB3","\u0AB5-\u0AB9","\u0ABD","\u0AD0","\u0AE0","\u0AE1","\u0B05-\u0B0C","\u0B0F","\u0B10","\u0B13-\u0B28","\u0B2A-\u0B30","\u0B32","\u0B33","\u0B35-\u0B39","\u0B3D","\u0B5C","\u0B5D","\u0B5F-\u0B61","\u0B71","\u0B83","\u0B85-\u0B8A","\u0B8E-\u0B90","\u0B92-\u0B95","\u0B99","\u0B9A","\u0B9C","\u0B9E","\u0B9F","\u0BA3","\u0BA4","\u0BA8-\u0BAA","\u0BAE-\u0BB9","\u0BD0","\u0C05-\u0C0C","\u0C0E-\u0C10","\u0C12-\u0C28","\u0C2A-\u0C33","\u0C35-\u0C39","\u0C3D","\u0C58","\u0C59","\u0C60","\u0C61","\u0C85-\u0C8C","\u0C8E-\u0C90","\u0C92-\u0CA8","\u0CAA-\u0CB3","\u0CB5-\u0CB9","\u0CBD","\u0CDE","\u0CE0","\u0CE1","\u0CF1","\u0CF2","\u0D05-\u0D0C","\u0D0E-\u0D10","\u0D12-\u0D3A","\u0D3D","\u0D4E","\u0D60","\u0D61","\u0D7A-\u0D7F","\u0D85-\u0D96","\u0D9A-\u0DB1","\u0DB3-\u0DBB","\u0DBD","\u0DC0-\u0DC6","\u0E01-\u0E30","\u0E32","\u0E33","\u0E40-\u0E46","\u0E81","\u0E82","\u0E84","\u0E87","\u0E88","\u0E8A","\u0E8D","\u0E94-\u0E97","\u0E99-\u0E9F","\u0EA1-\u0EA3","\u0EA5","\u0EA7","\u0EAA","\u0EAB","\u0EAD-\u0EB0","\u0EB2","\u0EB3","\u0EBD","\u0EC0-\u0EC4","\u0EC6","\u0EDC-\u0EDF","\u0F00","\u0F40-\u0F47","\u0F49-\u0F6C","\u0F88-\u0F8C","\u1000-\u102A","\u103F","\u1050-\u1055","\u105A-\u105D","\u1061","\u1065","\u1066","\u106E-\u1070","\u1075-\u1081","\u108E","\u10A0-\u10C5","\u10C7","\u10CD","\u10D0-\u10FA","\u10FC-\u1248","\u124A-\u124D","\u1250-\u1256","\u1258","\u125A-\u125D","\u1260-\u1288","\u128A-\u128D","\u1290-\u12B0","\u12B2-\u12B5","\u12B8-\u12BE","\u12C0","\u12C2-\u12C5","\u12C8-\u12D6","\u12D8-\u1310","\u1312-\u1315","\u1318-\u135A","\u1380-\u138F","\u13A0-\u13F4","\u1401-\u166C","\u166F-\u167F","\u1681-\u169A","\u16A0-\u16EA","\u1700-\u170C","\u170E-\u1711","\u1720-\u1731","\u1740-\u1751","\u1760-\u176C","\u176E-\u1770","\u1780-\u17B3","\u17D7","\u17DC","\u1820-\u1877","\u1880-\u18A8","\u18AA","\u18B0-\u18F5","\u1900-\u191C","\u1950-\u196D","\u1970-\u1974","\u1980-\u19AB","\u19C1-\u19C7","\u1A00-\u1A16","\u1A20-\u1A54","\u1AA7","\u1B05-\u1B33","\u1B45-\u1B4B","\u1B83-\u1BA0","\u1BAE","\u1BAF","\u1BBA-\u1BE5","\u1C00-\u1C23","\u1C4D-\u1C4F","\u1C5A-\u1C7D","\u1CE9-\u1CEC","\u1CEE-\u1CF1","\u1CF5","\u1CF6","\u1D00-\u1DBF","\u1E00-\u1F15","\u1F18-\u1F1D","\u1F20-\u1F45","\u1F48-\u1F4D","\u1F50-\u1F57","\u1F59","\u1F5B","\u1F5D","\u1F5F-\u1F7D","\u1F80-\u1FB4","\u1FB6-\u1FBC","\u1FBE","\u1FC2-\u1FC4","\u1FC6-\u1FCC","\u1FD0-\u1FD3","\u1FD6-\u1FDB","\u1FE0-\u1FEC","\u1FF2-\u1FF4","\u1FF6-\u1FFC","\u2071","\u207F","\u2090-\u209C","\u2102","\u2107","\u210A-\u2113","\u2115","\u2119-\u211D","\u2124","\u2126","\u2128","\u212A-\u212D","\u212F-\u2139","\u213C-\u213F","\u2145-\u2149","\u214E","\u2183","\u2184","\u2C00-\u2C2E","\u2C30-\u2C5E","\u2C60-\u2CE4","\u2CEB-\u2CEE","\u2CF2","\u2CF3","\u2D00-\u2D25","\u2D27","\u2D2D","\u2D30-\u2D67","\u2D6F","\u2D80-\u2D96","\u2DA0-\u2DA6","\u2DA8-\u2DAE","\u2DB0-\u2DB6","\u2DB8-\u2DBE","\u2DC0-\u2DC6","\u2DC8-\u2DCE","\u2DD0-\u2DD6","\u2DD8-\u2DDE","\u2E2F","\u3005","\u3006","\u3031-\u3035","\u303B","\u303C","\u3041-\u3096","\u309D-\u309F","\u30A1-\u30FA","\u30FC-\u30FF","\u3105-\u312D","\u3131-\u318E","\u31A0-\u31BA","\u31F0-\u31FF","\u3400-\u4DB5","\u4E00-\u9FCC","\uA000-\uA48C","\uA4D0-\uA4FD","\uA500-\uA60C","\uA610-\uA61F","\uA62A","\uA62B","\uA640-\uA66E","\uA67F-\uA697","\uA6A0-\uA6E5","\uA717-\uA71F","\uA722-\uA788","\uA78B-\uA78E","\uA790-\uA793","\uA7A0-\uA7AA","\uA7F8-\uA801","\uA803-\uA805","\uA807-\uA80A","\uA80C-\uA822","\uA840-\uA873","\uA882-\uA8B3","\uA8F2-\uA8F7","\uA8FB","\uA90A-\uA925","\uA930-\uA946","\uA960-\uA97C","\uA984-\uA9B2","\uA9CF","\uAA00-\uAA28","\uAA40-\uAA42","\uAA44-\uAA4B","\uAA60-\uAA76","\uAA7A","\uAA80-\uAAAF","\uAAB1","\uAAB5","\uAAB6","\uAAB9-\uAABD","\uAAC0","\uAAC2","\uAADB-\uAADD","\uAAE0-\uAAEA","\uAAF2-\uAAF4","\uAB01-\uAB06","\uAB09-\uAB0E","\uAB11-\uAB16","\uAB20-\uAB26","\uAB28-\uAB2E","\uABC0-\uABE2","\uAC00-\uD7A3","\uD7B0-\uD7C6","\uD7CB-\uD7FB","\uF900-\uFA6D","\uFA70-\uFAD9","\uFB00-\uFB06","\uFB13-\uFB17","\uFB1D","\uFB1F-\uFB28","\uFB2A-\uFB36","\uFB38-\uFB3C","\uFB3E","\uFB40","\uFB41","\uFB43","\uFB44","\uFB46-\uFBB1","\uFBD3-\uFD3D","\uFD50-\uFD8F","\uFD92-\uFDC7","\uFDF0-\uFDFB","\uFE70-\uFE74","\uFE76-\uFEFC","\uFF21-\uFF3A","\uFF41-\uFF5A","\uFF66-\uFFBE","\uFFC2-\uFFC7","\uFFCA-\uFFCF","\uFFD2-\uFFD7","\uFFDA-\uFFDC"];wordCharacters=wordCharacters.join("");var search=_.extend({model:null,_searchableModels:null,_wordIndex:null,_regularExpressions:{matchNotWordBoundaries:new RegExp("["+wordCharacters+"]+","g"),trimReplaceNonWordCharacters:new RegExp("^([^"+wordCharacters+"])+|([^"+wordCharacters+"])+$","g"),trimReplaceWhitespace:/^\s+|\s+$/g,escapeRegExp:function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},initialize:function initialize(){this.setupListeners()},setupListeners:function setupListeners(){this.listenTo(Adapt,{"app:dataReady":this.onDataReady,"app:languageChanged":this.clearSearchResults})},clearSearchResults:function clearSearchResults(){Adapt.trigger("search:filterTerms","")},onDataReady:function onDataReady(){var config=Adapt.course.get("_search");if(!config||config._isEnabled===false)return;this.setupConfig();this._searchableModels=this.collectModelTexts();this.makeModelTextProfiles();this.indexTextProfiles();Adapt.trigger("search-algorithm:ready")},setupConfig:function setupConfig(){var model=Adapt.course.get("_search")||{};var modelWithDefaults=_.extend(searchDefaults,model);Adapt.course.set("_search",modelWithDefaults);this.model=new Backbone.Model(modelWithDefaults)},collectModelTexts:function collectModelTexts(){var searchAttributes=this.model.get("_searchAttributes");var hideComponents=this.model.get("_hideComponents");var hideTypes=this.model.get("_hideTypes");var regularExpressions=this._regularExpressions;function combineAdaptModels(){var rtn=[].concat(Adapt.contentObjects.models).concat(Adapt.articles.models).concat(Adapt.blocks.models).concat(Adapt.components.models);var filtered=_.filter(rtn,function(model){var type=model.get("_type"),displayTitle,title;if(_.contains(hideTypes,type))return false;if(type=="component"){var component=model.get("_component");if(_.contains(hideComponents,component))return false}if(model.has("displayTitle"))displayTitle=model.get("displayTitle").replace(regularExpressions.trimReplaceWhitespace,"");if(model.has("title"))title=model.get("title").replace(regularExpressions.trimReplaceWhitespace,"");if(!displayTitle&&!title)return false;return true});return filtered}function getSearchableModels(){var adaptModels=combineAdaptModels();var searchable=[];for(var i=0,l=adaptModels.length;i<l;i++){var model=adaptModels[i];if(!isModelSearchable(model))continue;var json=model.toJSON();var searchProfile={"_raw":recursivelyCollectModelTexts(json)};model.set("_searchProfile",searchProfile);searchable.push(model)}return new Backbone.Collection(searchable)}function isModelSearchable(model){var trail=model.getAncestorModels(true);var config=model.get("_search");if(config&&config._isEnabled===false)return false;var firstDisabledTrailItem=_.find(trail,function(item){var config=item.get("_search");if(!config)return false;if(config&&config._isEnabled!==false)return false;return true});return firstDisabledTrailItem===undefined}function recursivelyCollectModelTexts(json,level){var texts=[];for(var i=0,l=searchAttributes.length;i<l;i++){var attributeObject=searchAttributes[i];if(!json[attributeObject._attributeName])continue;switch(_typeof(json[attributeObject._attributeName])){case"object":if(json[attributeObject._attributeName]instanceof Array){for(var sa=0,sal=json[attributeObject._attributeName].length;sa<sal;sa++){switch(_typeof(json[attributeObject._attributeName][sa])){case"object":texts=texts.concat(recursivelyCollectModelTexts(json[attributeObject._attributeName][sa],attributeObject._level));break;case"string":addString(json[attributeObject._attributeName][sa],attributeObject._level,attributeObject);}}}else{texts=texts.concat(recursivelyCollectModelTexts(json[attributeObject._attributeName],attributeObject._level))}break;case"string":addString(json[attributeObject._attributeName],level,attributeObject);break;}}return texts;function addString(string,level,attributeObject){var textLevel=level||attributeObject._level;var text=$("<div>"+string.replace(regularExpressions.trimReplaceWhitespace,"")+"</div>").text();text=text.replace(regularExpressions.trimReplaceWhitespace,"");if(!text)return;texts.push({score:1/textLevel,text:text,searchAttribute:attributeObject})}}return getSearchableModels()},makeModelTextProfiles:function makeModelTextProfiles(){var ignoreWords=this.model.get("_ignoreWords")instanceof Array?this.model.get("_ignoreWords"):this.model.get("_ignoreWords").split(",");var regularExpressions=this._regularExpressions;var searchAttributes=this.model.get("_searchAttributes");var minimumWordLength=this.model.get("_minimumWordLength");var scores=_.uniq(_.pluck(searchAttributes,"_level"));scores=_.map(scores,function(l){return 1/l});for(var i=0,l=this._searchableModels.models.length;i<l;i++){var item=this._searchableModels.models[i];var profile=item.get("_searchProfile");makeModelPhraseProfile(profile);makeModelPhraseWordAndWordProfile(profile)}function makeModelPhraseProfile(profile){profile._phrases=[];var phrases=_.groupBy(profile._raw,function(phrase){return phrase.text});for(var p in phrases){var bestItem=_.max(phrases[p],function(item){return item.score});profile._phrases.push({searchAttribute:bestItem.searchAttribute,phrase:bestItem.text,score:bestItem.score,words:[]})}return profile}function makeModelPhraseWordAndWordProfile(profile){profile._words=[];for(var l=0,ll=scores.length;l<ll;l++){var score=scores[l];var phrases=_.where(profile._phrases,{score:score});var scoreWords=[];for(var i=0,pl=phrases.length;i<pl;i++){var phraseObject=phrases[i];var chunks=phraseObject.phrase.match(regularExpressions.matchNotWordBoundaries);var words=_.map(chunks,function(chunk){return chunk.replace(regularExpressions.trimReplaceNonWordCharacters,"")});phraseObject.words=_.countBy(words,function(word){return word.toLowerCase()});phraseObject.words=_.omit(phraseObject.words,ignoreWords);scoreWords=scoreWords.concat(words)}scoreWords=_.filter(scoreWords,function(word){return word.length>=minimumWordLength});scoreWords=_.countBy(scoreWords,function(word){return word.toLowerCase()});scoreWords=_.omit(scoreWords,ignoreWords);for(var word in scoreWords){profile._words.push({word:word,score:score,count:scoreWords[word]})}}return profile}},indexTextProfiles:function indexTextProfiles(){this._wordIndex={};for(var i=0,il=this._searchableModels.models.length;i<il;i++){var item=this._searchableModels.models[i];var id=item.get("_id");var searchProfile=item.get("_searchProfile");for(var w=0,wl=searchProfile._words.length;w<wl;w++){var word=searchProfile._words[w].word;if(Object.prototype.hasOwnProperty&&!this._wordIndex.hasOwnProperty(word)){this._wordIndex[word]=[]}else{this._wordIndex[word]=this._wordIndex[word]||[]}this._wordIndex[word].push(id)}}for(var _word in this._wordIndex){this._wordIndex[_word]=_.uniq(this._wordIndex[_word])}},find:function find(findPhrase){var regularExpressions=this._regularExpressions;var wordIndex=this._wordIndex;var ignoreWords=this.model.get("_ignoreWords")instanceof Array?this.model.get("_ignoreWords"):this.model.get("_ignoreWords").split(",");var scoreQualificationThreshold=this.model.get("_scoreQualificationThreshold");var minimumWordLength=this.model.get("_minimumWordLength");var frequencyImportance=this.model.get("_frequencyImportance");var matchOn=this.model.get("_matchOn")||{};var json=this._searchableModels.toJSON();function getFindPhraseWords(findPhrase){var findChunks=findPhrase.match(regularExpressions.matchNotWordBoundaries);var findWords=_.map(findChunks,function(chunk){return chunk.replace(regularExpressions.trimReplaceNonWordCharacters,"")});findWords=_.countBy(findWords,function(word){return word.toLowerCase()});findWords=_.omit(findWords,ignoreWords);findWords=_.omit(findWords,function(count,item){return item.length<minimumWordLength});return findWords}function getMatchingIdScoreObjects(findWords){var matchingIdScoreObjects={};for(var findWord in findWords){for(var indexWord in wordIndex){var rIndexWordBegins=new RegExp("^"+regularExpressions.escapeRegExp(indexWord),"g");var rFindWordContains=new RegExp(regularExpressions.escapeRegExp(findWord),"g");var rFindWordBegins=new RegExp("^"+regularExpressions.escapeRegExp(findWord),"g");var isIndexBeginsMatch=matchOn._contentWordBeginsPhraseWord===false?false:rIndexWordBegins.test(findWord);var isFindContainsMatch=matchOn._contentWordContainsPhraseWord===false?false:rFindWordContains.test(indexWord);var isFindBeginsMatch=matchOn._phraseWordBeginsContentWord===false?false:rFindWordBegins.test(indexWord);var isFullMatch=matchOn._contentWordEqualsPhraseWord==false?false:findWord==indexWord;var isPartMatch=isIndexBeginsMatch||isFindContainsMatch||isFindBeginsMatch;if(!isFullMatch&&!isPartMatch)continue;var partMatchRatio=1;if(isPartMatch&&!isFullMatch){if(findWord.length>indexWord.length)partMatchRatio=indexWord.length/findWord.length;else partMatchRatio=findWord.length/indexWord.length}updateIdScoreObjectsForWord(matchingIdScoreObjects,indexWord,isFullMatch,partMatchRatio)}}return _.values(matchingIdScoreObjects)}function updateIdScoreObjectsForWord(matchingIdScoreObjects,word,isFullMatch,partMatchRatio){for(var i=0,l=wordIndex[word].length;i<l;i++){var id=wordIndex[word][i];var model=_.findWhere(json,{_id:id});if(matchingIdScoreObjects[id]===undefined){matchingIdScoreObjects[id]={score:0,foundWords:{},foundPhrases:null,model:Adapt.findById(id)}}if(matchingIdScoreObjects[id].foundWords[word]===undefined)matchingIdScoreObjects[id].foundWords[word]=0;var allPhraseWordRatingObjects=_.where(model._searchProfile._words,{word:word});var wordFrequency=_.reduce(allPhraseWordRatingObjects,function(memo,item){return memo+item.count},0);var wordFrequencyHitScore=_.reduce(allPhraseWordRatingObjects,function(memo,item){var frequencyBonus=item.score*item.count/frequencyImportance;return memo+item.score+frequencyBonus},0);matchingIdScoreObjects[id].foundWords[word]+=wordFrequency;if(isFullMatch){matchingIdScoreObjects[id].score+=wordFrequencyHitScore}else{matchingIdScoreObjects[id].score+=wordFrequencyHitScore*partMatchRatio}}}function filterAndSortQualifyingMatches(matchingIdScoreObjects){var allowedScoreObjects=_.filter(matchingIdScoreObjects,function(item){return isModelSearchable(item.model)});var qualifyingScoreThreshold=1/scoreQualificationThreshold;var qualifyingMatches=_.filter(allowedScoreObjects,function(item){return item.score>=qualifyingScoreThreshold});qualifyingMatches=_.sortBy(qualifyingMatches,function(item){return 1/item.score});return qualifyingMatches}function isModelSearchable(model){var trail=model.getAncestorModels(true);var config=model.get("_search");if(config&&config._isEnabled===false)return false;if(model.get("_isLocked"))return false;var firstDisabledTrailItem=_.find(trail,function(item){var config=item.get("_search");if(item.get("_isLocked"))return true;if(config&&config._isEnabled===false)return true;return false});return firstDisabledTrailItem===undefined}function mapSearchPhrasesToMatchingWords(matchingIdScoreObjects){for(var i=0,l=matchingIdScoreObjects.length;i<l;i++){var matchingPhrases=[];var scoreObject=matchingIdScoreObjects[i];var foundWords=_.keys(scoreObject.foundWords);var modelPhrases=scoreObject.model.get("_searchProfile")._phrases;for(var p=0,lp=modelPhrases.length;p<lp;p++){var modelPhrase=modelPhrases[p];if(!modelPhrase.searchAttribute._allowTextPreview)continue;if(_.intersection(foundWords,_.keys(modelPhrase.words)).length>0){matchingPhrases.push(modelPhrase)}}scoreObject.foundPhrases=matchingPhrases}}var findWords=getFindPhraseWords(findPhrase);var matchingIdScoreObjects=getMatchingIdScoreObjects(findWords);mapSearchPhrasesToMatchingWords(matchingIdScoreObjects);var qualifyingMatchedScoreObjects=filterAndSortQualifyingMatches(matchingIdScoreObjects);return qualifyingMatchedScoreObjects}},Backbone.Events);search.initialize();window.search=search;return search});define("extensions/adapt-search/js/searchResultsView",["require","backbone","core/js/adapt","./search-algorithm"],function(require){var Backbone=require("backbone");var Adapt=require("core/js/adapt");var SearchAlgorithm=require("./search-algorithm");var replaceTagsRegEx=/\<{1}[^\>]+\>/g;var replaceEscapedTagsRegEx=/&lt;[^&gt;]+&gt;/g;var replaceEndTagsRegEx=/\<{1}\/{1}[^\>]+\>/g;var replaceEscapedEndTagsRegEx=/&lt;\/[^&gt;]+&gt;/g;var SearchResultsView=Backbone.View.extend({className:"search__items-container is-inactive",events:{"click [data-id]":"navigateToResultPage"},initialize:function initialize(options){this.listenTo(Adapt,{"drawer:empty":this.remove,"search:termsFiltered":this.updateResults});this.render();if(options.searchObject){this.updateResults(options.searchObject)}},render:function render(){var template=Handlebars.templates["searchResults"];$(this.el).html(template());return this},updateResults:function updateResults(searchObject){this.$el.removeClass("is-inactive");var formattedResults=this.formatResults(searchObject);this.renderResults(formattedResults)},formatResults:function formatResults(searchObject){var self=this;var resultsLimit=Math.min(5,searchObject.searchResults.length);var formattedResults=_.map(_.first(searchObject.searchResults,resultsLimit),function(result){return self.formatResult(result)});searchObject.formattedResults=formattedResults;return searchObject},formatResult:function formatResult(result,query){var foundWords=_.keys(result.foundWords).join(" ");var title=result.model.get("title");var displayTitle=result.model.get("displayTitle");var body=result.model.get("body");var previewWords=this.model.get("_previewWords");var previewCharacters=this.model.get("_previewCharacters");var wordCharacters=search._regularExpressions.wordCharacters;title=title.replace(SearchAlgorithm._regularExpressions.trimReplaceWhitespace,"");displayTitle=displayTitle.replace(SearchAlgorithm._regularExpressions.trimReplaceWhitespace,"");body=body.replace(SearchAlgorithm._regularExpressions.trimReplaceWhitespace,"");title=this.stripTags(title);displayTitle=this.stripTags(displayTitle);body=this.stripTags(body);var searchTitle="";var textPreview="";if(!title){searchTitle=$("<div>"+displayTitle+"</div>").text()||"No title found"}else{searchTitle=$("<div>"+title+"</div>").text()}if(result.foundPhrases.length>0){var finder;var phrase=result.foundPhrases[0].phrase;phrase=this.stripTags(phrase);var lowerPhrase=phrase.toLowerCase();var lowerSearchTitle=searchTitle.toLowerCase();if(lowerPhrase==lowerSearchTitle&&result.foundPhrases.length>1){phrase=result.foundPhrases[1].phrase;phrase=this.stripTags(phrase);lowerPhrase=phrase.toLowerCase()}if(lowerPhrase==lowerSearchTitle){finder=new RegExp("(([^"+wordCharacters+"]*["+wordCharacters+"]{1}){1,"+previewWords+"}|.{0,"+previewCharacters+"})","i");if(body){textPreview=body.match(finder)[0]+"..."}}else{var wordMap=_.map(result.foundWords,function(count,word){return{word:word,count:count}});_.sortBy(wordMap,function(item){return item.count});var wordIndex=0;var wordInPhraseStartPosition=lowerPhrase.indexOf(wordMap[wordIndex].word);while(wordInPhraseStartPosition==-1){wordIndex++;if(wordIndex==wordMap.length)throw"search: cannot find word in phrase";wordInPhraseStartPosition=lowerPhrase.indexOf(wordMap[wordIndex].word)}var regex=new RegExp("(([^"+wordCharacters+"]*["+wordCharacters+"]{1}){1,"+previewWords+"}|.{0,"+previewCharacters+"})"+SearchAlgorithm._regularExpressions.escapeRegExp(wordMap[wordIndex].word)+"((["+wordCharacters+"]{1}[^"+wordCharacters+"]*){1,"+previewWords+"}|.{0,"+previewCharacters+"})","i");var snippet=phrase.match(regex)[0];var snippetIndexInPhrase=phrase.indexOf(snippet);if(snippet.length==phrase.length){textPreview=snippet}else if(snippetIndexInPhrase===0){textPreview=snippet+"..."}else if(snippetIndexInPhrase+snippet.length==phrase.length){textPreview="..."+snippet}else{textPreview="..."+snippet+"..."}}}else{finder=new RegExp("(([^"+wordCharacters+"]*["+wordCharacters+"]{1}){1,"+previewWords+"}|.{0,"+previewCharacters+"})","i");if(body){textPreview=body.match(finder)[0]+"..."}}var searchTitleTagged=tag(result.foundWords,searchTitle);var textPreviewTagged=tag(result.foundWords,textPreview);return{searchTitleTagged:searchTitleTagged,searchTitle:searchTitle,foundWords:foundWords,textPreview:textPreview,textPreviewTagged:textPreviewTagged,id:result.model.get("_id")};function tag(words,text){var initial="";_.each(words,function(count,word){var wordPos=text.toLowerCase().indexOf(word);if(wordPos<0)return;initial+=text.slice(0,wordPos);var highlighted=text.slice(wordPos,wordPos+word.length);initial+="<span class='is-found'>"+highlighted+"</span>";text=text.slice(wordPos+word.length,text.length)});initial+=text;return initial}},stripTags:function stripTags(text){text=$("<span>"+text+"</span>").html();return text.replace(replaceEndTagsRegEx," ").replace(replaceTagsRegEx,"").replace(replaceEscapedEndTagsRegEx," ").replace(replaceEscapedTagsRegEx,"")},renderResults:function renderResults(results){var template=Handlebars.templates["searchResultsContent"];this.$(".search__items-container-inner").html(template(results))},navigateToResultPage:function navigateToResultPage(event){event&&event.preventDefault();var blockID=$(event.currentTarget).attr("data-id");Adapt.navigateToElement("."+blockID);Adapt.trigger("drawer:closeDrawer")}});return SearchResultsView});define("extensions/adapt-search/js/adapt-search",["core/js/adapt","./searchDrawerItemView","./searchResultsView","./search-algorithm"],function(Adapt,SearchDrawerItemView,SearchResultsView,SearchAlgorithm){var lastSearchQuery=null;var lastSearchObject=null;var isSearchShown=false;var searchConfigDefault={_previewWords:15,_previewCharacters:30,_showHighlights:true,_showFoundWords:true,title:"Search",description:"Type in search words",placeholder:"",noResultsMessage:"Sorry, no results were found",awaitingResultsMessage:"Formulating results..."};Adapt.on("search-algorithm:ready",function(){Adapt.course.set("_search",_.extend(searchConfigDefault,Adapt.course.get("_search")));var searchConfig=Adapt.course.get("_search");searchConfig.title=searchConfig.title||"Search";searchConfig.description=searchConfig.description||"Description";var drawerObject={title:searchConfig.title,description:searchConfig.description,className:"is-search",drawerOrder:searchConfig._drawerOrder||0};Adapt.drawer.addItem(drawerObject,"resources:showSearch")});Adapt.on("resources:showSearch",function(){if(isSearchShown)return;var searchConfig=Adapt.course.get("_search");searchConfig=new Backbone.Model(searchConfig);var template=Handlebars.templates["searchSingleItem"];var $element=$(template(searchConfig.toJSON()));Adapt.drawer.triggerCustomView($element,true);Adapt.trigger("search:draw")});Adapt.on("drawer:openedItemView search:draw",function(){isSearchShown=true;var searchConfig=Adapt.course.get("_search");searchConfig=new Backbone.Model(searchConfig);var $searchDrawerButton=$(".is-search");if($searchDrawerButton.is(":not(div)")){var $replacementButton=$("<div></div>");$replacementButton.attr("class",$searchDrawerButton.attr("class"));$searchDrawerButton.children().appendTo($replacementButton);$searchDrawerButton.replaceWith($replacementButton)}if(lastSearchObject&&lastSearchObject.searchResults&&lastSearchObject.searchResults.length===0){lastSearchObject=null;lastSearchQuery=null}$(".drawer__holder .is-search").append(new SearchDrawerItemView({model:searchConfig,query:lastSearchQuery}).el);$(".drawer__holder .is-search").append(new SearchResultsView({model:searchConfig,searchObject:lastSearchObject}).el)});Adapt.on("drawer:closed",function(){isSearchShown=false});Adapt.on("search:filterTerms",function(query){var searchConfig=Adapt.course.get("_search");var searchObject;lastSearchQuery=query;if(query.length===0){searchObject=_.extend({},searchConfig,{query:query,searchResults:[],isAwaitingResults:false,isBlank:true})}else if(query.length<searchConfig._minimumWordLength){searchObject=_.extend({},searchConfig,{query:query,searchResults:[],isAwaitingResults:true,isBlank:false})}else{var results=SearchAlgorithm.find(query);searchObject=_.extend({},searchConfig,{query:query,searchResults:results,isAwaitingResults:false,isBlank:false})}lastSearchObject=searchObject;Adapt.trigger("search:termsFiltered",searchObject)});Adapt.once("drawer:noItems",function(){$(".nav-drawer-btn").removeClass("u-display-none")})});define("extensions/adapt-submitAll/js/adapt-submitAll",["core/js/adapt"],function(Adapt){var SubmitAll=Backbone.View.extend({className:"submit-all",events:{"click .js-btn-action":"onSubmitAllButtonClicked"},initialize:function initialize(){this.model.get("_articleView").$el.addClass("no-submit-buttons");this.listenTo(Adapt,{"componentView:postRender":this.onComponentViewRendered,remove:function remove(){this.removeEventListeners();this.remove()}});_.bindAll(this,"onInteraction","_onInteractionDelegate");this.render()},render:function render(){var submitButtonLabels=Adapt.course.get("_buttons")._submit;this.$el.html(Handlebars.templates.submitAll({buttonText:submitButtonLabels.buttonText,ariaLabel:submitButtonLabels.ariaLabel}));var $containerDiv=this.getContainerDiv(this.model.get("_articleView").$el,this.model.get("_insertAfterBlock"));$containerDiv.after(this.$el);return this},getContainerDiv:function getContainerDiv($article,blockId){if(blockId){var $div=$article.find("."+blockId);if($div.length>0)return $div}return $article.find(".block").last()},enableSubmitAllButton:function enableSubmitAllButton(enable){var $submitAllButton=this.$el.find(".js-btn-action");if(enable){$submitAllButton.removeClass("is-disabled").attr("disabled",false);return}$submitAllButton.addClass("is-disabled").attr("disabled",true)},canSubmit:function canSubmit(){return this.model.get("_componentViews").every(function(component){if(component.model.get("_isEnabled")&&component.canSubmit()){return true}})},removeEventListeners:function removeEventListeners(){this.model.get("_componentViews").forEach(function(view){if(view.model.get("_component")==="textinput"){view.$el.find("input").off("change.submitAll");return}view.$el.off("click.submitAll")})},onComponentViewRendered:function onComponentViewRendered(view){if(!view.$el.hasClass("is-question"))return;var parentArticleId=view.model.findAncestor("articles").get("_id");var submitAllArticleId=this.model.get("_articleView").model.get("_id");if(parentArticleId===submitAllArticleId){this.model.get("_componentViews").push(view);if(view.model.get("_component")==="textinput"){view.$el.find("input").on("change.submitAll",this.onInteraction);return}view.$el.on("click.submitAll",this.onInteraction)}},onInteraction:function onInteraction(){_.defer(this._onInteractionDelegate)},_onInteractionDelegate:function _onInteractionDelegate(){if(!!this.model.get("_isSubmitted"))return;this.enableSubmitAllButton(this.canSubmit())},onSubmitAllButtonClicked:function onSubmitAllButtonClicked(){this.model.get("_componentViews").forEach(function(view){view.$el.find(".js-btn-action").trigger("click")});this.enableSubmitAllButton(false);this.model.set("_isSubmitted",true);Adapt.trigger("submitAll:submitted",this.model.get("_componentViews"))}});Adapt.on("articleView:postRender",function(view){var saData=view.model.get("_submitAll");if(saData&&saData._isEnabled){var model=new Backbone.Model(saData);model.set({_articleView:view,_componentViews:[]});new SubmitAll({model:model})}})});define("core/js/views/menuItemView",["core/js/views/adaptView"],function(AdaptView){var MenuItemView=function(_AdaptView5){"use strict";_inherits(MenuItemView,_AdaptView5);var _super59=_createSuper(MenuItemView);function MenuItemView(){_classCallCheck(this,MenuItemView);return _super59.apply(this,arguments)}_createClass(MenuItemView,[{key:"attributes",value:function attributes(){return AdaptView.resultExtend("attributes",{"role":"listitem","aria-labelledby":this.model.get("_id")+"-heading"},this)}},{key:"className",value:function className(){return["menu-item",this.constructor.className,this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isVisited")?"is-visited":"",this.model.get("_isComplete")?"is-complete":"",this.model.get("_isLocked")?"is-locked":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}},{key:"preRender",value:function preRender(){this.model.checkCompletionStatus();this.model.checkInteractionCompletionStatus()}},{key:"postRender",value:function postRender(){this.$el.imageready(this.setReadyStatus.bind(this))}}]);return MenuItemView}(AdaptView);MenuItemView.type="menuItem";return MenuItemView});define("core/js/views/menuView",["core/js/views/contentObjectView","core/js/views/menuItemView"],function(ContentObjectView,MenuItemView){var MenuView=function(_ContentObjectView2){"use strict";_inherits(MenuView,_ContentObjectView2);var _super60=_createSuper(MenuView);function MenuView(){_classCallCheck(this,MenuView);return _super60.apply(this,arguments)}return MenuView}(ContentObjectView);Object.assign(MenuView,{childContainer:".js-children",childView:MenuItemView,type:"menu",template:"menu"});return MenuView});define("menu/adapt-carousel-menu/js/adapt-carousel-menuItemView",["core/js/views/adaptView","core/js/adapt"],function(AdaptView,Adapt){var CarouselMenuItemView=AdaptView.extend({className:function className(){var classes="carousel-menu-item";var modelClasses=this.model.get("_classes");if(modelClasses)classes+=" "+modelClasses;if(this.isVisited())classes+=" visited";if(this.model.get("_isOptional"))classes+=" optional";if(this.model.get("_isComplete"))classes+=" completed";if(this.model.get("_isLocked"))classes+=" locked";return classes},events:{"click .carousel-menu-item-button":"onClick"},postRender:function postRender(){this.setBackgroundImage();this.$el.imageready(_.bind(this.setReadyStatus,this))},onClick:function onClick(){if(!this.model.get("_isLocked")){Backbone.history.navigate("#/id/"+this.model.get("_id"),{trigger:true})}var models=this.model.getParent().getAvailableChildModels();var numofpgs=models.length;var addmodels=parseInt(models.indexOf(this.model)+1);$(".navpagenum").text("Page "+addmodels+" of "+numofpgs);$(".arianavpgnum").text("Page "+addmodels+" of "+numofpgs).attr("role","region").attr("tabindex","0").addClass("aria-label");var navtitle2=$(".carousel-menu-item[data-adapt-id=\"home\"] .carousel-menu-item-title").text();$(".modulehead").html(navtitle2)},setBackgroundImage:function setBackgroundImage(){var graphic=this.model.get("_graphic");var src=graphic&&graphic.src;if(src)this.$el.css("background-image","url("+src+")")},isVisited:function isVisited(){if(this.model.get("_isVisited"))return true;var components=this.model.findDescendantModels("components");return _.find(components,function(component){return component.get("_isComplete")&&component.get("_isAvailable")&&!component.get("_isOptional")})}},{template:"carouselMenuItem",type:"menu"});return CarouselMenuItemView});define("menu/adapt-carousel-menu/js/adapt-carousel-menuItemIndicatorView",["./adapt-carousel-menuItemView","core/js/adapt"],function(CarouselMenuItemView,Adapt){var CarouselMenuItemIndicatorView=CarouselMenuItemView.extend({attributes:function attributes(){var models=this.model.getParent().getAvailableChildModels();return _.extend(CarouselMenuItemView.prototype.attributes.call(this),{"data-item-index":parseInt(models.indexOf(this.model)+1)})},className:function className(){var classes=CarouselMenuItemView.prototype.className.call(this);return classes+=" carousel-menu-item-indicator"},events:{"click .carousel-menu-item-indicator-button":"onClick","mouseover .carousel-menu-item-indicator-button":"onOver","mouseout .carousel-menu-item-indicator-button":"onOut"},postRender:function postRender(){},onClick:function onClick(){var index=this.$el.data("item-index");Adapt.trigger("carouselMenu:setItem",this.model.get("_id"),index)},onOver:function onOver(){var index=this.$el.data("item-index");$(".carousel-menu-item[data-item-index=\""+index+"\"] .menu-tooltip").css({"opacity":"1","-webkit-animation-name":"fadeInUp","animation-name":"fadeInUp"})},onOut:function onOut(){var index=this.$el.data("item-index");$(".carousel-menu-item[data-item-index=\""+index+"\"] .menu-tooltip").css({"opacity":"0","-webkit-animation-name":"none","animation-name":"none"})}},{template:"carouselMenuItemIndicator"});return CarouselMenuItemIndicatorView});define("menu/adapt-carousel-menu/js/adapt-carousel-menu",["core/js/views/menuView","core/js/adapt","./adapt-carousel-menuItemView","./adapt-carousel-menuItemIndicatorView"],function(MenuView,Adapt,CarouselMenuItemView,CarouselMenuItemIndicatorView){var CarouselMenuView=MenuView.extend({attributes:function attributes(){return _.extend(MenuView.prototype.attributes.call(this),{"data-item-count":this.model.getAvailableChildModels().length+1})},className:function className(){return MenuView.prototype.className.call(this)+" carousel-menu"},events:{"click .carousel-menu-item-control":"onControlClick","click .numspothome":"onHome","mouseover .numspothome":"homeOver","mouseout .numspothome":"homeOut","click .tooltips6 .skipme":"toolTip"},postRender:function postRender(){var item=this.getNextIncompleteItem();this.listenTo(Adapt,{"carouselMenu:setItem":this.setItem,"menuView:ready":this.onReady});this.setBackgroundImage();this.setUpItems();this.setItem(item.id,item.index);if($(".navigation-back-button").hasClass("display-none")){var navtitle2=$(".carousel-menu-item[data-adapt-id=\"home\"] .carousel-menu-item-title").text();Adapt.offlineStorage.set("mycourseTitle",navtitle2);var courseholder=Adapt.offlineStorage.get("mycourseTitle")}else{$(".location-menu .carousel-menu").addClass("submenu-carousel");var navtitle2=$(".carousel-menu-item[data-adapt-id=\"home\"] .carousel-menu-item-title").text();Adapt.offlineStorage.set("mycourseTitle",navtitle2);var courseholder=Adapt.offlineStorage.get("mycourseTitle")}if($(".location-menu").hasClass("accessibility")){if($(".navigation-back-button").hasClass("display-none")){window.setTimeout(function(){$(".carousel-menu-item:nth-child(2) .carousel-menu-item-button").trigger("click")},250)}else{window.setTimeout(function(){$(".carousel-menu-item:nth-child(2) .carousel-menu-item-button").trigger("click");window.setTimeout(function(){$("head").prepend("<style>.accessibility .audio-controls .audio-inner button {display:none;}</style>");$(".carousel-menu-item:nth-child(2) .carousel-menu-item-button").trigger("click")},250)},250)}}window.setTimeout(function(){$(".tooltips6").remove()},15000)},setItem:function setItem(id,index){this.model.set("_coverId",id);Adapt.offlineStorage.set("coverId",id);this.$el.attr("data-item-index",index)},onReady:function onReady(){if(Adapt.device.screenSize!=="large")this.scroll();this.$(".carousel-menu-item-container").removeClass("no-transition");if($(".visited.carousel-menu-item-indicator .carousel-menu-item-indicator-button-inner div").hasClass("page-level-progress-menu-item")){$(".carousel-menu-item-indicator .page-level-progress-menu-item-indicator-bar").each(function(percent){$(".visited.carousel-menu-item-indicator").addClass("pgpercent");$(".pgpercent").each(function(pgcount){$(this).addClass("pgcount"+parseInt(pgcount+1));$(".carousel-menu-item-indicator-container .pgpercent.pgcount"+parseInt(pgcount+1)+" .carousel-menu-item-indicator-button-inner").css("width",$(".pgcount"+parseInt(pgcount+1)+" .page-level-progress-menu-item-indicator-bar").css("width"))})})}},onControlClick:function onControlClick(event){var index=$(event.currentTarget).hasClass("back")?parseInt(this.$el.attr("data-item-index"),10)-1:parseInt(this.$el.attr("data-item-index"),10)+1;var models=this.model.getAvailableChildModels();if(index>-1&&index<models.length){this.setItem(models[index].get("_id"),index)}if($(event.currentTarget).hasClass("next")){if(index==models.length){$(".carousel-menu").attr("data-item-index",models.length)}}},onHome:function onHome(){$(".carousel-menu").attr("data-item-index","0")},homeOver:function homeOver(){$(".carousel-menu-item[data-adapt-id=\"home\"] .menu-tooltip").css({"opacity":"1","-webkit-animation-name":"fadeInUp","animation-name":"fadeInUp"})},homeOut:function homeOut(){$(".carousel-menu-item[data-adapt-id=\"home\"] .menu-tooltip").css({"opacity":"0","-webkit-animation-name":"none","animation-name":"none"})},toolTip:function toolTip(){$(".tooltips6").css({"opacity":"0","display":"none","z-index":"-1"})},setBackgroundImage:function setBackgroundImage(){var config=this.model.get("_carouselMenu");var src=config&&config._backgroundSrc;if(src)this.$el.css("background-image","url("+src+")")},setUpItems:function setUpItems(){var items=this.model.getAvailableChildModels();var $items=this.$(".carousel-menu-item-container");var $indicators=this.$(".carousel-menu-item-indicator-container");for(var i=0,j=items.length;i<j;i++){var options={model:items[i]};$items.append(new CarouselMenuItemView(options).$el);$indicators.append(new CarouselMenuItemIndicatorView(options).$el)}},getNextIncompleteItem:function getNextIncompleteItem(){var models=this.model.getAvailableChildModels();var id=this.model.get("_coverId")||Adapt.offlineStorage.get("coverId");var index=_.findIndex(models,function(model){return model.get("_id")===id});if(index===-1)index=0;for(var i=index,j=models;i<j;i++){var model=models[i];if(!model.get("_isComplete"))return{id:model.get("_id"),index:i}}return{id:id,index:parseInt(index+1)}},scroll:function scroll(){var $item=this.$(".carousel-menu-item").filter("[data-adapt-id='"+this.model.get("_coverId")+"']");if(Adapt.device.screenSize=="large")Adapt.scrollTo($item)}},{template:"carouselMenu"});Adapt.on("router:menu",function(model){$("#wrapper").append(new CarouselMenuView({model:model}).$el)})});define("menu/adapt-contrib-boxMenu/js/adapt-contrib-boxMenuItemView",["core/js/views/menuItemView"],function(MenuItemView){var BoxMenuItemView=MenuItemView.extend({events:{"click .js-btn-click":"onClickMenuItemButton"},onClickMenuItemButton:function onClickMenuItemButton(event){if(event&&event.preventDefault)event.preventDefault();if(this.model.get("_isLocked"))return;Backbone.history.navigate("#/id/"+this.model.get("_id"),{trigger:true})}},{className:"boxmenu-item",template:"boxMenuItem"});return BoxMenuItemView});define("menu/adapt-contrib-boxMenu/js/adapt-contrib-boxMenuGroupView",["core/js/views/menuItemView","./adapt-contrib-boxMenuItemView"],function(MenuItemView,BoxMenuItemView){var BoxMenuGroupView=MenuItemView.extend({postRender:function postRender(){_.defer(this.addChildren.bind(this));this.$el.imageready(this.setReadyStatus.bind(this));this.$el.parents(".boxmenu__item-container").addClass("has-groups")}},{childContainer:".js-group-children",childView:BoxMenuItemView,className:"boxmenu-group",template:"boxMenuGroup"});return BoxMenuGroupView});define("menu/adapt-contrib-boxMenu/js/adapt-contrib-boxMenu",["core/js/adapt","core/js/models/menuModel","core/js/views/menuView","./adapt-contrib-boxMenuItemView","./adapt-contrib-boxMenuGroupView"],function(Adapt,MenuModel,MenuView,BoxMenuItemView,BoxMenuGroupView){var BoxMenuView=MenuView.extend({initialize:function initialize(){MenuView.prototype.initialize.apply(this);this.setStyles();this.listenTo(Adapt,{"device:changed":this.onDeviceResize})},onDeviceResize:function onDeviceResize(){this.setStyles()},addChildren:function addChildren(){var nthChild=0;var models=this.model.getChildren().models;this.childViews={};models.forEach(function(model){if(!model.get("_isAvailable"))return;nthChild++;model.set("_nthChild",nthChild);var ChildView=model.get("_type")==="menu"&&model.get("_boxMenu")&&model.get("_boxMenu")._renderAsGroup?BoxMenuGroupView:BoxMenuItemView;var $parentContainer=this.$(this.constructor.childContainer);var childView=new ChildView({model:model});this.childViews[model.get("_id")]=childView;$parentContainer.append(childView.$el)}.bind(this))},setStyles:function setStyles(){this.setBackgroundImage();this.setBackgroundStyles();this.processHeader()},setBackgroundImage:function setBackgroundImage(){var config=this.model.get("_boxMenu");var backgroundImages=config&&config._backgroundImage;if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){this.$el.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{this.$el.removeClass("has-bg-image").css("background-image","")}},setBackgroundStyles:function setBackgroundStyles(){var config=this.model.get("_boxMenu");var styles=config&&config._backgroundStyles;if(!styles)return;this.$el.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},processHeader:function processHeader(){var config=this.model.get("_boxMenu");var header=config&&config._menuHeader;if(!header)return;var $header=this.$(".menu__header");this.setHeaderBackgroundImage(header,$header);this.setHeaderBackgroundStyles(header,$header);this.setHeaderMinimumHeight(header,$header)},setHeaderBackgroundImage:function setHeaderBackgroundImage(config,$header){var backgroundImages=config._backgroundImage;if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){$header.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{$header.removeClass("has-bg-image").css("background-image","")}},setHeaderBackgroundStyles:function setHeaderBackgroundStyles(config,$header){var styles=config._backgroundStyles;if(!styles)return;$header.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setHeaderMinimumHeight:function setHeaderMinimumHeight(config,$header){var minimumHeights=config._minimumHeights;if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){$header.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{$header.removeClass("has-min-height").css("min-height","")}}},{className:"boxmenu",template:"boxMenu"});Adapt.register("course menu",{view:BoxMenuView});Adapt.register("boxMenu",{view:BoxMenuView,model:MenuModel.extend({})})});define("menu/adapt-hotspotMenu/js/adapt-hotspotMenuItemView",["core/js/views/adaptView","core/js/adapt"],function(AdaptView,Adapt){var HotspotMenuItemView=AdaptView.extend({tagName:"button",className:function className(){var classes="hotspot-menu-item";var modelClasses=this.model.get("_classes");if(modelClasses)classes+=" "+modelClasses;if(this.isVisited())classes+=" visited";if(this.model.get("_isOptional"))classes+=" optional";if(this.model.get("_isComplete"))classes+=" completed";if(this.model.get("_isLocked"))classes+=" locked";return classes},events:{"click":"onClick"},postRender:function postRender(){this.setPosition();this.setReadyStatus()},setPosition:function setPosition(){var config=this.model.get("_hotspotMenu");if(config){this.$el.css({top:config._top+"%",left:config._left+"%"})}},onClick:function onClick(){if(!this.model.get("_isLocked")){Backbone.history.navigate("#/id/"+this.model.get("_id"),{trigger:true})}},isVisited:function isVisited(){if(this.model.get("_isVisited"))return true;var components=this.model.findDescendantModels("components");return components.some(function(component){return component.get("_isComplete")&&component.get("_isAvailable")&&!component.get("_isOptional")})}},{template:"hotspotMenuItem",type:"menu"});return HotspotMenuItemView});define("menu/adapt-hotspotMenu/js/adapt-hotspotMenu",["core/js/views/menuView","./adapt-hotspotMenuItemView","core/js/adapt"],function(MenuView,HotspotMenuItemView,Adapt){var HotspotMenuView=MenuView.extend({className:function className(){return MenuView.prototype.className.call(this)+" hotspot-menu"},postRender:function postRender(){this.setBackgroundImage();this.setUpItems();var nthChild=this.model.getAvailableChildModels();$(".hotspot-menu-item").each(function(u){$(this).attr("name","nth-child-"+parseInt(u+1)).addClass("nth-child-"+parseInt(u+1));$(".hotspot-menu-item[name=\"nth-child-"+parseInt(u+1)+"\"]").click(function(){$(".navpagenum").text("Page "+parseInt(u+1)+" of "+nthChild.length);$(".arianavpgnum").text("Page "+parseInt(u+1)+" of "+nthChild.length).attr("role","region").attr("tabindex","0").addClass("aria-label")})});if($(".navigation-inner button").is("#accessibility2toggle")){$(".navigation-back-button").addClass("hotspot-adjust")}else{}if($(".hotspot-menu .hotspot-menu-header div").hasClass("hotspot-menu-body")){console.log("Menu has body text!")}else{$(".hotspot-menu .hotspot-menu-header .hotspot-menu-title:not(.submenu-title)").css({"text-align":"center","width":"100%"})}if($(".navigation-back-button").hasClass("display-none")){var navtitle2=$(".hotspot-menu-title").text();$(".modulehead").html(navtitle2)}else{$(".location-menu .hotspot-menu").addClass("submenu-hotspot");$(".location-menu .hotspot-menu .hotspot-menu-header .hotspot-menu-title").addClass("submenu-title");$(".location-menu .hotspot-menu .hotspot-menu-header .hotspot-menu-body").addClass("submenu-body");var navtitle2=$(".hotspot-menu-title").text();$(".modulehead").html(navtitle2)}if($(".location-menu").hasClass("accessibility")){if($(".navigation-back-button").hasClass("display-none")){window.setTimeout(function(){$(".hotspot-menu-item.nth-child-1").trigger("click")},250)}else{window.setTimeout(function(){$(".hotspot-menu-item.nth-child-1").trigger("click");window.setTimeout(function(){$("head").prepend("<style>.accessibility .audio-controls .audio-inner button {display:none;}</style>");$(".hotspot-menu-item.nth-child-1").trigger("click")},250)},250)}}},setBackgroundImage:function setBackgroundImage(){var config=this.model.get("_hotspotMenu");var src=config&&config._backgroundSrc;if(src)this.$el.parent().css({"background-image":"url("+src+")","background-size":"cover","background-position":"center","background-repeat":"no-repeat"})},setUpItems:function setUpItems(){var items=this.model.getAvailableChildModels();var $items=this.$(".hotspot-menu-item-container");for(var i=0,j=items.length;i<j;i++){$items.append(new HotspotMenuItemView({model:items[i]}).$el)}}},{template:"hotspotMenu"});Adapt.on("router:menu",function(model){$("#wrapper").append(new HotspotMenuView({model:model}).$el)})});define("menu/adapt-scroll-sbermenu/js/adapt-contrib-scrollMenuItemView",["core/js/views/menuItemView"],function(MenuItemView){var BoxMenuItemView=MenuItemView.extend({events:{"click .viewtext":"onClickMenuItemButton"},onClickMenuItemButton:function onClickMenuItemButton(event){if(event&&event.preventDefault)event.preventDefault();if(this.model.get("_isLocked"))return;Backbone.history.navigate("#/id/"+this.model.get("_id"),{trigger:true})}},{className:"boxmenu-item",template:"boxMenuItem"});return BoxMenuItemView});define("menu/adapt-scroll-sbermenu/js/adapt-contrib-scrollMenu",["core/js/adapt","core/js/views/menuView","./adapt-contrib-scrollMenuItemView"],function(Adapt,MenuView,BoxMenuItemView){var BoxMenuView=MenuView.extend({initialize:function initialize(){MenuView.prototype.initialize.apply(this);this.setStyles();this.listenTo(Adapt,{"device:changed":this.onDeviceResize})},onDeviceResize:function onDeviceResize(){this.setStyles()},setStyles:function setStyles(){this.setBackgroundImage();this.setBackgroundStyles();this.processHeader()},setBackgroundImage:function setBackgroundImage(){var config=this.model.get("_sber-scrollMenu");var backgroundImages=config&&config._backgroundImage;if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){this.$el.find(".menu__info").addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{this.$el.find(".menu__info").removeClass("has-bg-image").css("background-image","")}},setBackgroundStyles:function setBackgroundStyles(){var config=this.model.get("_sber-scrollMenu");var styles=config&&config._backgroundStyles;if(!styles)return;this.$el.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},processHeader:function processHeader(){var config=this.model.get("_sber-scrollMenu");var header=config&&config._menuHeader;if(!header)return;var $header=this.$(".menu__info");this.setHeaderBackgroundImage(header,$header);this.setHeaderBackgroundStyles(header,$header);this.setHeaderMinimumHeight(header,$header)},setHeaderBackgroundImage:function setHeaderBackgroundImage(config,$header){var backgroundImages=config._backgroundImage;if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){$header.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{$header.removeClass("has-bg-image").css("background-image","")}},setHeaderBackgroundStyles:function setHeaderBackgroundStyles(config,$header){var styles=config._backgroundStyles;if(!styles)return;$header.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setHeaderMinimumHeight:function setHeaderMinimumHeight(config,$header){var minimumHeights=config._minimumHeights;if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){$header.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{$header.removeClass("has-min-height").css("min-height","")}}},{childView:BoxMenuItemView,className:"boxmenu",template:"boxMenu"});Adapt.on("router:menu",function(model){$("#wrapper").append(new BoxMenuView({model:model}).$el)})});define("menu/adapt-tilesMenu/js/adapt-tilesmenu",["core/js/adapt","core/js/views/menuView","core/js/views/menuItemView"],function(Adapt,MenuView,MenuItemView){var BoxMenuView=MenuView.extend({className:function className(){return MenuView.prototype.className.apply(this)+" tilesmenu-menu"},postRender:function postRender(){var nthChild=0;this.model.getChildren().each(function(item){if(item.get("_isAvailable")&&!item.get("_isHidden")){item.set("_nthChild",++nthChild);this.$(".menu-tile-items").append(new BoxMenuItemView({model:item}).$el)}if(item.get("_isHidden")){item.set("_isReady",true)}});$(".menu-item").each(function(i){$(this).attr("name","nth-child-"+parseInt(i+1));$(this).find(".menu-item-button").attr("data-content",++i);$(".menu-item-button[data-content=\""+i+"\"]").click(function(){$(".navpagenum").text("Page "+i+" of "+nthChild);$(".arianavpgnum").text("Page "+i+" of "+nthChild).attr("role","region").attr("tabindex","0").addClass("aria-label")});$(".menu-item-button[data-content=\""+i+"\"] .origbutton ul").replaceWith(function(){return $("<p />",{html:$(this).html()})});$(".menu-item-button[data-content=\""+i+"\"] .origbutton ol").replaceWith(function(){return $("<p />",{html:$(this).html()})});$(".menu-item-button[data-content=\""+i+"\"] .origbutton").find("table").wrap("<p></p>");var myPtag=$(".menu-item-button[data-content=\""+i+"\"] .origbutton").find("p:first");var howmanyPtag=$(".menu-item-button[data-content=\""+i+"\"] .origbutton").find("p");if(myPtag.text().length>=200||howmanyPtag.length>1){$(".menu-item-button[data-content=\""+i+"\"] .origbutton p:first").addClass("myPtag").html($(".menu-item-button[data-content=\""+i+"\"] .origbutton p:first").html().substring(0,200)+" ...<br/>"+"<div id=\"tilemenupopup\">+ Read more</div>")}else{$(".menu-item-button[data-content=\""+i+"\"] .origbutton p:first").addClass("myPtag")}});if($(".navigation-back-button").hasClass("display-none")){var navtitle2=$(".menu-title-inner").text();Adapt.offlineStorage.set("mycourseTitle",navtitle2);var courseholder=Adapt.offlineStorage.get("mycourseTitle")}else{$(".tilesmenu-menu .menu-container-inner .menu-header .menu-header-inner .menu-title").addClass("submenu-title");$(".tilesmenu-menu .menu-container-inner .menu-header .menu-header-inner .menu-body").addClass("submenu-body");var navtitle2=$(".menu-title-inner").text();Adapt.offlineStorage.set("mycourseTitle",navtitle2);var courseholder=Adapt.offlineStorage.get("mycourseTitle")}if($(".location-menu").hasClass("accessibility")){if($(".navigation-back-button").hasClass("display-none")){window.setTimeout(function(){$(".nth-child-1 .viewtext").trigger("click")},250)}else{window.setTimeout(function(){$(".nth-child-1 .viewtext").trigger("click");window.setTimeout(function(){$("head").prepend("<style>.accessibility .audio-controls .audio-inner button {display:none;}</style>");$(".nth-child-1 .viewtext").trigger("click")},250)},250)}}}},{template:"tilesmenu"});var BoxMenuItemView=MenuView.extend({events:{"click .viewtext":"onClickMenuItemButton","click #tilemenupopup":"menunotifyPopup"},className:function className(){var nthChild=this.model.get("_nthChild");return["menu-item","menu-item-"+this.model.get("_id"),this.model.get("_classes"),this.model.get("_isVisited")?"visited":"",this.model.get("_isComplete")?"completed":"",this.model.get("_isLocked")?"locked":"","nth-child-"+nthChild,nthChild%2===0?"nth-child-even":"nth-child-odd"].join(" ")},preRender:function preRender(){this.model.checkCompletionStatus();this.model.checkInteractionCompletionStatus()},postRender:function postRender(){var graphic=this.model.get("_graphic");var nthChild=this.model.get("_nthChild");if(graphic&&graphic.src){this.$el.imageready(this.setReadyStatus.bind(this));return}this.setReadyStatus()},onClickMenuItemButton:function onClickMenuItemButton(event){if(event&&event.preventDefault)event.preventDefault();if(this.model.get("_isLocked"))return;Backbone.history.navigate("#/id/"+this.model.get("_id"),{trigger:true})},menunotifyPopup:function menunotifyPopup(event){event.preventDefault();this.model.set("_active",false);var bodyText=this.model.get("body");var titleText=this.model.get("displayTitle");var popupObject={title:titleText,body:bodyText};Adapt.trigger("notify:popup",popupObject)}},{template:"tilesmenu-item"});Adapt.on("router:menu",function(model){$("#wrapper").append(new BoxMenuView({model:model}).$el)})});define("theme/adapt-contrib-vanilla/js/themeView",["core/js/adapt"],function(Adapt){var ThemeView=Backbone.View.extend({className:function className(){},initialize:function initialize(){this.setStyles();this.listenTo(Adapt,{"device:changed":this.onDeviceResize,"remove":this.remove})},onDeviceResize:function onDeviceResize(){this.setStyles()},remove:function remove(){Backbone.View.prototype.remove.call(this);this.onRemove()},setStyles:function setStyles(){this.setClasses();this.setBackgroundImage();this.setBackgroundStyles();this.setMinimumHeight();this.setCustomStyles()},setClasses:function setClasses(){this.$el.addClass(this.className())},setBackgroundImage:function setBackgroundImage(){var backgroundImages=this.model.get("_backgroundImage");if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){this.$el.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{this.$el.removeClass("has-bg-image").css("background-image","")}},setBackgroundStyles:function setBackgroundStyles(){var styles=this.model.get("_backgroundStyles");if(!styles)return;this.$el.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setMinimumHeight:function setMinimumHeight(){var minimumHeights=this.model.get("_minimumHeights");if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){this.$el.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{this.$el.removeClass("has-min-height").css("min-height","")}},setCustomStyles:function setCustomStyles(){},onRemove:function onRemove(){}});return ThemeView});define("theme/adapt-contrib-vanilla/js/themePageView",["./themeView","core/js/adapt"],function(ThemeView,Adapt){var ThemePageView=ThemeView.extend({className:function className(){},setCustomStyles:function setCustomStyles(){this.processHeader()},processHeader:function processHeader(){var header=this.model.get("_pageHeader");if(!header)return;var $header=this.$(".page__header");this.setHeaderBackgroundImage(header,$header);this.setHeaderBackgroundStyles(header,$header);this.setHeaderMinimumHeight(header,$header)},setHeaderBackgroundImage:function setHeaderBackgroundImage(config,$header){var backgroundImages=config._backgroundImage;if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){$header.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{$header.removeClass("has-bg-image").css("background-image","")}},setHeaderBackgroundStyles:function setHeaderBackgroundStyles(config,$header){var styles=config._backgroundStyles;if(!styles)return;$header.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setHeaderMinimumHeight:function setHeaderMinimumHeight(config,$header){var minimumHeights=config._minimumHeights;if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){$header.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{$header.removeClass("has-min-height").css("min-height","")}},onRemove:function onRemove(){}});return ThemePageView});define("theme/adapt-contrib-vanilla/js/themeArticleView",["./themeView","core/js/adapt"],function(ThemeView,Adapt){var ThemeArticleView=ThemeView.extend({className:function className(){},setCustomStyles:function setCustomStyles(){},onRemove:function onRemove(){}});return ThemeArticleView});define("theme/adapt-contrib-vanilla/js/themeBlockView",["./themeView","core/js/adapt"],function(ThemeView,Adapt){var ThemeBlockView=ThemeView.extend({className:function className(){return this.model.get("_isDividerBlock")?"is-divider-block":""},setCustomStyles:function setCustomStyles(){},onRemove:function onRemove(){}});return ThemeBlockView});define("theme/adapt-contrib-vanilla/js/theme",["core/js/adapt","./themePageView","./themeArticleView","./themeBlockView","./themeView"],function(Adapt,ThemePageView,ThemeArticleView,ThemeBlockView,ThemeView){function onDataReady(){$("html").addClass(Adapt.course.get("_courseStyle"))}function onPostRender(view){var model=view.model;var theme=model.get("_vanilla");if(!theme)return;switch(model.get("_type")){case"page":new ThemePageView({model:new Backbone.Model(theme),el:view.$el});break;case"article":new ThemeArticleView({model:new Backbone.Model(theme),el:view.$el});break;case"block":new ThemeBlockView({model:new Backbone.Model(theme),el:view.$el});break;default:new ThemeView({model:new Backbone.Model(theme),el:view.$el});}}Adapt.on({"app:dataReady":onDataReady,"pageView:postRender articleView:postRender blockView:postRender":onPostRender})});define("theme/adapt-sber-vanilla/js/themeView",["core/js/adapt"],function(Adapt){var ThemeView=Backbone.View.extend({className:function className(){},initialize:function initialize(){this.setStyles();this.listenTo(Adapt,{"device:changed":this.onDeviceResize,"remove":this.remove})},onDeviceResize:function onDeviceResize(){this.setStyles()},remove:function remove(){Backbone.View.prototype.remove.call(this);this.onRemove()},setStyles:function setStyles(){this.setClasses();this.setBackgroundImage();this.setBackgroundStyles();this.setMinimumHeight();this.setCustomStyles()},setClasses:function setClasses(){this.$el.addClass(this.className())},setBackgroundImage:function setBackgroundImage(){var backgroundImages=this.model.get("_backgroundImage");if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){this.$el.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{this.$el.removeClass("has-bg-image").css("background-image","")}},setBackgroundStyles:function setBackgroundStyles(){var styles=this.model.get("_backgroundStyles");if(!styles)return;this.$el.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setMinimumHeight:function setMinimumHeight(){var minimumHeights=this.model.get("_minimumHeights");if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){this.$el.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{this.$el.removeClass("has-min-height").css("min-height","")}},setCustomStyles:function setCustomStyles(){},onRemove:function onRemove(){}});return ThemeView});define("theme/adapt-sber-vanilla/js/themePageView",["./themeView","core/js/adapt"],function(ThemeView,Adapt){var ThemePageView=ThemeView.extend({className:function className(){},setCustomStyles:function setCustomStyles(){this.processHeader()},processHeader:function processHeader(){var header=this.model.get("_pageHeader");if(!header)return;var $header=this.$(".page__header");this.setHeaderBackgroundImage(header,$header);this.setHeaderBackgroundStyles(header,$header);this.setHeaderMinimumHeight(header,$header)},setHeaderBackgroundImage:function setHeaderBackgroundImage(config,$header){var backgroundImages=config._backgroundImage;if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){$header.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{$header.removeClass("has-bg-image").css("background-image","")}},setHeaderBackgroundStyles:function setHeaderBackgroundStyles(config,$header){var styles=config._backgroundStyles;if(!styles)return;$header.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setHeaderMinimumHeight:function setHeaderMinimumHeight(config,$header){var minimumHeights=config._minimumHeights;if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){$header.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{$header.removeClass("has-min-height").css("min-height","")}},onRemove:function onRemove(){}});return ThemePageView});define("theme/adapt-sber-vanilla/js/themeArticleView",["./themeView","core/js/adapt"],function(ThemeView,Adapt){var ThemeArticleView=ThemeView.extend({className:function className(){},setCustomStyles:function setCustomStyles(){},onRemove:function onRemove(){}});return ThemeArticleView});define("theme/adapt-sber-vanilla/js/themeBlockView",["./themeView","core/js/adapt"],function(ThemeView,Adapt){var ThemeBlockView=ThemeView.extend({className:function className(){return this.model.get("_isDividerBlock")?"is-divider-block":""},setCustomStyles:function setCustomStyles(){},onRemove:function onRemove(){}});return ThemeBlockView});define("theme/adapt-sber-vanilla/js/theme",["core/js/adapt","./themePageView","./themeArticleView","./themeBlockView","./themeView"],function(Adapt,ThemePageView,ThemeArticleView,ThemeBlockView,ThemeView){function onDataReady(){$("html").addClass(Adapt.course.get("_courseStyle"))}function onPostRender(view){var model=view.model;var theme=model.get("_sber-vanilla");if(!theme)return;switch(model.get("_type")){case"page":new ThemePageView({model:new Backbone.Model(theme),el:view.$el});break;case"article":new ThemeArticleView({model:new Backbone.Model(theme),el:view.$el});break;case"block":new ThemeBlockView({model:new Backbone.Model(theme),el:view.$el});break;default:new ThemeView({model:new Backbone.Model(theme),el:view.$el});}}Adapt.on({"app:dataReady":onDataReady,"pageView:postRender articleView:postRender blockView:postRender":onPostRender})});;define("plugins",["components/adapt-before-and-after/js/adapt-before-and-after","components/adapt-blinds/js/adapt-blinds","components/adapt-contrib-accordion/js/adapt-contrib-accordion","components/adapt-contrib-assessmentResults/js/adapt-contrib-assessmentResults","components/adapt-contrib-blank/js/adapt-contrib-blank","components/adapt-contrib-flipcard/js/adapt-contrib-flipcard","components/adapt-contrib-glossary/js/adapt-contrib-glossary","components/adapt-contrib-gmcq/js/adapt-contrib-gmcq","components/adapt-contrib-graphic/js/adapt-contrib-graphic","components/adapt-contrib-hotgraphic/js/adapt-contrib-hotgraphic","components/adapt-contrib-imgMagnify/js/adapt-contrib-imgMagnify","components/adapt-contrib-matching/js/adapt-contrib-matching","components/adapt-contrib-mcq/js/adapt-contrib-mcq","components/adapt-contrib-media/js/adapt-contrib-media","components/adapt-contrib-MultipleNotify/js/adapt-contrib-MultipleNotify","components/adapt-contrib-narrative/js/adapt-contrib-narrative","components/adapt-contrib-reveal/js/adapt-contrib-reveal","components/adapt-contrib-slider/js/adapt-contrib-slider","components/adapt-contrib-text/js/adapt-contrib-text","components/adapt-contrib-textInput/js/adapt-contrib-textInput","components/adapt-dragndrop/js/adapt-dragndrop","components/adapt-dragndropwithimage/js/adapt-dragndropwithimage","components/adapt-iframe/js/adapt-iframe","components/adapt-imageSlider/js/adapt-image-slider","components/adapt-list/js/adapt-list","components/adapt-notify-imagegrid/js/adapt-notify-imagegrid","components/adapt-pageNav/js/adapt-pageNav","components/adapt-ppq/js/adapt-ppq","components/adapt-stacklist/js/adapt-stacklist","components/adapt-tabs/js/adapt-tabs","components/adapt-timed-mcq/js/adapt-timed-mcq","extensions/adapt-aboutUs/js/adapt-aboutUs","extensions/adapt-articleBlockSlider/js/articleBlockSlider","extensions/adapt-close/js/adapt-close","extensions/adapt-contrib-assessment/js/adapt-assessmentArticleExtension","extensions/adapt-contrib-bookmarking/js/adapt-contrib-bookmarking","extensions/adapt-contrib-contentObjectTransition/js/adapt-contrib-contentObjectTransition","extensions/adapt-contrib-languagePicker/js/adapt-languagePicker","extensions/adapt-contrib-pageLevelProgress/js/adapt-contrib-pageLevelProgress","extensions/adapt-contrib-resources/js/adapt-contrib-resources","extensions/adapt-contrib-spoor/js/adapt-contrib-spoor","extensions/adapt-contrib-trickle/js/adapt-contrib-trickle","extensions/adapt-contrib-tutor/js/adapt-contrib-tutor","extensions/adapt-contrib-xapi/js/index","extensions/adapt-devtools/js/adapt-devtools","extensions/adapt-homeButton/js/adapt-homeButton","extensions/adapt-keepScrollPosition/js/adapt-keepScrollPosition","extensions/adapt-navigationLogo/js/adapt-navigationLogo","extensions/adapt-navigationTitle/js/adapt-navigationTitle","extensions/adapt-pageIncompletePrompt/js/adapt-pageIncompletePrompt","extensions/adapt-search/js/adapt-search","extensions/adapt-submitAll/js/adapt-submitAll","menu/adapt-carousel-menu/js/adapt-carousel-menu","menu/adapt-contrib-boxMenu/js/adapt-contrib-boxMenu","menu/adapt-hotspotMenu/js/adapt-hotspotMenu","menu/adapt-scroll-sbermenu/js/adapt-contrib-scrollMenu","menu/adapt-tilesMenu/js/adapt-tilesmenu","theme/adapt-contrib-vanilla/js/theme","theme/adapt-sber-vanilla/js/theme"],function(){});require(["core/js/adapt","core/js/templates","core/js/fixes","core/js/accessibility","core/js/data","core/js/offlineStorage","core/js/logging","core/js/tracking","core/js/device","core/js/drawer","core/js/notify","core/js/router","core/js/models/lockingModel","core/js/mpabc","core/js/helpers","core/js/scrolling","core/js/headings","core/js/navigation","plugins"],function(Adapt){$("body").append(Handlebars.templates.loading());Adapt.data.on("ready",function triggerInit(){Adapt.log.debug("Calling Adapt.init");Adapt.init();Adapt.off("adaptCollection:dataLoaded courseModel:dataLoaded")}).init()});define("core/js/app",function(){});
